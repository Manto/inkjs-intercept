{"firstLayout":"Main","gdVersion":{"build":99,"major":4,"minor":0,"revision":0},"properties":{"adaptGameResolutionAtRuntime":true,"antialiasingMode":"MSAA","antialisingEnabledOnMobile":false,"folderProject":false,"orientation":"landscape","packageName":"com.example.gamename","pixelsRounding":false,"projectUuid":"a2e62760-3098-401a-a0e8-9d70c5ebe4c0","scaleMode":"nearest","sizeOnStartupMode":"adaptWidth","templateSlug":"","useExternalSourceFiles":false,"version":"1.0.0","name":"Hanging Desire","description":"","author":"","windowWidth":1920,"windowHeight":1080,"latestCompilationDirectory":"","maxFPS":60,"minFPS":20,"verticalSync":false,"platformSpecificAssets":{},"loadingScreen":{"backgroundColor":0,"backgroundFadeInDuration":0.2,"backgroundImageResourceName":"","gdevelopLogoStyle":"light","logoAndProgressFadeInDuration":0.2,"logoAndProgressLogoFadeInDelay":0.2,"minDuration":1.5,"progressBarColor":16777215,"progressBarHeight":20.0,"progressBarMaxWidth":200.0,"progressBarMinWidth":40.0,"progressBarWidthPercent":30.0,"showGDevelopSplash":true,"showProgressBar":true},"watermark":{"placement":"bottom-left","showWatermark":true},"authorIds":[],"authorUsernames":[],"categories":[],"playableDevices":[],"extensionProperties":[],"platforms":[{"name":"GDevelop JS platform"}],"currentPlatform":"GDevelop JS platform"},"resources":{"resources":[{"file":"assets/Roboto-Bold.ttf","kind":"font","metadata":"","name":"3bd40ac788d44626fd640ec67ef04ab0364816b5e8c831f2077bff8805cfe689_Roboto-Bold.ttf","userAdded":false,"origin":{"identifier":"https://asset-resources.gdevelop.io/public-resources/Open Font License/3bd40ac788d44626fd640ec67ef04ab0364816b5e8c831f2077bff8805cfe689_Roboto-Bold.ttf","name":"gdevelop-asset-store"}},{"alwaysLoaded":false,"file":"assets/Blue Button_Hovered.png","kind":"image","metadata":"","name":"Blue Button_Hovered.png","smoothed":false,"userAdded":false,"origin":{"identifier":"https://asset-resources.gdevelop.io/public-resources/Menu buttons/1ffd07cb739df2a909155dd3057f6def46b833ced6ef1a09527b6ea59e88e464_Blue Button_Hovered.png","name":"Blue Button_Hovered.png"}},{"alwaysLoaded":false,"file":"assets/Blue Button_Idle.png","kind":"image","metadata":"","name":"Blue Button_Idle.png","smoothed":false,"userAdded":false,"origin":{"identifier":"https://asset-resources.gdevelop.io/public-resources/Menu buttons/eeac55458b66fb84f756b38085fbf7d1e079c39363c942abd35ea9d0939465ce_Blue Button_Idle.png","name":"Blue Button_Idle.png"}},{"alwaysLoaded":false,"file":"assets/Blue Button_Pressed.png","kind":"image","metadata":"","name":"Blue Button_Pressed.png","smoothed":false,"userAdded":false,"origin":{"identifier":"https://asset-resources.gdevelop.io/public-resources/Menu buttons/f0ede8843d544f6e84bc09299a8aabffbce558966f25af98f7b47ab1648217ce_Blue Button_Pressed.png","name":"Blue Button_Pressed.png"}},{"disablePreload":false,"file":"story.json","kind":"json","metadata":"","name":"story.json","userAdded":true},{"disablePreload":false,"file":"test.json","kind":"json","metadata":"","name":"test.json","userAdded":true}],"resourceFolders":[]},"objects":[],"objectsGroups":[],"variables":[],"layouts":[{"b":209,"disableInputWhenNotFocused":true,"mangledName":"Main","name":"Main","r":209,"standardSortMethod":true,"stopSoundsOnStartup":true,"title":"","v":209,"uiSettings":{"grid":false,"gridType":"rectangular","gridWidth":32.0,"gridHeight":32.0,"gridOffsetX":0.0,"gridOffsetY":0.0,"gridColor":10401023.0,"gridAlpha":0.8,"snap":false,"zoomFactor":0.546875,"windowMask":false},"objectsGroups":[],"variables":[{"folded":true,"name":"CurrentStoryJson","type":"structure","children":[]}],"instances":[{"angle":0.0,"customSize":false,"height":0.0,"layer":"","name":"Label","persistentUuid":"887eb3bc-dfe0-4241-8029-5ea3895ce9b9","width":0.0,"x":55.0,"y":46.0,"zOrder":1,"numberProperties":[],"stringProperties":[],"initialVariables":[]},{"angle":0.0,"customSize":true,"depth":32.0,"height":122.0,"layer":"","name":"LoadStoryButton","persistentUuid":"bbaa1cc4-b8ea-4f0e-92fa-4f77b52fa760","width":393.0,"x":311.0,"y":23.0,"zOrder":3,"numberProperties":[],"stringProperties":[],"initialVariables":[]}],"objects":[{"assetStoreId":"","bold":true,"italic":false,"name":"Label","smoothed":true,"tags":"","type":"TextObject::Text","underlined":false,"variables":[],"effects":[],"behaviors":[],"string":"InkJs Test","font":"3bd40ac788d44626fd640ec67ef04ab0364816b5e8c831f2077bff8805cfe689_Roboto-Bold.ttf","textAlignment":"left","characterSize":50.0,"color":{"b":0,"g":0,"r":0}},{"assetStoreId":"","name":"NewBBText","tags":"","type":"BBText::BBText","variables":[],"effects":[],"behaviors":[],"content":{"text":"Log goes here","opacity":255,"fontSize":24,"visible":true,"color":"0;0;0","fontFamily":"3bd40ac788d44626fd640ec67ef04ab0364816b5e8c831f2077bff8805cfe689_Roboto-Bold.ttf","align":"left","wordWrap":true}},{"assetStoreId":"90d94b6e3a23c34948e59eaaef4679740f8ab588696d59b21e0c0c2ef106b94d","name":"LoadStoryButton","tags":"","type":"PanelSpriteButton::PanelSpriteButton","variables":[],"effects":[],"behaviors":[],"content":{"LeftPadding":16.0,"RightPadding":16.0,"PressedLabelOffsetY":10.0,"BottomPadding":32.0,"TopPadding":16.0,"HoveredFadeOutDuration":0.25},"childrenContent":{"Hovered":{"bottomMargin":32.0,"height":106.0,"leftMargin":16.0,"rightMargin":16.0,"texture":"Blue Button_Hovered.png","tiled":true,"topMargin":16.0,"width":256.0},"Idle":{"bottomMargin":32.0,"height":106.0,"leftMargin":16.0,"rightMargin":16.0,"texture":"Blue Button_Idle.png","tiled":true,"topMargin":16.0,"width":256.0},"Label":{"bold":false,"italic":false,"smoothed":true,"underlined":false,"string":"Load Story!","font":"","textAlignment":"center","characterSize":60.0,"color":{"b":99,"g":69,"r":28}},"Pressed":{"bottomMargin":16.0,"height":106.0,"leftMargin":16.0,"rightMargin":16.0,"texture":"Blue Button_Pressed.png","tiled":true,"topMargin":32.0,"width":256.0}}}],"events":[{"type":"BuiltinCommonInstructions::Standard","conditions":[{"type":{"value":"PanelSpriteButton::PanelSpriteButton::IsClicked"},"parameters":["LoadStoryButton",""]}],"actions":[{"type":{"value":"InkJs::LoadStory"},"parameters":["","story.json",""]}]}],"layers":[{"ambientLightColorB":200,"ambientLightColorG":200,"ambientLightColorR":200,"camera3DFarPlaneDistance":10000.0,"camera3DFieldOfView":45.0,"camera3DNearPlaneDistance":0.1,"followBaseLayerCamera":false,"isLightingLayer":false,"isLocked":false,"name":"","renderingType":"","visibility":true,"cameras":[{"defaultSize":true,"defaultViewport":true,"height":0.0,"viewportBottom":1.0,"viewportLeft":0.0,"viewportRight":1.0,"viewportTop":0.0,"width":0.0}],"effects":[]}],"behaviorsSharedData":[]}],"externalEvents":[],"eventsFunctionsExtensions":[{"author":"","category":"","extensionNamespace":"","fullName":"InkJs","helpPath":"","iconUrl":"","name":"InkJs","previewIconUrl":"","shortDescription":"InkJs Integration","version":"0.1.0","description":"","tags":[],"authorIds":[],"dependencies":[],"eventsFunctions":[{"fullName":"","functionType":"Action","name":"onFirstSceneLoaded","sentence":"","events":[{"type":"BuiltinCommonInstructions::JsCode","inlineCode":["gdjs.evtTools.inkjs = {","    currentStoryData: null,","    currentStory: null,","    logger: null","};","","gdjs.evtTools.inkjs.logger = new gdjs.Logger('InkJs')","gdjs.evtTools.inkjs.logger.info(\"Initializing InkJs extension...\")","","!function(t,e){\"object\"==typeof exports&&\"undefined\"!=typeof module?e(exports):\"function\"==typeof define&&define.amd?define([\"exports\"],e):e((t=\"undefined\"!=typeof globalThis?globalThis:t||self).inkjs={})}(this,(function(t){\"use strict\";function e(t){return e=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&\"function\"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?\"symbol\":typeof t},e(t)}function n(t,e){if(!(t instanceof e))throw new TypeError(\"Cannot call a class as a function\")}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,\"value\"in i&&(i.writable=!0),Object.defineProperty(t,(r=i.key,a=void 0,\"symbol\"==typeof(a=function(t,e){if(\"object\"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||\"default\");if(\"object\"!=typeof i)return i;throw new TypeError(\"@@toPrimitive must return a primitive value.\")}return(\"string\"===e?String:Number)(t)}(r,\"string\"))?a:String(a)),i)}var r,a}function r(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),Object.defineProperty(t,\"prototype\",{writable:!1}),t}function a(t,e){if(\"function\"!=typeof e&&null!==e)throw new TypeError(\"Super expression must either be null or a function\");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,\"prototype\",{writable:!1}),e&&o(t,e)}function s(t){return s=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},s(t)}function o(t,e){return o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},o(t,e)}function u(){if(\"undefined\"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if(\"function\"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function l(t,e,n){return l=u()?Reflect.construct.bind():function(t,e,n){var i=[null];i.push.apply(i,e);var r=new(Function.bind.apply(t,i));return n&&o(r,n.prototype),r},l.apply(null,arguments)}function h(t){var e=\"function\"==typeof Map?new Map:void 0;return h=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf(\"[native code]\")))return t;var n;if(\"function\"!=typeof t)throw new TypeError(\"Super expression must either be null or a function\");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,i)}function i(){return l(t,arguments,s(this).constructor)}return i.prototype=Object.create(t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),o(i,t)},h(t)}function c(t){if(void 0===t)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return t}function f(t,e){if(e&&(\"object\"==typeof e||\"function\"==typeof e))return e;if(void 0!==e)throw new TypeError(\"Derived constructors may only return object or undefined\");return c(t)}function v(t){var e=u();return function(){var n,i=s(t);if(e){var r=s(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return f(this,n)}}function d(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:\"undefined\"!=typeof Symbol&&t[Symbol.iterator]||t[\"@@iterator\"];if(null!=n){var i,r,a,s,o=[],u=!0,l=!1;try{if(a=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(i=a.call(n)).done)&&(o.push(i.value),o.length!==e);u=!0);}catch(t){l=!0,r=t}finally{try{if(!u&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(l)throw r}}return o}}(t,e)||y(t,e)||function(){throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}()}function p(t){return function(t){if(Array.isArray(t))return m(t)}(t)||function(t){if(\"undefined\"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t[\"@@iterator\"])return Array.from(t)}(t)||y(t)||function(){throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}()}function y(t,e){if(t){if(\"string\"==typeof t)return m(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return\"Object\"===n&&t.constructor&&(n=t.constructor.name),\"Map\"===n||\"Set\"===n?Array.from(t):\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(t,e):void 0}}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function g(t,e){var n=\"undefined\"!=typeof Symbol&&t[Symbol.iterator]||t[\"@@iterator\"];if(!n){if(Array.isArray(t)||(n=y(t))||e&&t&&\"number\"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}var a,s=!0,o=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){o=!0,a=t},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw a}}}}var S,k=function(){function t(){if(n(this,t),this._components=[],this._componentsString=null,this._isRelative=!1,\"string\"==typeof arguments[0]){var e=arguments[0];this.componentsString=e}else if(arguments[0]instanceof t.Component&&arguments[1]instanceof t){var i=arguments[0],r=arguments[1];this._components.push(i),this._components=this._components.concat(r._components)}else if(arguments[0]instanceof Array){var a=arguments[0],s=!!arguments[1];this._components=this._components.concat(a),this._isRelative=s}}return r(t,[{key:\"isRelative\",get:function(){return this._isRelative}},{key:\"componentCount\",get:function(){return this._components.length}},{key:\"head\",get:function(){return this._components.length>0?this._components[0]:null}},{key:\"tail\",get:function(){return this._components.length>=2?new t(this._components.slice(1,this._components.length)):t.self}},{key:\"length\",get:function(){return this._components.length}},{key:\"lastComponent\",get:function(){var t=this._components.length-1;return t>=0?this._components[t]:null}},{key:\"containsNamedComponent\",get:function(){for(var t=0,e=this._components.length;t<e;t++)if(!this._components[t].isIndex)return!0;return!1}},{key:\"GetComponent\",value:function(t){return this._components[t]}},{key:\"PathByAppendingPath\",value:function(e){for(var n=new t,i=0,r=0;r<e._components.length&&e._components[r].isParent;++r)i++;for(var a=0;a<this._components.length-i;++a)n._components.push(this._components[a]);for(var s=i;s<e._components.length;++s)n._components.push(e._components[s]);return n}},{key:\"componentsString\",get:function(){return null==this._componentsString&&(this._componentsString=this._components.join(\".\"),this.isRelative&&(this._componentsString=\".\"+this._componentsString)),this._componentsString},set:function(e){if(this._components.length=0,this._componentsString=e,null!=this._componentsString&&\"\"!=this._componentsString){\".\"==this._componentsString[0]&&(this._isRelative=!0,this._componentsString=this._componentsString.substring(1));var n,i=g(this._componentsString.split(\".\"));try{for(i.s();!(n=i.n()).done;){var r=n.value;/^(\\-|\\+)?([0-9]+|Infinity)$/.test(r)?this._components.push(new t.Component(parseInt(r))):this._components.push(new t.Component(r))}}catch(t){i.e(t)}finally{i.f()}}}},{key:\"toString\",value:function(){return this.componentsString}},{key:\"Equals\",value:function(t){if(null==t)return!1;if(t._components.length!=this._components.length)return!1;if(t.isRelative!=this.isRelative)return!1;for(var e=0,n=t._components.length;e<n;e++)if(!t._components[e].Equals(this._components[e]))return!1;return!0}},{key:\"PathByAppendingComponent\",value:function(e){var n,i=new t;return(n=i._components).push.apply(n,p(this._components)),i._components.push(e),i}}],[{key:\"self\",get:function(){var e=new t;return e._isRelative=!0,e}}]),t}();function C(t,e){return t instanceof e?E(t):null}function b(t,e){if(t instanceof e)return E(t);throw new Error(\"\".concat(t,\" is not of type \").concat(e))}function w(t){return t.hasValidName&&t.name?t:null}function _(t){return void 0===t?null:t}function T(t){return\"object\"===e(t)&&\"function\"==typeof t.Equals}function E(t,e){return t}k.parentId=\"^\",function(t){var e=function(){function e(t){n(this,e),this.index=-1,this.name=null,\"string\"==typeof t?this.name=t:this.index=t}return r(e,[{key:\"isIndex\",get:function(){return this.index>=0}},{key:\"isParent\",get:function(){return this.name==t.parentId}},{key:\"toString\",value:function(){return this.isIndex?this.index.toString():this.name}},{key:\"Equals\",value:function(t){return null!=t&&t.isIndex==this.isIndex&&(this.isIndex?this.index==t.index:this.name==t.name)}}],[{key:\"ToParent\",value:function(){return new e(t.parentId)}}]),e}();t.Component=e}(k||(k={})),function(t){function e(t,e){if(!t)throw void 0!==e&&console.warn(e),console.trace&&console.trace(),new Error(\"\")}t.AssertType=function(t,n,i){e(t instanceof n,i)},t.Assert=e}(S||(S={}));var O=function(t){a(i,t);var e=v(i);function i(){return n(this,i),e.apply(this,arguments)}return r(i)}(h(Error));function P(t){throw new O(\"\".concat(t,\" is null or undefined\"))}var N=function(){function t(){n(this,t),this.parent=null,this._debugMetadata=null,this._path=null}return r(t,[{key:\"debugMetadata\",get:function(){return null===this._debugMetadata&&this.parent?this.parent.debugMetadata:this._debugMetadata},set:function(t){this._debugMetadata=t}},{key:\"ownDebugMetadata\",get:function(){return this._debugMetadata}},{key:\"DebugLineNumberOfPath\",value:function(t){if(null===t)return null;var e=this.rootContentContainer;if(e){var n=e.ContentAtPath(t).obj;if(n){var i=n.debugMetadata;if(null!==i)return i.startLineNumber}}return null}},{key:\"path\",get:function(){if(null==this._path)if(null==this.parent)this._path=new k;else{for(var t=[],e=this,n=C(e.parent,K);null!==n;){var i=w(e);if(null!=i&&i.hasValidName){if(null===i.name)return P(\"namedChild.name\");t.unshift(new k.Component(i.name))}else t.unshift(new k.Component(n.content.indexOf(e)));e=n,n=C(n.parent,K)}this._path=new k(t)}return this._path}},{key:\"ResolvePath\",value:function(t){if(null===t)return P(\"path\");if(t.isRelative){var e=C(this,K);return null===e&&(S.Assert(null!==this.parent,\"Can't resolve relative path because we don't have a parent\"),e=C(this.parent,K),S.Assert(null!==e,\"Expected parent to be a container\"),S.Assert(t.GetComponent(0).isParent),t=t.tail),null===e?P(\"nearestContainer\"):e.ContentAtPath(t)}var n=this.rootContentContainer;return null===n?P(\"contentContainer\"):n.ContentAtPath(t)}},{key:\"ConvertPathToRelative\",value:function(t){for(var e=this.path,n=Math.min(t.length,e.length),i=-1,r=0;r<n;++r){var a=e.GetComponent(r),s=t.GetComponent(r);if(!a.Equals(s))break;i=r}if(-1==i)return t;for(var o=e.componentCount-1-i,u=[],l=0;l<o;++l)u.push(k.Component.ToParent());for(var h=i+1;h<t.componentCount;++h)u.push(t.GetComponent(h));return new k(u,!0)}},{key:\"CompactPathString\",value:function(t){var e=null,n=null;t.isRelative?(n=t.componentsString,e=this.path.PathByAppendingPath(t).componentsString):(n=this.ConvertPathToRelative(t).componentsString,e=t.componentsString);return n.length<e.length?n:e}},{key:\"rootContentContainer\",get:function(){for(var t=this;t.parent;)t=t.parent;return C(t,K)}},{key:\"Copy\",value:function(){throw Error(\"Not Implemented: Doesn't support copying\")}},{key:\"SetChild\",value:function(t,e,n){t[e]&&(t[e]=null),t[e]=n,t[e]&&(t[e].parent=this)}},{key:\"Equals\",value:function(t){return t===this}}]),t}(),A=function(){function t(e){n(this,t),e=void 0!==e?e.toString():\"\",this.string=e}return r(t,[{key:\"Length\",get:function(){return this.string.length}},{key:\"Append\",value:function(t){null!==t&&(this.string+=t)}},{key:\"AppendLine\",value:function(t){void 0!==t&&this.Append(t),this.string+=\"\\n\"}},{key:\"AppendFormat\",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];this.string+=t.replace(/{(\\d+)}/g,(function(t,e){return void 0!==n[e]?n[e]:t}))}},{key:\"toString\",value:function(){return this.string}},{key:\"Clear\",value:function(){this.string=\"\"}}]),t}(),I=function(){function t(){if(n(this,t),this.originName=null,this.itemName=null,void 0!==arguments[1]){var e=arguments[0],i=arguments[1];this.originName=e,this.itemName=i}else if(arguments[0]){var r=arguments[0].toString().split(\".\");this.originName=r[0],this.itemName=r[1]}}return r(t,[{key:\"isNull\",get:function(){return null==this.originName&&null==this.itemName}},{key:\"fullName\",get:function(){return(null!==this.originName?this.originName:\"?\")+\".\"+this.itemName}},{key:\"toString\",value:function(){return this.fullName}},{key:\"Equals\",value:function(e){if(e instanceof t){var n=e;return n.itemName==this.itemName&&n.originName==this.originName}return!1}},{key:\"copy\",value:function(){return new t(this.originName,this.itemName)}},{key:\"serialized\",value:function(){return JSON.stringify({originName:this.originName,itemName:this.itemName})}}],[{key:\"Null\",get:function(){return new t(null,null)}},{key:\"fromSerializedKey\",value:function(e){var n=JSON.parse(e);if(!t.isLikeInkListItem(n))return t.Null;var i=n;return new t(i.originName,i.itemName)}},{key:\"isLikeInkListItem\",value:function(t){return\"object\"===e(t)&&(!(!t.hasOwnProperty(\"originName\")||!t.hasOwnProperty(\"itemName\"))&&((\"string\"==typeof t.originName||null===e(t.originName))&&(\"string\"==typeof t.itemName||null===e(t.itemName))))}}]),t}(),F=function(t){a(s,t);var i=v(s);function s(){var t,r=arguments;if(n(this,s),(t=i.call(this,r[0]instanceof s?r[0]:[])).origins=null,t._originNames=[],arguments[0]instanceof s){var a=arguments[0],o=a.originNames;null!==o&&(t._originNames=o.slice()),null!==a.origins&&(t.origins=a.origins.slice())}else if(\"string\"==typeof arguments[0]){var u=arguments[0],l=arguments[1];if(t.SetInitialOriginName(u),null===l.listDefinitions)return f(t,P(\"originStory.listDefinitions\"));var h=l.listDefinitions.TryListGetDefinition(u,null);if(!h.exists)throw new Error(\"InkList origin could not be found in story when constructing new list: \"+u);if(null===h.result)return f(t,P(\"def.result\"));t.origins=[h.result]}else if(\"object\"===e(arguments[0])&&arguments[0].hasOwnProperty(\"Key\")&&arguments[0].hasOwnProperty(\"Value\")){var c=arguments[0];t.Add(c.Key,c.Value)}return t}return r(s,[{key:\"AddItem\",value:function(t){if(t instanceof I){var e=t;if(null==e.originName)return void this.AddItem(e.itemName);if(null===this.origins)return P(\"this.origins\");var n,i=g(this.origins);try{for(i.s();!(n=i.n()).done;){var r=n.value;if(r.name==e.originName){var a=r.TryGetValueForItem(e,0);if(a.exists)return void this.Add(e,a.result);throw new Error(\"Could not add the item \"+e+\" to this list because it doesn't exist in the original list definition in ink.\")}}}catch(t){i.e(t)}finally{i.f()}throw new Error(\"Failed to add item to list because the item was from a new list definition that wasn't previously known to this list. Only items from previously known lists can be used, so that the int value can be found.\")}var s=t,o=null;if(null===this.origins)return P(\"this.origins\");var u,l=g(this.origins);try{for(l.s();!(u=l.n()).done;){var h=u.value;if(null===s)return P(\"itemName\");if(h.ContainsItemWithName(s)){if(null!=o)throw new Error(\"Could not add the item \"+s+\" to this list because it could come from either \"+h.name+\" or \"+o.name);o=h}}}catch(t){l.e(t)}finally{l.f()}if(null==o)throw new Error(\"Could not add the item \"+s+\" to this list because it isn't known to any list definitions previously associated with this list.\");var c=new I(o.name,s),f=o.ValueForItem(c);this.Add(c,f)}},{key:\"ContainsItemNamed\",value:function(t){var e,n=g(this);try{for(n.s();!(e=n.n()).done;){var i=d(e.value,1)[0];if(I.fromSerializedKey(i).itemName==t)return!0}}catch(t){n.e(t)}finally{n.f()}return!1}},{key:\"ContainsKey\",value:function(t){return this.has(t.serialized())}},{key:\"Add\",value:function(t,e){var n=t.serialized();if(this.has(n))throw new Error(\"The Map already contains an entry for \".concat(t));this.set(n,e)}},{key:\"Remove\",value:function(t){return this.delete(t.serialized())}},{key:\"Count\",get:function(){return this.size}},{key:\"originOfMaxItem\",get:function(){if(null==this.origins)return null;var t=this.maxItem.Key.originName,e=null;return this.origins.every((function(n){return n.name!=t||(e=n,!1)})),e}},{key:\"originNames\",get:function(){if(this.Count>0){null==this._originNames&&this.Count>0?this._originNames=[]:(this._originNames||(this._originNames=[]),this._originNames.length=0);var t,e=g(this);try{for(e.s();!(t=e.n()).done;){var n=d(t.value,1)[0],i=I.fromSerializedKey(n);if(null===i.originName)return P(\"item.originName\");this._originNames.push(i.originName)}}catch(t){e.e(t)}finally{e.f()}}return this._originNames}},{key:\"SetInitialOriginName\",value:function(t){this._originNames=[t]}},{key:\"SetInitialOriginNames\",value:function(t){this._originNames=null==t?null:t.slice()}},{key:\"maxItem\",get:function(){var t,e={Key:I.Null,Value:0},n=g(this);try{for(n.s();!(t=n.n()).done;){var i=d(t.value,2),r=i[0],a=i[1],s=I.fromSerializedKey(r);(e.Key.isNull||a>e.Value)&&(e={Key:s,Value:a})}}catch(t){n.e(t)}finally{n.f()}return e}},{key:\"minItem\",get:function(){var t,e={Key:I.Null,Value:0},n=g(this);try{for(n.s();!(t=n.n()).done;){var i=d(t.value,2),r=i[0],a=i[1],s=I.fromSerializedKey(r);(e.Key.isNull||a<e.Value)&&(e={Key:s,Value:a})}}catch(t){n.e(t)}finally{n.f()}return e}},{key:\"inverse\",get:function(){var t=new s;if(null!=this.origins){var e,n=g(this.origins);try{for(n.s();!(e=n.n()).done;){var i,r=g(e.value.items);try{for(r.s();!(i=r.n()).done;){var a=d(i.value,2),o=a[0],u=a[1],l=I.fromSerializedKey(o);this.ContainsKey(l)||t.Add(l,u)}}catch(t){r.e(t)}finally{r.f()}}}catch(t){n.e(t)}finally{n.f()}}return t}},{key:\"all\",get:function(){var t=new s;if(null!=this.origins){var e,n=g(this.origins);try{for(n.s();!(e=n.n()).done;){var i,r=g(e.value.items);try{for(r.s();!(i=r.n()).done;){var a=d(i.value,2),o=a[0],u=a[1],l=I.fromSerializedKey(o);t.set(l.serialized(),u)}}catch(t){r.e(t)}finally{r.f()}}}catch(t){n.e(t)}finally{n.f()}}return t}},{key:\"Union\",value:function(t){var e,n=new s(this),i=g(t);try{for(i.s();!(e=i.n()).done;){var r=d(e.value,2),a=r[0],o=r[1];n.set(a,o)}}catch(t){i.e(t)}finally{i.f()}return n}},{key:\"Intersect\",value:function(t){var e,n=new s,i=g(this);try{for(i.s();!(e=i.n()).done;){var r=d(e.value,2),a=r[0],o=r[1];t.has(a)&&n.set(a,o)}}catch(t){i.e(t)}finally{i.f()}return n}},{key:\"HasIntersection\",value:function(t){var e,n=g(this);try{for(n.s();!(e=n.n()).done;){var i=d(e.value,1)[0];if(t.has(i))return!0}}catch(t){n.e(t)}finally{n.f()}return!1}},{key:\"Without\",value:function(t){var e,n=new s(this),i=g(t);try{for(i.s();!(e=i.n()).done;){var r=d(e.value,1)[0];n.delete(r)}}catch(t){i.e(t)}finally{i.f()}return n}},{key:\"Contains\",value:function(t){if(\"string\"==typeof t)return this.ContainsItemNamed(t);var e=t;if(0==e.size||0==this.size)return!1;var n,i=g(e);try{for(i.s();!(n=i.n()).done;){var r=d(n.value,1)[0];if(!this.has(r))return!1}}catch(t){i.e(t)}finally{i.f()}return!0}},{key:\"GreaterThan\",value:function(t){return 0!=this.Count&&(0==t.Count||this.minItem.Value>t.maxItem.Value)}},{key:\"GreaterThanOrEquals\",value:function(t){return 0!=this.Count&&(0==t.Count||this.minItem.Value>=t.minItem.Value&&this.maxItem.Value>=t.maxItem.Value)}},{key:\"LessThan\",value:function(t){return 0!=t.Count&&(0==this.Count||this.maxItem.Value<t.minItem.Value)}},{key:\"LessThanOrEquals\",value:function(t){return 0!=t.Count&&(0==this.Count||this.maxItem.Value<=t.maxItem.Value&&this.minItem.Value<=t.minItem.Value)}},{key:\"MaxAsList\",value:function(){return this.Count>0?new s(this.maxItem):new s}},{key:\"MinAsList\",value:function(){return this.Count>0?new s(this.minItem):new s}},{key:\"ListWithSubRange\",value:function(t,e){if(0==this.Count)return new s;var n=this.orderedItems,i=0,r=Number.MAX_SAFE_INTEGER;Number.isInteger(t)?i=t:t instanceof s&&t.Count>0&&(i=t.minItem.Value),Number.isInteger(e)?r=e:t instanceof s&&t.Count>0&&(r=e.maxItem.Value);var a=new s;a.SetInitialOriginNames(this.originNames);var o,u=g(n);try{for(u.s();!(o=u.n()).done;){var l=o.value;l.Value>=i&&l.Value<=r&&a.Add(l.Key,l.Value)}}catch(t){u.e(t)}finally{u.f()}return a}},{key:\"Equals\",value:function(t){if(t instanceof s==!1)return!1;if(t.Count!=this.Count)return!1;var e,n=g(this);try{for(n.s();!(e=n.n()).done;){var i=d(e.value,1)[0];if(!t.has(i))return!1}}catch(t){n.e(t)}finally{n.f()}return!0}},{key:\"orderedItems\",get:function(){var t,e=new Array,n=g(this);try{for(n.s();!(t=n.n()).done;){var i=d(t.value,2),r=i[0],a=i[1],s=I.fromSerializedKey(r);e.push({Key:s,Value:a})}}catch(t){n.e(t)}finally{n.f()}return e.sort((function(t,e){return null===t.Key.originName?P(\"x.Key.originName\"):null===e.Key.originName?P(\"y.Key.originName\"):t.Value==e.Value?t.Key.originName.localeCompare(e.Key.originName):t.Value<e.Value?-1:t.Value>e.Value?1:0})),e}},{key:\"toString\",value:function(){for(var t=this.orderedItems,e=new A,n=0;n<t.length;n++){n>0&&e.Append(\", \");var i=t[n].Key;if(null===i.itemName)return P(\"item.itemName\");e.Append(i.itemName)}return e.toString()}},{key:\"valueOf\",value:function(){return NaN}}],[{key:\"FromString\",value:function(t,e){var n,i=null===(n=e.listDefinitions)||void 0===n?void 0:n.FindSingleItemListWithName(t);if(i)return null===i.value?P(\"listValue.value\"):new s(i.value);throw new Error(\"Could not find the InkListItem from the string '\"+t+\"' to create an InkList because it doesn't exist in the original list definition in ink.\")}}]),s}(h(Map)),x=function(t){a(i,t);var e=v(i);function i(t){var r;return n(this,i),(r=e.call(this,t)).useEndLineNumber=!1,r.message=t,r.name=\"StoryException\",r}return r(i)}(h(Error));function W(t,e,n){if(null===t)return{result:n,exists:!1};var i=t.get(e);return void 0===i?{result:n,exists:!1}:{result:i,exists:!0}}var V,L=function(t){a(i,t);var e=v(i);function i(){return n(this,i),e.apply(this,arguments)}return r(i,[{key:\"Copy\",value:function(){return b(i.Create(this.valueObject),N)}},{key:\"BadCastException\",value:function(t){return new x(\"Can't cast \"+this.valueObject+\" from \"+this.valueType+\" to \"+t)}}],[{key:\"Create\",value:function(t,e){if(e){if(e===V.Int&&Number.isInteger(Number(t)))return new D(Number(t));if(e===V.Float&&!isNaN(t))return new B(Number(t))}return\"boolean\"==typeof t?new R(Boolean(t)):\"string\"==typeof t?new G(String(t)):Number.isInteger(Number(t))?new D(Number(t)):isNaN(t)?t instanceof k?new M(b(t,k)):t instanceof F?new U(b(t,F)):null:new B(Number(t))}}]),i}(N),j=function(t){a(i,t);var e=v(i);function i(t){var r;return n(this,i),(r=e.call(this)).value=t,r}return r(i,[{key:\"valueObject\",get:function(){return this.value}},{key:\"toString\",value:function(){return null===this.value?P(\"Value.value\"):this.value.toString()}}]),i}(L),R=function(t){a(i,t);var e=v(i);function i(t){return n(this,i),e.call(this,t||!1)}return r(i,[{key:\"isTruthy\",get:function(){return Boolean(this.value)}},{key:\"valueType\",get:function(){return V.Bool}},{key:\"Cast\",value:function(t){if(null===this.value)return P(\"Value.value\");if(t==this.valueType)return this;if(t==V.Int)return new D(this.value?1:0);if(t==V.Float)return new B(this.value?1:0);if(t==V.String)return new G(this.value?\"true\":\"false\");throw this.BadCastException(t)}},{key:\"toString\",value:function(){return this.value?\"true\":\"false\"}}]),i}(j),D=function(t){a(i,t);var e=v(i);function i(t){return n(this,i),e.call(this,t||0)}return r(i,[{key:\"isTruthy\",get:function(){return 0!=this.value}},{key:\"valueType\",get:function(){return V.Int}},{key:\"Cast\",value:function(t){if(null===this.value)return P(\"Value.value\");if(t==this.valueType)return this;if(t==V.Bool)return new R(0!==this.value);if(t==V.Float)return new B(this.value);if(t==V.String)return new G(\"\"+this.value);throw this.BadCastException(t)}}]),i}(j),B=function(t){a(i,t);var e=v(i);function i(t){return n(this,i),e.call(this,t||0)}return r(i,[{key:\"isTruthy\",get:function(){return 0!=this.value}},{key:\"valueType\",get:function(){return V.Float}},{key:\"Cast\",value:function(t){if(null===this.value)return P(\"Value.value\");if(t==this.valueType)return this;if(t==V.Bool)return new R(0!==this.value);if(t==V.Int)return new D(this.value);if(t==V.String)return new G(\"\"+this.value);throw this.BadCastException(t)}}]),i}(j),G=function(t){a(i,t);var e=v(i);function i(t){var r;return n(this,i),(r=e.call(this,t||\"\"))._isNewline=\"\\n\"==r.value,r._isInlineWhitespace=!0,null===r.value?f(r,P(\"Value.value\")):(r.value.length>0&&r.value.split(\"\").every((function(t){return\" \"==t||\"\\t\"==t||(r._isInlineWhitespace=!1,!1)})),r)}return r(i,[{key:\"valueType\",get:function(){return V.String}},{key:\"isTruthy\",get:function(){return null===this.value?P(\"Value.value\"):this.value.length>0}},{key:\"isNewline\",get:function(){return this._isNewline}},{key:\"isInlineWhitespace\",get:function(){return this._isInlineWhitespace}},{key:\"isNonWhitespace\",get:function(){return!this.isNewline&&!this.isInlineWhitespace}},{key:\"Cast\",value:function(t){if(t==this.valueType)return this;if(t==V.Int){var e=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=parseInt(t);return Number.isNaN(n)?{result:e,exists:!1}:{result:n,exists:!0}}(this.value);if(e.exists)return new D(e.result);throw this.BadCastException(t)}if(t==V.Float){var n=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=parseFloat(t);return Number.isNaN(n)?{result:e,exists:!1}:{result:n,exists:!0}}(this.value);if(n.exists)return new B(n.result);throw this.BadCastException(t)}throw this.BadCastException(t)}}]),i}(j),M=function(t){a(i,t);var e=v(i);function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return n(this,i),e.call(this,t)}return r(i,[{key:\"valueType\",get:function(){return V.DivertTarget}},{key:\"targetPath\",get:function(){return null===this.value?P(\"Value.value\"):this.value},set:function(t){this.value=t}},{key:\"isTruthy\",get:function(){throw new Error(\"Shouldn't be checking the truthiness of a divert target\")}},{key:\"Cast\",value:function(t){if(t==this.valueType)return this;throw this.BadCastException(t)}},{key:\"toString\",value:function(){return\"DivertTargetValue(\"+this.targetPath+\")\"}}]),i}(j),J=function(t){a(i,t);var e=v(i);function i(t){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return n(this,i),(r=e.call(this,t))._contextIndex=a,r}return r(i,[{key:\"contextIndex\",get:function(){return this._contextIndex},set:function(t){this._contextIndex=t}},{key:\"variableName\",get:function(){return null===this.value?P(\"Value.value\"):this.value},set:function(t){this.value=t}},{key:\"valueType\",get:function(){return V.VariablePointer}},{key:\"isTruthy\",get:function(){throw new Error(\"Shouldn't be checking the truthiness of a variable pointer\")}},{key:\"Cast\",value:function(t){if(t==this.valueType)return this;throw this.BadCastException(t)}},{key:\"toString\",value:function(){return\"VariablePointerValue(\"+this.variableName+\")\"}},{key:\"Copy\",value:function(){return new i(this.variableName,this.contextIndex)}}]),i}(j),U=function(t){a(i,t);var e=v(i);function i(t,r){var a;return n(this,i),a=e.call(this,null),t||r?t instanceof F?a.value=new F(t):t instanceof I&&\"number\"==typeof r&&(a.value=new F({Key:t,Value:r})):a.value=new F,a}return r(i,[{key:\"isTruthy\",get:function(){return null===this.value?P(\"this.value\"):this.value.Count>0}},{key:\"valueType\",get:function(){return V.List}},{key:\"Cast\",value:function(t){if(null===this.value)return P(\"Value.value\");if(t==V.Int){var e=this.value.maxItem;return e.Key.isNull?new D(0):new D(e.Value)}if(t==V.Float){var n=this.value.maxItem;return n.Key.isNull?new B(0):new B(n.Value)}if(t==V.String){var i=this.value.maxItem;return i.Key.isNull?new G(\"\"):new G(i.Key.toString())}if(t==this.valueType)return this;throw this.BadCastException(t)}}],[{key:\"RetainListOriginsForAssignment\",value:function(t,e){var n=C(t,i),r=C(e,i);return r&&null===r.value?P(\"newList.value\"):n&&null===n.value?P(\"oldList.value\"):void(n&&r&&0==r.value.Count&&r.value.SetInitialOriginNames(n.value.originNames))}}]),i}(j);!function(t){t[t.Bool=-1]=\"Bool\",t[t.Int=0]=\"Int\",t[t.Float=1]=\"Float\",t[t.List=2]=\"List\",t[t.String=3]=\"String\",t[t.DivertTarget=4]=\"DivertTarget\",t[t.VariablePointer=5]=\"VariablePointer\"}(V||(V={}));var q=function(){function t(){n(this,t),this.obj=null,this.approximate=!1}return r(t,[{key:\"correctObj\",get:function(){return this.approximate?null:this.obj}},{key:\"container\",get:function(){return this.obj instanceof K?this.obj:null}},{key:\"copy\",value:function(){var e=new t;return e.obj=this.obj,e.approximate=this.approximate,e}}]),t}(),K=function(t){a(i,t);var e=v(i);function i(){var t;return n(this,i),(t=e.apply(this,arguments)).name=null,t._content=[],t.namedContent=new Map,t.visitsShouldBeCounted=!1,t.turnIndexShouldBeCounted=!1,t.countingAtStartOnly=!1,t._pathToFirstLeafContent=null,t}return r(i,[{key:\"hasValidName\",get:function(){return null!=this.name&&this.name.length>0}},{key:\"content\",get:function(){return this._content},set:function(t){this.AddContent(t)}},{key:\"namedOnlyContent\",get:function(){var t,e=new Map,n=g(this.namedContent);try{for(n.s();!(t=n.n()).done;){var i=d(t.value,2),r=i[0],a=b(i[1],N);e.set(r,a)}}catch(t){n.e(t)}finally{n.f()}var s,o=g(this.content);try{for(o.s();!(s=o.n()).done;){var u=w(s.value);null!=u&&u.hasValidName&&e.delete(u.name)}}catch(t){o.e(t)}finally{o.f()}return 0==e.size&&(e=null),e},set:function(t){var e=this.namedOnlyContent;if(null!=e){var n,i=g(e);try{for(i.s();!(n=i.n()).done;){var r=d(n.value,1)[0];this.namedContent.delete(r)}}catch(t){i.e(t)}finally{i.f()}}if(null!=t){var a,s=g(t);try{for(s.s();!(a=s.n()).done;){var o=w(d(a.value,2)[1]);null!=o&&this.AddToNamedContentOnly(o)}}catch(t){s.e(t)}finally{s.f()}}}},{key:\"countFlags\",get:function(){var t=0;return this.visitsShouldBeCounted&&(t|=i.CountFlags.Visits),this.turnIndexShouldBeCounted&&(t|=i.CountFlags.Turns),this.countingAtStartOnly&&(t|=i.CountFlags.CountStartOnly),t==i.CountFlags.CountStartOnly&&(t=0),t},set:function(t){var e=t;(e&i.CountFlags.Visits)>0&&(this.visitsShouldBeCounted=!0),(e&i.CountFlags.Turns)>0&&(this.turnIndexShouldBeCounted=!0),(e&i.CountFlags.CountStartOnly)>0&&(this.countingAtStartOnly=!0)}},{key:\"pathToFirstLeafContent\",get:function(){return null==this._pathToFirstLeafContent&&(this._pathToFirstLeafContent=this.path.PathByAppendingPath(this.internalPathToFirstLeafContent)),this._pathToFirstLeafContent}},{key:\"internalPathToFirstLeafContent\",get:function(){for(var t=[],e=this;e instanceof i;)e.content.length>0&&(t.push(new k.Component(0)),e=e.content[0]);return new k(t)}},{key:\"AddContent\",value:function(t){if(t instanceof Array){var e,n=g(t);try{for(n.s();!(e=n.n()).done;){var i=e.value;this.AddContent(i)}}catch(t){n.e(t)}finally{n.f()}}else{var r=t;if(this._content.push(r),r.parent)throw new Error(\"content is already in \"+r.parent);r.parent=this,this.TryAddNamedContent(r)}}},{key:\"TryAddNamedContent\",value:function(t){var e=w(t);null!=e&&e.hasValidName&&this.AddToNamedContentOnly(e)}},{key:\"AddToNamedContentOnly\",value:function(t){if(S.AssertType(t,N,\"Can only add Runtime.Objects to a Runtime.Container\"),b(t,N).parent=this,null===t.name)return P(\"namedContentObj.name\");this.namedContent.set(t.name,t)}},{key:\"ContentAtPath\",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;-1==n&&(n=t.length);var r=new q;r.approximate=!1;for(var a=this,s=this,o=e;o<n;++o){var u=t.GetComponent(o);if(null==a){r.approximate=!0;break}var l=a.ContentWithPathComponent(u);if(null==l){r.approximate=!0;break}s=l,a=C(l,i)}return r.obj=s,r}},{key:\"InsertContent\",value:function(t,e){if(this.content.splice(e,0,t),t.parent)throw new Error(\"content is already in \"+t.parent);t.parent=this,this.TryAddNamedContent(t)}},{key:\"AddContentsOfContainer\",value:function(t){var e;(e=this.content).push.apply(e,p(t.content));var n,i=g(t.content);try{for(i.s();!(n=i.n()).done;){var r=n.value;r.parent=this,this.TryAddNamedContent(r)}}catch(t){i.e(t)}finally{i.f()}}},{key:\"ContentWithPathComponent\",value:function(t){if(t.isIndex)return t.index>=0&&t.index<this.content.length?this.content[t.index]:null;if(t.isParent)return this.parent;if(null===t.name)return P(\"component.name\");var e=W(this.namedContent,t.name,null);return e.exists?b(e.result,N):null}},{key:\"BuildStringOfHierarchy\",value:function(){var t;if(0==arguments.length)return t=new A,this.BuildStringOfHierarchy(t,0,null),t.toString();t=arguments[0];var e=arguments[1],n=arguments[2];function r(){for(var n=0;n<4*e;++n)t.Append(\" \")}r(),t.Append(\"[\"),this.hasValidName&&t.AppendFormat(\" ({0})\",this.name),this==n&&t.Append(\"  <---\"),t.AppendLine(),e++;for(var a=0;a<this.content.length;++a){var s=this.content[a];if(s instanceof i)s.BuildStringOfHierarchy(t,e,n);else r(),s instanceof G?(t.Append('\"'),t.Append(s.toString().replace(\"\\n\",\"\\\\n\")),t.Append('\"')):t.Append(s.toString());a!=this.content.length-1&&t.Append(\",\"),s instanceof i||s!=n||t.Append(\"  <---\"),t.AppendLine()}var o,u=new Map,l=g(this.namedContent);try{for(l.s();!(o=l.n()).done;){var h=d(o.value,2),c=h[0],f=h[1];this.content.indexOf(b(f,N))>=0||u.set(c,f)}}catch(t){l.e(t)}finally{l.f()}if(u.size>0){r(),t.AppendLine(\"-- named: --\");var v,p=g(u);try{for(p.s();!(v=p.n()).done;){var y=d(v.value,2)[1];S.AssertType(y,i,\"Can only print out named Containers\"),y.BuildStringOfHierarchy(t,e,n),t.AppendLine()}}catch(t){p.e(t)}finally{p.f()}}e--,r(),t.Append(\"]\")}}]),i}(N);!function(t){var e;(e=t.CountFlags||(t.CountFlags={}))[e.Visits=1]=\"Visits\",e[e.Turns=2]=\"Turns\",e[e.CountStartOnly=4]=\"CountStartOnly\"}(K||(K={}));var z,H=function(t){a(i,t);var e=v(i);function i(){return n(this,i),e.apply(this,arguments)}return r(i,[{key:\"toString\",value:function(){return\"Glue\"}}]),i}(N),X=function(t){a(i,t);var e=v(i);function i(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.CommandType.NotSet;return n(this,i),(t=e.call(this))._commandType=r,t}return r(i,[{key:\"commandType\",get:function(){return this._commandType}},{key:\"Copy\",value:function(){return new i(this.commandType)}},{key:\"toString\",value:function(){return this.commandType.toString()}}],[{key:\"EvalStart\",value:function(){return new i(i.CommandType.EvalStart)}},{key:\"EvalOutput\",value:function(){return new i(i.CommandType.EvalOutput)}},{key:\"EvalEnd\",value:function(){return new i(i.CommandType.EvalEnd)}},{key:\"Duplicate\",value:function(){return new i(i.CommandType.Duplicate)}},{key:\"PopEvaluatedValue\",value:function(){return new i(i.CommandType.PopEvaluatedValue)}},{key:\"PopFunction\",value:function(){return new i(i.CommandType.PopFunction)}},{key:\"PopTunnel\",value:function(){return new i(i.CommandType.PopTunnel)}},{key:\"BeginString\",value:function(){return new i(i.CommandType.BeginString)}},{key:\"EndString\",value:function(){return new i(i.CommandType.EndString)}},{key:\"NoOp\",value:function(){return new i(i.CommandType.NoOp)}},{key:\"ChoiceCount\",value:function(){return new i(i.CommandType.ChoiceCount)}},{key:\"Turns\",value:function(){return new i(i.CommandType.Turns)}},{key:\"TurnsSince\",value:function(){return new i(i.CommandType.TurnsSince)}},{key:\"ReadCount\",value:function(){return new i(i.CommandType.ReadCount)}},{key:\"Random\",value:function(){return new i(i.CommandType.Random)}},{key:\"SeedRandom\",value:function(){return new i(i.CommandType.SeedRandom)}},{key:\"VisitIndex\",value:function(){return new i(i.CommandType.VisitIndex)}},{key:\"SequenceShuffleIndex\",value:function(){return new i(i.CommandType.SequenceShuffleIndex)}},{key:\"StartThread\",value:function(){return new i(i.CommandType.StartThread)}},{key:\"Done\",value:function(){return new i(i.CommandType.Done)}},{key:\"End\",value:function(){return new i(i.CommandType.End)}},{key:\"ListFromInt\",value:function(){return new i(i.CommandType.ListFromInt)}},{key:\"ListRange\",value:function(){return new i(i.CommandType.ListRange)}},{key:\"ListRandom\",value:function(){return new i(i.CommandType.ListRandom)}},{key:\"BeginTag\",value:function(){return new i(i.CommandType.BeginTag)}},{key:\"EndTag\",value:function(){return new i(i.CommandType.EndTag)}}]),i}(N);!function(t){var e;(e=t.CommandType||(t.CommandType={}))[e.NotSet=-1]=\"NotSet\",e[e.EvalStart=0]=\"EvalStart\",e[e.EvalOutput=1]=\"EvalOutput\",e[e.EvalEnd=2]=\"EvalEnd\",e[e.Duplicate=3]=\"Duplicate\",e[e.PopEvaluatedValue=4]=\"PopEvaluatedValue\",e[e.PopFunction=5]=\"PopFunction\",e[e.PopTunnel=6]=\"PopTunnel\",e[e.BeginString=7]=\"BeginString\",e[e.EndString=8]=\"EndString\",e[e.NoOp=9]=\"NoOp\",e[e.ChoiceCount=10]=\"ChoiceCount\",e[e.Turns=11]=\"Turns\",e[e.TurnsSince=12]=\"TurnsSince\",e[e.ReadCount=13]=\"ReadCount\",e[e.Random=14]=\"Random\",e[e.SeedRandom=15]=\"SeedRandom\",e[e.VisitIndex=16]=\"VisitIndex\",e[e.SequenceShuffleIndex=17]=\"SequenceShuffleIndex\",e[e.StartThread=18]=\"StartThread\",e[e.Done=19]=\"Done\",e[e.End=20]=\"End\",e[e.ListFromInt=21]=\"ListFromInt\",e[e.ListRange=22]=\"ListRange\",e[e.ListRandom=23]=\"ListRandom\",e[e.BeginTag=24]=\"BeginTag\",e[e.EndTag=25]=\"EndTag\",e[e.TOTAL_VALUES=26]=\"TOTAL_VALUES\"}(X||(X={})),function(t){t[t.Tunnel=0]=\"Tunnel\",t[t.Function=1]=\"Function\",t[t.FunctionEvaluationFromGame=2]=\"FunctionEvaluationFromGame\"}(z||(z={}));var $=function(){function t(){n(this,t),this.container=null,this.index=-1,2===arguments.length&&(this.container=arguments[0],this.index=arguments[1])}return r(t,[{key:\"Resolve\",value:function(){return this.index<0?this.container:null==this.container?null:0==this.container.content.length?this.container:this.index>=this.container.content.length?null:this.container.content[this.index]}},{key:\"isNull\",get:function(){return null==this.container}},{key:\"path\",get:function(){return this.isNull?null:this.index>=0?this.container.path.PathByAppendingComponent(new k.Component(this.index)):this.container.path}},{key:\"toString\",value:function(){return this.container?\"Ink Pointer -> \"+this.container.path.toString()+\" -- index \"+this.index:\"Ink Pointer (null)\"}},{key:\"copy\",value:function(){return new t(this.container,this.index)}}],[{key:\"StartOf\",value:function(e){return new t(e,0)}},{key:\"Null\",get:function(){return new t(null,-1)}}]),t}(),Y=function(t){a(i,t);var e=v(i);function i(t){var r;return n(this,i),(r=e.call(this))._targetPath=null,r._targetPointer=$.Null,r.variableDivertName=null,r.pushesToStack=!1,r.stackPushType=0,r.isExternal=!1,r.externalArgs=0,r.isConditional=!1,r.pushesToStack=!1,void 0!==t&&(r.pushesToStack=!0,r.stackPushType=t),r}return r(i,[{key:\"targetPath\",get:function(){if(null!=this._targetPath&&this._targetPath.isRelative){var t=this.targetPointer.Resolve();t&&(this._targetPath=t.path)}return this._targetPath},set:function(t){this._targetPath=t,this._targetPointer=$.Null}},{key:\"targetPointer\",get:function(){if(this._targetPointer.isNull){var t=this.ResolvePath(this._targetPath).obj;if(null===this._targetPath)return P(\"this._targetPath\");if(null===this._targetPath.lastComponent)return P(\"this._targetPath.lastComponent\");if(this._targetPath.lastComponent.isIndex){if(null===t)return P(\"targetObj\");this._targetPointer.container=t.parent instanceof K?t.parent:null,this._targetPointer.index=this._targetPath.lastComponent.index}else this._targetPointer=$.StartOf(t instanceof K?t:null)}return this._targetPointer.copy()}},{key:\"targetPathString\",get:function(){return null==this.targetPath?null:this.CompactPathString(this.targetPath)},set:function(t){this.targetPath=null==t?null:new k(t)}},{key:\"hasVariableTarget\",get:function(){return null!=this.variableDivertName}},{key:\"Equals\",value:function(t){var e=t;return e instanceof i&&this.hasVariableTarget==e.hasVariableTarget&&(this.hasVariableTarget?this.variableDivertName==e.variableDivertName:null===this.targetPath?P(\"this.targetPath\"):this.targetPath.Equals(e.targetPath))}},{key:\"toString\",value:function(){if(this.hasVariableTarget)return\"Divert(variable: \"+this.variableDivertName+\")\";if(null==this.targetPath)return\"Divert(null)\";var t=new A,e=this.targetPath.toString();return t.Append(\"Divert\"),this.isConditional&&t.Append(\"?\"),this.pushesToStack&&(this.stackPushType==z.Function?t.Append(\" function\"):t.Append(\" tunnel\")),t.Append(\" -> \"),t.Append(this.targetPathString),t.Append(\" (\"),t.Append(e),t.Append(\")\"),t.toString()}}]),i}(N),Q=function(t){a(i,t);var e=v(i);function i(){var t,r=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return n(this,i),(t=e.call(this))._pathOnChoice=null,t.hasCondition=!1,t.hasStartContent=!1,t.hasChoiceOnlyContent=!1,t.isInvisibleDefault=!1,t.onceOnly=!0,t.onceOnly=r,t}return r(i,[{key:\"pathOnChoice\",get:function(){if(null!=this._pathOnChoice&&this._pathOnChoice.isRelative){var t=this.choiceTarget;t&&(this._pathOnChoice=t.path)}return this._pathOnChoice},set:function(t){this._pathOnChoice=t}},{key:\"choiceTarget\",get:function(){return null===this._pathOnChoice?P(\"ChoicePoint._pathOnChoice\"):this.ResolvePath(this._pathOnChoice).container}},{key:\"pathStringOnChoice\",get:function(){return null===this.pathOnChoice?P(\"ChoicePoint.pathOnChoice\"):this.CompactPathString(this.pathOnChoice)},set:function(t){this.pathOnChoice=new k(t)}},{key:\"flags\",get:function(){var t=0;return this.hasCondition&&(t|=1),this.hasStartContent&&(t|=2),this.hasChoiceOnlyContent&&(t|=4),this.isInvisibleDefault&&(t|=8),this.onceOnly&&(t|=16),t},set:function(t){this.hasCondition=(1&t)>0,this.hasStartContent=(2&t)>0,this.hasChoiceOnlyContent=(4&t)>0,this.isInvisibleDefault=(8&t)>0,this.onceOnly=(16&t)>0}},{key:\"toString\",value:function(){return null===this.pathOnChoice?P(\"ChoicePoint.pathOnChoice\"):\"Choice: -> \"+this.pathOnChoice.toString()}}]),i}(N),Z=function(t){a(i,t);var e=v(i);function i(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return n(this,i),(t=e.call(this)).pathForCount=null,t.name=r,t}return r(i,[{key:\"containerForCount\",get:function(){return null===this.pathForCount?null:this.ResolvePath(this.pathForCount).container}},{key:\"pathStringForCount\",get:function(){return null===this.pathForCount?null:this.CompactPathString(this.pathForCount)},set:function(t){this.pathForCount=null===t?null:new k(t)}},{key:\"toString\",value:function(){return null!=this.name?\"var(\"+this.name+\")\":\"read_count(\"+this.pathStringForCount+\")\"}}]),i}(N),tt=function(t){a(i,t);var e=v(i);function i(t,r){var a;return n(this,i),(a=e.call(this)).variableName=t||null,a.isNewDeclaration=!!r,a.isGlobal=!1,a}return r(i,[{key:\"toString\",value:function(){return\"VarAssign to \"+this.variableName}}]),i}(N),et=function(t){a(i,t);var e=v(i);function i(){return n(this,i),e.apply(this,arguments)}return r(i)}(N),nt=function(t){a(i,t);var e=v(i);function i(){var t;if(n(this,i),(t=e.call(this))._name=null,t._numberOfParameters=0,t._prototype=null,t._isPrototype=!1,t._operationFuncs=null,0===arguments.length)i.GenerateNativeFunctionsIfNecessary();else if(1===arguments.length){var r=arguments[0];i.GenerateNativeFunctionsIfNecessary(),t.name=r}else if(2===arguments.length){var a=arguments[0],s=arguments[1];t._isPrototype=!0,t.name=a,t.numberOfParameters=s}return t}return r(i,[{key:\"name\",get:function(){return null===this._name?P(\"NativeFunctionCall._name\"):this._name},set:function(t){this._name=t,this._isPrototype||(null===i._nativeFunctions?P(\"NativeFunctionCall._nativeFunctions\"):this._prototype=i._nativeFunctions.get(this._name)||null)}},{key:\"numberOfParameters\",get:function(){return this._prototype?this._prototype.numberOfParameters:this._numberOfParameters},set:function(t){this._numberOfParameters=t}},{key:\"Call\",value:function(t){if(this._prototype)return this._prototype.Call(t);if(this.numberOfParameters!=t.length)throw new Error(\"Unexpected number of parameters\");var e,n=!1,i=g(t);try{for(i.s();!(e=i.n()).done;){var r=e.value;if(r instanceof et)throw new x('Attempting to perform operation on a void value. Did you forget to \"return\" a value from a function you called here?');r instanceof U&&(n=!0)}}catch(t){i.e(t)}finally{i.f()}if(2==t.length&&n)return this.CallBinaryListOperation(t);var a=this.CoerceValuesToSingleType(t),s=a[0].valueType;return s==V.Int||s==V.Float||s==V.String||s==V.DivertTarget||s==V.List?this.CallType(a):null}},{key:\"CallType\",value:function(t){var e=b(t[0],j),n=e.valueType,r=e,a=t.length;if(2==a||1==a){if(null===this._operationFuncs)return P(\"NativeFunctionCall._operationFuncs\");var s=this._operationFuncs.get(n);if(!s){var o=V[n];throw new x(\"Cannot perform operation \"+this.name+\" on \"+o)}if(2==a){var u=b(t[1],j),l=s;if(null===r.value||null===u.value)return P(\"NativeFunctionCall.Call BinaryOp values\");var h=l(r.value,u.value);return j.Create(h)}var c=s;if(null===r.value)return P(\"NativeFunctionCall.Call UnaryOp value\");var f=c(r.value);return this.name===i.Int?j.Create(f,V.Int):this.name===i.Float?j.Create(f,V.Float):j.Create(f,e.valueType)}throw new Error(\"Unexpected number of parameters to NativeFunctionCall: \"+t.length)}},{key:\"CallBinaryListOperation\",value:function(t){if((\"+\"==this.name||\"-\"==this.name)&&t[0]instanceof U&&t[1]instanceof D)return this.CallListIncrementOperation(t);var e=b(t[0],j),n=b(t[1],j);if(!(\"&&\"!=this.name&&\"||\"!=this.name||e.valueType==V.List&&n.valueType==V.List)){if(null===this._operationFuncs)return P(\"NativeFunctionCall._operationFuncs\");var i=this._operationFuncs.get(V.Int);if(null===i)return P(\"NativeFunctionCall.CallBinaryListOperation op\");var r=function(t){if(\"boolean\"==typeof t)return t;throw new Error(\"\".concat(t,\" is not a boolean\"))}(i(e.isTruthy?1:0,n.isTruthy?1:0));return new R(r)}if(e.valueType==V.List&&n.valueType==V.List)return this.CallType([e,n]);throw new x(\"Can not call use \"+this.name+\" operation on \"+V[e.valueType]+\" and \"+V[n.valueType])}},{key:\"CallListIncrementOperation\",value:function(t){var e=b(t[0],U),n=b(t[1],D),i=new F;if(null===e.value)return P(\"NativeFunctionCall.CallListIncrementOperation listVal.value\");var r,a=g(e.value);try{for(a.s();!(r=a.n()).done;){var s=d(r.value,2),o=s[0],u=s[1],l=I.fromSerializedKey(o);if(null===this._operationFuncs)return P(\"NativeFunctionCall._operationFuncs\");var h=this._operationFuncs.get(V.Int);if(null===n.value)return P(\"NativeFunctionCall.CallListIncrementOperation intVal.value\");var c=h(u,n.value),f=null;if(null===e.value.origins)return P(\"NativeFunctionCall.CallListIncrementOperation listVal.value.origins\");var v,p=g(e.value.origins);try{for(p.s();!(v=p.n()).done;){var y=v.value;if(y.name==l.originName){f=y;break}}}catch(t){p.e(t)}finally{p.f()}if(null!=f){var m=f.TryGetItemWithValue(c,I.Null);m.exists&&i.Add(m.result,c)}}}catch(t){a.e(t)}finally{a.f()}return new U(i)}},{key:\"CoerceValuesToSingleType\",value:function(t){var e,n=V.Int,i=null,r=g(t);try{for(r.s();!(e=r.n()).done;){var a=b(e.value,j);a.valueType>n&&(n=a.valueType),a.valueType==V.List&&(i=C(a,U))}}catch(t){r.e(t)}finally{r.f()}var s=[];if(V[n]==V[V.List]){var o,u=g(t);try{for(u.s();!(o=u.n()).done;){var l=b(o.value,j);if(l.valueType==V.List)s.push(l);else{if(l.valueType!=V.Int){var h=V[l.valueType];throw new x(\"Cannot mix Lists and \"+h+\" values in this operation\")}var c=parseInt(l.valueObject);if(null===(i=b(i,U)).value)return P(\"NativeFunctionCall.CoerceValuesToSingleType specialCaseList.value\");var f=i.value.originOfMaxItem;if(null===f)return P(\"NativeFunctionCall.CoerceValuesToSingleType list\");var v=f.TryGetItemWithValue(c,I.Null);if(!v.exists)throw new x(\"Could not find List item with the value \"+c+\" in \"+f.name);var d=new U(v.result,c);s.push(d)}}}catch(t){u.e(t)}finally{u.f()}}else{var p,y=g(t);try{for(y.s();!(p=y.n()).done;){var m=b(p.value,j).Cast(n);s.push(m)}}catch(t){y.e(t)}finally{y.f()}}return s}},{key:\"AddOpFuncForType\",value:function(t,e){null==this._operationFuncs&&(this._operationFuncs=new Map),this._operationFuncs.set(t,e)}},{key:\"toString\",value:function(){return'Native \"'+this.name+'\"'}}],[{key:\"CallWithName\",value:function(t){return new i(t)}},{key:\"CallExistsWithName\",value:function(t){return this.GenerateNativeFunctionsIfNecessary(),this._nativeFunctions.get(t)}},{key:\"Identity\",value:function(t){return t}},{key:\"GenerateNativeFunctionsIfNecessary\",value:function(){if(null==this._nativeFunctions){this._nativeFunctions=new Map,this.AddIntBinaryOp(this.Add,(function(t,e){return t+e})),this.AddIntBinaryOp(this.Subtract,(function(t,e){return t-e})),this.AddIntBinaryOp(this.Multiply,(function(t,e){return t*e})),this.AddIntBinaryOp(this.Divide,(function(t,e){return Math.floor(t/e)})),this.AddIntBinaryOp(this.Mod,(function(t,e){return t%e})),this.AddIntUnaryOp(this.Negate,(function(t){return-t})),this.AddIntBinaryOp(this.Equal,(function(t,e){return t==e})),this.AddIntBinaryOp(this.Greater,(function(t,e){return t>e})),this.AddIntBinaryOp(this.Less,(function(t,e){return t<e})),this.AddIntBinaryOp(this.GreaterThanOrEquals,(function(t,e){return t>=e})),this.AddIntBinaryOp(this.LessThanOrEquals,(function(t,e){return t<=e})),this.AddIntBinaryOp(this.NotEquals,(function(t,e){return t!=e})),this.AddIntUnaryOp(this.Not,(function(t){return 0==t})),this.AddIntBinaryOp(this.And,(function(t,e){return 0!=t&&0!=e})),this.AddIntBinaryOp(this.Or,(function(t,e){return 0!=t||0!=e})),this.AddIntBinaryOp(this.Max,(function(t,e){return Math.max(t,e)})),this.AddIntBinaryOp(this.Min,(function(t,e){return Math.min(t,e)})),this.AddIntBinaryOp(this.Pow,(function(t,e){return Math.pow(t,e)})),this.AddIntUnaryOp(this.Floor,i.Identity),this.AddIntUnaryOp(this.Ceiling,i.Identity),this.AddIntUnaryOp(this.Int,i.Identity),this.AddIntUnaryOp(this.Float,(function(t){return t})),this.AddFloatBinaryOp(this.Add,(function(t,e){return t+e})),this.AddFloatBinaryOp(this.Subtract,(function(t,e){return t-e})),this.AddFloatBinaryOp(this.Multiply,(function(t,e){return t*e})),this.AddFloatBinaryOp(this.Divide,(function(t,e){return t/e})),this.AddFloatBinaryOp(this.Mod,(function(t,e){return t%e})),this.AddFloatUnaryOp(this.Negate,(function(t){return-t})),this.AddFloatBinaryOp(this.Equal,(function(t,e){return t==e})),this.AddFloatBinaryOp(this.Greater,(function(t,e){return t>e})),this.AddFloatBinaryOp(this.Less,(function(t,e){return t<e})),this.AddFloatBinaryOp(this.GreaterThanOrEquals,(function(t,e){return t>=e})),this.AddFloatBinaryOp(this.LessThanOrEquals,(function(t,e){return t<=e})),this.AddFloatBinaryOp(this.NotEquals,(function(t,e){return t!=e})),this.AddFloatUnaryOp(this.Not,(function(t){return 0==t})),this.AddFloatBinaryOp(this.And,(function(t,e){return 0!=t&&0!=e})),this.AddFloatBinaryOp(this.Or,(function(t,e){return 0!=t||0!=e})),this.AddFloatBinaryOp(this.Max,(function(t,e){return Math.max(t,e)})),this.AddFloatBinaryOp(this.Min,(function(t,e){return Math.min(t,e)})),this.AddFloatBinaryOp(this.Pow,(function(t,e){return Math.pow(t,e)})),this.AddFloatUnaryOp(this.Floor,(function(t){return Math.floor(t)})),this.AddFloatUnaryOp(this.Ceiling,(function(t){return Math.ceil(t)})),this.AddFloatUnaryOp(this.Int,(function(t){return Math.floor(t)})),this.AddFloatUnaryOp(this.Float,i.Identity),this.AddStringBinaryOp(this.Add,(function(t,e){return t+e})),this.AddStringBinaryOp(this.Equal,(function(t,e){return t===e})),this.AddStringBinaryOp(this.NotEquals,(function(t,e){return!(t===e)})),this.AddStringBinaryOp(this.Has,(function(t,e){return t.includes(e)})),this.AddStringBinaryOp(this.Hasnt,(function(t,e){return!t.includes(e)})),this.AddListBinaryOp(this.Add,(function(t,e){return t.Union(e)})),this.AddListBinaryOp(this.Subtract,(function(t,e){return t.Without(e)})),this.AddListBinaryOp(this.Has,(function(t,e){return t.Contains(e)})),this.AddListBinaryOp(this.Hasnt,(function(t,e){return!t.Contains(e)})),this.AddListBinaryOp(this.Intersect,(function(t,e){return t.Intersect(e)})),this.AddListBinaryOp(this.Equal,(function(t,e){return t.Equals(e)})),this.AddListBinaryOp(this.Greater,(function(t,e){return t.GreaterThan(e)})),this.AddListBinaryOp(this.Less,(function(t,e){return t.LessThan(e)})),this.AddListBinaryOp(this.GreaterThanOrEquals,(function(t,e){return t.GreaterThanOrEquals(e)})),this.AddListBinaryOp(this.LessThanOrEquals,(function(t,e){return t.LessThanOrEquals(e)})),this.AddListBinaryOp(this.NotEquals,(function(t,e){return!t.Equals(e)})),this.AddListBinaryOp(this.And,(function(t,e){return t.Count>0&&e.Count>0})),this.AddListBinaryOp(this.Or,(function(t,e){return t.Count>0||e.Count>0})),this.AddListUnaryOp(this.Not,(function(t){return 0==t.Count?1:0})),this.AddListUnaryOp(this.Invert,(function(t){return t.inverse})),this.AddListUnaryOp(this.All,(function(t){return t.all})),this.AddListUnaryOp(this.ListMin,(function(t){return t.MinAsList()})),this.AddListUnaryOp(this.ListMax,(function(t){return t.MaxAsList()})),this.AddListUnaryOp(this.Count,(function(t){return t.Count})),this.AddListUnaryOp(this.ValueOfList,(function(t){return t.maxItem.Value}));this.AddOpToNativeFunc(this.Equal,2,V.DivertTarget,(function(t,e){return t.Equals(e)})),this.AddOpToNativeFunc(this.NotEquals,2,V.DivertTarget,(function(t,e){return!t.Equals(e)}))}}},{key:\"AddOpToNativeFunc\",value:function(t,e,n,r){if(null===this._nativeFunctions)return P(\"NativeFunctionCall._nativeFunctions\");var a=this._nativeFunctions.get(t);a||(a=new i(t,e),this._nativeFunctions.set(t,a)),a.AddOpFuncForType(n,r)}},{key:\"AddIntBinaryOp\",value:function(t,e){this.AddOpToNativeFunc(t,2,V.Int,e)}},{key:\"AddIntUnaryOp\",value:function(t,e){this.AddOpToNativeFunc(t,1,V.Int,e)}},{key:\"AddFloatBinaryOp\",value:function(t,e){this.AddOpToNativeFunc(t,2,V.Float,e)}},{key:\"AddFloatUnaryOp\",value:function(t,e){this.AddOpToNativeFunc(t,1,V.Float,e)}},{key:\"AddStringBinaryOp\",value:function(t,e){this.AddOpToNativeFunc(t,2,V.String,e)}},{key:\"AddListBinaryOp\",value:function(t,e){this.AddOpToNativeFunc(t,2,V.List,e)}},{key:\"AddListUnaryOp\",value:function(t,e){this.AddOpToNativeFunc(t,1,V.List,e)}}]),i}(N);nt.Add=\"+\",nt.Subtract=\"-\",nt.Divide=\"/\",nt.Multiply=\"*\",nt.Mod=\"%\",nt.Negate=\"_\",nt.Equal=\"==\",nt.Greater=\">\",nt.Less=\"<\",nt.GreaterThanOrEquals=\">=\",nt.LessThanOrEquals=\"<=\",nt.NotEquals=\"!=\",nt.Not=\"!\",nt.And=\"&&\",nt.Or=\"||\",nt.Min=\"MIN\",nt.Max=\"MAX\",nt.Pow=\"POW\",nt.Floor=\"FLOOR\",nt.Ceiling=\"CEILING\",nt.Int=\"INT\",nt.Float=\"FLOAT\",nt.Has=\"?\",nt.Hasnt=\"!?\",nt.Intersect=\"^\",nt.ListMin=\"LIST_MIN\",nt.ListMax=\"LIST_MAX\",nt.All=\"LIST_ALL\",nt.Count=\"LIST_COUNT\",nt.ValueOfList=\"LIST_VALUE\",nt.Invert=\"LIST_INVERT\",nt._nativeFunctions=null;var it=function(t){a(i,t);var e=v(i);function i(t){var r;return n(this,i),(r=e.call(this)).text=t.toString()||\"\",r}return r(i,[{key:\"toString\",value:function(){return\"# \"+this.text}}]),i}(N),rt=function(t){a(i,t);var e=v(i);function i(){var t;return n(this,i),(t=e.apply(this,arguments)).text=\"\",t.index=0,t.threadAtGeneration=null,t.sourcePath=\"\",t.targetPath=null,t.isInvisibleDefault=!1,t.tags=null,t.originalThreadIndex=0,t}return r(i,[{key:\"pathStringOnChoice\",get:function(){return null===this.targetPath?P(\"Choice.targetPath\"):this.targetPath.toString()},set:function(t){this.targetPath=new k(t)}}]),i}(N),at=function(){function t(e,i){n(this,t),this._name=e||\"\",this._items=null,this._itemNameToValues=i||new Map}return r(t,[{key:\"name\",get:function(){return this._name}},{key:\"items\",get:function(){if(null==this._items){this._items=new Map;var t,e=g(this._itemNameToValues);try{for(e.s();!(t=e.n()).done;){var n=d(t.value,2),i=n[0],r=n[1],a=new I(this.name,i);this._items.set(a.serialized(),r)}}catch(t){e.e(t)}finally{e.f()}}return this._items}},{key:\"ValueForItem\",value:function(t){if(!t.itemName)return 0;var e=this._itemNameToValues.get(t.itemName);return void 0!==e?e:0}},{key:\"ContainsItem\",value:function(t){return!!t.itemName&&(t.originName==this.name&&this._itemNameToValues.has(t.itemName))}},{key:\"ContainsItemWithName\",value:function(t){return this._itemNameToValues.has(t)}},{key:\"TryGetItemWithValue\",value:function(t,e){var n,i=g(this._itemNameToValues);try{for(i.s();!(n=i.n()).done;){var r=d(n.value,2),a=r[0];if(r[1]==t)return{result:new I(this.name,a),exists:!0}}}catch(t){i.e(t)}finally{i.f()}return{result:I.Null,exists:!1}}},{key:\"TryGetValueForItem\",value:function(t,e){if(!t.itemName)return{result:0,exists:!1};var n=this._itemNameToValues.get(t.itemName);return n?{result:n,exists:!0}:{result:0,exists:!1}}}]),t}(),st=function(){function t(e){n(this,t),this._lists=new Map,this._allUnambiguousListValueCache=new Map;var i,r=g(e);try{for(r.s();!(i=r.n()).done;){var a=i.value;this._lists.set(a.name,a);var s,o=g(a.items);try{for(o.s();!(s=o.n()).done;){var u=d(s.value,2),l=u[0],h=u[1],c=I.fromSerializedKey(l),f=new U(c,h);if(!c.itemName)throw new Error(\"item.itemName is null or undefined.\");this._allUnambiguousListValueCache.set(c.itemName,f),this._allUnambiguousListValueCache.set(c.fullName,f)}}catch(t){o.e(t)}finally{o.f()}}}catch(t){r.e(t)}finally{r.f()}}return r(t,[{key:\"lists\",get:function(){var t,e=[],n=g(this._lists);try{for(n.s();!(t=n.n()).done;){var i=d(t.value,2)[1];e.push(i)}}catch(t){n.e(t)}finally{n.f()}return e}},{key:\"TryListGetDefinition\",value:function(t,e){if(null===t)return{result:e,exists:!1};var n=this._lists.get(t);return n?{result:n,exists:!0}:{result:e,exists:!1}}},{key:\"FindSingleItemListWithName\",value:function(t){if(null===t)return P(\"name\");var e=this._allUnambiguousListValueCache.get(t);return void 0!==e?e:null}}]),t}(),ot=function(){function t(){n(this,t)}return r(t,null,[{key:\"JArrayToRuntimeObjList\",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t.length;e&&n--;for(var i=[],r=0;r<n;r++){var a=t[r],s=this.JTokenToRuntimeObject(a);if(null===s)return P(\"runtimeObj\");i.push(s)}return i}},{key:\"WriteDictionaryRuntimeObjs\",value:function(t,e){t.WriteObjectStart();var n,i=g(e);try{for(i.s();!(n=i.n()).done;){var r=d(n.value,2),a=r[0],s=r[1];t.WritePropertyStart(a),this.WriteRuntimeObject(t,s),t.WritePropertyEnd()}}catch(t){i.e(t)}finally{i.f()}t.WriteObjectEnd()}},{key:\"WriteListRuntimeObjs\",value:function(t,e){t.WriteArrayStart();var n,i=g(e);try{for(i.s();!(n=i.n()).done;){var r=n.value;this.WriteRuntimeObject(t,r)}}catch(t){i.e(t)}finally{i.f()}t.WriteArrayEnd()}},{key:\"WriteIntDictionary\",value:function(t,e){t.WriteObjectStart();var n,i=g(e);try{for(i.s();!(n=i.n()).done;){var r=d(n.value,2),a=r[0],s=r[1];t.WriteIntProperty(a,s)}}catch(t){i.e(t)}finally{i.f()}t.WriteObjectEnd()}},{key:\"WriteRuntimeObject\",value:function(e,n){var i=C(n,K);if(i)this.WriteRuntimeContainer(e,i);else{var r=C(n,Y);if(r){var a,s=\"->\";return r.isExternal?s=\"x()\":r.pushesToStack&&(r.stackPushType==z.Function?s=\"f()\":r.stackPushType==z.Tunnel&&(s=\"->t->\")),a=r.hasVariableTarget?r.variableDivertName:r.targetPathString,e.WriteObjectStart(),e.WriteProperty(s,a),r.hasVariableTarget&&e.WriteProperty(\"var\",!0),r.isConditional&&e.WriteProperty(\"c\",!0),r.externalArgs>0&&e.WriteIntProperty(\"exArgs\",r.externalArgs),void e.WriteObjectEnd()}var o=C(n,Q);if(o)return e.WriteObjectStart(),e.WriteProperty(\"*\",o.pathStringOnChoice),e.WriteIntProperty(\"flg\",o.flags),void e.WriteObjectEnd();var u=C(n,R);if(u)e.WriteBool(u.value);else{var l=C(n,D);if(l)e.WriteInt(l.value);else{var h=C(n,B);if(h)e.WriteFloat(h.value);else{var c=C(n,G);if(c)c.isNewline?e.Write(\"\\n\",!1):(e.WriteStringStart(),e.WriteStringInner(\"^\"),e.WriteStringInner(c.value),e.WriteStringEnd());else{var f=C(n,U);if(f)this.WriteInkList(e,f);else{var v=C(n,M);if(v)return e.WriteObjectStart(),null===v.value?P(\"divTargetVal.value\"):(e.WriteProperty(\"^->\",v.value.componentsString),void e.WriteObjectEnd());var d=C(n,J);if(d)return e.WriteObjectStart(),e.WriteProperty(\"^var\",d.value),e.WriteIntProperty(\"ci\",d.contextIndex),void e.WriteObjectEnd();if(C(n,H))e.Write(\"<>\");else{var p=C(n,X);if(p)e.Write(t._controlCommandNames[p.commandType]);else{var y=C(n,nt);if(y){var m=y.name;return\"^\"==m&&(m=\"L^\"),void e.Write(m)}var g=C(n,Z);if(g){e.WriteObjectStart();var S=g.pathStringForCount;return null!=S?e.WriteProperty(\"CNT?\",S):e.WriteProperty(\"VAR?\",g.name),void e.WriteObjectEnd()}var k=C(n,tt);if(k){e.WriteObjectStart();var b=k.isGlobal?\"VAR=\":\"temp=\";return e.WriteProperty(b,k.variableName),k.isNewDeclaration||e.WriteProperty(\"re\",!0),void e.WriteObjectEnd()}if(C(n,et))e.Write(\"void\");else{var w=C(n,it);if(w)return e.WriteObjectStart(),e.WriteProperty(\"#\",w.text),void e.WriteObjectEnd();var _=C(n,rt);if(!_)throw new Error(\"Failed to convert runtime object to Json token: \"+n);this.WriteChoice(e,_)}}}}}}}}}}},{key:\"JObjectToDictionaryRuntimeObjs\",value:function(t){var e=new Map;for(var n in t)if(t.hasOwnProperty(n)){var i=this.JTokenToRuntimeObject(t[n]);if(null===i)return P(\"inkObject\");e.set(n,i)}return e}},{key:\"JObjectToIntDictionary\",value:function(t){var e=new Map;for(var n in t)t.hasOwnProperty(n)&&e.set(n,parseInt(t[n]));return e}},{key:\"JTokenToRuntimeObject\",value:function(n){if(\"number\"==typeof n&&!isNaN(n)||\"boolean\"==typeof n)return j.Create(n);if(\"string\"==typeof n){var i=n.toString(),r=i[0];if(\"^\"==r)return new G(i.substring(1));if(\"\\n\"==r&&1==i.length)return new G(\"\\n\");if(\"<>\"==i)return new H;for(var a=0;a<t._controlCommandNames.length;++a){if(i==t._controlCommandNames[a])return new X(a)}if(\"L^\"==i&&(i=\"^\"),nt.CallExistsWithName(i))return nt.CallWithName(i);if(\"->->\"==i)return X.PopTunnel();if(\"~ret\"==i)return X.PopFunction();if(\"void\"==i)return new et}if(\"object\"===e(n)&&!Array.isArray(n)){var s,o=n;if(o[\"^->\"])return s=o[\"^->\"],new M(new k(s.toString()));if(o[\"^var\"]){s=o[\"^var\"];var u=new J(s.toString());return\"ci\"in o&&(s=o.ci,u.contextIndex=parseInt(s)),u}var l=!1,h=!1,c=z.Function,f=!1;if((s=o[\"->\"])?l=!0:(s=o[\"f()\"])?(l=!0,h=!0,c=z.Function):(s=o[\"->t->\"])?(l=!0,h=!0,c=z.Tunnel):(s=o[\"x()\"])&&(l=!0,f=!0,h=!1,c=z.Function),l){var v=new Y;v.pushesToStack=h,v.stackPushType=c,v.isExternal=f;var d=s.toString();return(s=o.var)?v.variableDivertName=d:v.targetPathString=d,v.isConditional=!!o.c,f&&(s=o.exArgs)&&(v.externalArgs=parseInt(s)),v}if(s=o[\"*\"]){var p=new Q;return p.pathStringOnChoice=s.toString(),(s=o.flg)&&(p.flags=parseInt(s)),p}if(s=o[\"VAR?\"])return new Z(s.toString());if(s=o[\"CNT?\"]){var y=new Z;return y.pathStringForCount=s.toString(),y}var m=!1,g=!1;if((s=o[\"VAR=\"])?(m=!0,g=!0):(s=o[\"temp=\"])&&(m=!0,g=!1),m){var S=s.toString(),C=!o.re,b=new tt(S,C);return b.isGlobal=g,b}if(void 0!==o[\"#\"])return s=o[\"#\"],new it(s.toString());if(s=o.list){var w=s,_=new F;if(s=o.origins){var T=s;_.SetInitialOriginNames(T)}for(var E in w)if(w.hasOwnProperty(E)){var O=w[E],P=new I(E),N=parseInt(O);_.Add(P,N)}return new U(_)}if(null!=o.originalChoicePath)return this.JObjectToChoice(o)}if(Array.isArray(n))return this.JArrayToContainer(n);if(null==n)return null;throw new Error(\"Failed to convert token to runtime object: \"+this.toJson(n,[\"parent\"]))}},{key:\"toJson\",value:function(t,e,n){return JSON.stringify(t,(function(t,n){return(null==e?void 0:e.some((function(e){return e===t})))?void 0:n}),n)}},{key:\"WriteRuntimeContainer\",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t.WriteArrayStart(),null===e)return P(\"container\");var i,r=g(e.content);try{for(r.s();!(i=r.n()).done;){var a=i.value;this.WriteRuntimeObject(t,a)}}catch(t){r.e(t)}finally{r.f()}var s=e.namedOnlyContent,o=e.countFlags,u=null!=e.name&&!n,l=null!=s||o>0||u;if(l&&t.WriteObjectStart(),null!=s){var h,c=g(s);try{for(c.s();!(h=c.n()).done;){var f=d(h.value,2),v=f[0],p=f[1],y=v,m=C(p,K);t.WritePropertyStart(y),this.WriteRuntimeContainer(t,m,!0),t.WritePropertyEnd()}}catch(t){c.e(t)}finally{c.f()}}o>0&&t.WriteIntProperty(\"#f\",o),u&&t.WriteProperty(\"#n\",e.name),l?t.WriteObjectEnd():t.WriteNull(),t.WriteArrayEnd()}},{key:\"JArrayToContainer\",value:function(t){var e=new K;e.content=this.JArrayToRuntimeObjList(t,!0);var n=t[t.length-1];if(null!=n){var i=new Map;for(var r in n)if(\"#f\"==r)e.countFlags=parseInt(n[r]);else if(\"#n\"==r)e.name=n[r].toString();else{var a=this.JTokenToRuntimeObject(n[r]),s=C(a,K);s&&(s.name=r),i.set(r,a)}e.namedOnlyContent=i}return e}},{key:\"JObjectToChoice\",value:function(t){var e=new rt;return e.text=t.text.toString(),e.index=parseInt(t.index),e.sourcePath=t.originalChoicePath.toString(),e.originalThreadIndex=parseInt(t.originalThreadIndex),e.pathStringOnChoice=t.targetPath.toString(),e}},{key:\"WriteChoice\",value:function(t,e){t.WriteObjectStart(),t.WriteProperty(\"text\",e.text),t.WriteIntProperty(\"index\",e.index),t.WriteProperty(\"originalChoicePath\",e.sourcePath),t.WriteIntProperty(\"originalThreadIndex\",e.originalThreadIndex),t.WriteProperty(\"targetPath\",e.pathStringOnChoice),t.WriteObjectEnd()}},{key:\"WriteInkList\",value:function(t,e){var n=e.value;if(null===n)return P(\"rawList\");t.WriteObjectStart(),t.WritePropertyStart(\"list\"),t.WriteObjectStart();var i,r=g(n);try{for(r.s();!(i=r.n()).done;){var a=d(i.value,2),s=a[0],o=a[1],u=I.fromSerializedKey(s),l=o;if(null===u.itemName)return P(\"item.itemName\");t.WritePropertyNameStart(),t.WritePropertyNameInner(u.originName?u.originName:\"?\"),t.WritePropertyNameInner(\".\"),t.WritePropertyNameInner(u.itemName),t.WritePropertyNameEnd(),t.Write(l),t.WritePropertyEnd()}}catch(t){r.e(t)}finally{r.f()}if(t.WriteObjectEnd(),t.WritePropertyEnd(),0==n.Count&&null!=n.originNames&&n.originNames.length>0){t.WritePropertyStart(\"origins\"),t.WriteArrayStart();var h,c=g(n.originNames);try{for(c.s();!(h=c.n()).done;){var f=h.value;t.Write(f)}}catch(t){c.e(t)}finally{c.f()}t.WriteArrayEnd(),t.WritePropertyEnd()}t.WriteObjectEnd()}},{key:\"ListDefinitionsToJToken\",value:function(t){var e,n={},i=g(t.lists);try{for(i.s();!(e=i.n()).done;){var r,a=e.value,s={},o=g(a.items);try{for(o.s();!(r=o.n()).done;){var u=d(r.value,2),l=u[0],h=u[1],c=I.fromSerializedKey(l);if(null===c.itemName)return P(\"item.itemName\");s[c.itemName]=h}}catch(t){o.e(t)}finally{o.f()}n[a.name]=s}}catch(t){i.e(t)}finally{i.f()}return n}},{key:\"JTokenToListDefinitions\",value:function(t){var e=t,n=[];for(var i in e)if(e.hasOwnProperty(i)){var r=i.toString(),a=e[i],s=new Map;for(var o in a)if(e.hasOwnProperty(i)){var u=a[o];s.set(o,parseInt(u))}var l=new at(r,s);n.push(l)}return new st(n)}}]),t}();ot._controlCommandNames=function(){var t=[];t[X.CommandType.EvalStart]=\"ev\",t[X.CommandType.EvalOutput]=\"out\",t[X.CommandType.EvalEnd]=\"/ev\",t[X.CommandType.Duplicate]=\"du\",t[X.CommandType.PopEvaluatedValue]=\"pop\",t[X.CommandType.PopFunction]=\"~ret\",t[X.CommandType.PopTunnel]=\"->->\",t[X.CommandType.BeginString]=\"str\",t[X.CommandType.EndString]=\"/str\",t[X.CommandType.NoOp]=\"nop\",t[X.CommandType.ChoiceCount]=\"choiceCnt\",t[X.CommandType.Turns]=\"turn\",t[X.CommandType.TurnsSince]=\"turns\",t[X.CommandType.ReadCount]=\"readc\",t[X.CommandType.Random]=\"rnd\",t[X.CommandType.SeedRandom]=\"srnd\",t[X.CommandType.VisitIndex]=\"visit\",t[X.CommandType.SequenceShuffleIndex]=\"seq\",t[X.CommandType.StartThread]=\"thread\",t[X.CommandType.Done]=\"done\",t[X.CommandType.End]=\"end\",t[X.CommandType.ListFromInt]=\"listInt\",t[X.CommandType.ListRange]=\"range\",t[X.CommandType.ListRandom]=\"lrnd\",t[X.CommandType.BeginTag]=\"#\",t[X.CommandType.EndTag]=\"/#\";for(var e=0;e<X.CommandType.TOTAL_VALUES;++e)if(null==t[e])throw new Error(\"Control command not accounted for in serialisation\");return t}();var ut=function(){function e(){if(n(this,e),this._threadCounter=0,this._startOfRoot=$.Null,arguments[0]instanceof t.Story){var i=arguments[0];this._startOfRoot=$.StartOf(i.rootContentContainer),this.Reset()}else{var r=arguments[0];this._threads=[];var a,s=g(r._threads);try{for(s.s();!(a=s.n()).done;){var o=a.value;this._threads.push(o.Copy())}}catch(t){s.e(t)}finally{s.f()}this._threadCounter=r._threadCounter,this._startOfRoot=r._startOfRoot.copy()}}return r(e,[{key:\"elements\",get:function(){return this.callStack}},{key:\"depth\",get:function(){return this.elements.length}},{key:\"currentElement\",get:function(){var t=this._threads[this._threads.length-1].callstack;return t[t.length-1]}},{key:\"currentElementIndex\",get:function(){return this.callStack.length-1}},{key:\"currentThread\",get:function(){return this._threads[this._threads.length-1]},set:function(t){S.Assert(1==this._threads.length,\"Shouldn't be directly setting the current thread when we have a stack of them\"),this._threads.length=0,this._threads.push(t)}},{key:\"canPop\",get:function(){return this.callStack.length>1}},{key:\"Reset\",value:function(){this._threads=[],this._threads.push(new e.Thread),this._threads[0].callstack.push(new e.Element(z.Tunnel,this._startOfRoot))}},{key:\"SetJsonToken\",value:function(t,n){this._threads.length=0;var i,r=g(t.threads);try{for(r.s();!(i=r.n()).done;){var a=i.value,s=new e.Thread(a,n);this._threads.push(s)}}catch(t){r.e(t)}finally{r.f()}this._threadCounter=parseInt(t.threadCounter),this._startOfRoot=$.StartOf(n.rootContentContainer)}},{key:\"WriteJson\",value:function(t){var e=this;t.WriteObject((function(t){t.WritePropertyStart(\"threads\"),t.WriteArrayStart();var n,i=g(e._threads);try{for(i.s();!(n=i.n()).done;){n.value.WriteJson(t)}}catch(t){i.e(t)}finally{i.f()}t.WriteArrayEnd(),t.WritePropertyEnd(),t.WritePropertyStart(\"threadCounter\"),t.WriteInt(e._threadCounter),t.WritePropertyEnd()}))}},{key:\"PushThread\",value:function(){var t=this.currentThread.Copy();this._threadCounter++,t.threadIndex=this._threadCounter,this._threads.push(t)}},{key:\"ForkThread\",value:function(){var t=this.currentThread.Copy();return this._threadCounter++,t.threadIndex=this._threadCounter,t}},{key:\"PopThread\",value:function(){if(!this.canPopThread)throw new Error(\"Can't pop thread\");this._threads.splice(this._threads.indexOf(this.currentThread),1)}},{key:\"canPopThread\",get:function(){return this._threads.length>1&&!this.elementIsEvaluateFromGame}},{key:\"elementIsEvaluateFromGame\",get:function(){return this.currentElement.type==z.FunctionEvaluationFromGame}},{key:\"Push\",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=new e.Element(t,this.currentElement.currentPointer,!1);r.evaluationStackHeightWhenPushed=n,r.functionStartInOutputStream=i,this.callStack.push(r)}},{key:\"CanPop\",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return!!this.canPop&&(null==t||this.currentElement.type==t)}},{key:\"Pop\",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!this.CanPop(t))throw new Error(\"Mismatched push/pop in Callstack\");this.callStack.pop()}},{key:\"GetTemporaryVariableWithName\",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;-1==e&&(e=this.currentElementIndex+1);var n=W(this.callStack[e-1].temporaryVariables,t,null);return n.exists?n.result:null}},{key:\"SetTemporaryVariable\",value:function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;-1==i&&(i=this.currentElementIndex+1);var r=this.callStack[i-1];if(!n&&!r.temporaryVariables.get(t))throw new Error(\"Could not find temporary variable to set: \"+t);var a=W(r.temporaryVariables,t,null);a.exists&&U.RetainListOriginsForAssignment(a.result,e),r.temporaryVariables.set(t,e)}},{key:\"ContextForVariableNamed\",value:function(t){return this.currentElement.temporaryVariables.get(t)?this.currentElementIndex+1:0}},{key:\"ThreadWithIndex\",value:function(t){var e=this._threads.filter((function(e){if(e.threadIndex==t)return e}));return e.length>0?e[0]:null}},{key:\"callStack\",get:function(){return this.currentThread.callstack}},{key:\"callStackTrace\",get:function(){for(var t=new A,e=0;e<this._threads.length;e++){var n=this._threads[e],i=e==this._threads.length-1;t.AppendFormat(\"=== THREAD {0}/{1} {2}===\\n\",e+1,this._threads.length,i?\"(current) \":\"\");for(var r=0;r<n.callstack.length;r++){n.callstack[r].type==z.Function?t.Append(\"  [FUNCTION] \"):t.Append(\"  [TUNNEL] \");var a=n.callstack[r].currentPointer;if(!a.isNull){if(t.Append(\"<SOMEWHERE IN \"),null===a.container)return P(\"pointer.container\");t.Append(a.container.path.toString()),t.AppendLine(\">\")}}}return t.toString()}}]),e}();!function(t){var e=function(){function t(e,i){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];n(this,t),this.evaluationStackHeightWhenPushed=0,this.functionStartInOutputStream=0,this.currentPointer=i.copy(),this.inExpressionEvaluation=r,this.temporaryVariables=new Map,this.type=e}return r(t,[{key:\"Copy\",value:function(){var e=new t(this.type,this.currentPointer,this.inExpressionEvaluation);return e.temporaryVariables=new Map(this.temporaryVariables),e.evaluationStackHeightWhenPushed=this.evaluationStackHeightWhenPushed,e.functionStartInOutputStream=this.functionStartInOutputStream,e}}]),t}();t.Element=e;var i=function(){function t(){if(n(this,t),this.threadIndex=0,this.previousPointer=$.Null,this.callstack=[],arguments[0]&&arguments[1]){var i=arguments[0],r=arguments[1];this.threadIndex=parseInt(i.threadIndex);var a,s=g(i.callstack);try{for(s.s();!(a=s.n()).done;){var o=a.value,u=parseInt(o.type),l=$.Null,h=void 0,c=o.cPath;if(void 0!==c){h=c.toString();var f=r.ContentAtPath(new k(h));if(l.container=f.container,l.index=parseInt(o.idx),null==f.obj)throw new Error(\"When loading state, internal story location couldn't be found: \"+h+\". Has the story changed since this save data was created?\");if(f.approximate){if(null===l.container)return P(\"pointer.container\");r.Warning(\"When loading state, exact internal story location couldn't be found: '\"+h+\"', so it was approximated to '\"+l.container.path.toString()+\"' to recover. Has the story changed since this save data was created?\")}}var v=!!o.exp,d=new e(u,l,v),p=o.temp;void 0!==p?d.temporaryVariables=ot.JObjectToDictionaryRuntimeObjs(p):d.temporaryVariables.clear(),this.callstack.push(d)}}catch(t){s.e(t)}finally{s.f()}var y=i.previousContentObject;if(void 0!==y){var m=new k(y.toString());this.previousPointer=r.PointerAtPath(m)}}}return r(t,[{key:\"Copy\",value:function(){var e=new t;e.threadIndex=this.threadIndex;var n,i=g(this.callstack);try{for(i.s();!(n=i.n()).done;){var r=n.value;e.callstack.push(r.Copy())}}catch(t){i.e(t)}finally{i.f()}return e.previousPointer=this.previousPointer.copy(),e}},{key:\"WriteJson\",value:function(t){t.WriteObjectStart(),t.WritePropertyStart(\"callstack\"),t.WriteArrayStart();var e,n=g(this.callstack);try{for(n.s();!(e=n.n()).done;){var i=e.value;if(t.WriteObjectStart(),!i.currentPointer.isNull){if(null===i.currentPointer.container)return P(\"el.currentPointer.container\");t.WriteProperty(\"cPath\",i.currentPointer.container.path.componentsString),t.WriteIntProperty(\"idx\",i.currentPointer.index)}t.WriteProperty(\"exp\",i.inExpressionEvaluation),t.WriteIntProperty(\"type\",i.type),i.temporaryVariables.size>0&&(t.WritePropertyStart(\"temp\"),ot.WriteDictionaryRuntimeObjs(t,i.temporaryVariables),t.WritePropertyEnd()),t.WriteObjectEnd()}}catch(t){n.e(t)}finally{n.f()}if(t.WriteArrayEnd(),t.WritePropertyEnd(),t.WriteIntProperty(\"threadIndex\",this.threadIndex),!this.previousPointer.isNull){var r=this.previousPointer.Resolve();if(null===r)return P(\"this.previousPointer.Resolve()\");t.WriteProperty(\"previousContentObject\",r.path.toString())}t.WriteObjectEnd()}}]),t}();t.Thread=i}(ut||(ut={}));var lt=function(t){a(i,t);var e=v(i);function i(t,r){var a;n(this,i),(a=e.call(this)).variableChangedEventCallbacks=[],a.patch=null,a._batchObservingVariableChanges=!1,a._defaultGlobalVariables=new Map,a._changedVariablesForBatchObs=new Set,a._globalVariables=new Map,a._callStack=t,a._listDefsOrigin=r;try{return f(a,new Proxy(c(a),{get:function(t,e){return e in t?t[e]:t.$(e)},set:function(t,e,n){return e in t?t[e]=n:t.$(e,n),!0}}))}catch(t){}return a}return r(i,[{key:\"variableChangedEvent\",value:function(t,e){var n,i=g(this.variableChangedEventCallbacks);try{for(i.s();!(n=i.n()).done;){(0,n.value)(t,e)}}catch(t){i.e(t)}finally{i.f()}}},{key:\"batchObservingVariableChanges\",get:function(){return this._batchObservingVariableChanges},set:function(t){if(this._batchObservingVariableChanges=t,t)this._changedVariablesForBatchObs=new Set;else if(null!=this._changedVariablesForBatchObs){var e,n=g(this._changedVariablesForBatchObs);try{for(n.s();!(e=n.n()).done;){var i=e.value,r=this._globalVariables.get(i);r?this.variableChangedEvent(i,r):P(\"currentValue\")}}catch(t){n.e(t)}finally{n.f()}this._changedVariablesForBatchObs=null}}},{key:\"callStack\",get:function(){return this._callStack},set:function(t){this._callStack=t}},{key:\"$\",value:function(t,e){if(void 0===e){var n=null;return null!==this.patch&&(n=this.patch.TryGetGlobal(t,null)).exists?n.result.valueObject:(void 0===(n=this._globalVariables.get(t))&&(n=this._defaultGlobalVariables.get(t)),void 0!==n?n.valueObject:null)}if(void 0===this._defaultGlobalVariables.get(t))throw new x(\"Cannot assign to a variable (\"+t+\") that hasn't been declared in the story\");var i=j.Create(e);if(null==i)throw null==e?new Error(\"Cannot pass null to VariableState\"):new Error(\"Invalid value passed to VariableState: \"+e.toString());this.SetGlobal(t,i)}},{key:\"ApplyPatch\",value:function(){if(null===this.patch)return P(\"this.patch\");var t,e=g(this.patch.globals);try{for(e.s();!(t=e.n()).done;){var n=d(t.value,2),i=n[0],r=n[1];this._globalVariables.set(i,r)}}catch(t){e.e(t)}finally{e.f()}if(null!==this._changedVariablesForBatchObs){var a,s=g(this.patch.changedVariables);try{for(s.s();!(a=s.n()).done;){var o=a.value;this._changedVariablesForBatchObs.add(o)}}catch(t){s.e(t)}finally{s.f()}}this.patch=null}},{key:\"SetJsonToken\",value:function(t){this._globalVariables.clear();var e,n=g(this._defaultGlobalVariables);try{for(n.s();!(e=n.n()).done;){var i=d(e.value,2),r=i[0],a=i[1],s=t[r];if(void 0!==s){var o=ot.JTokenToRuntimeObject(s);if(null===o)return P(\"tokenInkObject\");this._globalVariables.set(r,o)}else this._globalVariables.set(r,a)}}catch(t){n.e(t)}finally{n.f()}}},{key:\"WriteJson\",value:function(t){t.WriteObjectStart();var e,n=g(this._globalVariables);try{for(n.s();!(e=n.n()).done;){var r=d(e.value,2),a=r[0],s=r[1],o=a,u=s;if(i.dontSaveDefaultValues&&this._defaultGlobalVariables.has(o)){var l=this._defaultGlobalVariables.get(o);if(this.RuntimeObjectsEqual(u,l))continue}t.WritePropertyStart(o),ot.WriteRuntimeObject(t,u),t.WritePropertyEnd()}}catch(t){n.e(t)}finally{n.f()}t.WriteObjectEnd()}},{key:\"RuntimeObjectsEqual\",value:function(t,e){if(null===t)return P(\"obj1\");if(null===e)return P(\"obj2\");if(t.constructor!==e.constructor)return!1;var n=C(t,R);if(null!==n)return n.value===b(e,R).value;var i=C(t,D);if(null!==i)return i.value===b(e,D).value;var r=C(t,B);if(null!==r)return r.value===b(e,B).value;var a=C(t,j),s=C(e,j);if(null!==a&&null!==s)return T(a.valueObject)&&T(s.valueObject)?a.valueObject.Equals(s.valueObject):a.valueObject===s.valueObject;throw new Error(\"FastRoughDefinitelyEquals: Unsupported runtime object type: \"+t.constructor.name)}},{key:\"GetVariableWithName\",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=this.GetRawVariableWithName(t,e),i=C(n,J);return null!==i&&(n=this.ValueAtVariablePointer(i)),n}},{key:\"TryGetDefaultVariableValue\",value:function(t){var e=W(this._defaultGlobalVariables,t,null);return e.exists?e.result:null}},{key:\"GlobalVariableExistsWithName\",value:function(t){return this._globalVariables.has(t)||null!==this._defaultGlobalVariables&&this._defaultGlobalVariables.has(t)}},{key:\"GetRawVariableWithName\",value:function(t,e){if(0==e||-1==e){var n=null;if(null!==this.patch&&(n=this.patch.TryGetGlobal(t,null)).exists)return n.result;if((n=W(this._globalVariables,t,null)).exists)return n.result;if(null!==this._defaultGlobalVariables&&(n=W(this._defaultGlobalVariables,t,null)).exists)return n.result;if(null===this._listDefsOrigin)return P(\"VariablesState._listDefsOrigin\");var i=this._listDefsOrigin.FindSingleItemListWithName(t);if(i)return i}return this._callStack.GetTemporaryVariableWithName(t,e)}},{key:\"ValueAtVariablePointer\",value:function(t){return this.GetVariableWithName(t.variableName,t.contextIndex)}},{key:\"Assign\",value:function(t,e){var n=t.variableName;if(null===n)return P(\"name\");var i=-1,r=!1;if(r=t.isNewDeclaration?t.isGlobal:this.GlobalVariableExistsWithName(n),t.isNewDeclaration){var a=C(e,J);if(null!==a)e=this.ResolveVariablePointer(a)}else{var s=null;do{null!=(s=C(this.GetRawVariableWithName(n,i),J))&&(n=s.variableName,r=0==(i=s.contextIndex))}while(null!=s)}r?this.SetGlobal(n,e):this._callStack.SetTemporaryVariable(n,e,t.isNewDeclaration,i)}},{key:\"SnapshotDefaultGlobals\",value:function(){this._defaultGlobalVariables=new Map(this._globalVariables)}},{key:\"RetainListOriginsForAssignment\",value:function(t,e){var n=b(t,U),i=b(e,U);n.value&&i.value&&0==i.value.Count&&i.value.SetInitialOriginNames(n.value.originNames)}},{key:\"SetGlobal\",value:function(t,e){var n=null;if(null===this.patch&&(n=W(this._globalVariables,t,null)),null!==this.patch&&((n=this.patch.TryGetGlobal(t,null)).exists||(n=W(this._globalVariables,t,null))),U.RetainListOriginsForAssignment(n.result,e),null===t)return P(\"variableName\");if(null!==this.patch?this.patch.SetGlobal(t,e):this._globalVariables.set(t,e),null!==this.variableChangedEvent&&null!==n&&e!==n.result)if(this.batchObservingVariableChanges){if(null===this._changedVariablesForBatchObs)return P(\"this._changedVariablesForBatchObs\");null!==this.patch?this.patch.AddChangedVariable(t):null!==this._changedVariablesForBatchObs&&this._changedVariablesForBatchObs.add(t)}else this.variableChangedEvent(t,e)}},{key:\"ResolveVariablePointer\",value:function(t){var e=t.contextIndex;-1==e&&(e=this.GetContextIndexOfVariableNamed(t.variableName));var n=C(this.GetRawVariableWithName(t.variableName,e),J);return null!=n?n:new J(t.variableName,e)}},{key:\"GetContextIndexOfVariableNamed\",value:function(t){return this.GlobalVariableExistsWithName(t)?0:this._callStack.currentElementIndex}},{key:\"ObserveVariableChange\",value:function(t){this.variableChangedEventCallbacks.push(t)}}]),i}(function(){return r((function t(){n(this,t)}))}());lt.dontSaveDefaultValues=!0;var ht=function(){function t(e){n(this,t),this.seed=e%2147483647,this.seed<=0&&(this.seed+=2147483646)}return r(t,[{key:\"next\",value:function(){return this.seed=48271*this.seed%2147483647}},{key:\"nextFloat\",value:function(){return(this.next()-1)/2147483646}}]),t}(),ct=function(){function t(){if(n(this,t),this._changedVariables=new Set,this._visitCounts=new Map,this._turnIndices=new Map,1===arguments.length&&null!==arguments[0]){var e=arguments[0];this._globals=new Map(e._globals),this._changedVariables=new Set(e._changedVariables),this._visitCounts=new Map(e._visitCounts),this._turnIndices=new Map(e._turnIndices)}else this._globals=new Map,this._changedVariables=new Set,this._visitCounts=new Map,this._turnIndices=new Map}return r(t,[{key:\"globals\",get:function(){return this._globals}},{key:\"changedVariables\",get:function(){return this._changedVariables}},{key:\"visitCounts\",get:function(){return this._visitCounts}},{key:\"turnIndices\",get:function(){return this._turnIndices}},{key:\"TryGetGlobal\",value:function(t,e){return null!==t&&this._globals.has(t)?{result:this._globals.get(t),exists:!0}:{result:e,exists:!1}}},{key:\"SetGlobal\",value:function(t,e){this._globals.set(t,e)}},{key:\"AddChangedVariable\",value:function(t){return this._changedVariables.add(t)}},{key:\"TryGetVisitCount\",value:function(t,e){return this._visitCounts.has(t)?{result:this._visitCounts.get(t),exists:!0}:{result:e,exists:!1}}},{key:\"SetVisitCount\",value:function(t,e){this._visitCounts.set(t,e)}},{key:\"SetTurnIndex\",value:function(t,e){this._turnIndices.set(t,e)}},{key:\"TryGetTurnIndex\",value:function(t,e){return this._turnIndices.has(t)?{result:this._turnIndices.get(t),exists:!0}:{result:e,exists:!1}}}]),t}(),ft=function(){function t(){n(this,t)}return r(t,null,[{key:\"TextToDictionary\",value:function(e){return new t.Reader(e).ToDictionary()}},{key:\"TextToArray\",value:function(e){return new t.Reader(e).ToArray()}}]),t}();!function(t){var e=function(){function t(e){n(this,t),this._rootObject=JSON.parse(e)}return r(t,[{key:\"ToDictionary\",value:function(){return this._rootObject}},{key:\"ToArray\",value:function(){return this._rootObject}}]),t}();t.Reader=e;var i=function(){function e(){n(this,e),this._currentPropertyName=null,this._currentString=null,this._stateStack=[],this._collectionStack=[],this._propertyNameStack=[],this._jsonObject=null}return r(e,[{key:\"WriteObject\",value:function(t){this.WriteObjectStart(),t(this),this.WriteObjectEnd()}},{key:\"WriteObjectStart\",value:function(){this.StartNewObject(!0);var e={};if(this.state===t.Writer.State.Property){this.Assert(null!==this.currentCollection),this.Assert(null!==this.currentPropertyName);var n=this._propertyNameStack.pop();this.currentCollection[n]=e,this._collectionStack.push(e)}else this.state===t.Writer.State.Array?(this.Assert(null!==this.currentCollection),this.currentCollection.push(e),this._collectionStack.push(e)):(this.Assert(this.state===t.Writer.State.None),this._jsonObject=e,this._collectionStack.push(e));this._stateStack.push(new t.Writer.StateElement(t.Writer.State.Object))}},{key:\"WriteObjectEnd\",value:function(){this.Assert(this.state===t.Writer.State.Object),this._collectionStack.pop(),this._stateStack.pop()}},{key:\"WriteProperty\",value:function(t,e){if(this.WritePropertyStart(t),arguments[1]instanceof Function){(0,arguments[1])(this)}else{var n=arguments[1];this.Write(n)}this.WritePropertyEnd()}},{key:\"WriteIntProperty\",value:function(t,e){this.WritePropertyStart(t),this.WriteInt(e),this.WritePropertyEnd()}},{key:\"WriteFloatProperty\",value:function(t,e){this.WritePropertyStart(t),this.WriteFloat(e),this.WritePropertyEnd()}},{key:\"WritePropertyStart\",value:function(e){this.Assert(this.state===t.Writer.State.Object),this._propertyNameStack.push(e),this.IncrementChildCount(),this._stateStack.push(new t.Writer.StateElement(t.Writer.State.Property))}},{key:\"WritePropertyEnd\",value:function(){this.Assert(this.state===t.Writer.State.Property),this.Assert(1===this.childCount),this._stateStack.pop()}},{key:\"WritePropertyNameStart\",value:function(){this.Assert(this.state===t.Writer.State.Object),this.IncrementChildCount(),this._currentPropertyName=\"\",this._stateStack.push(new t.Writer.StateElement(t.Writer.State.Property)),this._stateStack.push(new t.Writer.StateElement(t.Writer.State.PropertyName))}},{key:\"WritePropertyNameEnd\",value:function(){this.Assert(this.state===t.Writer.State.PropertyName),this.Assert(null!==this._currentPropertyName),this._propertyNameStack.push(this._currentPropertyName),this._currentPropertyName=null,this._stateStack.pop()}},{key:\"WritePropertyNameInner\",value:function(e){this.Assert(this.state===t.Writer.State.PropertyName),this.Assert(null!==this._currentPropertyName),this._currentPropertyName+=e}},{key:\"WriteArrayStart\",value:function(){this.StartNewObject(!0);var e=[];if(this.state===t.Writer.State.Property){this.Assert(null!==this.currentCollection),this.Assert(null!==this.currentPropertyName);var n=this._propertyNameStack.pop();this.currentCollection[n]=e,this._collectionStack.push(e)}else this.state===t.Writer.State.Array?(this.Assert(null!==this.currentCollection),this.currentCollection.push(e),this._collectionStack.push(e)):(this.Assert(this.state===t.Writer.State.None),this._jsonObject=e,this._collectionStack.push(e));this._stateStack.push(new t.Writer.StateElement(t.Writer.State.Array))}},{key:\"WriteArrayEnd\",value:function(){this.Assert(this.state===t.Writer.State.Array),this._collectionStack.pop(),this._stateStack.pop()}},{key:\"Write\",value:function(t){null!==t?(this.StartNewObject(!1),this._addToCurrentObject(t)):console.error(\"Warning: trying to write a null value\")}},{key:\"WriteBool\",value:function(t){null!==t&&(this.StartNewObject(!1),this._addToCurrentObject(t))}},{key:\"WriteInt\",value:function(t){null!==t&&(this.StartNewObject(!1),this._addToCurrentObject(Math.floor(t)))}},{key:\"WriteFloat\",value:function(t){null!==t&&(this.StartNewObject(!1),t==Number.POSITIVE_INFINITY?this._addToCurrentObject(34e37):t==Number.NEGATIVE_INFINITY?this._addToCurrentObject(-34e37):isNaN(t)?this._addToCurrentObject(0):this._addToCurrentObject(t))}},{key:\"WriteNull\",value:function(){this.StartNewObject(!1),this._addToCurrentObject(null)}},{key:\"WriteStringStart\",value:function(){this.StartNewObject(!1),this._currentString=\"\",this._stateStack.push(new t.Writer.StateElement(t.Writer.State.String))}},{key:\"WriteStringEnd\",value:function(){this.Assert(this.state==t.Writer.State.String),this._stateStack.pop(),this._addToCurrentObject(this._currentString),this._currentString=null}},{key:\"WriteStringInner\",value:function(e){this.Assert(this.state===t.Writer.State.String),null!==e?this._currentString+=e:console.error(\"Warning: trying to write a null string\")}},{key:\"toString\",value:function(){return null===this._jsonObject?\"\":JSON.stringify(this._jsonObject)}},{key:\"StartNewObject\",value:function(e){e?this.Assert(this.state===t.Writer.State.None||this.state===t.Writer.State.Property||this.state===t.Writer.State.Array):this.Assert(this.state===t.Writer.State.Property||this.state===t.Writer.State.Array),this.state===t.Writer.State.Property&&this.Assert(0===this.childCount),this.state!==t.Writer.State.Array&&this.state!==t.Writer.State.Property||this.IncrementChildCount()}},{key:\"state\",get:function(){return this._stateStack.length>0?this._stateStack[this._stateStack.length-1].type:t.Writer.State.None}},{key:\"childCount\",get:function(){return this._stateStack.length>0?this._stateStack[this._stateStack.length-1].childCount:0}},{key:\"currentCollection\",get:function(){return this._collectionStack.length>0?this._collectionStack[this._collectionStack.length-1]:null}},{key:\"currentPropertyName\",get:function(){return this._propertyNameStack.length>0?this._propertyNameStack[this._propertyNameStack.length-1]:null}},{key:\"IncrementChildCount\",value:function(){this.Assert(this._stateStack.length>0);var t=this._stateStack.pop();t.childCount++,this._stateStack.push(t)}},{key:\"Assert\",value:function(t){if(!t)throw Error(\"Assert failed while writing JSON\")}},{key:\"_addToCurrentObject\",value:function(e){this.Assert(null!==this.currentCollection),this.state===t.Writer.State.Array?(this.Assert(Array.isArray(this.currentCollection)),this.currentCollection.push(e)):this.state===t.Writer.State.Property&&(this.Assert(!Array.isArray(this.currentCollection)),this.Assert(null!==this.currentPropertyName),this.currentCollection[this.currentPropertyName]=e,this._propertyNameStack.pop())}}]),e}();t.Writer=i,function(e){var i;(i=e.State||(e.State={}))[i.None=0]=\"None\",i[i.Object=1]=\"Object\",i[i.Array=2]=\"Array\",i[i.Property=3]=\"Property\",i[i.PropertyName=4]=\"PropertyName\",i[i.String=5]=\"String\";var a=r((function e(i){n(this,e),this.type=t.Writer.State.None,this.childCount=0,this.type=i}));e.StateElement=a}(i=t.Writer||(t.Writer={}))}(ft||(ft={}));var vt,dt,pt,yt=function(){function t(){n(this,t);var e=arguments[0],i=arguments[1];if(this.name=e,this.callStack=new ut(i),arguments[2]){var r=arguments[2];this.callStack.SetJsonToken(r.callstack,i),this.outputStream=ot.JArrayToRuntimeObjList(r.outputStream),this.currentChoices=ot.JArrayToRuntimeObjList(r.currentChoices);var a=r.choiceThreads;void 0!==a&&this.LoadFlowChoiceThreads(a,i)}else this.outputStream=[],this.currentChoices=[]}return r(t,[{key:\"WriteJson\",value:function(t){var e=this;t.WriteObjectStart(),t.WriteProperty(\"callstack\",(function(t){return e.callStack.WriteJson(t)})),t.WriteProperty(\"outputStream\",(function(t){return ot.WriteListRuntimeObjs(t,e.outputStream)}));var n,i=!1,r=g(this.currentChoices);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(null===a.threadAtGeneration)return P(\"c.threadAtGeneration\");a.originalThreadIndex=a.threadAtGeneration.threadIndex,null===this.callStack.ThreadWithIndex(a.originalThreadIndex)&&(i||(i=!0,t.WritePropertyStart(\"choiceThreads\"),t.WriteObjectStart()),t.WritePropertyStart(a.originalThreadIndex),a.threadAtGeneration.WriteJson(t),t.WritePropertyEnd())}}catch(t){r.e(t)}finally{r.f()}i&&(t.WriteObjectEnd(),t.WritePropertyEnd()),t.WriteProperty(\"currentChoices\",(function(t){t.WriteArrayStart();var n,i=g(e.currentChoices);try{for(i.s();!(n=i.n()).done;){var r=n.value;ot.WriteChoice(t,r)}}catch(t){i.e(t)}finally{i.f()}t.WriteArrayEnd()})),t.WriteObjectEnd()}},{key:\"LoadFlowChoiceThreads\",value:function(t,e){var n,i=g(this.currentChoices);try{for(i.s();!(n=i.n()).done;){var r=n.value,a=this.callStack.ThreadWithIndex(r.originalThreadIndex);if(null!==a)r.threadAtGeneration=a.Copy();else{var s=t[\"\".concat(r.originalThreadIndex)];r.threadAtGeneration=new ut.Thread(s,e)}}}catch(t){i.e(t)}finally{i.f()}}}]),t}(),mt=function(){function e(t){n(this,e),this.kInkSaveStateVersion=10,this.kMinCompatibleLoadVersion=8,this.onDidLoadState=null,this._currentErrors=null,this._currentWarnings=null,this.divertedPointer=$.Null,this._currentTurnIndex=0,this.storySeed=0,this.previousRandom=0,this.didSafeExit=!1,this._currentText=null,this._currentTags=null,this._outputStreamTextDirty=!0,this._outputStreamTagsDirty=!0,this._patch=null,this._aliveFlowNames=null,this._namedFlows=null,this.kDefaultFlowName=\"DEFAULT_FLOW\",this._aliveFlowNamesDirty=!0,this.story=t,this._currentFlow=new yt(this.kDefaultFlowName,t),this.OutputStreamDirty(),this._aliveFlowNamesDirty=!0,this._evaluationStack=[],this._variablesState=new lt(this.callStack,t.listDefinitions),this._visitCounts=new Map,this._turnIndices=new Map,this.currentTurnIndex=-1;var i=(new Date).getTime();this.storySeed=new ht(i).next()%100,this.previousRandom=0,this.GoToStart()}return r(e,[{key:\"ToJson\",value:function(){var t=new ft.Writer;return this.WriteJson(t),t.toString()}},{key:\"toJson\",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.ToJson(t)}},{key:\"LoadJson\",value:function(t){var e=ft.TextToDictionary(t);this.LoadJsonObj(e),null!==this.onDidLoadState&&this.onDidLoadState()}},{key:\"VisitCountAtPathString\",value:function(t){var e;if(null!==this._patch){var n=this.story.ContentAtPath(new k(t)).container;if(null===n)throw new Error(\"Content at path not found: \"+t);if((e=this._patch.TryGetVisitCount(n,0)).exists)return e.result}return(e=W(this._visitCounts,t,null)).exists?e.result:0}},{key:\"VisitCountForContainer\",value:function(t){if(null===t)return P(\"container\");if(!t.visitsShouldBeCounted)return this.story.Error(\"Read count for target (\"+t.name+\" - on \"+t.debugMetadata+\") unknown. The story may need to be compiled with countAllVisits flag (-c).\"),0;if(null!==this._patch){var e=this._patch.TryGetVisitCount(t,0);if(e.exists)return e.result}var n=t.path.toString(),i=W(this._visitCounts,n,null);return i.exists?i.result:0}},{key:\"IncrementVisitCountForContainer\",value:function(t){if(null!==this._patch){var e=this.VisitCountForContainer(t);return e++,void this._patch.SetVisitCount(t,e)}var n=t.path.toString(),i=W(this._visitCounts,n,null);i.exists?this._visitCounts.set(n,i.result+1):this._visitCounts.set(n,1)}},{key:\"RecordTurnIndexVisitToContainer\",value:function(t){if(null===this._patch){var e=t.path.toString();this._turnIndices.set(e,this.currentTurnIndex)}else this._patch.SetTurnIndex(t,this.currentTurnIndex)}},{key:\"TurnsSinceForContainer\",value:function(t){if(t.turnIndexShouldBeCounted||this.story.Error(\"TURNS_SINCE() for target (\"+t.name+\" - on \"+t.debugMetadata+\") unknown. The story may need to be compiled with countAllVisits flag (-c).\"),null!==this._patch){var e=this._patch.TryGetTurnIndex(t,0);if(e.exists)return this.currentTurnIndex-e.result}var n=t.path.toString(),i=W(this._turnIndices,n,0);return i.exists?this.currentTurnIndex-i.result:-1}},{key:\"callstackDepth\",get:function(){return this.callStack.depth}},{key:\"outputStream\",get:function(){return this._currentFlow.outputStream}},{key:\"currentChoices\",get:function(){return this.canContinue?[]:this._currentFlow.currentChoices}},{key:\"generatedChoices\",get:function(){return this._currentFlow.currentChoices}},{key:\"currentErrors\",get:function(){return this._currentErrors}},{key:\"currentWarnings\",get:function(){return this._currentWarnings}},{key:\"variablesState\",get:function(){return this._variablesState},set:function(t){this._variablesState=t}},{key:\"callStack\",get:function(){return this._currentFlow.callStack}},{key:\"evaluationStack\",get:function(){return this._evaluationStack}},{key:\"currentTurnIndex\",get:function(){return this._currentTurnIndex},set:function(t){this._currentTurnIndex=t}},{key:\"currentPathString\",get:function(){var t=this.currentPointer;return t.isNull?null:null===t.path?P(\"pointer.path\"):t.path.toString()}},{key:\"currentPointer\",get:function(){return this.callStack.currentElement.currentPointer.copy()},set:function(t){this.callStack.currentElement.currentPointer=t.copy()}},{key:\"previousPointer\",get:function(){return this.callStack.currentThread.previousPointer.copy()},set:function(t){this.callStack.currentThread.previousPointer=t.copy()}},{key:\"canContinue\",get:function(){return!this.currentPointer.isNull&&!this.hasError}},{key:\"hasError\",get:function(){return null!=this.currentErrors&&this.currentErrors.length>0}},{key:\"hasWarning\",get:function(){return null!=this.currentWarnings&&this.currentWarnings.length>0}},{key:\"currentText\",get:function(){if(this._outputStreamTextDirty){var t,e=new A,n=!1,i=g(this.outputStream);try{for(i.s();!(t=i.n()).done;){var r=t.value,a=C(r,G);if(n||null===a){var s=C(r,X);null!==s&&(s.commandType==X.CommandType.BeginTag?n=!0:s.commandType==X.CommandType.EndTag&&(n=!1))}else e.Append(a.value)}}catch(t){i.e(t)}finally{i.f()}this._currentText=this.CleanOutputWhitespace(e.toString()),this._outputStreamTextDirty=!1}return this._currentText}},{key:\"CleanOutputWhitespace\",value:function(t){for(var e=new A,n=-1,i=0,r=0;r<t.length;r++){var a=t.charAt(r),s=\" \"==a||\"\\t\"==a;s&&-1==n&&(n=r),s||(\"\\n\"!=a&&n>0&&n!=i&&e.Append(\" \"),n=-1),\"\\n\"==a&&(i=r+1),s||e.Append(a)}return e.toString()}},{key:\"currentTags\",get:function(){if(this._outputStreamTagsDirty){this._currentTags=[];var t,e=!1,n=new A,i=g(this.outputStream);try{for(i.s();!(t=i.n()).done;){var r=t.value,a=C(r,X);if(null!=a){if(a.commandType==X.CommandType.BeginTag){if(e&&n.Length>0){var s=this.CleanOutputWhitespace(n.toString());this._currentTags.push(s),n.Clear()}e=!0}else if(a.commandType==X.CommandType.EndTag){if(n.Length>0){var o=this.CleanOutputWhitespace(n.toString());this._currentTags.push(o),n.Clear()}e=!1}}else if(e){var u=C(r,G);null!==u&&n.Append(u.value)}else{var l=C(r,it);null!=l&&null!=l.text&&l.text.length>0&&this._currentTags.push(l.text)}}}catch(t){i.e(t)}finally{i.f()}if(n.Length>0){var h=this.CleanOutputWhitespace(n.toString());this._currentTags.push(h),n.Clear()}this._outputStreamTagsDirty=!1}return this._currentTags}},{key:\"currentFlowName\",get:function(){return this._currentFlow.name}},{key:\"currentFlowIsDefaultFlow\",get:function(){return this._currentFlow.name==this.kDefaultFlowName}},{key:\"aliveFlowNames\",get:function(){if(this._aliveFlowNamesDirty){if(this._aliveFlowNames=[],null!=this._namedFlows){var t,e=g(this._namedFlows.keys());try{for(e.s();!(t=e.n()).done;){var n=t.value;n!=this.kDefaultFlowName&&this._aliveFlowNames.push(n)}}catch(t){e.e(t)}finally{e.f()}}this._aliveFlowNamesDirty=!1}return this._aliveFlowNames}},{key:\"inExpressionEvaluation\",get:function(){return this.callStack.currentElement.inExpressionEvaluation},set:function(t){this.callStack.currentElement.inExpressionEvaluation=t}},{key:\"GoToStart\",value:function(){this.callStack.currentElement.currentPointer=$.StartOf(this.story.mainContentContainer)}},{key:\"SwitchFlow_Internal\",value:function(t){if(null===t)throw new Error(\"Must pass a non-null string to Story.SwitchFlow\");if(null===this._namedFlows&&(this._namedFlows=new Map,this._namedFlows.set(this.kDefaultFlowName,this._currentFlow)),t!==this._currentFlow.name){var e,n=W(this._namedFlows,t,null);n.exists?e=n.result:(e=new yt(t,this.story),this._namedFlows.set(t,e),this._aliveFlowNamesDirty=!0),this._currentFlow=e,this.variablesState.callStack=this._currentFlow.callStack,this.OutputStreamDirty()}}},{key:\"SwitchToDefaultFlow_Internal\",value:function(){null!==this._namedFlows&&this.SwitchFlow_Internal(this.kDefaultFlowName)}},{key:\"RemoveFlow_Internal\",value:function(t){if(null===t)throw new Error(\"Must pass a non-null string to Story.DestroyFlow\");if(t===this.kDefaultFlowName)throw new Error(\"Cannot destroy default flow\");if(this._currentFlow.name===t&&this.SwitchToDefaultFlow_Internal(),null===this._namedFlows)return P(\"this._namedFlows\");this._namedFlows.delete(t),this._aliveFlowNamesDirty=!0}},{key:\"CopyAndStartPatching\",value:function(){var t,n,i,r,a,s=new e(this.story);if(s._patch=new ct(this._patch),s._currentFlow.name=this._currentFlow.name,s._currentFlow.callStack=new ut(this._currentFlow.callStack),(t=s._currentFlow.currentChoices).push.apply(t,p(this._currentFlow.currentChoices)),(n=s._currentFlow.outputStream).push.apply(n,p(this._currentFlow.outputStream)),s.OutputStreamDirty(),null!==this._namedFlows){s._namedFlows=new Map;var o,u=g(this._namedFlows);try{for(u.s();!(o=u.n()).done;){var l=d(o.value,2),h=l[0],c=l[1];s._namedFlows.set(h,c),s._aliveFlowNamesDirty=!0}}catch(t){u.e(t)}finally{u.f()}s._namedFlows.set(this._currentFlow.name,s._currentFlow)}this.hasError&&(s._currentErrors=[],(r=s._currentErrors).push.apply(r,p(this.currentErrors||[])));this.hasWarning&&(s._currentWarnings=[],(a=s._currentWarnings).push.apply(a,p(this.currentWarnings||[])));return s.variablesState=this.variablesState,s.variablesState.callStack=s.callStack,s.variablesState.patch=s._patch,(i=s.evaluationStack).push.apply(i,p(this.evaluationStack)),this.divertedPointer.isNull||(s.divertedPointer=this.divertedPointer.copy()),s.previousPointer=this.previousPointer.copy(),s._visitCounts=this._visitCounts,s._turnIndices=this._turnIndices,s.currentTurnIndex=this.currentTurnIndex,s.storySeed=this.storySeed,s.previousRandom=this.previousRandom,s.didSafeExit=this.didSafeExit,s}},{key:\"RestoreAfterPatch\",value:function(){this.variablesState.callStack=this.callStack,this.variablesState.patch=this._patch}},{key:\"ApplyAnyPatch\",value:function(){if(null!==this._patch){this.variablesState.ApplyPatch();var t,e=g(this._patch.visitCounts);try{for(e.s();!(t=e.n()).done;){var n=d(t.value,2),i=n[0],r=n[1];this.ApplyCountChanges(i,r,!0)}}catch(t){e.e(t)}finally{e.f()}var a,s=g(this._patch.turnIndices);try{for(s.s();!(a=s.n()).done;){var o=d(a.value,2),u=o[0],l=o[1];this.ApplyCountChanges(u,l,!1)}}catch(t){s.e(t)}finally{s.f()}this._patch=null}}},{key:\"ApplyCountChanges\",value:function(t,e,n){(n?this._visitCounts:this._turnIndices).set(t.path.toString(),e)}},{key:\"WriteJson\",value:function(e){var n=this;if(e.WriteObjectStart(),e.WritePropertyStart(\"flows\"),e.WriteObjectStart(),null!==this._namedFlows){var i,r=g(this._namedFlows);try{var a=function(){var t=d(i.value,2),n=t[0],r=t[1];e.WriteProperty(n,(function(t){return r.WriteJson(t)}))};for(r.s();!(i=r.n()).done;)a()}catch(t){r.e(t)}finally{r.f()}}else e.WriteProperty(this._currentFlow.name,(function(t){return n._currentFlow.WriteJson(t)}));if(e.WriteObjectEnd(),e.WritePropertyEnd(),e.WriteProperty(\"currentFlowName\",this._currentFlow.name),e.WriteProperty(\"variablesState\",(function(t){return n.variablesState.WriteJson(t)})),e.WriteProperty(\"evalStack\",(function(t){return ot.WriteListRuntimeObjs(t,n.evaluationStack)})),!this.divertedPointer.isNull){if(null===this.divertedPointer.path)return P(\"divertedPointer\");e.WriteProperty(\"currentDivertTarget\",this.divertedPointer.path.componentsString)}e.WriteProperty(\"visitCounts\",(function(t){return ot.WriteIntDictionary(t,n._visitCounts)})),e.WriteProperty(\"turnIndices\",(function(t){return ot.WriteIntDictionary(t,n._turnIndices)})),e.WriteIntProperty(\"turnIdx\",this.currentTurnIndex),e.WriteIntProperty(\"storySeed\",this.storySeed),e.WriteIntProperty(\"previousRandom\",this.previousRandom),e.WriteIntProperty(\"inkSaveVersion\",this.kInkSaveStateVersion),e.WriteIntProperty(\"inkFormatVersion\",t.Story.inkVersionCurrent),e.WriteObjectEnd()}},{key:\"LoadJsonObj\",value:function(t){var e=t,n=e.inkSaveVersion;if(null==n)throw new Error(\"ink save format incorrect, can't load.\");if(parseInt(n)<this.kMinCompatibleLoadVersion)throw new Error(\"Ink save format isn't compatible with the current version (saw '\"+n+\"', but minimum is \"+this.kMinCompatibleLoadVersion+\"), so can't load.\");var i=e.flows;if(null!=i){var r=i;1===Object.keys(r).length?this._namedFlows=null:null===this._namedFlows?this._namedFlows=new Map:this._namedFlows.clear();for(var a=0,s=Object.entries(r);a<s.length;a++){var o=d(s[a],2),u=o[0],l=o[1],h=new yt(u,this.story,l);if(1===Object.keys(r).length)this._currentFlow=new yt(u,this.story,l);else{if(null===this._namedFlows)return P(\"this._namedFlows\");this._namedFlows.set(u,h)}}if(null!=this._namedFlows&&this._namedFlows.size>1){var c=e.currentFlowName;this._currentFlow=this._namedFlows.get(c)}}else{this._namedFlows=null,this._currentFlow.name=this.kDefaultFlowName,this._currentFlow.callStack.SetJsonToken(e.callstackThreads,this.story),this._currentFlow.outputStream=ot.JArrayToRuntimeObjList(e.outputStream),this._currentFlow.currentChoices=ot.JArrayToRuntimeObjList(e.currentChoices);var f=e.choiceThreads;this._currentFlow.LoadFlowChoiceThreads(f,this.story)}this.OutputStreamDirty(),this._aliveFlowNamesDirty=!0,this.variablesState.SetJsonToken(e.variablesState),this.variablesState.callStack=this._currentFlow.callStack,this._evaluationStack=ot.JArrayToRuntimeObjList(e.evalStack);var v=e.currentDivertTarget;if(null!=v){var p=new k(v.toString());this.divertedPointer=this.story.PointerAtPath(p)}this._visitCounts=ot.JObjectToIntDictionary(e.visitCounts),this._turnIndices=ot.JObjectToIntDictionary(e.turnIndices),this.currentTurnIndex=parseInt(e.turnIdx),this.storySeed=parseInt(e.storySeed),this.previousRandom=parseInt(e.previousRandom)}},{key:\"ResetErrors\",value:function(){this._currentErrors=null,this._currentWarnings=null}},{key:\"ResetOutput\",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.outputStream.length=0,null!==e&&(t=this.outputStream).push.apply(t,p(e)),this.OutputStreamDirty()}},{key:\"PushToOutputStream\",value:function(t){var e=C(t,G);if(null!==e){var n=this.TrySplittingHeadTailWhitespace(e);if(null!==n){var i,r=g(n);try{for(r.s();!(i=r.n()).done;){var a=i.value;this.PushToOutputStreamIndividual(a)}}catch(t){r.e(t)}finally{r.f()}return void this.OutputStreamDirty()}}this.PushToOutputStreamIndividual(t),this.OutputStreamDirty()}},{key:\"PopFromOutputStream\",value:function(t){this.outputStream.splice(this.outputStream.length-t,t),this.OutputStreamDirty()}},{key:\"TrySplittingHeadTailWhitespace\",value:function(t){var e=t.value;if(null===e)return P(\"single.value\");for(var n=-1,i=-1,r=0;r<e.length;r++){var a=e[r];if(\"\\n\"!=a){if(\" \"==a||\"\\t\"==a)continue;break}-1==n&&(n=r),i=r}for(var s=-1,o=-1,u=e.length-1;u>=0;u--){var l=e[u];if(\"\\n\"!=l){if(\" \"==l||\"\\t\"==l)continue;break}-1==s&&(s=u),o=u}if(-1==n&&-1==s)return null;var h=[],c=0,f=e.length;if(-1!=n){if(n>0){var v=new G(e.substring(0,n));h.push(v)}h.push(new G(\"\\n\")),c=i+1}if(-1!=s&&(f=o),f>c){var d=e.substring(c,f);h.push(new G(d))}if(-1!=s&&o>i&&(h.push(new G(\"\\n\")),s<e.length-1)){var p=e.length-s-1,y=new G(e.substring(s+1,s+1+p));h.push(y)}return h}},{key:\"PushToOutputStreamIndividual\",value:function(t){var e=C(t,H),n=C(t,G),i=!0;if(e)this.TrimNewlinesFromOutputStream(),i=!0;else if(n){var r=-1,a=this.callStack.currentElement;a.type==z.Function&&(r=a.functionStartInOutputStream);for(var s=-1,o=this.outputStream.length-1;o>=0;o--){var u=this.outputStream[o],l=u instanceof X?u:null;if(null!=(u instanceof H?u:null)){s=o;break}if(null!=l&&l.commandType==X.CommandType.BeginString){o>=r&&(r=-1);break}}if(-1!=(-1!=s&&-1!=r?Math.min(r,s):-1!=s?s:r)){if(n.isNewline)i=!1;else if(n.isNonWhitespace&&(s>-1&&this.RemoveExistingGlue(),r>-1))for(var h=this.callStack.elements,c=h.length-1;c>=0;c--){var f=h[c];if(f.type!=z.Function)break;f.functionStartInOutputStream=-1}}else n.isNewline&&(!this.outputStreamEndsInNewline&&this.outputStreamContainsContent||(i=!1))}if(i){if(null===t)return P(\"obj\");this.outputStream.push(t),this.OutputStreamDirty()}}},{key:\"TrimNewlinesFromOutputStream\",value:function(){for(var t=-1,e=this.outputStream.length-1;e>=0;){var n=this.outputStream[e],i=C(n,X),r=C(n,G);if(null!=i||null!=r&&r.isNonWhitespace)break;null!=r&&r.isNewline&&(t=e),e--}if(t>=0)for(e=t;e<this.outputStream.length;){C(this.outputStream[e],G)?this.outputStream.splice(e,1):e++}this.OutputStreamDirty()}},{key:\"RemoveExistingGlue\",value:function(){for(var t=this.outputStream.length-1;t>=0;t--){var e=this.outputStream[t];if(e instanceof H)this.outputStream.splice(t,1);else if(e instanceof X)break}this.OutputStreamDirty()}},{key:\"outputStreamEndsInNewline\",get:function(){if(this.outputStream.length>0)for(var t=this.outputStream.length-1;t>=0;t--){if(this.outputStream[t]instanceof X)break;var e=this.outputStream[t];if(e instanceof G){if(e.isNewline)return!0;if(e.isNonWhitespace)break}}return!1}},{key:\"outputStreamContainsContent\",get:function(){var t,e=g(this.outputStream);try{for(e.s();!(t=e.n()).done;){if(t.value instanceof G)return!0}}catch(t){e.e(t)}finally{e.f()}return!1}},{key:\"inStringEvaluation\",get:function(){for(var t=this.outputStream.length-1;t>=0;t--){var e=C(this.outputStream[t],X);if(e instanceof X&&e.commandType==X.CommandType.BeginString)return!0}return!1}},{key:\"PushEvaluationStack\",value:function(t){var e=C(t,U);if(e){var n=e.value;if(null===n)return P(\"rawList\");if(null!=n.originNames){n.origins||(n.origins=[]),n.origins.length=0;var i,r=g(n.originNames);try{for(r.s();!(i=r.n()).done;){var a=i.value;if(null===this.story.listDefinitions)return P(\"StoryState.story.listDefinitions\");var s=this.story.listDefinitions.TryListGetDefinition(a,null);if(null===s.result)return P(\"StoryState def.result\");n.origins.indexOf(s.result)<0&&n.origins.push(s.result)}}catch(t){r.e(t)}finally{r.f()}}}if(null===t)return P(\"obj\");this.evaluationStack.push(t)}},{key:\"PopEvaluationStack\",value:function(t){if(void 0===t)return _(this.evaluationStack.pop());if(t>this.evaluationStack.length)throw new Error(\"trying to pop too many objects\");return _(this.evaluationStack.splice(this.evaluationStack.length-t,t))}},{key:\"PeekEvaluationStack\",value:function(){return this.evaluationStack[this.evaluationStack.length-1]}},{key:\"ForceEnd\",value:function(){this.callStack.Reset(),this._currentFlow.currentChoices.length=0,this.currentPointer=$.Null,this.previousPointer=$.Null,this.didSafeExit=!0}},{key:\"TrimWhitespaceFromFunctionEnd\",value:function(){S.Assert(this.callStack.currentElement.type==z.Function);var t=this.callStack.currentElement.functionStartInOutputStream;-1==t&&(t=0);for(var e=this.outputStream.length-1;e>=t;e--){var n=this.outputStream[e],i=C(n,G),r=C(n,X);if(null!=i){if(r)break;if(!i.isNewline&&!i.isInlineWhitespace)break;this.outputStream.splice(e,1),this.OutputStreamDirty()}}}},{key:\"PopCallStack\",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.callStack.currentElement.type==z.Function&&this.TrimWhitespaceFromFunctionEnd(),this.callStack.Pop(t)}},{key:\"SetChosenPath\",value:function(t,e){this._currentFlow.currentChoices.length=0;var n=this.story.PointerAtPath(t);n.isNull||-1!=n.index||(n.index=0),this.currentPointer=n,e&&this.currentTurnIndex++}},{key:\"StartFunctionEvaluationFromGame\",value:function(t,e){this.callStack.Push(z.FunctionEvaluationFromGame,this.evaluationStack.length),this.callStack.currentElement.currentPointer=$.StartOf(t),this.PassArgumentsToEvaluationStack(e)}},{key:\"PassArgumentsToEvaluationStack\",value:function(t){if(null!==t)for(var e=0;e<t.length;e++){if(!(\"number\"==typeof t[e]||\"string\"==typeof t[e]||\"boolean\"==typeof t[e]||t[e]instanceof F))throw new Error((_(arguments[e]),\"null\"));this.PushEvaluationStack(j.Create(t[e]))}}},{key:\"TryExitFunctionEvaluationFromGame\",value:function(){return this.callStack.currentElement.type==z.FunctionEvaluationFromGame&&(this.currentPointer=$.Null,this.didSafeExit=!0,!0)}},{key:\"CompleteFunctionEvaluationFromGame\",value:function(){if(this.callStack.currentElement.type!=z.FunctionEvaluationFromGame)throw new Error(\"Expected external function evaluation to be complete. Stack trace: \"+this.callStack.callStackTrace);for(var t=this.callStack.currentElement.evaluationStackHeightWhenPushed,e=null;this.evaluationStack.length>t;){var n=this.PopEvaluationStack();null===e&&(e=n)}if(this.PopCallStack(z.FunctionEvaluationFromGame),e){if(e instanceof et)return null;var i=b(e,j);return i.valueType==V.DivertTarget?i.valueObject.toString():i.valueObject}return null}},{key:\"AddError\",value:function(t,e){e?(null==this._currentWarnings&&(this._currentWarnings=[]),this._currentWarnings.push(t)):(null==this._currentErrors&&(this._currentErrors=[]),this._currentErrors.push(t))}},{key:\"OutputStreamDirty\",value:function(){this._outputStreamTextDirty=!0,this._outputStreamTagsDirty=!0}}]),e}(),gt=function(){function t(){n(this,t),this.startTime=void 0}return r(t,[{key:\"ElapsedMilliseconds\",get:function(){return void 0===this.startTime?0:(new Date).getTime()-this.startTime}},{key:\"Start\",value:function(){this.startTime=(new Date).getTime()}},{key:\"Stop\",value:function(){this.startTime=void 0}}]),t}();!function(t){t[t.Author=0]=\"Author\",t[t.Warning=1]=\"Warning\",t[t.Error=2]=\"Error\"}(vt||(vt={})),Number.isInteger||(Number.isInteger=function(t){return\"number\"==typeof t&&isFinite(t)&&t>-9007199254740992&&t<9007199254740992&&Math.floor(t)===t}),t.Story=function(t){a(s,t);var i=v(s);function s(){var t,e;n(this,s),(t=i.call(this)).inkVersionMinimumCompatible=18,t.onError=null,t.onDidContinue=null,t.onMakeChoice=null,t.onEvaluateFunction=null,t.onCompleteEvaluateFunction=null,t.onChoosePathString=null,t._prevContainers=[],t.allowExternalFunctionFallbacks=!1,t._listDefinitions=null,t._variableObservers=null,t._hasValidatedExternals=!1,t._temporaryEvaluationContainer=null,t._asyncContinueActive=!1,t._stateSnapshotAtLastNewline=null,t._sawLookaheadUnsafeFunctionAfterNewline=!1,t._recursiveContinueCount=0,t._asyncSaving=!1,t._profiler=null;var r=null,a=null;if(arguments[0]instanceof K)e=arguments[0],void 0!==arguments[1]&&(r=arguments[1]),t._mainContentContainer=e;else if(\"string\"==typeof arguments[0]){var o=arguments[0];a=ft.TextToDictionary(o)}else a=arguments[0];if(null!=r&&(t._listDefinitions=new st(r)),t._externals=new Map,null!==a){var u=a,l=u.inkVersion;if(null==l)throw new Error(\"ink version number not found. Are you sure it's a valid .ink.json file?\");var h=parseInt(l);if(h>s.inkVersionCurrent)throw new Error(\"Version of ink used to build story was newer than the current version of the engine\");if(h<t.inkVersionMinimumCompatible)throw new Error(\"Version of ink used to build story is too old to be loaded by this version of the engine\");h!=s.inkVersionCurrent&&console.warn(\"WARNING: Version of ink used to build story doesn't match current version of engine. Non-critical, but recommend synchronising.\");var c,f=u.root;if(null==f)throw new Error(\"Root node for ink not found. Are you sure it's a valid .ink.json file?\");(c=u.listDefs)&&(t._listDefinitions=ot.JTokenToListDefinitions(c)),t._mainContentContainer=b(ot.JTokenToRuntimeObject(f),K),t.ResetState()}return t}return r(s,[{key:\"currentChoices\",get:function(){var t=[];if(null===this._state)return P(\"this._state\");var e,n=g(this._state.currentChoices);try{for(n.s();!(e=n.n()).done;){var i=e.value;i.isInvisibleDefault||(i.index=t.length,t.push(i))}}catch(t){n.e(t)}finally{n.f()}return t}},{key:\"currentText\",get:function(){return this.IfAsyncWeCant(\"call currentText since it's a work in progress\"),this.state.currentText}},{key:\"currentTags\",get:function(){return this.IfAsyncWeCant(\"call currentTags since it's a work in progress\"),this.state.currentTags}},{key:\"currentErrors\",get:function(){return this.state.currentErrors}},{key:\"currentWarnings\",get:function(){return this.state.currentWarnings}},{key:\"currentFlowName\",get:function(){return this.state.currentFlowName}},{key:\"currentFlowIsDefaultFlow\",get:function(){return this.state.currentFlowIsDefaultFlow}},{key:\"aliveFlowNames\",get:function(){return this.state.aliveFlowNames}},{key:\"hasError\",get:function(){return this.state.hasError}},{key:\"hasWarning\",get:function(){return this.state.hasWarning}},{key:\"variablesState\",get:function(){return this.state.variablesState}},{key:\"listDefinitions\",get:function(){return this._listDefinitions}},{key:\"state\",get:function(){return this._state}},{key:\"StartProfiling\",value:function(){}},{key:\"EndProfiling\",value:function(){}},{key:\"ToJson\",value:function(t){var e=this,n=!1;if(t||(n=!0,t=new ft.Writer),t.WriteObjectStart(),t.WriteIntProperty(\"inkVersion\",s.inkVersionCurrent),t.WriteProperty(\"root\",(function(t){return ot.WriteRuntimeContainer(t,e._mainContentContainer)})),null!=this._listDefinitions){t.WritePropertyStart(\"listDefs\"),t.WriteObjectStart();var i,r=g(this._listDefinitions.lists);try{for(r.s();!(i=r.n()).done;){var a=i.value;t.WritePropertyStart(a.name),t.WriteObjectStart();var o,u=g(a.items);try{for(u.s();!(o=u.n()).done;){var l=d(o.value,2),h=l[0],c=l[1],f=I.fromSerializedKey(h),v=c;t.WriteIntProperty(f.itemName,v)}}catch(t){u.e(t)}finally{u.f()}t.WriteObjectEnd(),t.WritePropertyEnd()}}catch(t){r.e(t)}finally{r.f()}t.WriteObjectEnd(),t.WritePropertyEnd()}if(t.WriteObjectEnd(),n)return t.toString()}},{key:\"ResetState\",value:function(){this.IfAsyncWeCant(\"ResetState\"),this._state=new mt(this),this._state.variablesState.ObserveVariableChange(this.VariableStateDidChangeEvent.bind(this)),this.ResetGlobals()}},{key:\"ResetErrors\",value:function(){if(null===this._state)return P(\"this._state\");this._state.ResetErrors()}},{key:\"ResetCallstack\",value:function(){if(this.IfAsyncWeCant(\"ResetCallstack\"),null===this._state)return P(\"this._state\");this._state.ForceEnd()}},{key:\"ResetGlobals\",value:function(){if(this._mainContentContainer.namedContent.get(\"global decl\")){var t=this.state.currentPointer.copy();this.ChoosePath(new k(\"global decl\"),!1),this.ContinueInternal(),this.state.currentPointer=t}this.state.variablesState.SnapshotDefaultGlobals()}},{key:\"SwitchFlow\",value:function(t){if(this.IfAsyncWeCant(\"switch flow\"),this._asyncSaving)throw new Error(\"Story is already in background saving mode, can't switch flow to \"+t);this.state.SwitchFlow_Internal(t)}},{key:\"RemoveFlow\",value:function(t){this.state.RemoveFlow_Internal(t)}},{key:\"SwitchToDefaultFlow\",value:function(){this.state.SwitchToDefaultFlow_Internal()}},{key:\"Continue\",value:function(){return this.ContinueAsync(0),this.currentText}},{key:\"canContinue\",get:function(){return this.state.canContinue}},{key:\"asyncContinueComplete\",get:function(){return!this._asyncContinueActive}},{key:\"ContinueAsync\",value:function(t){this._hasValidatedExternals||this.ValidateExternalBindings(),this.ContinueInternal(t)}},{key:\"ContinueInternal\",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;null!=this._profiler&&this._profiler.PreContinue();var e=t>0;if(this._recursiveContinueCount++,!this._asyncContinueActive){if(this._asyncContinueActive=e,!this.canContinue)throw new Error(\"Can't continue - should check canContinue before calling Continue\");this._state.didSafeExit=!1,this._state.ResetOutput(),1==this._recursiveContinueCount&&(this._state.variablesState.batchObservingVariableChanges=!0)}var n=new gt;n.Start();var i=!1;this._sawLookaheadUnsafeFunctionAfterNewline=!1;do{try{i=this.ContinueSingleStep()}catch(t){if(!(t instanceof x))throw t;this.AddError(t.message,void 0,t.useEndLineNumber);break}if(i)break;if(this._asyncContinueActive&&n.ElapsedMilliseconds>t)break}while(this.canContinue);if(n.Stop(),!i&&this.canContinue||(null!==this._stateSnapshotAtLastNewline&&this.RestoreStateSnapshot(),this.canContinue||(this.state.callStack.canPopThread&&this.AddError(\"Thread available to pop, threads should always be flat by the end of evaluation?\"),0!=this.state.generatedChoices.length||this.state.didSafeExit||null!=this._temporaryEvaluationContainer||(this.state.callStack.CanPop(z.Tunnel)?this.AddError(\"unexpectedly reached end of content. Do you need a '->->' to return from a tunnel?\"):this.state.callStack.CanPop(z.Function)?this.AddError(\"unexpectedly reached end of content. Do you need a '~ return'?\"):this.state.callStack.canPop?this.AddError(\"unexpectedly reached end of content for unknown reason. Please debug compiler!\"):this.AddError(\"ran out of content. Do you need a '-> DONE' or '-> END'?\"))),this.state.didSafeExit=!1,this._sawLookaheadUnsafeFunctionAfterNewline=!1,1==this._recursiveContinueCount&&(this._state.variablesState.batchObservingVariableChanges=!1),this._asyncContinueActive=!1,null!==this.onDidContinue&&this.onDidContinue()),this._recursiveContinueCount--,null!=this._profiler&&this._profiler.PostContinue(),this.state.hasError||this.state.hasWarning){if(null===this.onError){var r=new A;throw r.Append(\"Ink had \"),this.state.hasError&&(r.Append(\"\".concat(this.state.currentErrors.length)),r.Append(1==this.state.currentErrors.length?\" error\":\"errors\"),this.state.hasWarning&&r.Append(\" and \")),this.state.hasWarning&&(r.Append(\"\".concat(this.state.currentWarnings.length)),r.Append(1==this.state.currentWarnings.length?\" warning\":\"warnings\"),this.state.hasWarning&&r.Append(\" and \")),r.Append(\". It is strongly suggested that you assign an error handler to story.onError. The first issue was: \"),r.Append(this.state.hasError?this.state.currentErrors[0]:this.state.currentWarnings[0]),new x(r.toString())}if(this.state.hasError){var a,s=g(this.state.currentErrors);try{for(s.s();!(a=s.n()).done;){var o=a.value;this.onError(o,vt.Error)}}catch(o){s.e(o)}finally{s.f()}}if(this.state.hasWarning){var u,l=g(this.state.currentWarnings);try{for(l.s();!(u=l.n()).done;){var h=u.value;this.onError(h,vt.Warning)}}catch(o){l.e(o)}finally{l.f()}}this.ResetErrors()}}},{key:\"ContinueSingleStep\",value:function(){if(null!=this._profiler&&this._profiler.PreStep(),this.Step(),null!=this._profiler&&this._profiler.PostStep(),this.canContinue||this.state.callStack.elementIsEvaluateFromGame||this.TryFollowDefaultInvisibleChoice(),null!=this._profiler&&this._profiler.PreSnapshot(),!this.state.inStringEvaluation){if(null!==this._stateSnapshotAtLastNewline){if(null===this._stateSnapshotAtLastNewline.currentTags)return P(\"this._stateAtLastNewline.currentTags\");if(null===this.state.currentTags)return P(\"this.state.currentTags\");var t=this.CalculateNewlineOutputStateChange(this._stateSnapshotAtLastNewline.currentText,this.state.currentText,this._stateSnapshotAtLastNewline.currentTags.length,this.state.currentTags.length);if(t==s.OutputStateChange.ExtendedBeyondNewline||this._sawLookaheadUnsafeFunctionAfterNewline)return this.RestoreStateSnapshot(),!0;t==s.OutputStateChange.NewlineRemoved&&this.DiscardSnapshot()}this.state.outputStreamEndsInNewline&&(this.canContinue?null==this._stateSnapshotAtLastNewline&&this.StateSnapshot():this.DiscardSnapshot())}return null!=this._profiler&&this._profiler.PostSnapshot(),!1}},{key:\"CalculateNewlineOutputStateChange\",value:function(t,e,n,i){if(null===t)return P(\"prevText\");if(null===e)return P(\"currText\");var r=e.length>=t.length&&t.length>0&&\"\\n\"==e.charAt(t.length-1);if(n==i&&t.length==e.length&&r)return s.OutputStateChange.NoChange;if(!r)return s.OutputStateChange.NewlineRemoved;if(i>n)return s.OutputStateChange.ExtendedBeyondNewline;for(var a=t.length;a<e.length;a++){var o=e.charAt(a);if(\" \"!=o&&\"\\t\"!=o)return s.OutputStateChange.ExtendedBeyondNewline}return s.OutputStateChange.NoChange}},{key:\"ContinueMaximally\",value:function(){this.IfAsyncWeCant(\"ContinueMaximally\");for(var t=new A;this.canContinue;)t.Append(this.Continue());return t.toString()}},{key:\"ContentAtPath\",value:function(t){return this.mainContentContainer.ContentAtPath(t)}},{key:\"KnotContainerWithName\",value:function(t){var e=this.mainContentContainer.namedContent.get(t);return e instanceof K?e:null}},{key:\"PointerAtPath\",value:function(t){if(0==t.length)return $.Null;var e=new $,n=t.length,i=null;return null===t.lastComponent?P(\"path.lastComponent\"):(t.lastComponent.isIndex?(n=t.length-1,i=this.mainContentContainer.ContentAtPath(t,void 0,n),e.container=i.container,e.index=t.lastComponent.index):(i=this.mainContentContainer.ContentAtPath(t),e.container=i.container,e.index=-1),null==i.obj||i.obj==this.mainContentContainer&&n>0?this.Error(\"Failed to find content at path '\"+t+\"', and no approximation of it was possible.\"):i.approximate&&this.Warning(\"Failed to find content at path '\"+t+\"', so it was approximated to: '\"+i.obj.path+\"'.\"),e)}},{key:\"StateSnapshot\",value:function(){this._stateSnapshotAtLastNewline=this._state,this._state=this._state.CopyAndStartPatching()}},{key:\"RestoreStateSnapshot\",value:function(){null===this._stateSnapshotAtLastNewline&&P(\"_stateSnapshotAtLastNewline\"),this._stateSnapshotAtLastNewline.RestoreAfterPatch(),this._state=this._stateSnapshotAtLastNewline,this._stateSnapshotAtLastNewline=null,this._asyncSaving||this._state.ApplyAnyPatch()}},{key:\"DiscardSnapshot\",value:function(){this._asyncSaving||this._state.ApplyAnyPatch(),this._stateSnapshotAtLastNewline=null}},{key:\"CopyStateForBackgroundThreadSave\",value:function(){if(this.IfAsyncWeCant(\"start saving on a background thread\"),this._asyncSaving)throw new Error(\"Story is already in background saving mode, can't call CopyStateForBackgroundThreadSave again!\");var t=this._state;return this._state=this._state.CopyAndStartPatching(),this._asyncSaving=!0,t}},{key:\"BackgroundSaveComplete\",value:function(){null===this._stateSnapshotAtLastNewline&&this._state.ApplyAnyPatch(),this._asyncSaving=!1}},{key:\"Step\",value:function(){var t=!0,e=this.state.currentPointer.copy();if(!e.isNull){for(var n=C(e.Resolve(),K);n&&(this.VisitContainer(n,!0),0!=n.content.length);)n=C((e=$.StartOf(n)).Resolve(),K);this.state.currentPointer=e.copy(),null!=this._profiler&&this._profiler.Step(this.state.callStack);var i=e.Resolve(),r=this.PerformLogicAndFlowControl(i);if(!this.state.currentPointer.isNull){r&&(t=!1);var a=C(i,Q);if(a){var s=this.ProcessChoice(a);s&&this.state.generatedChoices.push(s),i=null,t=!1}if(i instanceof K&&(t=!1),t){var o=C(i,J);if(o&&-1==o.contextIndex){var u=this.state.callStack.ContextForVariableNamed(o.variableName);i=new J(o.variableName,u)}this.state.inExpressionEvaluation?this.state.PushEvaluationStack(i):this.state.PushToOutputStream(i)}this.NextContent();var l=C(i,X);l&&l.commandType==X.CommandType.StartThread&&this.state.callStack.PushThread()}}}},{key:\"VisitContainer\",value:function(t,e){t.countingAtStartOnly&&!e||(t.visitsShouldBeCounted&&this.state.IncrementVisitCountForContainer(t),t.turnIndexShouldBeCounted&&this.state.RecordTurnIndexVisitToContainer(t))}},{key:\"VisitChangedContainersDueToDivert\",value:function(){var t=this.state.previousPointer.copy(),e=this.state.currentPointer.copy();if(!e.isNull&&-1!=e.index){if(this._prevContainers.length=0,!t.isNull)for(var n=C(t.Resolve(),K)||C(t.container,K);n;)this._prevContainers.push(n),n=C(n.parent,K);var i=e.Resolve();if(null!=i)for(var r=C(i.parent,K),a=!0;r&&(this._prevContainers.indexOf(r)<0||r.countingAtStartOnly);){var s=r.content.length>0&&i==r.content[0]&&a;s||(a=!1),this.VisitContainer(r,s),i=r,r=C(r.parent,K)}}}},{key:\"PopChoiceStringAndTags\",value:function(t){for(var e=b(this.state.PopEvaluationStack(),G);this.state.evaluationStack.length>0&&null!=C(this.state.PeekEvaluationStack(),it);){var n=C(this.state.PopEvaluationStack(),it);n&&t.push(n.text)}return e.value}},{key:\"ProcessChoice\",value:function(t){var e=!0;if(t.hasCondition){var n=this.state.PopEvaluationStack();this.IsTruthy(n)||(e=!1)}var i=\"\",r=\"\",a=[];(t.hasChoiceOnlyContent&&(r=this.PopChoiceStringAndTags(a)||\"\"),t.hasStartContent&&(i=this.PopChoiceStringAndTags(a)||\"\"),t.onceOnly)&&(this.state.VisitCountForContainer(t.choiceTarget)>0&&(e=!1));if(!e)return null;var s=new rt;return s.targetPath=t.pathOnChoice,s.sourcePath=t.path.toString(),s.isInvisibleDefault=t.isInvisibleDefault,s.threadAtGeneration=this.state.callStack.ForkThread(),s.tags=a.reverse(),s.text=(i+r).replace(/^[ \\t]+|[ \\t]+$/g,\"\"),s}},{key:\"IsTruthy\",value:function(t){if(t instanceof j){var e=t;if(e instanceof M){var n=e;return this.Error(\"Shouldn't use a divert target (to \"+n.targetPath+\") as a conditional value. Did you intend a function call 'likeThis()' or a read count check 'likeThis'? (no arrows)\"),!1}return e.isTruthy}return!1}},{key:\"PerformLogicAndFlowControl\",value:function(t){if(null==t)return!1;if(t instanceof Y){var e=t;if(e.isConditional){var n=this.state.PopEvaluationStack();if(!this.IsTruthy(n))return!0}if(e.hasVariableTarget){var i=e.variableDivertName,r=this.state.variablesState.GetVariableWithName(i);if(null==r)this.Error(\"Tried to divert using a target from a variable that could not be found (\"+i+\")\");else if(!(r instanceof M)){var a=C(r,D),s=\"Tried to divert to a target from a variable, but the variable (\"+i+\") didn't contain a divert target, it \";a instanceof D&&0==a.value?s+=\"was empty/null (the value 0).\":s+=\"contained '\"+r+\"'.\",this.Error(s)}var o=b(r,M);this.state.divertedPointer=this.PointerAtPath(o.targetPath)}else{if(e.isExternal)return this.CallExternalFunction(e.targetPathString,e.externalArgs),!0;this.state.divertedPointer=e.targetPointer.copy()}return e.pushesToStack&&this.state.callStack.Push(e.stackPushType,void 0,this.state.outputStream.length),this.state.divertedPointer.isNull&&!e.isExternal&&(e&&e.debugMetadata&&null!=e.debugMetadata.sourceName?this.Error(\"Divert target doesn't exist: \"+e.debugMetadata.sourceName):this.Error(\"Divert resolution failed: \"+e)),!0}if(t instanceof X){var u=t;switch(u.commandType){case X.CommandType.EvalStart:this.Assert(!1===this.state.inExpressionEvaluation,\"Already in expression evaluation?\"),this.state.inExpressionEvaluation=!0;break;case X.CommandType.EvalEnd:this.Assert(!0===this.state.inExpressionEvaluation,\"Not in expression evaluation mode\"),this.state.inExpressionEvaluation=!1;break;case X.CommandType.EvalOutput:if(this.state.evaluationStack.length>0){var l=this.state.PopEvaluationStack();if(!(l instanceof et)){var h=new G(l.toString());this.state.PushToOutputStream(h)}}break;case X.CommandType.NoOp:break;case X.CommandType.Duplicate:this.state.PushEvaluationStack(this.state.PeekEvaluationStack());break;case X.CommandType.PopEvaluatedValue:this.state.PopEvaluationStack();break;case X.CommandType.PopFunction:case X.CommandType.PopTunnel:var c=u.commandType==X.CommandType.PopFunction?z.Function:z.Tunnel,f=null;if(c==z.Tunnel){var v=this.state.PopEvaluationStack();null===(f=C(v,M))&&this.Assert(v instanceof et,\"Expected void if ->-> doesn't override target\")}if(this.state.TryExitFunctionEvaluationFromGame())break;if(this.state.callStack.currentElement.type==c&&this.state.callStack.canPop)this.state.PopCallStack(),f&&(this.state.divertedPointer=this.PointerAtPath(f.targetPath));else{var d=new Map;d.set(z.Function,\"function return statement (~ return)\"),d.set(z.Tunnel,\"tunnel onwards statement (->->)\");var p=d.get(this.state.callStack.currentElement.type);this.state.callStack.canPop||(p=\"end of flow (-> END or choice)\");var y=\"Found \"+d.get(c)+\", when expected \"+p;this.Error(y)}break;case X.CommandType.BeginString:this.state.PushToOutputStream(u),this.Assert(!0===this.state.inExpressionEvaluation,\"Expected to be in an expression when evaluating a string\"),this.state.inExpressionEvaluation=!1;break;case X.CommandType.BeginTag:this.state.PushToOutputStream(u);break;case X.CommandType.EndTag:if(this.state.inStringEvaluation){for(var m=[],S=0,k=this.state.outputStream.length-1;k>=0;--k){var w=this.state.outputStream[k];S++;var _=C(w,X);if(null!=_){if(_.commandType==X.CommandType.BeginTag)break;this.Error(\"Unexpected ControlCommand while extracting tag from choice\");break}w instanceof G&&m.push(w)}this.state.PopFromOutputStream(S);for(var T=new A,E=0,O=m;E<O.length;E++){var N=O[E];T.Append(N.toString())}var W=new it(this.state.CleanOutputWhitespace(T.toString()));this.state.PushEvaluationStack(W)}else this.state.PushToOutputStream(u);break;case X.CommandType.EndString:for(var V=[],L=[],R=0,B=this.state.outputStream.length-1;B>=0;--B){var J=this.state.outputStream[B];R++;var q=C(J,X);if(q&&q.commandType==X.CommandType.BeginString)break;J instanceof it&&L.push(J),J instanceof G&&V.push(J)}this.state.PopFromOutputStream(R);for(var H=0,Q=L;H<Q.length;H++){var rt=Q[H];this.state.PushToOutputStream(rt)}V=V.reverse();var at,st=new A,ot=g(V);try{for(ot.s();!(at=ot.n()).done;){var ut=at.value;st.Append(ut.toString())}}catch(t){ot.e(t)}finally{ot.f()}this.state.inExpressionEvaluation=!0,this.state.PushEvaluationStack(new G(st.toString()));break;case X.CommandType.ChoiceCount:var lt=this.state.generatedChoices.length;this.state.PushEvaluationStack(new D(lt));break;case X.CommandType.Turns:this.state.PushEvaluationStack(new D(this.state.currentTurnIndex+1));break;case X.CommandType.TurnsSince:case X.CommandType.ReadCount:var ct=this.state.PopEvaluationStack();if(!(ct instanceof M)){var ft=\"\";ct instanceof D&&(ft=\". Did you accidentally pass a read count ('knot_name') instead of a target ('-> knot_name')?\"),this.Error(\"TURNS_SINCE / READ_COUNT expected a divert target (knot, stitch, label name), but saw \"+ct+ft);break}var vt,dt=b(ct,M),pt=C(this.ContentAtPath(dt.targetPath).correctObj,K);null!=pt?vt=u.commandType==X.CommandType.TurnsSince?this.state.TurnsSinceForContainer(pt):this.state.VisitCountForContainer(pt):(vt=u.commandType==X.CommandType.TurnsSince?-1:0,this.Warning(\"Failed to find container for \"+u.toString()+\" lookup at \"+dt.targetPath.toString())),this.state.PushEvaluationStack(new D(vt));break;case X.CommandType.Random:var yt=C(this.state.PopEvaluationStack(),D),mt=C(this.state.PopEvaluationStack(),D);if(null==mt||mt instanceof D==!1)return this.Error(\"Invalid value for minimum parameter of RANDOM(min, max)\");if(null==yt||mt instanceof D==!1)return this.Error(\"Invalid value for maximum parameter of RANDOM(min, max)\");if(null===yt.value)return P(\"maxInt.value\");if(null===mt.value)return P(\"minInt.value\");var gt=yt.value-mt.value+1;(!isFinite(gt)||gt>Number.MAX_SAFE_INTEGER)&&(gt=Number.MAX_SAFE_INTEGER,this.Error(\"RANDOM was called with a range that exceeds the size that ink numbers can use.\")),gt<=0&&this.Error(\"RANDOM was called with minimum as \"+mt.value+\" and maximum as \"+yt.value+\". The maximum must be larger\");var St=this.state.storySeed+this.state.previousRandom,kt=new ht(St).next(),Ct=kt%gt+mt.value;this.state.PushEvaluationStack(new D(Ct)),this.state.previousRandom=kt;break;case X.CommandType.SeedRandom:var bt=C(this.state.PopEvaluationStack(),D);if(null==bt||bt instanceof D==!1)return this.Error(\"Invalid value passed to SEED_RANDOM\");if(null===bt.value)return P(\"minInt.value\");this.state.storySeed=bt.value,this.state.previousRandom=0,this.state.PushEvaluationStack(new et);break;case X.CommandType.VisitIndex:var wt=this.state.VisitCountForContainer(this.state.currentPointer.container)-1;this.state.PushEvaluationStack(new D(wt));break;case X.CommandType.SequenceShuffleIndex:var _t=this.NextSequenceShuffleIndex();this.state.PushEvaluationStack(new D(_t));break;case X.CommandType.StartThread:break;case X.CommandType.Done:this.state.callStack.canPopThread?this.state.callStack.PopThread():(this.state.didSafeExit=!0,this.state.currentPointer=$.Null);break;case X.CommandType.End:this.state.ForceEnd();break;case X.CommandType.ListFromInt:var Tt=C(this.state.PopEvaluationStack(),D),Et=b(this.state.PopEvaluationStack(),G);if(null===Tt)throw new x(\"Passed non-integer when creating a list element from a numerical value.\");var Ot=null;if(null===this.listDefinitions)return P(\"this.listDefinitions\");var Pt=this.listDefinitions.TryListGetDefinition(Et.value,null);if(!Pt.exists)throw new x(\"Failed to find LIST called \"+Et.value);if(null===Tt.value)return P(\"minInt.value\");var Nt=Pt.result.TryGetItemWithValue(Tt.value,I.Null);Nt.exists&&(Ot=new U(Nt.result,Tt.value)),null==Ot&&(Ot=new U),this.state.PushEvaluationStack(Ot);break;case X.CommandType.ListRange:var At=C(this.state.PopEvaluationStack(),j),It=C(this.state.PopEvaluationStack(),j),Ft=C(this.state.PopEvaluationStack(),U);if(null===Ft||null===It||null===At)throw new x(\"Expected list, minimum and maximum for LIST_RANGE\");if(null===Ft.value)return P(\"targetList.value\");var xt=Ft.value.ListWithSubRange(It.valueObject,At.valueObject);this.state.PushEvaluationStack(new U(xt));break;case X.CommandType.ListRandom:var Wt=this.state.PopEvaluationStack();if(null===Wt)throw new x(\"Expected list for LIST_RANDOM\");var Vt=Wt.value,Lt=null;if(null===Vt)throw P(\"list\");if(0==Vt.Count)Lt=new F;else{for(var jt=this.state.storySeed+this.state.previousRandom,Rt=new ht(jt).next(),Dt=Rt%Vt.Count,Bt=Vt.entries(),Gt=0;Gt<=Dt-1;Gt++)Bt.next();var Mt=Bt.next().value,Jt={Key:I.fromSerializedKey(Mt[0]),Value:Mt[1]};if(null===Jt.Key.originName)return P(\"randomItem.Key.originName\");(Lt=new F(Jt.Key.originName,this)).Add(Jt.Key,Jt.Value),this.state.previousRandom=Rt}this.state.PushEvaluationStack(new U(Lt));break;default:this.Error(\"unhandled ControlCommand: \"+u)}return!0}if(t instanceof tt){var Ut=t,qt=this.state.PopEvaluationStack();return this.state.variablesState.Assign(Ut,qt),!0}if(t instanceof Z){var Kt=t,zt=null;if(null!=Kt.pathForCount){var Ht=Kt.containerForCount,Xt=this.state.VisitCountForContainer(Ht);zt=new D(Xt)}else null==(zt=this.state.variablesState.GetVariableWithName(Kt.name))&&(this.Warning(\"Variable not found: '\"+Kt.name+\"'. Using default value of 0 (false). This can happen with temporary variables if the declaration hasn't yet been hit. Globals are always given a default value on load if a value doesn't exist in the save state.\"),zt=new D(0));return this.state.PushEvaluationStack(zt),!0}if(t instanceof nt){var $t=t,Yt=this.state.PopEvaluationStack($t.numberOfParameters),Qt=$t.Call(Yt);return this.state.PushEvaluationStack(Qt),!0}return!1}},{key:\"ChoosePathString\",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(this.IfAsyncWeCant(\"call ChoosePathString right now\"),null!==this.onChoosePathString&&this.onChoosePathString(t,n),e)this.ResetCallstack();else if(this.state.callStack.currentElement.type==z.Function){var i=\"\",r=this.state.callStack.currentElement.currentPointer.container;throw null!=r&&(i=\"(\"+r.path.toString()+\") \"),new Error(\"Story was running a function \"+i+\"when you called ChoosePathString(\"+t+\") - this is almost certainly not not what you want! Full stack trace: \\n\"+this.state.callStack.callStackTrace)}this.state.PassArgumentsToEvaluationStack(n),this.ChoosePath(new k(t))}},{key:\"IfAsyncWeCant\",value:function(t){if(this._asyncContinueActive)throw new Error(\"Can't \"+t+\". Story is in the middle of a ContinueAsync(). Make more ContinueAsync() calls or a single Continue() call beforehand.\")}},{key:\"ChoosePath\",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.state.SetChosenPath(t,e),this.VisitChangedContainersDueToDivert()}},{key:\"ChooseChoiceIndex\",value:function(t){var e=this.currentChoices;this.Assert(t>=0&&t<e.length,\"choice out of range\");var n=e[t];return null!==this.onMakeChoice&&this.onMakeChoice(n),null===n.threadAtGeneration?P(\"choiceToChoose.threadAtGeneration\"):null===n.targetPath?P(\"choiceToChoose.targetPath\"):(this.state.callStack.currentThread=n.threadAtGeneration,void this.ChoosePath(n.targetPath))}},{key:\"HasFunction\",value:function(t){try{return null!=this.KnotContainerWithName(t)}catch(t){return!1}}},{key:\"EvaluateFunction\",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null!==this.onEvaluateFunction&&this.onEvaluateFunction(t,e),this.IfAsyncWeCant(\"evaluate a function\"),null==t)throw new Error(\"Function is null\");if(\"\"==t||\"\"==t.trim())throw new Error(\"Function is empty or white space.\");var i=this.KnotContainerWithName(t);if(null==i)throw new Error(\"Function doesn't exist: '\"+t+\"'\");var r=[];r.push.apply(r,p(this.state.outputStream)),this._state.ResetOutput(),this.state.StartFunctionEvaluationFromGame(i,e);for(var a=new A;this.canContinue;)a.Append(this.Continue());var s=a.toString();this._state.ResetOutput(r);var o=this.state.CompleteFunctionEvaluationFromGame();return null!=this.onCompleteEvaluateFunction&&this.onCompleteEvaluateFunction(t,e,s,o),n?{returned:o,output:s}:o}},{key:\"EvaluateExpression\",value:function(t){var e=this.state.callStack.elements.length;this.state.callStack.Push(z.Tunnel),this._temporaryEvaluationContainer=t,this.state.GoToStart();var n=this.state.evaluationStack.length;return this.Continue(),this._temporaryEvaluationContainer=null,this.state.callStack.elements.length>e&&this.state.PopCallStack(),this.state.evaluationStack.length>n?this.state.PopEvaluationStack():null}},{key:\"CallExternalFunction\",value:function(t,n){if(null===t)return P(\"funcName\");var i=this._externals.get(t),r=null,a=void 0!==i;if(!a||i.lookAheadSafe||null===this._stateSnapshotAtLastNewline){if(!a){if(this.allowExternalFunctionFallbacks)return r=this.KnotContainerWithName(t),this.Assert(null!==r,\"Trying to call EXTERNAL function '\"+t+\"' which has not been bound, and fallback ink function could not be found.\"),this.state.callStack.Push(z.Function,void 0,this.state.outputStream.length),void(this.state.divertedPointer=$.StartOf(r));this.Assert(!1,\"Trying to call EXTERNAL function '\"+t+\"' which has not been bound (and ink fallbacks disabled).\")}for(var s=[],o=0;o<n;++o){var u=b(this.state.PopEvaluationStack(),j).valueObject;s.push(u)}s.reverse();var l=i.function(s),h=null;null!=l?(h=j.Create(l),this.Assert(null!==h,\"Could not create ink value from returned object of type \"+e(l))):h=new et,this.state.PushEvaluationStack(h)}else this._sawLookaheadUnsafeFunctionAfterNewline=!0}},{key:\"BindExternalFunctionGeneral\",value:function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.IfAsyncWeCant(\"bind an external function\"),this.Assert(!this._externals.has(t),\"Function '\"+t+\"' has already been bound.\"),this._externals.set(t,{function:e,lookAheadSafe:n})}},{key:\"TryCoerce\",value:function(t){return t}},{key:\"BindExternalFunction\",value:function(t,e){var n=this,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.Assert(null!=e,\"Can't bind a null function\"),this.BindExternalFunctionGeneral(t,(function(t){n.Assert(t.length>=e.length,\"External function expected \"+e.length+\" arguments\");for(var i=[],r=0,a=t.length;r<a;r++)i[r]=n.TryCoerce(t[r]);return e.apply(null,i)}),i)}},{key:\"UnbindExternalFunction\",value:function(t){this.IfAsyncWeCant(\"unbind an external a function\"),this.Assert(this._externals.has(t),\"Function '\"+t+\"' has not been bound.\"),this._externals.delete(t)}},{key:\"ValidateExternalBindings\",value:function(){var t=null,e=null,n=arguments[1]||new Set;if(arguments[0]instanceof K&&(t=arguments[0]),arguments[0]instanceof N&&(e=arguments[0]),null===t&&null===e)if(this.ValidateExternalBindings(this._mainContentContainer,n),this._hasValidatedExternals=!0,0==n.size)this._hasValidatedExternals=!0;else{var i=\"Error: Missing function binding for external\";i+=n.size>1?\"s\":\"\",i+=\": '\",i+=Array.from(n).join(\"', '\"),i+=\"' \",i+=this.allowExternalFunctionFallbacks?\", and no fallback ink function found.\":\" (ink fallbacks disabled)\",this.Error(i)}else if(null!=t){var r,a=g(t.content);try{for(a.s();!(r=a.n()).done;){var s=r.value;null!=s&&s.hasValidName||this.ValidateExternalBindings(s,n)}}catch(t){a.e(t)}finally{a.f()}var o,u=g(t.namedContent);try{for(u.s();!(o=u.n()).done;){var l=d(o.value,2)[1];this.ValidateExternalBindings(C(l,N),n)}}catch(t){u.e(t)}finally{u.f()}}else if(null!=e){var h=C(e,Y);if(h&&h.isExternal){var c=h.targetPathString;if(null===c)return P(\"name\");if(!this._externals.has(c))if(this.allowExternalFunctionFallbacks)this.mainContentContainer.namedContent.has(c)||n.add(c);else n.add(c)}}}},{key:\"ObserveVariable\",value:function(t,e){if(this.IfAsyncWeCant(\"observe a new variable\"),null===this._variableObservers&&(this._variableObservers=new Map),!this.state.variablesState.GlobalVariableExistsWithName(t))throw new Error(\"Cannot observe variable '\"+t+\"' because it wasn't declared in the ink story.\");this._variableObservers.has(t)?this._variableObservers.get(t).push(e):this._variableObservers.set(t,[e])}},{key:\"ObserveVariables\",value:function(t,e){for(var n=0,i=t.length;n<i;n++)this.ObserveVariable(t[n],e[n])}},{key:\"RemoveVariableObserver\",value:function(t,e){if(this.IfAsyncWeCant(\"remove a variable observer\"),null!==this._variableObservers)if(null!=e){if(this._variableObservers.has(e))if(null!=t){var n=this._variableObservers.get(e);null!=n&&(n.splice(n.indexOf(t),1),0===n.length&&this._variableObservers.delete(e))}else this._variableObservers.delete(e)}else if(null!=t){var i,r=g(this._variableObservers.keys());try{for(r.s();!(i=r.n()).done;){var a=i.value,s=this._variableObservers.get(a);null!=s&&(s.splice(s.indexOf(t),1),0===s.length&&this._variableObservers.delete(a))}}catch(t){r.e(t)}finally{r.f()}}}},{key:\"VariableStateDidChangeEvent\",value:function(t,e){if(null!==this._variableObservers){var n=this._variableObservers.get(t);if(void 0!==n){if(!(e instanceof j))throw new Error(\"Tried to get the value of a variable that isn't a standard type\");var i,r=b(e,j),a=g(n);try{for(a.s();!(i=a.n()).done;){(0,i.value)(t,r.valueObject)}}catch(t){a.e(t)}finally{a.f()}}}}},{key:\"globalTags\",get:function(){return this.TagsAtStartOfFlowContainerWithPathString(\"\")}},{key:\"TagsForContentAtPath\",value:function(t){return this.TagsAtStartOfFlowContainerWithPathString(t)}},{key:\"TagsAtStartOfFlowContainerWithPathString\",value:function(t){var e=new k(t),n=this.ContentAtPath(e).container;if(null===n)return P(\"flowContainer\");for(;;){var i=n.content[0];if(!(i instanceof K))break;n=i}var r,a=!1,s=null,o=g(n.content);try{for(o.s();!(r=o.n()).done;){var u=r.value,l=C(u,X);if(null!=l)l.commandType==X.CommandType.BeginTag?a=!0:l.commandType==X.CommandType.EndTag&&(a=!1);else{if(!a)break;var h=C(u,G);null!==h?(null===s&&(s=[]),null!==h.value&&s.push(h.value)):this.Error(\"Tag contained non-text content. Only plain text is allowed when using globalTags or TagsAtContentPath. If you want to evaluate dynamic content, you need to use story.Continue().\")}}}catch(t){o.e(t)}finally{o.f()}return s}},{key:\"BuildStringOfHierarchy\",value:function(){var t=new A;return this.mainContentContainer.BuildStringOfHierarchy(t,0,this.state.currentPointer.Resolve()),t.toString()}},{key:\"BuildStringOfContainer\",value:function(t){var e=new A;return t.BuildStringOfHierarchy(e,0,this.state.currentPointer.Resolve()),e.toString()}},{key:\"NextContent\",value:function(){if((this.state.previousPointer=this.state.currentPointer.copy(),this.state.divertedPointer.isNull||(this.state.currentPointer=this.state.divertedPointer.copy(),this.state.divertedPointer=$.Null,this.VisitChangedContainersDueToDivert(),this.state.currentPointer.isNull))&&!this.IncrementContentPointer()){var t=!1;this.state.callStack.CanPop(z.Function)?(this.state.PopCallStack(z.Function),this.state.inExpressionEvaluation&&this.state.PushEvaluationStack(new et),t=!0):this.state.callStack.canPopThread?(this.state.callStack.PopThread(),t=!0):this.state.TryExitFunctionEvaluationFromGame(),t&&!this.state.currentPointer.isNull&&this.NextContent()}}},{key:\"IncrementContentPointer\",value:function(){var t=!0,e=this.state.callStack.currentElement.currentPointer.copy();if(e.index++,null===e.container)return P(\"pointer.container\");for(;e.index>=e.container.content.length;){t=!1;var n=C(e.container.parent,K);if(n instanceof K==!1)break;var i=n.content.indexOf(e.container);if(-1==i)break;if((e=new $(n,i)).index++,t=!0,null===e.container)return P(\"pointer.container\")}return t||(e=$.Null),this.state.callStack.currentElement.currentPointer=e.copy(),t}},{key:\"TryFollowDefaultInvisibleChoice\",value:function(){var t=this._state.currentChoices,e=t.filter((function(t){return t.isInvisibleDefault}));if(0==e.length||t.length>e.length)return!1;var n=e[0];return null===n.targetPath?P(\"choice.targetPath\"):null===n.threadAtGeneration?P(\"choice.threadAtGeneration\"):(this.state.callStack.currentThread=n.threadAtGeneration,null!==this._stateSnapshotAtLastNewline&&(this.state.callStack.currentThread=this.state.callStack.ForkThread()),this.ChoosePath(n.targetPath,!1),!0)}},{key:\"NextSequenceShuffleIndex\",value:function(){var t=C(this.state.PopEvaluationStack(),D);if(!(t instanceof D))return this.Error(\"expected number of elements in sequence for shuffle index\"),0;var e=this.state.currentPointer.container;if(null===e)return P(\"seqContainer\");if(null===t.value)return P(\"numElementsIntVal.value\");var n=t.value,i=b(this.state.PopEvaluationStack(),D).value;if(null===i)return P(\"seqCount\");for(var r=i/n,a=i%n,s=e.path.toString(),o=0,u=0,l=s.length;u<l;u++)o+=s.charCodeAt(u)||0;for(var h=o+r+this.state.storySeed,c=new ht(Math.floor(h)),f=[],v=0;v<n;++v)f.push(v);for(var d=0;d<=a;++d){var p=c.next()%f.length,y=f[p];if(f.splice(p,1),d==a)return y}throw new Error(\"Should never reach here\")}},{key:\"Error\",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=new x(t);throw n.useEndLineNumber=e,n}},{key:\"Warning\",value:function(t){this.AddError(t,!0)}},{key:\"AddError\",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this.currentDebugMetadata,r=e?\"WARNING\":\"ERROR\";if(null!=i){var a=n?i.endLineNumber:i.startLineNumber;t=\"RUNTIME \"+r+\": '\"+i.fileName+\"' line \"+a+\": \"+t}else t=this.state.currentPointer.isNull?\"RUNTIME \"+r+\": \"+t:\"RUNTIME \"+r+\": (\"+this.state.currentPointer+\"): \"+t;this.state.AddError(t,e),e||this.state.ForceEnd()}},{key:\"Assert\",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(0==t)throw null==e&&(e=\"Story assert\"),new Error(e+\" \"+this.currentDebugMetadata)}},{key:\"currentDebugMetadata\",get:function(){var t,e=this.state.currentPointer;if(!e.isNull&&null!==e.Resolve()&&null!==(t=e.Resolve().debugMetadata))return t;for(var n=this.state.callStack.elements.length-1;n>=0;--n)if(!(e=this.state.callStack.elements[n].currentPointer).isNull&&null!==e.Resolve()&&null!==(t=e.Resolve().debugMetadata))return t;for(var i=this.state.outputStream.length-1;i>=0;--i){if(null!==(t=this.state.outputStream[i].debugMetadata))return t}return null}},{key:\"mainContentContainer\",get:function(){return this._temporaryEvaluationContainer?this._temporaryEvaluationContainer:this._mainContentContainer}}]),s}(N),t.Story.inkVersionCurrent=21,dt=t.Story||(t.Story={}),(pt=dt.OutputStateChange||(dt.OutputStateChange={}))[pt.NoChange=0]=\"NoChange\",pt[pt.ExtendedBeyondNewline=1]=\"ExtendedBeyondNewline\",pt[pt.NewlineRemoved=2]=\"NewlineRemoved\",t.InkList=F,Object.defineProperty(t,\"__esModule\",{value:!0})}));","","gdjs.evtTools.inkjs.logger.log(\"InkJs Extension initialized.\")"],"parameterObjects":"","useStrict":true,"eventsSheetExpanded":false}],"parameters":[],"objectGroups":[]},{"description":"Loads a JSON resource as the current InkJs story","fullName":"Load a JSON resource as current InkJs story","functionType":"Action","name":"LoadStory","sentence":"Loads a JSON resource from variable _PARAM1_ as InkJs story","events":[{"type":"BuiltinCommonInstructions::Standard","conditions":[],"actions":[]},{"type":"BuiltinCommonInstructions::JsCode","inlineCode":["const jsonData = runtimeScene","  .getGame()","  .getJsonManager()","  .getLoadedJson(eventsFunctionContext.getArgument(\"Resource\"))","","gdjs.evtTools.inkjs.logger.info(`Loaded data: ${jsonData}`)","gdjs.evtTools.inkjs.currentStoryData = jsonData;","","try {","  console.log(\"LOAD ME\")","  // gdjs.dialogueTree.runner.load(gdjs.dialogueTree.yarnData);","} catch (error) {","  gdjs.evtTools.inkjs.logger.error(","    'An error happened while loading parsing the dialogue tree data:',","    error","  );","}","// if (startDialogueNode && startDialogueNode.length > 0) {","//   gdjs.dialogueTree.startFrom(startDialogueNode);","// }"],"parameterObjects":"","useStrict":true,"eventsSheetExpanded":true}],"parameters":[{"description":"The resource to load the JSON from","name":"Resource","type":"jsonResource"}],"objectGroups":[]}],"eventsBasedBehaviors":[],"eventsBasedObjects":[]},{"author":"","category":"General","extensionNamespace":"","fullName":"JSON Resource Loading","helpPath":"","iconUrl":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0ibWRpLWZpbGUtY29kZS1vdXRsaW5lIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZD0iTTE0IDJINkM0Ljg5IDIgNCAyLjkgNCA0VjIwQzQgMjEuMTEgNC44OSAyMiA2IDIySDE4QzE5LjExIDIyIDIwIDIxLjExIDIwIDIwVjhMMTQgMk0xOCAyMEg2VjRIMTNWOUgxOFYyME05LjU0IDE1LjY1TDExLjYzIDE3Ljc0TDEwLjM1IDE5TDcgMTUuNjVMMTAuMzUgMTIuM0wxMS42MyAxMy41Nkw5LjU0IDE1LjY1TTE3IDE1LjY1TDEzLjY1IDE5TDEyLjM4IDE3Ljc0TDE0LjQ3IDE1LjY1TDEyLjM4IDEzLjU2TDEzLjY1IDEyLjNMMTcgMTUuNjVaIiAvPjwvc3ZnPg==","name":"JSONResourceLoader","previewIconUrl":"https://resources.gdevelop-app.com/assets/Icons/file-code-outline.svg","shortDescription":"Loads a JSON resource into a variable.","version":"1.0.0","description":["Loads a (static) JSON resource from your project files into a global, scene, or object variable.","","NEVER use this to load your game.json into a variable - this would increase your game size by a lot and make your whole project file available for anyone to open!"],"origin":{"identifier":"JSONResourceLoader","name":"gdevelop-extension-store"},"tags":["json","resource","load","open","file","data","static","file"],"authorIds":["ZgrsWuRTAkXgeuPV9bo0zuEcA2w1"],"dependencies":[],"eventsFunctions":[{"description":"Loads a JSON resource into a scene structure variable.","fullName":"Load a JSON resource in a scene variable","functionType":"Action","name":"LoadJSONToScene","sentence":"Load _PARAM1_ into scene variable _PARAM2_","events":[{"type":"BuiltinCommonInstructions::JsCode","inlineCode":["eventsFunctionContext","    .getArgument(\"Variable\")","    .fromJSObject(","        runtimeScene","            .getGame()","            .getJsonManager()","            .getLoadedJson(eventsFunctionContext.getArgument(\"Resource\"))","    );",""],"parameterObjects":"","useStrict":true,"eventsSheetExpanded":false}],"parameters":[{"description":"The resource to load the JSON from","name":"Resource","type":"jsonResource"},{"description":"The scene variable to load the JSON to","name":"Variable","type":"scenevar"}],"objectGroups":[]},{"description":"Loads a JSON resource into a global structure variable.","fullName":"Load a JSON resource in a global variable","functionType":"Action","name":"LoadJSONToGlobal","sentence":"Load _PARAM1_ into global variable _PARAM2_","events":[{"type":"BuiltinCommonInstructions::JsCode","inlineCode":["eventsFunctionContext","    .getArgument(\"Variable\")","    .fromJSObject(","        runtimeScene","            .getGame()","            .getJsonManager()","            .getLoadedJson(eventsFunctionContext.getArgument(\"Resource\"))","    );",""],"parameterObjects":"","useStrict":true,"eventsSheetExpanded":false}],"parameters":[{"description":"The resource to load the JSON from","name":"Resource","type":"jsonResource"},{"description":"The global variable to load the JSON to","name":"Variable","type":"globalvar"}],"objectGroups":[]},{"description":"Loads a JSON resource into an object structure variable.","fullName":"Load a JSON resource in an object variable","functionType":"Action","name":"LoadJSONToObject","sentence":"Load _PARAM1_ into object variable _PARAM3_ of object _PARAM2_","events":[{"type":"BuiltinCommonInstructions::JsCode","inlineCode":["eventsFunctionContext","    .getArgument(\"Variable\")","    .fromJSObject(","        runtimeScene","            .getGame()","            .getJsonManager()","            .getLoadedJson(eventsFunctionContext.getArgument(\"Resource\"))","    );",""],"parameterObjects":"","useStrict":true,"eventsSheetExpanded":false}],"parameters":[{"description":"The resource to load the JSON from","name":"Resource","type":"jsonResource"},{"description":"The object where to find the variable","name":"Object","type":"objectList"},{"description":"The object variable to load the JSON to","name":"Variable","type":"objectvar"}],"objectGroups":[]}],"eventsBasedBehaviors":[],"eventsBasedObjects":[]},{"author":"","category":"User interface","extensionNamespace":"","fullName":"Panel sprite button","helpPath":"/objects/button","iconUrl":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAyMy4wLjMsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iSWNvbnMiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4Ig0KCSB2aWV3Qm94PSIwIDAgMzIgMzIiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDMyIDMyOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+DQo8c3R5bGUgdHlwZT0idGV4dC9jc3MiPg0KCS5zdDB7ZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoyO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDoxMDt9DQo8L3N0eWxlPg0KPHBhdGggY2xhc3M9InN0MCIgZD0iTTI5LDIzSDNjLTEuMSwwLTItMC45LTItMlYxMWMwLTEuMSwwLjktMiwyLTJoMjZjMS4xLDAsMiwwLjksMiwydjEwQzMxLDIyLjEsMzAuMSwyMywyOSwyM3oiLz4NCjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik0xMywxOUwxMywxOWMtMS4xLDAtMi0wLjktMi0ydi0yYzAtMS4xLDAuOS0yLDItMmgwYzEuMSwwLDIsMC45LDIsMnYyQzE1LDE4LjEsMTQuMSwxOSwxMywxOXoiLz4NCjxsaW5lIGNsYXNzPSJzdDAiIHgxPSIxOCIgeTE9IjEzIiB4Mj0iMTgiIHkyPSIxOSIvPg0KPGxpbmUgY2xhc3M9InN0MCIgeDE9IjIxIiB5MT0iMTMiIHgyPSIxOCIgeTI9IjE3Ii8+DQo8bGluZSBjbGFzcz0ic3QwIiB4MT0iMjEiIHkxPSIxOSIgeDI9IjE5IiB5Mj0iMTYiLz4NCjwvc3ZnPg0K","name":"PanelSpriteButton","previewIconUrl":"https://resources.gdevelop-app.com/assets/Icons/Line Hero Pack/Master/SVG/Interface Elements/Interface Elements_interface_ui_button_ok_cta_clock_tap.svg","shortDescription":"A button that can be customized.","version":"1.4.4","description":["The button can be customized with a background for each state and a label. It handles user interactions and a simple condition can be used to check if it is clicked.","","There are ready-to-use buttons in the asset-store [menu buttons pack](https://editor.gdevelop.io/?initial-dialog=asset-store&asset-pack=menu-buttons-menu-buttons)."],"origin":{"identifier":"PanelSpriteButton","name":"gdevelop-extension-store"},"tags":["button","ui"],"authorIds":["IWykYNRvhCZBN3vEgKEbBPOR3Oc2"],"dependencies":[],"eventsFunctions":[],"eventsBasedBehaviors":[{"description":"The finite state machine used internally by the button object.","fullName":"Button finite state machine","name":"ButtonFSM","objectType":"","private":true,"eventsFunctions":[{"fullName":"","functionType":"Action","name":"doStepPostEvents","sentence":"","events":[{"colorB":228,"colorG":176,"colorR":74,"creationTime":0,"name":"Finite state machine","source":"","type":"BuiltinCommonInstructions::Group","events":[{"type":"BuiltinCommonInstructions::Comment","color":{"b":109,"g":230,"r":255,"textB":0,"textG":0,"textR":0},"comment":"The \"Validated\" state only last one frame."},{"type":"BuiltinCommonInstructions::Standard","conditions":[{"type":{"value":"PanelSpriteButton::ButtonFSM::PropertyState"},"parameters":["Object","Behavior","=","\"Validated\""]}],"actions":[{"type":{"value":"PanelSpriteButton::ButtonFSM::SetPropertyState"},"parameters":["Object","Behavior","=","\"Idle\""]}]},{"colorB":228,"colorG":176,"colorR":74,"creationTime":0,"name":"Check position","source":"","type":"BuiltinCommonInstructions::Group","events":[{"type":"BuiltinCommonInstructions::Comment","color":{"b":109,"g":230,"r":255,"textB":0,"textG":0,"textR":0},"comment":"Make sure the cursor position is only checked once per frame."},{"type":"BuiltinCommonInstructions::Standard","conditions":[],"actions":[{"type":{"value":"PanelSpriteButton::ButtonFSM::SetPropertyMouseIsInside"},"parameters":["Object","Behavior","no"]}]},{"type":"BuiltinCommonInstructions::Standard","conditions":[{"type":{"value":"PanelSpriteButton::ButtonFSM::PropertyShouldCheckHovering"},"parameters":["Object","Behavior"]},{"type":{"value":"CollisionPoint"},"parameters":["Object","MouseOnlyCursorX(Object.Layer(), 0)","MouseOnlyCursorY(Object.Layer(), 0)"]}],"actions":[{"type":{"value":"PanelSpriteButton::ButtonFSM::SetPropertyMouseIsInside"},"parameters":["Object","Behavior","yes"]}]},{"type":"BuiltinCommonInstructions::Comment","color":{"b":109,"g":230,"r":255,"textB":0,"textG":0,"textR":0},"comment":"Touches are always pressed, so ShouldCheckHovering doesn't matter."},{"type":"BuiltinCommonInstructions::Standard","conditions":[],"actions":[{"type":{"value":"PanelSpriteButton::ButtonFSM::SetPropertyTouchIsInside"},"parameters":["Object","Behavior","no"]}]},{"type":"BuiltinCommonInstructions::Standard","conditions":[{"type":{"value":"PanelSpriteButton::ButtonFSM::PropertyTouchId"},"parameters":["Object","Behavior","!=","0"]},{"type":{"value":"CollisionPoint"},"parameters":["Object","TouchX(Object.Behavior::PropertyTouchId(), Object.Layer(), 0)","TouchY(Object.Behavior::PropertyTouchId(), Object.Layer(), 0)"]}],"actions":[{"type":{"value":"PanelSpriteButton::ButtonFSM::SetPropertyTouchIsInside"},"parameters":["Object","Behavior","yes"]}]}],"parameters":[]},{"colorB":228,"colorG":176,"colorR":74,"creationTime":0,"name":"Handle touch start","source":"","type":"BuiltinCommonInstructions::Group","events":[{"type":"BuiltinCommonInstructions::Standard","conditions":[{"type":{"value":"HasAnyTouchOrMouseStarted"},"parameters":[""]}],"actions":[{"type":{"value":"PanelSpriteButton::ButtonFSM::SetPropertyIndex"},"parameters":["Object","Behavior","=","0"]}],"events":[{"type":"BuiltinCommonInstructions::Repeat","repeatExpression":"StartedTouchOrMouseCount()","conditions":[],"actions":[],"events":[{"type":"BuiltinCommonInstructions::Standard","conditions":[{"type":{"value":"CollisionPoint"},"parameters":["Object","TouchX(StartedTouchOrMouseId(Object.Behavior::PropertyIndex()), Object.Layer(), 0)","TouchY(StartedTouchOrMouseId(Object.Behavior::PropertyIndex()), Object.Layer(), 0)"]}],"actions":[{"type":{"value":"PanelSpriteButton::ButtonFSM::SetPropertyTouchId"},"parameters":["Object","Behavior","=","StartedTouchOrMouseId(Object.Behavior::PropertyIndex())"]},{"type":{"value":"PanelSpriteButton::ButtonFSM::SetPropertyTouchIsInside"},"parameters":["Object","Behavior","yes"]}],"events":[{"type":"BuiltinCommonInstructions::Standard","conditions":[{"type":{"value":"BuiltinCommonInstructions::Or"},"parameters":[],"subInstructions":[{"type":{"value":"PanelSpriteButton::ButtonFSM::PropertyState"},"parameters":["Object","Behavior","=","\"Hovered\""]},{"type":{"value":"PanelSpriteButton::ButtonFSM::PropertyState"},"parameters":["Object","Behavior","=","\"Idle\""]}]}],"actions":[{"type":{"value":"PanelSpriteButton::ButtonFSM::SetPropertyState"},"parameters":["Object","Behavior","=","\"PressedInside\""]}]}]},{"type":"BuiltinCommonInstructions::Standard","conditions":[],"actions":[{"type":{"value":"PanelSpriteButton::ButtonFSM::SetPropertyIndex"},"parameters":["Object","Behavior","+","1"]}]}]}]}],"parameters":[]},{"colorB":228,"colorG":176,"colorR":74,"creationTime":0,"name":"Apply position changes","source":"","type":"BuiltinCommonInstructions::Group","events":[{"type":"BuiltinCommonInstructions::Standard","conditions":[{"type":{"inverted":true,"value":"PanelSpriteButton::ButtonFSM::PropertyMouseIsInside"},"parameters":["Object","Behavior"]},{"type":{"value":"PanelSpriteButton::ButtonFSM::PropertyState"},"parameters":["Object","Behavior","=","\"Hovered\""]}],"actions":[{"type":{"value":"PanelSpriteButton::ButtonFSM::SetPropertyState"},"parameters":["Object","Behavior","=","\"Idle\""]}]},{"type":"BuiltinCommonInstructions::Standard","conditions":[{"type":{"value":"PanelSpriteButton::ButtonFSM::PropertyMouseIsInside"},"parameters":["Object","Behavior"]},{"type":{"value":"PanelSpriteButton::ButtonFSM::PropertyState"},"parameters":["Object","Behavior","=","\"Idle\""]}],"actions":[{"type":{"value":"PanelSpriteButton::ButtonFSM::SetPropertyState"},"parameters":["Object","Behavior","=","\"Hovered\""]}]},{"type":"BuiltinCommonInstructions::Standard","conditions":[{"type":{"inverted":true,"value":"PanelSpriteButton::ButtonFSM::PropertyTouchIsInside"},"parameters":["Object","Behavior"]},{"type":{"value":"PanelSpriteButton::ButtonFSM::PropertyState"},"parameters":["Object","Behavior","=","\"PressedInside\""]}],"actions":[{"type":{"value":"PanelSpriteButton::ButtonFSM::SetPropertyState"},"parameters":["Object","Behavior","=","\"PressedOutside\""]}]},{"type":"BuiltinCommonInstructions::Standard","conditions":[{"type":{"value":"PanelSpriteButton::ButtonFSM::PropertyTouchIsInside"},"parameters":["Object","Behavior"]},{"type":{"value":"PanelSpriteButton::ButtonFSM::PropertyState"},"parameters":["Object","Behavior","=","\"PressedOutside\""]}],"actions":[{"type":{"value":"PanelSpriteButton::ButtonFSM::SetPropertyState"},"parameters":["Object","Behavior","=","\"PressedInside\""]}]}],"parameters":[]},{"colorB":228,"colorG":176,"colorR":74,"creationTime":0,"name":"Handle touch end","source":"","type":"BuiltinCommonInstructions::Group","events":[{"type":"BuiltinCommonInstructions::Standard","conditions":[{"type":{"value":"HasTouchEnded"},"parameters":["","Object.Behavior::PropertyTouchId()"]}],"actions":[{"type":{"value":"PanelSpriteButton::ButtonFSM::SetPropertyTouchId"},"parameters":["Object","Behavior","=","0"]}],"events":[{"type":"BuiltinCommonInstructions::Standard","conditions":[{"type":{"value":"PanelSpriteButton::ButtonFSM::PropertyState"},"parameters":["Object","Behavior","=","\"PressedInside\""]}],"actions":[{"type":{"value":"PanelSpriteButton::ButtonFSM::SetPropertyState"},"parameters":["Object","Behavior","=","\"Validated\""]}]},{"type":"BuiltinCommonInstructions::Standard","conditions":[{"type":{"inverted":true,"value":"PanelSpriteButton::ButtonFSM::PropertyState"},"parameters":["Object","Behavior","=","\"PressedInside\""]},{"type":{"inverted":true,"value":"PanelSpriteButton::ButtonFSM::PropertyState"},"parameters":["Object","Behavior","=","\"Validated\""]}],"actions":[{"type":{"value":"PanelSpriteButton::ButtonFSM::SetPropertyState"},"parameters":["Object","Behavior","=","\"Idle\""]}]}]}],"parameters":[]}],"parameters":[]}],"parameters":[{"description":"Object","name":"Object","type":"object"},{"description":"Behavior","name":"Behavior","supplementaryInformation":"PanelSpriteButton::ButtonFSM","type":"behavior"}],"objectGroups":[]},{"fullName":"","functionType":"Action","name":"onDeActivate","sentence":"","events":[{"type":"BuiltinCommonInstructions::Standard","conditions":[],"actions":[{"type":{"value":"PanelSpriteButton::ButtonFSM::ResetState"},"parameters":["Object","Behavior",""]}]}],"parameters":[{"description":"Object","name":"Object","type":"object"},{"description":"Behavior","name":"Behavior","supplementaryInformation":"PanelSpriteButton::ButtonFSM","type":"behavior"}],"objectGroups":[]},{"description":"Reset the state of the button.","fullName":"Reset state","functionType":"Action","name":"ResetState","private":true,"sentence":"Reset the button state of _PARAM0_","events":[{"type":"BuiltinCommonInstructions::Standard","conditions":[],"actions":[{"type":{"value":"PanelSpriteButton::ButtonFSM::SetPropertyState"},"parameters":["Object","Behavior","=","\"Idle\""]},{"type":{"value":"PanelSpriteButton::ButtonFSM::SetPropertyTouchId"},"parameters":["Object","Behavior","=","0"]}]}],"parameters":[{"description":"Object","name":"Object","type":"object"},{"description":"Behavior","name":"Behavior","supplementaryInformation":"PanelSpriteButton::ButtonFSM","type":"behavior"}],"objectGroups":[]},{"description":"Check if the button is not used.","fullName":"Is idle","functionType":"Condition","name":"IsIdle","sentence":"_PARAM0_ is idle","events":[{"type":"BuiltinCommonInstructions::Standard","conditions":[{"type":{"value":"PanelSpriteButton::ButtonFSM::PropertyState"},"parameters":["Object","Behavior","=","\"Idle\""]}],"actions":[{"type":{"value":"SetReturnBoolean"},"parameters":["True"]}]}],"parameters":[{"description":"Object","name":"Object","type":"object"},{"description":"Behavior","name":"Behavior","supplementaryInformation":"PanelSpriteButton::ButtonFSM","type":"behavior"}],"objectGroups":[]},{"description":"Check if the button was just clicked.","fullName":"Is clicked","functionType":"Condition","name":"IsClicked","sentence":"_PARAM0_ is clicked","events":[{"type":"BuiltinCommonInstructions::Standard","conditions":[{"type":{"value":"PanelSpriteButton::ButtonFSM::PropertyState"},"parameters":["Object","Behavior","=","\"Validated\""]}],"actions":[{"type":{"value":"SetReturnBoolean"},"parameters":["True"]}]}],"parameters":[{"description":"Object","name":"Object","type":"object"},{"description":"Behavior","name":"Behavior","supplementaryInformation":"PanelSpriteButton::ButtonFSM","type":"behavior"}],"objectGroups":[]},{"description":"Check if the cursor is hovered over the button.","fullName":"Is hovered","functionType":"Condition","name":"IsHovered","sentence":"_PARAM0_ is hovered","events":[{"type":"BuiltinCommonInstructions::Standard","conditions":[{"type":{"value":"PanelSpriteButton::ButtonFSM::PropertyState"},"parameters":["Object","Behavior","=","\"Hovered\""]}],"actions":[{"type":{"value":"SetReturnBoolean"},"parameters":["True"]}]}],"parameters":[{"description":"Object","name":"Object","type":"object"},{"description":"Behavior","name":"Behavior","supplementaryInformation":"PanelSpriteButton::ButtonFSM","type":"behavior"}],"objectGroups":[]},{"description":"Check if the button is either hovered or pressed but not hovered.","fullName":"Is focused","functionType":"Condition","name":"IsFocused","sentence":"_PARAM0_ is focused","events":[{"type":"BuiltinCommonInstructions::Standard","conditions":[{"type":{"value":"PanelSpriteButton::ButtonFSM::PropertyState"},"parameters":["Object","Behavior","=","\"Hovered\""]}],"actions":[{"type":{"value":"SetReturnBoolean"},"parameters":["True"]}]},{"type":"BuiltinCommonInstructions::Standard","conditions":[{"type":{"value":"PanelSpriteButton::ButtonFSM::PropertyState"},"parameters":["Object","Behavior","=","\"PressedOutside\""]}],"actions":[{"type":{"value":"SetReturnBoolean"},"parameters":["True"]}]}],"parameters":[{"description":"Object","name":"Object","type":"object"},{"description":"Behavior","name":"Behavior","supplementaryInformation":"PanelSpriteButton::ButtonFSM","type":"behavior"}],"objectGroups":[]},{"description":"Check if the button is currently being pressed with mouse or touch.","fullName":"Is pressed","functionType":"Condition","name":"IsPressed","sentence":"_PARAM0_ is pressed","events":[{"type":"BuiltinCommonInstructions::Standard","conditions":[{"type":{"value":"PanelSpriteButton::ButtonFSM::PropertyState"},"parameters":["Object","Behavior","=","\"PressedInside\""]}],"actions":[{"type":{"value":"SetReturnBoolean"},"parameters":["True"]}]}],"parameters":[{"description":"Object","name":"Object","type":"object"},{"description":"Behavior","name":"Behavior","supplementaryInformation":"PanelSpriteButton::ButtonFSM","type":"behavior"}],"objectGroups":[]},{"description":"Check if the button is currently being pressed outside with mouse or touch.","fullName":"Is held outside","functionType":"Condition","name":"IsPressedOutside","sentence":"_PARAM0_ is held outside","events":[{"type":"BuiltinCommonInstructions::Standard","conditions":[{"type":{"value":"PanelSpriteButton::ButtonFSM::PropertyState"},"parameters":["Object","Behavior","=","\"PressedOutside\""]}],"actions":[{"type":{"value":"SetReturnBoolean"},"parameters":["True"]}]}],"parameters":[{"description":"Object","name":"Object","type":"object"},{"description":"Behavior","name":"Behavior","supplementaryInformation":"PanelSpriteButton::ButtonFSM","type":"behavior"}],"objectGroups":[]},{"description":"the touch id that is using the button or 0 if none.","fullName":"Touch id","functionType":"ExpressionAndCondition","name":"TouchId","sentence":"the touch id","events":[{"type":"BuiltinCommonInstructions::Standard","conditions":[],"actions":[{"type":{"value":"SetReturnNumber"},"parameters":["Object.Behavior::PropertyTouchId()"]}]}],"expressionType":{"type":"expression"},"parameters":[{"description":"Object","name":"Object","type":"object"},{"description":"Behavior","name":"Behavior","supplementaryInformation":"PanelSpriteButton::ButtonFSM","type":"behavior"}],"objectGroups":[]}],"propertyDescriptors":[{"value":"true","type":"Boolean","label":"","description":"Should check hovering","group":"","extraInformation":[],"hidden":true,"name":"ShouldCheckHovering"},{"value":"Idle","type":"Choice","label":"State","description":"","group":"","extraInformation":["Idle","Hovered","PressedInside","PressedOutside","Validated"],"hidden":true,"name":"State"},{"value":"0","type":"Number","label":"Touch id","description":"","group":"","extraInformation":[],"hidden":true,"name":"TouchId"},{"value":"","type":"Boolean","label":"Touch is inside","description":"","group":"","extraInformation":[],"hidden":true,"name":"TouchIsInside"},{"value":"","type":"Boolean","label":"Mouse is inside","description":"","group":"","extraInformation":[],"hidden":true,"name":"MouseIsInside"},{"value":"","type":"Number","label":"","description":"","group":"","extraInformation":[],"hidden":true,"name":"Index"}],"sharedPropertyDescriptors":[]}],"eventsBasedObjects":[{"defaultName":"Button","description":"A button that can be customized.","fullName":"Button (panel sprite)","name":"PanelSpriteButton","eventsFunctions":[{"fullName":"","functionType":"Action","name":"onCreated","sentence":"","events":[{"type":"BuiltinCommonInstructions::Comment","color":{"b":109,"g":230,"r":255,"textB":0,"textG":0,"textR":0},"comment":"Create one background instance for of each state.\nOnly the instance for the current state is shown."},{"type":"BuiltinCommonInstructions::Standard","conditions":[],"actions":[{"type":{"value":"Create"},"parameters":["","Idle","0","0",""]},{"type":{"value":"Create"},"parameters":["","Hovered","0","0",""]},{"type":{"value":"Create"},"parameters":["","Pressed","0","0",""]},{"type":{"value":"Cache"},"parameters":["Hovered"]},{"type":{"value":"Cache"},"parameters":["Pressed"]},{"type":{"value":"ChangePlan"},"parameters":["Hovered","=","1"]}]},{"type":"BuiltinCommonInstructions::Comment","color":{"b":109,"g":230,"r":255,"textB":0,"textG":0,"textR":0},"comment":"Place the label over the backgrounds."},{"type":"BuiltinCommonInstructions::Standard","conditions":[],"actions":[{"type":{"value":"Create"},"parameters":["","Label","0","0",""]},{"type":{"value":"ChangePlan"},"parameters":["Label","=","2"]},{"type":{"value":"TextObject::SetWrapping"},"parameters":["Label","yes"]},{"type":{"value":"PanelSpriteButton::PanelSpriteButton::CenterLabel"},"parameters":["Object",""]}]}],"parameters":[{"description":"Object","name":"Object","supplementaryInformation":"PanelSpriteButton::PanelSpriteButton","type":"object"}],"objectGroups":[{"name":"Background","objects":[{"name":"Idle"},{"name":"Hovered"},{"name":"Pressed"}]}]},{"fullName":"","functionType":"Action","name":"onHotReloading","sentence":"","events":[{"type":"BuiltinCommonInstructions::Standard","conditions":[],"actions":[{"type":{"value":"PanelSpriteButton::PanelSpriteButton::CenterLabel"},"parameters":["Object",""]}]}],"parameters":[{"description":"Object","name":"Object","supplementaryInformation":"PanelSpriteButton::PanelSpriteButton","type":"object"}],"objectGroups":[]},{"fullName":"","functionType":"Action","name":"doStepPostEvents","sentence":"","events":[{"colorB":228,"colorG":176,"colorR":74,"creationTime":0,"name":"Apply states","source":"","type":"BuiltinCommonInstructions::Group","events":[{"type":"BuiltinCommonInstructions::Comment","color":{"b":109,"g":230,"r":255,"textB":0,"textG":0,"textR":0},"comment":"Show the right background accordingly to the new state."},{"type":"BuiltinCommonInstructions::Standard","conditions":[{"type":{"value":"PanelSpriteButton::PanelSpriteButton::IsIdle"},"parameters":["Object","ButtonFSM"]},{"type":{"value":"BuiltinCommonInstructions::Once"},"parameters":[]}],"actions":[{"type":{"value":"SetCenterY"},"parameters":["Label","=","Object.CenterWithPaddingY()"]},{"type":{"value":"Montre"},"parameters":["Idle",""]},{"type":{"value":"Cache"},"parameters":["Pressed"]}],"events":[{"type":"BuiltinCommonInstructions::Standard","conditions":[{"type":{"value":"Visible"},"parameters":["Hovered"]},{"type":{"value":"PanelSpriteButton::PanelSpriteButton::PropertyHoveredFadeOutDuration"},"parameters":["Object",">","0"]}],"actions":[{"type":{"value":"Tween::AddObjectOpacityTween"},"parameters":["Hovered","Tween","\"Fadeout\"","0","\"linear\"","Object.PropertyHoveredFadeOutDuration() * 1000",""]}]},{"type":"BuiltinCommonInstructions::Standard","conditions":[{"type":{"value":"PanelSpriteButton::PanelSpriteButton::PropertyHoveredFadeOutDuration"},"parameters":["Object","=","0"]}],"actions":[{"type":{"value":"Cache"},"parameters":["Hovered"]}]}]},{"type":"BuiltinCommonInstructions::Standard","conditions":[{"type":{"value":"PanelSpriteObject::Opacity"},"parameters":["Hovered","=","0"]}],"actions":[{"type":{"value":"Cache"},"parameters":["Hovered"]},{"type":{"value":"PanelSpriteObject::SetOpacity"},"parameters":["Hovered","=","255"]}]},{"type":"BuiltinCommonInstructions::Standard","conditions":[{"type":{"value":"PanelSpriteButton::PanelSpriteButton::IsHovered"},"parameters":["Object","ButtonFSM"]},{"type":{"value":"BuiltinCommonInstructions::Once"},"parameters":[]}],"actions":[{"type":{"value":"SetCenterY"},"parameters":["Label","=","Object.CenterWithPaddingY()"]},{"type":{"value":"Cache"},"parameters":["Idle"]},{"type":{"value":"Montre"},"parameters":["Hovered",""]},{"type":{"value":"Cache"},"parameters":["Pressed"]},{"type":{"value":"Tween::RemoveTween"},"parameters":["Hovered","Tween","\"Fadeout\""]},{"type":{"value":"PanelSpriteObject::SetOpacity"},"parameters":["Hovered","=","255"]}]},{"type":"BuiltinCommonInstructions::Standard","conditions":[{"type":{"value":"PanelSpriteButton::PanelSpriteButton::IsPressed"},"parameters":["Object","ButtonFSM"]},{"type":{"value":"BuiltinCommonInstructions::Once"},"parameters":[]}],"actions":[{"type":{"value":"SetCenterY"},"parameters":["Label","=","Object.CenterWithPaddingY() + Object.PropertyPressedLabelOffsetY()"]},{"type":{"value":"Cache"},"parameters":["Idle"]},{"type":{"value":"Cache"},"parameters":["Hovered"]},{"type":{"value":"Montre"},"parameters":["Pressed",""]}]},{"type":"BuiltinCommonInstructions::Standard","conditions":[{"type":{"value":"PanelSpriteButton::PanelSpriteButton::IsFocused"},"parameters":["Object","ButtonFSM"]},{"type":{"value":"BuiltinCommonInstructions::Once"},"parameters":[]}],"actions":[{"type":{"value":"SetCenterY"},"parameters":["Label","=","Object.CenterWithPaddingY()"]},{"type":{"value":"Cache"},"parameters":["Idle"]},{"type":{"value":"Montre"},"parameters":["Hovered",""]},{"type":{"value":"Cache"},"parameters":["Pressed"]}]}],"parameters":[]},{"colorB":228,"colorG":176,"colorR":74,"creationTime":0,"name":"Resize","source":"","type":"BuiltinCommonInstructions::Group","events":[{"type":"BuiltinCommonInstructions::Comment","color":{"b":109,"g":230,"r":255,"textB":0,"textG":0,"textR":0},"comment":"Children instances must be resized when the button size change:\n- backgrounds for each state are resized to take the full dimensions of the button\n- the label is put back at the center of the button\n\nThe scale is set back to 1 because it means that the parent instance has the same dimensions as the union of its children instances."},{"type":"BuiltinCommonInstructions::Standard","conditions":[{"type":{"value":"BuiltinCommonInstructions::Or"},"parameters":[],"subInstructions":[{"type":{"value":"BuiltinCommonInstructions::CompareNumbers"},"parameters":["Object.Width()","!=","max(Idle.BoundingBoxRight(), Label.BoundingBoxRight()) - min(Idle.BoundingBoxLeft(), Label.BoundingBoxLeft())"]},{"type":{"value":"BuiltinCommonInstructions::CompareNumbers"},"parameters":["Object.Height()","!=","max(Idle.BoundingBoxBottom(), Label.BoundingBoxBottom()) - min(Idle.BoundingBoxTop(), Label.BoundingBoxTop())"]}]}],"actions":[{"type":{"value":"ModVarObjet"},"parameters":["Idle","Width","=","Object.Width()"]},{"type":{"value":"ModVarObjet"},"parameters":["Idle","Height","=","Object.Height()"]},{"type":{"value":"PanelSpriteButton::Scale"},"parameters":["Object","=","1"]},{"type":{"value":"PanelSpriteObject::Width"},"parameters":["Background","=","Idle.Variable(Width)"]},{"type":{"value":"PanelSpriteObject::Height"},"parameters":["Background","=","Idle.Variable(Height)"]},{"type":{"value":"PanelSpriteButton::PanelSpriteButton::CenterLabel"},"parameters":["Object",""]}]}],"parameters":[]}],"parameters":[{"description":"Object","name":"Object","supplementaryInformation":"PanelSpriteButton::PanelSpriteButton","type":"object"}],"objectGroups":[{"name":"Background","objects":[{"name":"Idle"},{"name":"Hovered"},{"name":"Pressed"}]}]},{"description":"Check if the button is not used.","fullName":"Is idle","functionType":"Condition","name":"IsIdle","sentence":"_PARAM0_ is idle","events":[{"type":"BuiltinCommonInstructions::Standard","conditions":[{"type":{"value":"PanelSpriteButton::ButtonFSM::IsIdle"},"parameters":["Idle","ButtonFSM",""]}],"actions":[{"type":{"value":"SetReturnBoolean"},"parameters":["True"]}]}],"parameters":[{"description":"Object","name":"Object","supplementaryInformation":"PanelSpriteButton::PanelSpriteButton","type":"object"}],"objectGroups":[]},{"description":"Check if the button was just clicked.","fullName":"Is clicked","functionType":"Condition","name":"IsClicked","sentence":"_PARAM0_ is clicked","events":[{"type":"BuiltinCommonInstructions::Standard","conditions":[{"type":{"value":"PanelSpriteButton::ButtonFSM::IsClicked"},"parameters":["Idle","ButtonFSM",""]}],"actions":[{"type":{"value":"SetReturnBoolean"},"parameters":["True"]}]}],"parameters":[{"description":"Object","name":"Object","supplementaryInformation":"PanelSpriteButton::PanelSpriteButton","type":"object"}],"objectGroups":[]},{"description":"Check if the cursor is hovered over the button.","fullName":"Is hovered","functionType":"Condition","name":"IsHovered","sentence":"_PARAM0_ is hovered","events":[{"type":"BuiltinCommonInstructions::Standard","conditions":[{"type":{"value":"PanelSpriteButton::ButtonFSM::IsHovered"},"parameters":["Idle","ButtonFSM",""]}],"actions":[{"type":{"value":"SetReturnBoolean"},"parameters":["True"]}]}],"parameters":[{"description":"Object","name":"Object","supplementaryInformation":"PanelSpriteButton::PanelSpriteButton","type":"object"}],"objectGroups":[]},{"description":"Check if the button is either hovered or pressed but not hovered.","fullName":"Is focused","functionType":"Condition","name":"IsFocused","sentence":"_PARAM0_ is focused","events":[{"type":"BuiltinCommonInstructions::Standard","conditions":[{"type":{"value":"PanelSpriteButton::ButtonFSM::IsFocused"},"parameters":["Idle","ButtonFSM",""]}],"actions":[{"type":{"value":"SetReturnBoolean"},"parameters":["True"]}]}],"parameters":[{"description":"Object","name":"Object","supplementaryInformation":"PanelSpriteButton::PanelSpriteButton","type":"object"}],"objectGroups":[]},{"description":"Check if the button is currently being pressed with mouse or touch.","fullName":"Is pressed","functionType":"Condition","name":"IsPressed","sentence":"_PARAM0_ is pressed","events":[{"type":"BuiltinCommonInstructions::Standard","conditions":[{"type":{"value":"PanelSpriteButton::ButtonFSM::IsPressed"},"parameters":["Idle","ButtonFSM",""]}],"actions":[{"type":{"value":"SetReturnBoolean"},"parameters":["True"]}]}],"parameters":[{"description":"Object","name":"Object","supplementaryInformation":"PanelSpriteButton::PanelSpriteButton","type":"object"}],"objectGroups":[]},{"description":"Change the text of the button label.","fullName":"Label text","functionType":"Action","name":"SetLabelText","sentence":"Change the text of _PARAM0_ to _PARAM1_","events":[{"type":"BuiltinCommonInstructions::Standard","conditions":[],"actions":[{"type":{"value":"TextObject::String"},"parameters":["Label","=","GetArgumentAsString(\"LabelText\")"]},{"type":{"value":"PanelSpriteButton::PanelSpriteButton::CenterLabel"},"parameters":["Object",""]}]}],"parameters":[{"description":"Object","name":"Object","supplementaryInformation":"PanelSpriteButton::PanelSpriteButton","type":"object"},{"description":"Text","name":"LabelText","type":"string"}],"objectGroups":[]},{"description":"Return the label text.","fullName":"Label text","functionType":"StringExpression","name":"LabelText","sentence":"","events":[{"type":"BuiltinCommonInstructions::Standard","conditions":[],"actions":[{"type":{"value":"SetReturnString"},"parameters":["Label.String()"]}]}],"expressionType":{"type":"string"},"parameters":[{"description":"Object","name":"Object","supplementaryInformation":"PanelSpriteButton::PanelSpriteButton","type":"object"}],"objectGroups":[]},{"description":"Return the label center Y according to the button configuration. This expression is used in doStepPostEvents when the button is pressed or released.","fullName":"","functionType":"Expression","name":"CenterWithPaddingY","private":true,"sentence":"","events":[{"type":"BuiltinCommonInstructions::Standard","conditions":[],"actions":[{"type":{"value":"SetReturnNumber"},"parameters":["Idle.CenterY() + (Object.PropertyTopPadding() - Object.PropertyBottomPadding()) / 2"]}]}],"expressionType":{"type":"expression"},"parameters":[{"description":"Object","name":"Object","supplementaryInformation":"PanelSpriteButton::PanelSpriteButton","type":"object"}],"objectGroups":[]},{"description":"Center the label according to the button configuration. This is used in doStepPostEvents when the button is resized.","fullName":"","functionType":"Action","name":"CenterLabel","private":true,"sentence":"Center the label of _PARAM0_","events":[{"type":"BuiltinCommonInstructions::Standard","conditions":[],"actions":[{"type":{"value":"MettreXY"},"parameters":["Label","=","Object.PropertyLeftPadding()","=","Object.PropertyTopPadding()"]},{"type":{"value":"TextObject::WrappingWidth"},"parameters":["Label","=","Idle.Width() - Object.PropertyLeftPadding() - Object.PropertyRightPadding()"]},{"type":{"value":"SetCenterY"},"parameters":["Label","=","Object.CenterWithPaddingY()"]}],"events":[{"type":"BuiltinCommonInstructions::Standard","conditions":[],"actions":[{"type":{"value":"SetCenterX"},"parameters":["Label","=","Background.CenterX() +  (Object.PropertyLeftPadding() - Object.PropertyRightPadding()) / 2"]}]}]},{"type":"BuiltinCommonInstructions::Standard","conditions":[{"type":{"value":"PanelSpriteButton::PanelSpriteButton::IsPressed"},"parameters":["Object",""]}],"actions":[{"type":{"value":"MettreY"},"parameters":["Label","+","Object.PropertyPressedLabelOffsetY()"]}]}],"parameters":[{"description":"Object","name":"Object","supplementaryInformation":"PanelSpriteButton::PanelSpriteButton","type":"object"}],"objectGroups":[{"name":"Background","objects":[{"name":"Idle"},{"name":"Hovered"},{"name":"Pressed"}]}]},{"description":"De/activate interactions with the button.","fullName":"De/activate interactions","functionType":"Action","name":"Activate","sentence":"Activate interactions with _PARAM0_: _PARAM1_","events":[{"type":"BuiltinCommonInstructions::Standard","conditions":[{"type":{"value":"GetArgumentAsBoolean"},"parameters":["\"ShouldActivate\""]}],"actions":[{"type":{"value":"ActivateBehavior"},"parameters":["Idle","ButtonFSM","yes"]}]},{"type":"BuiltinCommonInstructions::Standard","conditions":[{"type":{"inverted":true,"value":"GetArgumentAsBoolean"},"parameters":["\"ShouldActivate\""]}],"actions":[{"type":{"value":"ActivateBehavior"},"parameters":["Idle","ButtonFSM","no"]}]}],"parameters":[{"description":"Object","name":"Object","supplementaryInformation":"PanelSpriteButton::PanelSpriteButton","type":"object"},{"description":"Activate","name":"ShouldActivate","type":"yesorno"}],"objectGroups":[]},{"description":"Check if interactions are activated on the button.","fullName":"Interactions activated","functionType":"Condition","name":"IsActivated","sentence":"Interactions on _PARAM0_ are activated","events":[{"type":"BuiltinCommonInstructions::Standard","conditions":[{"type":{"value":"BehaviorActivated"},"parameters":["Idle","ButtonFSM"]}],"actions":[{"type":{"value":"SetReturnBoolean"},"parameters":["True"]}]}],"parameters":[{"description":"Object","name":"Object","supplementaryInformation":"PanelSpriteButton::PanelSpriteButton","type":"object"}],"objectGroups":[]}],"propertyDescriptors":[{"value":"0","type":"Number","label":"Label offset on Y axis when pressed","description":"","group":"","extraInformation":[],"hidden":false,"name":"PressedLabelOffsetY"},{"value":"0","type":"Number","label":"Left padding","description":"","group":"Padding","extraInformation":["Label"],"hidden":false,"name":"LeftPadding"},{"value":"0","type":"Number","label":"Right padding","description":"","group":"Padding","extraInformation":["Label"],"hidden":false,"name":"RightPadding"},{"value":"0","type":"Number","label":"Top padding","description":"","group":"Padding","extraInformation":["Label"],"hidden":false,"name":"TopPadding"},{"value":"0","type":"Number","label":"Bottom padding","description":"","group":"Padding","extraInformation":["Label"],"hidden":false,"name":"BottomPadding"},{"value":"0.25","type":"Number","label":"Hovered fade out duration (in seconds)","description":"","group":"","extraInformation":[],"hidden":false,"name":"HoveredFadeOutDuration"}],"objects":[{"assetStoreId":"","bold":false,"italic":false,"name":"Label","smoothed":true,"tags":"","type":"TextObject::Text","underlined":false,"variables":[],"effects":[],"behaviors":[],"string":"Text","font":"","textAlignment":"","characterSize":20.0,"color":{"b":0,"g":0,"r":0}},{"assetStoreId":"","bottomMargin":0.0,"height":32.0,"leftMargin":0.0,"name":"Idle","rightMargin":0.0,"tags":"","texture":"","tiled":false,"topMargin":0.0,"type":"PanelSpriteObject::PanelSprite","width":32.0,"variables":[{"folded":true,"name":"State","type":"string","value":"Idle"}],"effects":[],"behaviors":[{"name":"ButtonFSM","type":"PanelSpriteButton::ButtonFSM","ShouldCheckHovering":true}]},{"assetStoreId":"","bottomMargin":0.0,"height":32.0,"leftMargin":0.0,"name":"Hovered","rightMargin":0.0,"tags":"","texture":"","tiled":false,"topMargin":0.0,"type":"PanelSpriteObject::PanelSprite","width":32.0,"variables":[],"effects":[],"behaviors":[{"name":"Tween","type":"Tween::TweenBehavior"}]},{"assetStoreId":"","bottomMargin":0.0,"height":32.0,"leftMargin":0.0,"name":"Pressed","rightMargin":0.0,"tags":"","texture":"","tiled":false,"topMargin":0.0,"type":"PanelSpriteObject::PanelSprite","width":32.0,"variables":[],"effects":[],"behaviors":[]}]}]},{"author":"Arthur Pacaud (@arthuro555)","category":"Network","extensionNamespace":"","fullName":"MQTT Client (advanced)","helpPath":"","iconUrl":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0ibWRpLW1lc3NhZ2UtZmxhc2giIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMjIgNEMyMiAyLjkgMjEuMSAyIDIwIDJINEMyLjkgMiAyIDIuOSAyIDRWMjJMNiAxOEgxNVYxMEgyMlY0TTIyLjUgMTZIMjAuM0wyMiAxMkgxN1YxOEgxOVYyM0wyMi41IDE2WiIgLz48L3N2Zz4=","name":"MQTT","previewIconUrl":"https://resources.gdevelop-app.com/assets/Icons/message-flash.svg","shortDescription":"An MQTT client for GDevelop: allow connections to a MQTT server and send/receive messages.","version":"1.0.0","description":["This extension wraps [MQTT.js](https://github.com/mqttjs/MQTT.js) to allow connections to a MQTT server and communication via pub/sub. The only transport method is Websockets. Make sure to use a broker that support those!","","# Dataloss","","The dataloss let you chose how to handle data. Due to how the GDevelop event loop is made, only one message per topic can be processed per frame. When dataloss is on, when you get 2 messages from one topic in one frame, only the latest one is remembered. When it is off, the first message is processed and the second is queued for the next frame.","","# QoS (Quality of service)","","Here is how QoS works:",""," - QoS 0 (received at most once): The packet is sent, and that's it. There is no validation about whether it has been received."," - QoS 1 (received at least once): The packet is sent and stored as long as the client has not received a confirmation from the server. MQTT ensures that it will be received, but there can be duplicates."," - QoS 2 (received exactly once): Same as QoS 1 but there is no duplicates.","","About data consumption: QoS 2 will consume more than QoS 1, which will consume more than QoS 0."],"origin":{"identifier":"MQTT","name":"gdevelop-extension-store"},"tags":["mqtt","iot","connection","networking"],"authorIds":["ZgrsWuRTAkXgeuPV9bo0zuEcA2w1"],"dependencies":[],"eventsFunctions":[{"fullName":"","functionType":"Action","name":"onFirstSceneLoaded","sentence":"","events":[{"type":"BuiltinCommonInstructions::JsCode","inlineCode":["/**"," * @typedef MQTTEvent Corresponds to a message coming from a subcribed topic."," * @property {boolean} loss Descibes how to handle multiple packages in one frame."," * @property {string || Array<string>} data The last message received by that event."," */","","/**"," * The mqtt tools"," * @namespace"," */","gdjs.evtTools.mqtt = {","    /** The current connection to the MQTT broker server */","    connection: null,","    /** ","     * The last error that occured ","     * @type {string}","     */","    lastError: \"\",","    /**","     * A list of events triggered.","     * @type {Object.<string, MQTTEvent>}","     */","    events: {},","    empty: Symbol(\"No event\"),","};","","// MQTT.js: https://github.com/mqttjs/MQTT.js","!function (e) { if (\"object\" == typeof exports && \"undefined\" != typeof module) module.exports = e(); else if (\"function\" == typeof define && define.amd) define([], e); else { (\"undefined\" != typeof window ? window : \"undefined\" != typeof global ? global : \"undefined\" != typeof self ? self : this).mqtt = e() } }(function () { return function () { return function e(t, r, n) { function i(s, a) { if (!r[s]) { if (!t[s]) { var u = \"function\" == typeof require && require; if (!a && u) return u(s, !0); if (o) return o(s, !0); var c = new Error(\"Cannot find module '\" + s + \"'\"); throw c.code = \"MODULE_NOT_FOUND\", c } var l = r[s] = { exports: {} }; t[s][0].call(l.exports, function (e) { return i(t[s][1][e] || e) }, l, l.exports, e, t, r, n) } return r[s].exports } for (var o = \"function\" == typeof require && require, s = 0; s < n.length; s++)i(n[s]); return i } }()({ 1: [function (e, t, r) { (function (r, n) { (function () { \"use strict\"; var i = e(\"events\").EventEmitter, o = e(\"./store\"), s = e(\"mqtt-packet\"), a = e(\"readable-stream\").Writable, u = e(\"inherits\"), c = e(\"reinterval\"), l = e(\"./validations\"), f = e(\"xtend\"), h = e(\"debug\")(\"mqttjs:client\"), p = r ? r.nextTick : function (e) { setTimeout(e, 0) }, d = n.setImmediate || function (e) { p(e) }, g = { keepalive: 60, reschedulePings: !0, protocolId: \"MQTT\", protocolVersion: 4, reconnectPeriod: 1e3, connectTimeout: 3e4, clean: !0, resubscribe: !0 }, b = [\"ECONNREFUSED\", \"EADDRINUSE\", \"ECONNRESET\", \"ENOTFOUND\"], m = { 0: \"\", 1: \"Unacceptable protocol version\", 2: \"Identifier rejected\", 3: \"Server unavailable\", 4: \"Bad username or password\", 5: \"Not authorized\", 16: \"No matching subscribers\", 17: \"No subscription existed\", 128: \"Unspecified error\", 129: \"Malformed Packet\", 130: \"Protocol Error\", 131: \"Implementation specific error\", 132: \"Unsupported Protocol Version\", 133: \"Client Identifier not valid\", 134: \"Bad User Name or Password\", 135: \"Not authorized\", 136: \"Server unavailable\", 137: \"Server busy\", 138: \"Banned\", 139: \"Server shutting down\", 140: \"Bad authentication method\", 141: \"Keep Alive timeout\", 142: \"Session taken over\", 143: \"Topic Filter invalid\", 144: \"Topic Name invalid\", 145: \"Packet identifier in use\", 146: \"Packet Identifier not found\", 147: \"Receive Maximum exceeded\", 148: \"Topic Alias invalid\", 149: \"Packet too large\", 150: \"Message rate too high\", 151: \"Quota exceeded\", 152: \"Administrative action\", 153: \"Payload format invalid\", 154: \"Retain not supported\", 155: \"QoS not supported\", 156: \"Use another server\", 157: \"Server moved\", 158: \"Shared Subscriptions not supported\", 159: \"Connection rate exceeded\", 160: \"Maximum connect time\", 161: \"Subscription Identifiers not supported\", 162: \"Wildcard Subscriptions not supported\" }; function y(e, t, r) { h(\"sendPacket :: packet: %O\", t), h(\"sendPacket :: emitting `packetsend`\"), e.emit(\"packetsend\", t), h(\"sendPacket :: writing to stream\"); var n = s.writeToStream(t, e.stream, e.options); h(\"sendPacket :: writeToStream result %s\", n), !n && r ? (h(\"sendPacket :: handle events on `drain` once through callback.\"), e.stream.once(\"drain\", r)) : r && (h(\"sendPacket :: invoking cb\"), r()) } function _(e, t, r, n) { h(\"storeAndSend :: store packet with cmd %s to outgoingStore\", t.cmd), e.outgoingStore.put(t, function (i) { if (i) return r && r(i); n(), y(e, t, r) }) } function w(e) { h(\"nop ::\", e) } function v(e, t) { var r, n = this; if (!(this instanceof v)) return new v(e, t); for (r in this.options = t || {}, g) void 0 === this.options[r] ? this.options[r] = g[r] : this.options[r] = t[r]; h(\"MqttClient :: options.protocol\", t.protocol), h(\"MqttClient :: options.protocolVersion\", t.protocolVersion), h(\"MqttClient :: options.username\", t.username), h(\"MqttClient :: options.keepalive\", t.keepalive), h(\"MqttClient :: options.reconnectPeriod\", t.reconnectPeriod), h(\"MqttClient :: options.rejectUnauthorized\", t.rejectUnauthorized), this.options.clientId = \"string\" == typeof t.clientId ? t.clientId : \"mqttjs_\" + Math.random().toString(16).substr(2, 8), h(\"MqttClient :: clientId\", this.options.clientId), this.options.customHandleAcks = 5 === t.protocolVersion && t.customHandleAcks ? t.customHandleAcks : function () { arguments[3](0) }, this.streamBuilder = e, this.outgoingStore = t.outgoingStore || new o, this.incomingStore = t.incomingStore || new o, this.queueQoSZero = void 0 === t.queueQoSZero || t.queueQoSZero, this._resubscribeTopics = {}, this.messageIdToTopic = {}, this.pingTimer = null, this.connected = !1, this.disconnecting = !1, this.queue = [], this.connackTimer = null, this.reconnectTimer = null, this._storeProcessing = !1, this._packetIdsDuringStoreProcessing = {}, this.nextId = Math.max(1, Math.floor(65535 * Math.random())), this.outgoing = {}, this._firstConnection = !0, this.on(\"connect\", function () { var e = this.queue; h(\"connect :: sending queued packets\"), function t() { var r = e.shift(); h(\"deliver :: entry %o\", r); var i; r && (i = r.packet, h(\"deliver :: call _sendPacket for %o\", i), n._sendPacket(i, function (e) { r.cb && r.cb(e), t() })) }() }), this.on(\"close\", function () { h(\"close :: connected set to `false`\"), this.connected = !1, h(\"close :: clearing connackTimer\"), clearTimeout(this.connackTimer), h(\"close :: clearing ping timer\"), null !== n.pingTimer && (n.pingTimer.clear(), n.pingTimer = null), h(\"close :: calling _setupReconnect\"), this._setupReconnect() }), i.call(this), h(\"MqttClient :: setting up stream\"), this._setupStream() } u(v, i), v.prototype._setupStream = function () { var e, t = this, r = new a, n = s.parser(this.options), i = null, o = []; function u() { if (o.length) p(c); else { var e = i; i = null, e() } } function c() { h(\"work :: getting next packet in queue\"); var e = o.shift(); if (e) h(\"work :: packet pulled from queue\"), t._handlePacket(e, u); else { h(\"work :: no packets in queue\"); var r = i; i = null, h(\"work :: done flag is %s\", !!r), r && r() } } if (h(\"_setupStream :: calling method to clear reconnect\"), this._clearReconnect(), h(\"_setupStream :: using streamBuilder provided to client to create stream\"), this.stream = this.streamBuilder(this), n.on(\"packet\", function (e) { h(\"parser :: on packet push to packets array.\"), o.push(e) }), r._write = function (e, t, r) { i = r, h(\"writable stream :: parsing buffer\"), n.parse(e), c() }, h(\"_setupStream :: pipe stream to writable stream\"), this.stream.pipe(r), this.stream.on(\"error\", function (e) { h(\"streamErrorHandler :: error\", e.message), b.includes(e.code) ? (h(\"streamErrorHandler :: emitting error\"), t.emit(\"error\", e)) : w(e) }), this.stream.on(\"close\", function () { var e; h(\"(%s)stream :: on close\", t.options.clientId), (e = t.outgoing) && (h(\"flushVolatile :: deleting volatile messages from the queue and setting their callbacks as error function\"), Object.keys(e).forEach(function (t) { e[t].volatile && \"function\" == typeof e[t].cb && (e[t].cb(new Error(\"Connection closed\")), delete e[t]) })), h(\"stream: emit close to MqttClient\"), t.emit(\"close\") }), h(\"_setupStream: sending packet `connect`\"), (e = Object.create(this.options)).cmd = \"connect\", y(this, e), n.on(\"error\", this.emit.bind(this, \"error\")), this.options.properties) { if (!this.options.properties.authenticationMethod && this.options.properties.authenticationData) return t.end(() => this.emit(\"error\", new Error(\"Packet has no Authentication Method\"))), this; if (this.options.properties.authenticationMethod && this.options.authPacket && \"object\" == typeof this.options.authPacket) y(this, f({ cmd: \"auth\", reasonCode: 0 }, this.options.authPacket)) } this.stream.setMaxListeners(1e3), clearTimeout(this.connackTimer), this.connackTimer = setTimeout(function () { h(\"!!connectTimeout hit!! Calling _cleanUp with force `true`\"), t._cleanUp(!0) }, this.options.connectTimeout) }, v.prototype._handlePacket = function (e, t) { var r = this.options; if (5 === r.protocolVersion && r.properties && r.properties.maximumPacketSize && r.properties.maximumPacketSize < e.length) return this.emit(\"error\", new Error(\"exceeding packets size \" + e.cmd)), this.end({ reasonCode: 149, properties: { reasonString: \"Maximum packet size was exceeded\" } }), this; switch (h(\"_handlePacket :: emitting packetreceive\"), this.emit(\"packetreceive\", e), e.cmd) { case \"publish\": this._handlePublish(e, t); break; case \"puback\": case \"pubrec\": case \"pubcomp\": case \"suback\": case \"unsuback\": this._handleAck(e), t(); break; case \"pubrel\": this._handlePubrel(e, t); break; case \"connack\": this._handleConnack(e), t(); break; case \"pingresp\": this._handlePingresp(e), t(); break; case \"disconnect\": this._handleDisconnect(e), t() } }, v.prototype._checkDisconnecting = function (e) { return this.disconnecting && (e ? e(new Error(\"client disconnecting\")) : this.emit(\"error\", new Error(\"client disconnecting\"))), this.disconnecting }, v.prototype.publish = function (e, t, r, n) { var i; h(\"publish :: message `%s` to topic `%s`\", t, e); var o = this.options; \"function\" == typeof r && (n = r, r = null); if (r = f({ qos: 0, retain: !1, dup: !1 }, r), this._checkDisconnecting(n)) return this; switch (i = { cmd: \"publish\", topic: e, payload: t, qos: r.qos, retain: r.retain, messageId: this._nextId(), dup: r.dup }, 5 === o.protocolVersion && (i.properties = r.properties, (!o.properties && i.properties && i.properties.topicAlias || r.properties && o.properties && (r.properties.topicAlias && o.properties.topicAliasMaximum && r.properties.topicAlias > o.properties.topicAliasMaximum || !o.properties.topicAliasMaximum && r.properties.topicAlias)) && delete i.properties.topicAlias), h(\"publish :: qos\", r.qos), r.qos) { case 1: case 2: this.outgoing[i.messageId] = { volatile: !1, cb: n || w }, this._storeProcessing ? (h(\"_storeProcessing enabled\"), this._packetIdsDuringStoreProcessing[i.messageId] = !1, this._storePacket(i, void 0, r.cbStorePut)) : (h(\"MqttClient:publish: packet cmd: %s\", i.cmd), this._sendPacket(i, void 0, r.cbStorePut)); break; default: this._storeProcessing ? (h(\"_storeProcessing enabled\"), this._storePacket(i, n, r.cbStorePut)) : (h(\"MqttClient:publish: packet cmd: %s\", i.cmd), this._sendPacket(i, n, r.cbStorePut)) }return this }, v.prototype.subscribe = function () { for (var e, t = new Array(arguments.length), r = 0; r < arguments.length; r++)t[r] = arguments[r]; var n, i = [], o = t.shift(), s = o.resubscribe, a = t.pop() || w, u = t.pop(), c = this, p = this.options.protocolVersion; if (delete o.resubscribe, \"string\" == typeof o && (o = [o]), \"function\" != typeof a && (u = a, a = w), null !== (n = l.validateTopics(o))) return d(a, new Error(\"Invalid topic \" + n)), this; if (this._checkDisconnecting(a)) return h(\"subscribe: discconecting true\"), this; var g = { qos: 0 }; if (5 === p && (g.nl = !1, g.rap = !1, g.rh = 0), u = f(g, u), Array.isArray(o) ? o.forEach(function (e) { if (h(\"subscribe: array topic %s\", e), !c._resubscribeTopics.hasOwnProperty(e) || c._resubscribeTopics[e].qos < u.qos || s) { var t = { topic: e, qos: u.qos }; 5 === p && (t.nl = u.nl, t.rap = u.rap, t.rh = u.rh, t.properties = u.properties), h(\"subscribe: pushing topic `%s` and qos `%s` to subs list\", t.topic, t.qos), i.push(t) } }) : Object.keys(o).forEach(function (e) { if (h(\"subscribe: object topic %s\", e), !c._resubscribeTopics.hasOwnProperty(e) || c._resubscribeTopics[e].qos < o[e].qos || s) { var t = { topic: e, qos: o[e].qos }; 5 === p && (t.nl = o[e].nl, t.rap = o[e].rap, t.rh = o[e].rh, t.properties = u.properties), h(\"subscribe: pushing `%s` to subs list\", t), i.push(t) } }), e = { cmd: \"subscribe\", subscriptions: i, qos: 1, retain: !1, dup: !1, messageId: this._nextId() }, u.properties && (e.properties = u.properties), i.length) { if (this.options.resubscribe) { h(\"subscribe :: resubscribe true\"); var b = []; i.forEach(function (e) { if (c.options.reconnectPeriod > 0) { var t = { qos: e.qos }; 5 === p && (t.nl = e.nl || !1, t.rap = e.rap || !1, t.rh = e.rh || 0, t.properties = e.properties), c._resubscribeTopics[e.topic] = t, b.push(e.topic) } }), c.messageIdToTopic[e.messageId] = b } return this.outgoing[e.messageId] = { volatile: !0, cb: function (e, t) { if (!e) for (var r = t.granted, n = 0; n < r.length; n += 1)i[n].qos = r[n]; a(e, i) } }, h(\"subscribe :: call _sendPacket\"), this._sendPacket(e), this } a(null, []) }, v.prototype.unsubscribe = function () { for (var e = { cmd: \"unsubscribe\", qos: 1, messageId: this._nextId() }, t = this, r = new Array(arguments.length), n = 0; n < arguments.length; n++)r[n] = arguments[n]; var i = r.shift(), o = r.pop() || w, s = r.pop(); return \"string\" == typeof i && (i = [i]), \"function\" != typeof o && (s = o, o = w), this._checkDisconnecting(o) ? this : (\"string\" == typeof i ? e.unsubscriptions = [i] : Array.isArray(i) && (e.unsubscriptions = i), this.options.resubscribe && e.unsubscriptions.forEach(function (e) { delete t._resubscribeTopics[e] }), \"object\" == typeof s && s.properties && (e.properties = s.properties), this.outgoing[e.messageId] = { volatile: !0, cb: o }, h(\"unsubscribe: call _sendPacket\"), this._sendPacket(e), this) }, v.prototype.end = function (e, t, r) { var n = this; function i() { h(\"end :: (%s) :: finish :: calling _cleanUp with force %s\", n.options.clientId, e), n._cleanUp(e, () => { h(\"end :: finish :: calling process.nextTick on closeStores\"), p(function () { h(\"end :: closeStores: closing incoming and outgoing stores\"), n.disconnected = !0, n.incomingStore.close(function (e) { n.outgoingStore.close(function (t) { if (h(\"end :: closeStores: emitting end\"), n.emit(\"end\"), r) { let n = e || t; h(\"end :: closeStores: invoking callback with args\"), r(n) } }) }), n._deferredReconnect && n._deferredReconnect() }.bind(n)) }, t) } return h(\"end :: (%s)\", this.options.clientId), null != e && \"boolean\" == typeof e || (r = t || w, t = e, e = !1, \"object\" != typeof t && (r = t, t = null, \"function\" != typeof r && (r = w))), \"object\" != typeof t && (r = t, t = null), h(\"end :: cb? %s\", !!r), r = r || w, this.disconnecting ? (r(), this) : (this._clearReconnect(), this.disconnecting = !0, !e && Object.keys(this.outgoing).length > 0 ? (h(\"end :: (%s) :: calling finish in 10ms once outgoing is empty\", n.options.clientId), this.once(\"outgoingEmpty\", setTimeout.bind(null, i, 10))) : (h(\"end :: (%s) :: immediately calling finish\", n.options.clientId), i()), this) }, v.prototype.removeOutgoingMessage = function (e) { var t = this.outgoing[e] ? this.outgoing[e].cb : null; return delete this.outgoing[e], this.outgoingStore.del({ messageId: e }, function () { t(new Error(\"Message removed\")) }), this }, v.prototype.reconnect = function (e) { h(\"client reconnect\"); var t = this, r = function () { e ? (t.options.incomingStore = e.incomingStore, t.options.outgoingStore = e.outgoingStore) : (t.options.incomingStore = null, t.options.outgoingStore = null), t.incomingStore = t.options.incomingStore || new o, t.outgoingStore = t.options.outgoingStore || new o, t.disconnecting = !1, t.disconnected = !1, t._deferredReconnect = null, t._reconnect() }; return this.disconnecting && !this.disconnected ? this._deferredReconnect = r : r(), this }, v.prototype._reconnect = function () { h(\"_reconnect: emitting reconnect to client\"), this.emit(\"reconnect\"), this.connected ? (this.end(() => { this._setupStream() }), h(\"client already connected. disconnecting first.\")) : (h(\"_reconnect: calling _setupStream\"), this._setupStream()) }, v.prototype._setupReconnect = function () { var e = this; !e.disconnecting && !e.reconnectTimer && e.options.reconnectPeriod > 0 ? (this.reconnecting || (h(\"_setupReconnect :: emit `offline` state\"), this.emit(\"offline\"), h(\"_setupReconnect :: set `reconnecting` to `true`\"), this.reconnecting = !0), h(\"_setupReconnect :: setting reconnectTimer for %d ms\", e.options.reconnectPeriod), e.reconnectTimer = setInterval(function () { h(\"reconnectTimer :: reconnect triggered!\"), e._reconnect() }, e.options.reconnectPeriod)) : h(\"_setupReconnect :: doing nothing...\") }, v.prototype._clearReconnect = function () { h(\"_clearReconnect : clearing reconnect timer\"), this.reconnectTimer && (clearInterval(this.reconnectTimer), this.reconnectTimer = null) }, v.prototype._cleanUp = function (e, t) { var r, n = arguments[2]; if (t && (h(\"_cleanUp :: done callback provided for on stream close\"), this.stream.on(\"close\", t)), h(\"_cleanUp :: forced? %s\", e), e) 0 === this.options.reconnectPeriod && this.options.clean && (r = this.outgoing) && (h(\"flush: queue exists? %b\", !!r), Object.keys(r).forEach(function (e) { \"function\" == typeof r[e].cb && (r[e].cb(new Error(\"Connection closed\")), delete r[e]) })), h(\"_cleanUp :: (%s) :: destroying stream\", this.options.clientId), this.stream.destroy(); else { var i = f({ cmd: \"disconnect\" }, n); h(\"_cleanUp :: (%s) :: call _sendPacket with disconnect packet\", this.options.clientId), this._sendPacket(i, d.bind(null, this.stream.end.bind(this.stream))) } this.disconnecting || (h(\"_cleanUp :: client not disconnecting. Clearing and resetting reconnect.\"), this._clearReconnect(), this._setupReconnect()), null !== this.pingTimer && (h(\"_cleanUp :: clearing pingTimer\"), this.pingTimer.clear(), this.pingTimer = null), t && !this.connected && (h(\"_cleanUp :: (%s) :: removing stream `done` callback `close` listener\", this.options.clientId), this.stream.removeListener(\"close\", t), t()) }, v.prototype._sendPacket = function (e, t, r) { if (h(\"_sendPacket :: (%s) ::  start\", this.options.clientId), r = r || w, !this.connected) return h(\"_sendPacket :: client not connected. Storing packet offline.\"), void this._storePacket(e, t, r); switch (this._shiftPingInterval(), e.cmd) { case \"publish\": break; case \"pubrel\": return void _(this, e, t, r); default: return void y(this, e, t) }switch (e.qos) { case 2: case 1: _(this, e, t, r); break; case 0: default: y(this, e, t) }h(\"_sendPacket :: (%s) ::  end\", this.options.clientId) }, v.prototype._storePacket = function (e, t, r) { h(\"_storePacket :: packet: %o\", e), h(\"_storePacket :: cb? %s\", !!t), r = r || w, 0 === (e.qos || 0) && this.queueQoSZero || \"publish\" !== e.cmd ? this.queue.push({ packet: e, cb: t }) : e.qos > 0 ? (t = this.outgoing[e.messageId] ? this.outgoing[e.messageId].cb : null, this.outgoingStore.put(e, function (e) { if (e) return t && t(e); r() })) : t && t(new Error(\"No connection to broker\")) }, v.prototype._setupPingTimer = function () { h(\"_setupPingTimer :: keepalive %d (seconds)\", this.options.keepalive); var e = this; !this.pingTimer && this.options.keepalive && (this.pingResp = !0, this.pingTimer = c(function () { e._checkPing() }, 1e3 * this.options.keepalive)) }, v.prototype._shiftPingInterval = function () { this.pingTimer && this.options.keepalive && this.options.reschedulePings && this.pingTimer.reschedule(1e3 * this.options.keepalive) }, v.prototype._checkPing = function () { h(\"_checkPing :: checking ping...\"), this.pingResp ? (h(\"_checkPing :: ping response received. Clearing flag and sending `pingreq`\"), this.pingResp = !1, this._sendPacket({ cmd: \"pingreq\" })) : (h(\"_checkPing :: calling _cleanUp with force true\"), this._cleanUp(!0)) }, v.prototype._handlePingresp = function () { this.pingResp = !0 }, v.prototype._handleConnack = function (e) { h(\"_handleConnack\"); var t = this.options, r = 5 === t.protocolVersion ? e.reasonCode : e.returnCode; if (clearTimeout(this.connackTimer), e.properties && (e.properties.topicAliasMaximum && (t.properties || (t.properties = {}), t.properties.topicAliasMaximum = e.properties.topicAliasMaximum), e.properties.serverKeepAlive && t.keepalive && (t.keepalive = e.properties.serverKeepAlive, this._shiftPingInterval()), e.properties.maximumPacketSize && (t.properties || (t.properties = {}), t.properties.maximumPacketSize = e.properties.maximumPacketSize)), 0 === r) this.reconnecting = !1, this._onConnect(e); else if (r > 0) { var n = new Error(\"Connection refused: \" + m[r]); n.code = r, this.emit(\"error\", n) } }, v.prototype._handlePublish = function (e, t) { h(\"_handlePublish: packet %o\", e), t = void 0 !== t ? t : w; var r = e.topic.toString(), n = e.payload, i = e.qos, o = e.messageId, s = this, a = this.options, u = [0, 16, 128, 131, 135, 144, 145, 151, 153]; switch (h(\"_handlePublish: qos %d\", i), i) { case 2: a.customHandleAcks(r, n, e, function (r, n) { return r instanceof Error || (n = r, r = null), r ? s.emit(\"error\", r) : -1 === u.indexOf(n) ? s.emit(\"error\", new Error(\"Wrong reason code for pubrec\")) : void (n ? s._sendPacket({ cmd: \"pubrec\", messageId: o, reasonCode: n }, t) : s.incomingStore.put(e, function () { s._sendPacket({ cmd: \"pubrec\", messageId: o }, t) })) }); break; case 1: a.customHandleAcks(r, n, e, function (i, a) { return i instanceof Error || (a = i, i = null), i ? s.emit(\"error\", i) : -1 === u.indexOf(a) ? s.emit(\"error\", new Error(\"Wrong reason code for puback\")) : (a || s.emit(\"message\", r, n, e), void s.handleMessage(e, function (e) { if (e) return t && t(e); s._sendPacket({ cmd: \"puback\", messageId: o, reasonCode: a }, t) })) }); break; case 0: this.emit(\"message\", r, n, e), this.handleMessage(e, t); break; default: h(\"_handlePublish: unknown QoS. Doing nothing.\") } }, v.prototype.handleMessage = function (e, t) { t() }, v.prototype._handleAck = function (e) { var t, r = e.messageId, n = e.cmd, i = null, o = this.outgoing[r] ? this.outgoing[r].cb : null, s = this; if (o) { switch (h(\"_handleAck :: packet type\", n), n) { case \"pubcomp\": case \"puback\": var a = e.reasonCode; a && a > 0 && 16 !== a && ((t = new Error(\"Publish error: \" + m[a])).code = a, o(t, e)), delete this.outgoing[r], this.outgoingStore.del(e, o); break; case \"pubrec\": i = { cmd: \"pubrel\", qos: 2, messageId: r }; var u = e.reasonCode; u && u > 0 && 16 !== u ? ((t = new Error(\"Publish error: \" + m[u])).code = u, o(t, e)) : this._sendPacket(i); break; case \"suback\": delete this.outgoing[r]; for (var c = 0; c < e.granted.length; c++)if (0 != (128 & e.granted[c])) { var l = this.messageIdToTopic[r]; l && l.forEach(function (e) { delete s._resubscribeTopics[e] }) } o(null, e); break; case \"unsuback\": delete this.outgoing[r], o(null); break; default: s.emit(\"error\", new Error(\"unrecognized packet type\")) }this.disconnecting && 0 === Object.keys(this.outgoing).length && this.emit(\"outgoingEmpty\") } else h(\"_handleAck :: Server sent an ack in error. Ignoring.\") }, v.prototype._handlePubrel = function (e, t) { h(\"handling pubrel packet\"), t = void 0 !== t ? t : w; var r = this, n = { cmd: \"pubcomp\", messageId: e.messageId }; r.incomingStore.get(e, function (e, i) { e ? r._sendPacket(n, t) : (r.emit(\"message\", i.topic, i.payload, i), r.handleMessage(i, function (e) { if (e) return t(e); r.incomingStore.del(i, w), r._sendPacket(n, t) })) }) }, v.prototype._handleDisconnect = function (e) { this.emit(\"disconnect\", e) }, v.prototype._nextId = function () { var e = this.nextId++; return 65536 === this.nextId && (this.nextId = 1), e }, v.prototype.getLastMessageId = function () { return 1 === this.nextId ? 65535 : this.nextId - 1 }, v.prototype._resubscribe = function (e) { h(\"_resubscribe\"); var t = Object.keys(this._resubscribeTopics); if (!this._firstConnection && (this.options.clean || 5 === this.options.protocolVersion && !e.sessionPresent) && t.length > 0) if (this.options.resubscribe) if (5 === this.options.protocolVersion) { h(\"_resubscribe: protocolVersion 5\"); for (var r = 0; r < t.length; r++) { var n = {}; n[t[r]] = this._resubscribeTopics[t[r]], n.resubscribe = !0, this.subscribe(n, { properties: n[t[r]].properties }) } } else this._resubscribeTopics.resubscribe = !0, this.subscribe(this._resubscribeTopics); else this._resubscribeTopics = {}; this._firstConnection = !1 }, v.prototype._onConnect = function (e) { if (this.disconnected) this.emit(\"connect\", e); else { var t = this; this._setupPingTimer(), this._resubscribe(e), this.connected = !0, function r() { var n = t.outgoingStore.createStream(); function i() { t._storeProcessing = !1, t._packetIdsDuringStoreProcessing = {} } function o() { n.destroy(), n = null, i() } t.once(\"close\", o), n.on(\"error\", function (e) { i(), t.removeListener(\"close\", o), t.emit(\"error\", e) }), n.on(\"end\", function () { var n = !0; for (var s in t._packetIdsDuringStoreProcessing) if (!t._packetIdsDuringStoreProcessing[s]) { n = !1; break } n ? (i(), t.removeListener(\"close\", o), t.emit(\"connect\", e)) : r() }), function e() { if (n) { t._storeProcessing = !0; var r, i = n.read(1); i ? t._packetIdsDuringStoreProcessing[i.messageId] ? e() : t.disconnecting || t.reconnectTimer ? n.destroy && n.destroy() : (r = t.outgoing[i.messageId] ? t.outgoing[i.messageId].cb : null, t.outgoing[i.messageId] = { volatile: !1, cb: function (t, n) { r && r(t, n), e() } }, t._packetIdsDuringStoreProcessing[i.messageId] = !0, t._sendPacket(i)) : n.once(\"readable\", e) } }() }() } }, t.exports = v }).call(this) }).call(this, e(\"_process\"), \"undefined\" != typeof global ? global : \"undefined\" != typeof self ? self : \"undefined\" != typeof window ? window : {}) }, { \"./store\": 7, \"./validations\": 8, _process: 46, debug: 16, events: 31, inherits: 33, \"mqtt-packet\": 38, \"readable-stream\": 65, reinterval: 66, xtend: 76 }], 2: [function (e, t, r) { (function (r) { (function () { \"use strict\"; var n, i, o, s = e(\"readable-stream\").Transform, a = e(\"duplexify\"), u = !1; t.exports = function (e, t) { if (t.hostname = t.hostname || t.host, !t.hostname) throw new Error(\"Could not determine host. Specify host manually.\"); var c = \"MQIsdp\" === t.protocolId && 3 === t.protocolVersion ? \"mqttv3.1\" : \"mqtt\"; !function (e) { e.hostname || (e.hostname = \"localhost\"), e.path || (e.path = \"/\"), e.wsOptions || (e.wsOptions = {}) }(t); var l = function (e, t) { var r = \"alis\" === e.protocol ? \"wss\" : \"ws\", n = r + \"://\" + e.hostname + e.path; return e.port && 80 !== e.port && 443 !== e.port && (n = r + \"://\" + e.hostname + \":\" + e.port + e.path), \"function\" == typeof e.transformWsUrl && (n = e.transformWsUrl(n, e, t)), n }(t, e); return (n = t.my).connectSocket({ url: l, protocols: c }), i = function () { var e = new s; return e._write = function (e, t, r) { n.sendSocketMessage({ data: e.buffer, success: function () { r() }, fail: function () { r(new Error) } }) }, e._flush = function (e) { n.closeSocket({ success: function () { e() } }) }, e }(), o = a.obj(), u || (u = !0, n.onSocketOpen(function () { o.setReadable(i), o.setWritable(i), o.emit(\"connect\") }), n.onSocketMessage(function (e) { if (\"string\" == typeof e.data) { var t = r.from(e.data, \"base64\"); i.push(t) } else { var n = new FileReader; n.addEventListener(\"load\", function () { var e = n.result; e = e instanceof ArrayBuffer ? r.from(e) : r.from(e, \"utf8\"), i.push(e) }), n.readAsArrayBuffer(e.data) } }), n.onSocketClose(function () { o.end(), o.destroy() }), n.onSocketError(function (e) { o.destroy(e) })), o } }).call(this) }).call(this, e(\"buffer\").Buffer) }, { buffer: 14, duplexify: 18, \"readable-stream\": 65 }], 3: [function (e, t, r) { \"use strict\"; var n = e(\"net\"), i = e(\"debug\")(\"mqttjs:tcp\"); t.exports = function (e, t) { var r, o; return t.port = t.port || 1883, t.hostname = t.hostname || t.host || \"localhost\", r = t.port, o = t.hostname, i(\"port %d and host %s\", r, o), n.createConnection(r, o) } }, { debug: 16, net: 13 }], 4: [function (e, t, r) { \"use strict\"; var n = e(\"tls\"), i = e(\"debug\")(\"mqttjs:tls\"); t.exports = function (e, t) { var r; function o(n) { t.rejectUnauthorized && e.emit(\"error\", n), r.end() } return t.port = t.port || 8883, t.host = t.hostname || t.host || \"localhost\", t.servername = t.host, t.rejectUnauthorized = !1 !== t.rejectUnauthorized, delete t.path, i(\"port %d host %s rejectUnauthorized %b\", t.port, t.host, t.rejectUnauthorized), (r = n.connect(t)).on(\"secureConnect\", function () { t.rejectUnauthorized && !r.authorized ? r.emit(\"error\", new Error(\"TLS not authorized\")) : r.removeListener(\"error\", o) }), r.on(\"error\", o), r } }, { debug: 16, tls: 13 }], 5: [function (e, t, r) { (function (r, n) { (function () { \"use strict\"; const i = e(\"ws\"), o = e(\"debug\")(\"mqttjs:ws\"), s = e(\"duplexify\"), a = e(\"readable-stream\").Transform; let u = [\"rejectUnauthorized\", \"ca\", \"cert\", \"key\", \"pfx\", \"passphrase\"]; const c = void 0 !== r && \"browser\" === r.title || \"function\" == typeof __webpack_require__; function l(e, t) { let r = e.protocol + \"://\" + e.hostname + \":\" + e.port + e.path; return \"function\" == typeof e.transformWsUrl && (r = e.transformWsUrl(r, e, t)), r } function f(e) { let t = e; return e.hostname || (t.hostname = \"localhost\"), e.port || (\"wss\" === e.protocol ? t.port = 443 : t.port = 80), e.path || (t.path = \"/\"), e.wsOptions || (t.wsOptions = {}), c || \"wss\" !== e.protocol || u.forEach(function (r) { e.hasOwnProperty(r) && !e.wsOptions.hasOwnProperty(r) && (t.wsOptions[r] = e[r]) }), t } t.exports = c ? function (e, t) { let r; o(\"browserStreamBuilder\"); const i = function (e) { let t = f(e); if (t.hostname || (t.hostname = t.host), !t.hostname) { if (\"undefined\" == typeof document) throw new Error(\"Could not determine host. Specify host manually.\"); const e = new URL(document.URL); t.hostname = e.hostname, t.port || (t.port = e.port) } return void 0 === t.objectMode && (t.objectMode = !(!0 === t.binary || void 0 === t.binary)), t }(t).browserBufferSize || 524288, u = t.browserBufferTimeout || 1e3, c = !t.objectMode; let h = function (e, t) { const r = \"MQIsdp\" === t.protocolId && 3 === t.protocolVersion ? \"mqttv3.1\" : \"mqtt\"; let n = l(t, e), i = new WebSocket(n, [r]); return i.binaryType = \"arraybuffer\", i }(e, t), p = function (e, t, r) { let n = new a({ objectModeMode: e.objectMode }); return n._write = t, n._flush = r, n }(t, function e(t, r, o) { h.bufferedAmount > i && setTimeout(e, u, t, r, o), c && \"string\" == typeof t && (t = n.from(t, \"utf8\")); try { h.send(t) } catch (e) { return o(e) } o() }, function (e) { h.close(), e() }); t.objectMode || (p._writev = _), p.on(\"close\", () => { h.close() }); const d = void 0 === h.addEventListener; function g() { r.setReadable(p), r.setWritable(p), r.emit(\"connect\") } function b() { r.end(), r.destroy() } function m(e) { r.destroy(e) } function y(e) { let t = e.data; t = t instanceof ArrayBuffer ? n.from(t) : n.from(t, \"utf8\"), p.push(t) } function _(e, t) { const r = new Array(e.length); for (let t = 0; t < e.length; t++)\"string\" == typeof e[t].chunk ? r[t] = n.from(e[t], \"utf8\") : r[t] = e[t].chunk; this._write(n.concat(r), \"binary\", t) } return h.readyState === h.OPEN ? r = p : (r = r = s(void 0, void 0, t), t.objectMode || (r._writev = _), d ? h.addEventListener(\"open\", g) : h.onopen = g), r.socket = h, d ? (h.addEventListener(\"close\", b), h.addEventListener(\"error\", m), h.addEventListener(\"message\", y)) : (h.onclose = b, h.onerror = m, h.onmessage = y), r } : function (e, t) { o(\"streamBuilder\"); let r = f(t); const n = l(r, e); let s = function (e, t, r) { o(\"createWebSocket\"), o(\"protocol: \" + r.protocolId + \" \" + r.protocolVersion); const n = \"MQIsdp\" === r.protocolId && 3 === r.protocolVersion ? \"mqttv3.1\" : \"mqtt\"; return o(\"creating new Websocket for url: \" + t + \" and protocol: \" + n), new i(t, [n], r.wsOptions) }(0, n, r), a = i.createWebSocketStream(s, r.wsOptions); return a.url = n, a } }).call(this) }).call(this, e(\"_process\"), e(\"buffer\").Buffer) }, { _process: 46, buffer: 14, debug: 16, duplexify: 18, \"readable-stream\": 65, ws: 75 }], 6: [function (e, t, r) { (function (r) { (function () { \"use strict\"; var n, i, o, s = e(\"readable-stream\").Transform, a = e(\"duplexify\"); t.exports = function (e, t) { if (t.hostname = t.hostname || t.host, !t.hostname) throw new Error(\"Could not determine host. Specify host manually.\"); var u = \"MQIsdp\" === t.protocolId && 3 === t.protocolVersion ? \"mqttv3.1\" : \"mqtt\"; !function (e) { e.hostname || (e.hostname = \"localhost\"), e.path || (e.path = \"/\"), e.wsOptions || (e.wsOptions = {}) }(t); var c = function (e, t) { var r = \"wxs\" === e.protocol ? \"wss\" : \"ws\", n = r + \"://\" + e.hostname + e.path; return e.port && 80 !== e.port && 443 !== e.port && (n = r + \"://\" + e.hostname + \":\" + e.port + e.path), \"function\" == typeof e.transformWsUrl && (n = e.transformWsUrl(n, e, t)), n }(t, e); n = wx.connectSocket({ url: c, protocols: [u] }), i = function () { var e = new s; return e._write = function (e, t, r) { n.send({ data: e.buffer, success: function () { r() }, fail: function (e) { r(new Error(e)) } }) }, e._flush = function (e) { n.close({ success: function () { e() } }) }, e }(), (o = a.obj())._destroy = function (e, t) { n.close({ success: function () { t && t(e) } }) }; var l = o.destroy; return o.destroy = function () { o.destroy = l; var e = this; setTimeout(function () { n.close({ fail: function () { e._destroy(new Error) } }) }, 0) }.bind(o), n.onOpen(function () { o.setReadable(i), o.setWritable(i), o.emit(\"connect\") }), n.onMessage(function (e) { var t = e.data; t = t instanceof ArrayBuffer ? r.from(t) : r.from(t, \"utf8\"), i.push(t) }), n.onClose(function () { o.end(), o.destroy() }), n.onError(function (e) { o.destroy(new Error(e.errMsg)) }), o } }).call(this) }).call(this, e(\"buffer\").Buffer) }, { buffer: 14, duplexify: 18, \"readable-stream\": 65 }], 7: [function (e, t, r) { \"use strict\"; var n = e(\"xtend\"), i = e(\"readable-stream\").Readable, o = { objectMode: !0 }, s = { clean: !0 }; function a(e) { if (!(this instanceof a)) return new a(e); this.options = e || {}, this.options = n(s, e), this._inflights = new Map } a.prototype.put = function (e, t) { return this._inflights.set(e.messageId, e), t && t(), this }, a.prototype.createStream = function () { var e = new i(o), t = !1, r = [], n = 0; return this._inflights.forEach(function (e, t) { r.push(e) }), e._read = function () { !t && n < r.length ? this.push(r[n++]) : this.push(null) }, e.destroy = function () { if (!t) { var e = this; t = !0, setTimeout(function () { e.emit(\"close\") }, 0) } }, e }, a.prototype.del = function (e, t) { return (e = this._inflights.get(e.messageId)) ? (this._inflights.delete(e.messageId), t(null, e)) : t && t(new Error(\"missing packet\")), this }, a.prototype.get = function (e, t) { return (e = this._inflights.get(e.messageId)) ? t(null, e) : t && t(new Error(\"missing packet\")), this }, a.prototype.close = function (e) { this.options.clean && (this._inflights = null), e && e() }, t.exports = a }, { \"readable-stream\": 65, xtend: 76 }], 8: [function (e, t, r) { \"use strict\"; function n(e) { for (var t = e.split(\"/\"), r = 0; r < t.length; r++)if (\"+\" !== t[r]) { if (\"#\" === t[r]) return r === t.length - 1; if (-1 !== t[r].indexOf(\"+\") || -1 !== t[r].indexOf(\"#\")) return !1 } return !0 } t.exports = { validateTopics: function (e) { if (0 === e.length) return \"empty_topic_list\"; for (var t = 0; t < e.length; t++)if (!n(e[t])) return e[t]; return null } } }, {}], 9: [function (e, t, r) { (function (r) { (function () { \"use strict\"; var n = e(\"../client\"), i = e(\"../store\"), o = e(\"url\"), s = e(\"xtend\"), a = e(\"debug\")(\"mqttjs\"), u = {}; function c(e, t) { if (a(\"connecting to an MQTT broker...\"), \"object\" != typeof e || t || (t = e, e = null), t = t || {}, e) { var r = o.parse(e, !0); if (null != r.port && (r.port = Number(r.port)), null === (t = s(r, t)).protocol) throw new Error(\"Missing protocol\"); t.protocol = t.protocol.replace(/:$/, \"\") } if (function (e) { var t; e.auth && ((t = e.auth.match(/^(.+):(.+)$/)) ? (e.username = t[1], e.password = t[2]) : e.username = e.auth) }(t), t.query && \"string\" == typeof t.query.clientId && (t.clientId = t.query.clientId), t.cert && t.key) { if (!t.protocol) throw new Error(\"Missing secure protocol key\"); if (-1 === [\"mqtts\", \"wss\", \"wxs\", \"alis\"].indexOf(t.protocol)) switch (t.protocol) { case \"mqtt\": t.protocol = \"mqtts\"; break; case \"ws\": t.protocol = \"wss\"; break; case \"wx\": t.protocol = \"wxs\"; break; case \"ali\": t.protocol = \"alis\"; break; default: throw new Error('Unknown protocol for secure connection: \"' + t.protocol + '\"!') } } if (!u[t.protocol]) { var i = -1 !== [\"mqtts\", \"wss\"].indexOf(t.protocol); t.protocol = [\"mqtt\", \"mqtts\", \"ws\", \"wss\", \"wx\", \"wxs\", \"ali\", \"alis\"].filter(function (e, t) { return (!i || t % 2 != 0) && \"function\" == typeof u[e] })[0] } if (!1 === t.clean && !t.clientId) throw new Error(\"Missing clientId for unclean clients\"); t.protocol && (t.defaultProtocol = t.protocol); var c = new n(function (e) { return t.servers && (e._reconnectCount && e._reconnectCount !== t.servers.length || (e._reconnectCount = 0), t.host = t.servers[e._reconnectCount].host, t.port = t.servers[e._reconnectCount].port, t.protocol = t.servers[e._reconnectCount].protocol ? t.servers[e._reconnectCount].protocol : t.defaultProtocol, t.hostname = t.host, e._reconnectCount++), a(\"calling streambuilder for\", t.protocol), u[t.protocol](e, t) }, t); return c.on(\"error\", function () { }), c } void 0 !== r && \"browser\" !== r.title || \"function\" != typeof __webpack_require__ ? (u.mqtt = e(\"./tcp\"), u.tcp = e(\"./tcp\"), u.ssl = e(\"./tls\"), u.tls = e(\"./tls\"), u.mqtts = e(\"./tls\")) : (u.wx = e(\"./wx\"), u.wxs = e(\"./wx\"), u.ali = e(\"./ali\"), u.alis = e(\"./ali\")), u.ws = e(\"./ws\"), u.wss = e(\"./ws\"), t.exports = c, t.exports.connect = c, t.exports.MqttClient = n, t.exports.Store = i }).call(this) }).call(this, e(\"_process\")) }, { \"../client\": 1, \"../store\": 7, \"./ali\": 2, \"./tcp\": 3, \"./tls\": 4, \"./ws\": 5, \"./wx\": 6, _process: 46, debug: 16, url: 71, xtend: 76 }], 10: [function (e, t, r) { \"use strict\"; r.byteLength = function (e) { var t = c(e), r = t[0], n = t[1]; return 3 * (r + n) / 4 - n }, r.toByteArray = function (e) { var t, r, n = c(e), s = n[0], a = n[1], u = new o(function (e, t, r) { return 3 * (t + r) / 4 - r }(0, s, a)), l = 0, f = a > 0 ? s - 4 : s; for (r = 0; r < f; r += 4)t = i[e.charCodeAt(r)] << 18 | i[e.charCodeAt(r + 1)] << 12 | i[e.charCodeAt(r + 2)] << 6 | i[e.charCodeAt(r + 3)], u[l++] = t >> 16 & 255, u[l++] = t >> 8 & 255, u[l++] = 255 & t; 2 === a && (t = i[e.charCodeAt(r)] << 2 | i[e.charCodeAt(r + 1)] >> 4, u[l++] = 255 & t); 1 === a && (t = i[e.charCodeAt(r)] << 10 | i[e.charCodeAt(r + 1)] << 4 | i[e.charCodeAt(r + 2)] >> 2, u[l++] = t >> 8 & 255, u[l++] = 255 & t); return u }, r.fromByteArray = function (e) { for (var t, r = e.length, i = r % 3, o = [], s = 0, a = r - i; s < a; s += 16383)o.push(l(e, s, s + 16383 > a ? a : s + 16383)); 1 === i ? (t = e[r - 1], o.push(n[t >> 2] + n[t << 4 & 63] + \"==\")) : 2 === i && (t = (e[r - 2] << 8) + e[r - 1], o.push(n[t >> 10] + n[t >> 4 & 63] + n[t << 2 & 63] + \"=\")); return o.join(\"\") }; for (var n = [], i = [], o = \"undefined\" != typeof Uint8Array ? Uint8Array : Array, s = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\", a = 0, u = s.length; a < u; ++a)n[a] = s[a], i[s.charCodeAt(a)] = a; function c(e) { var t = e.length; if (t % 4 > 0) throw new Error(\"Invalid string. Length must be a multiple of 4\"); var r = e.indexOf(\"=\"); return -1 === r && (r = t), [r, r === t ? 0 : 4 - r % 4] } function l(e, t, r) { for (var i, o, s = [], a = t; a < r; a += 3)i = (e[a] << 16 & 16711680) + (e[a + 1] << 8 & 65280) + (255 & e[a + 2]), s.push(n[(o = i) >> 18 & 63] + n[o >> 12 & 63] + n[o >> 6 & 63] + n[63 & o]); return s.join(\"\") } i[\"-\".charCodeAt(0)] = 62, i[\"_\".charCodeAt(0)] = 63 }, {}], 11: [function (e, t, r) { \"use strict\"; const { Buffer: n } = e(\"buffer\"), i = Symbol.for(\"BufferList\"); function o(e) { if (!(this instanceof o)) return new o(e); o._init.call(this, e) } o._init = function (e) { Object.defineProperty(this, i, { value: !0 }), this._bufs = [], this.length = 0, e && this.append(e) }, o.prototype._new = function (e) { return new o(e) }, o.prototype._offset = function (e) { if (0 === e) return [0, 0]; let t = 0; for (let r = 0; r < this._bufs.length; r++) { const n = t + this._bufs[r].length; if (e < n || r === this._bufs.length - 1) return [r, e - t]; t = n } }, o.prototype._reverseOffset = function (e) { const t = e[0]; let r = e[1]; for (let e = 0; e < t; e++)r += this._bufs[e].length; return r }, o.prototype.get = function (e) { if (e > this.length || e < 0) return; const t = this._offset(e); return this._bufs[t[0]][t[1]] }, o.prototype.slice = function (e, t) { return \"number\" == typeof e && e < 0 && (e += this.length), \"number\" == typeof t && t < 0 && (t += this.length), this.copy(null, 0, e, t) }, o.prototype.copy = function (e, t, r, i) { if ((\"number\" != typeof r || r < 0) && (r = 0), (\"number\" != typeof i || i > this.length) && (i = this.length), r >= this.length) return e || n.alloc(0); if (i <= 0) return e || n.alloc(0); const o = !!e, s = this._offset(r), a = i - r; let u = a, c = o && t || 0, l = s[1]; if (0 === r && i === this.length) { if (!o) return 1 === this._bufs.length ? this._bufs[0] : n.concat(this._bufs, this.length); for (let t = 0; t < this._bufs.length; t++)this._bufs[t].copy(e, c), c += this._bufs[t].length; return e } if (u <= this._bufs[s[0]].length - l) return o ? this._bufs[s[0]].copy(e, t, l, l + u) : this._bufs[s[0]].slice(l, l + u); o || (e = n.allocUnsafe(a)); for (let t = s[0]; t < this._bufs.length; t++) { const r = this._bufs[t].length - l; if (!(u > r)) { this._bufs[t].copy(e, c, l, l + u), c += r; break } this._bufs[t].copy(e, c, l), c += r, u -= r, l && (l = 0) } return e.length > c ? e.slice(0, c) : e }, o.prototype.shallowSlice = function (e, t) { if (e = e || 0, t = \"number\" != typeof t ? this.length : t, e < 0 && (e += this.length), t < 0 && (t += this.length), e === t) return this._new(); const r = this._offset(e), n = this._offset(t), i = this._bufs.slice(r[0], n[0] + 1); return 0 === n[1] ? i.pop() : i[i.length - 1] = i[i.length - 1].slice(0, n[1]), 0 !== r[1] && (i[0] = i[0].slice(r[1])), this._new(i) }, o.prototype.toString = function (e, t, r) { return this.slice(t, r).toString(e) }, o.prototype.consume = function (e) { if (e = Math.trunc(e), Number.isNaN(e) || e <= 0) return this; for (; this._bufs.length;) { if (!(e >= this._bufs[0].length)) { this._bufs[0] = this._bufs[0].slice(e), this.length -= e; break } e -= this._bufs[0].length, this.length -= this._bufs[0].length, this._bufs.shift() } return this }, o.prototype.duplicate = function () { const e = this._new(); for (let t = 0; t < this._bufs.length; t++)e.append(this._bufs[t]); return e }, o.prototype.append = function (e) { if (null == e) return this; if (e.buffer) this._appendBuffer(n.from(e.buffer, e.byteOffset, e.byteLength)); else if (Array.isArray(e)) for (let t = 0; t < e.length; t++)this.append(e[t]); else if (this._isBufferList(e)) for (let t = 0; t < e._bufs.length; t++)this.append(e._bufs[t]); else \"number\" == typeof e && (e = e.toString()), this._appendBuffer(n.from(e)); return this }, o.prototype._appendBuffer = function (e) { this._bufs.push(e), this.length += e.length }, o.prototype.indexOf = function (e, t, r) { if (void 0 === r && \"string\" == typeof t && (r = t, t = void 0), \"function\" == typeof e || Array.isArray(e)) throw new TypeError('The \"value\" argument must be one of type string, Buffer, BufferList, or Uint8Array.'); if (\"number\" == typeof e ? e = n.from([e]) : \"string\" == typeof e ? e = n.from(e, r) : this._isBufferList(e) ? e = e.slice() : Array.isArray(e.buffer) ? e = n.from(e.buffer, e.byteOffset, e.byteLength) : n.isBuffer(e) || (e = n.from(e)), t = Number(t || 0), isNaN(t) && (t = 0), t < 0 && (t = this.length + t), t < 0 && (t = 0), 0 === e.length) return t > this.length ? this.length : t; const i = this._offset(t); let o = i[0], s = i[1]; for (; o < this._bufs.length; o++) { const t = this._bufs[o]; for (; s < t.length;) { if (t.length - s >= e.length) { const r = t.indexOf(e, s); if (-1 !== r) return this._reverseOffset([o, r]); s = t.length - e.length + 1 } else { const t = this._reverseOffset([o, s]); if (this._match(t, e)) return t; s++ } } s = 0 } return -1 }, o.prototype._match = function (e, t) { if (this.length - e < t.length) return !1; for (let r = 0; r < t.length; r++)if (this.get(e + r) !== t[r]) return !1; return !0 }, function () { const e = { readDoubleBE: 8, readDoubleLE: 8, readFloatBE: 4, readFloatLE: 4, readInt32BE: 4, readInt32LE: 4, readUInt32BE: 4, readUInt32LE: 4, readInt16BE: 2, readInt16LE: 2, readUInt16BE: 2, readUInt16LE: 2, readInt8: 1, readUInt8: 1, readIntBE: null, readIntLE: null, readUIntBE: null, readUIntLE: null }; for (const t in e) !function (t) { o.prototype[t] = null === e[t] ? function (e, r) { return this.slice(e, e + r)[t](0, r) } : function (r) { return this.slice(r, r + e[t])[t](0) } }(t) }(), o.prototype._isBufferList = function (e) { return e instanceof o || o.isBufferList(e) }, o.isBufferList = function (e) { return null != e && e[i] }, t.exports = o }, { buffer: 14 }], 12: [function (e, t, r) { \"use strict\"; const n = e(\"readable-stream\").Duplex, i = e(\"inherits\"), o = e(\"./BufferList\"); function s(e) { if (!(this instanceof s)) return new s(e); if (\"function\" == typeof e) { this._callback = e; const t = function (e) { this._callback && (this._callback(e), this._callback = null) }.bind(this); this.on(\"pipe\", function (e) { e.on(\"error\", t) }), this.on(\"unpipe\", function (e) { e.removeListener(\"error\", t) }), e = null } o._init.call(this, e), n.call(this) } i(s, n), Object.assign(s.prototype, o.prototype), s.prototype._new = function (e) { return new s(e) }, s.prototype._write = function (e, t, r) { this._appendBuffer(e), \"function\" == typeof r && r() }, s.prototype._read = function (e) { if (!this.length) return this.push(null); e = Math.min(e, this.length), this.push(this.slice(0, e)), this.consume(e) }, s.prototype.end = function (e) { n.prototype.end.call(this, e), this._callback && (this._callback(null, this.slice()), this._callback = null) }, s.prototype._destroy = function (e, t) { this._bufs.length = 0, this.length = 0, t(e) }, s.prototype._isBufferList = function (e) { return e instanceof s || e instanceof o || s.isBufferList(e) }, s.isBufferList = o.isBufferList, t.exports = s, t.exports.BufferListStream = s, t.exports.BufferList = o }, { \"./BufferList\": 11, inherits: 33, \"readable-stream\": 65 }], 13: [function (e, t, r) { }, {}], 14: [function (e, t, r) { (function (t) { (function () { \"use strict\"; var t = e(\"base64-js\"), n = e(\"ieee754\"); r.Buffer = s, r.SlowBuffer = function (e) { +e != e && (e = 0); return s.alloc(+e) }, r.INSPECT_MAX_BYTES = 50; var i = 2147483647; function o(e) { if (e > i) throw new RangeError('The value \"' + e + '\" is invalid for option \"size\"'); var t = new Uint8Array(e); return t.__proto__ = s.prototype, t } function s(e, t, r) { if (\"number\" == typeof e) { if (\"string\" == typeof t) throw new TypeError('The \"string\" argument must be of type string. Received type number'); return c(e) } return a(e, t, r) } function a(e, t, r) { if (\"string\" == typeof e) return function (e, t) { \"string\" == typeof t && \"\" !== t || (t = \"utf8\"); if (!s.isEncoding(t)) throw new TypeError(\"Unknown encoding: \" + t); var r = 0 | h(e, t), n = o(r), i = n.write(e, t); i !== r && (n = n.slice(0, i)); return n }(e, t); if (ArrayBuffer.isView(e)) return l(e); if (null == e) throw TypeError(\"The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type \" + typeof e); if (q(e, ArrayBuffer) || e && q(e.buffer, ArrayBuffer)) return function (e, t, r) { if (t < 0 || e.byteLength < t) throw new RangeError('\"offset\" is outside of buffer bounds'); if (e.byteLength < t + (r || 0)) throw new RangeError('\"length\" is outside of buffer bounds'); var n; n = void 0 === t && void 0 === r ? new Uint8Array(e) : void 0 === r ? new Uint8Array(e, t) : new Uint8Array(e, t, r); return n.__proto__ = s.prototype, n }(e, t, r); if (\"number\" == typeof e) throw new TypeError('The \"value\" argument must not be of type number. Received type number'); var n = e.valueOf && e.valueOf(); if (null != n && n !== e) return s.from(n, t, r); var i = function (e) { if (s.isBuffer(e)) { var t = 0 | f(e.length), r = o(t); return 0 === r.length ? r : (e.copy(r, 0, 0, t), r) } if (void 0 !== e.length) return \"number\" != typeof e.length || D(e.length) ? o(0) : l(e); if (\"Buffer\" === e.type && Array.isArray(e.data)) return l(e.data) }(e); if (i) return i; if (\"undefined\" != typeof Symbol && null != Symbol.toPrimitive && \"function\" == typeof e[Symbol.toPrimitive]) return s.from(e[Symbol.toPrimitive](\"string\"), t, r); throw new TypeError(\"The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type \" + typeof e) } function u(e) { if (\"number\" != typeof e) throw new TypeError('\"size\" argument must be of type number'); if (e < 0) throw new RangeError('The value \"' + e + '\" is invalid for option \"size\"') } function c(e) { return u(e), o(e < 0 ? 0 : 0 | f(e)) } function l(e) { for (var t = e.length < 0 ? 0 : 0 | f(e.length), r = o(t), n = 0; n < t; n += 1)r[n] = 255 & e[n]; return r } function f(e) { if (e >= i) throw new RangeError(\"Attempt to allocate Buffer larger than maximum size: 0x\" + i.toString(16) + \" bytes\"); return 0 | e } function h(e, t) { if (s.isBuffer(e)) return e.length; if (ArrayBuffer.isView(e) || q(e, ArrayBuffer)) return e.byteLength; if (\"string\" != typeof e) throw new TypeError('The \"string\" argument must be one of type string, Buffer, or ArrayBuffer. Received type ' + typeof e); var r = e.length, n = arguments.length > 2 && !0 === arguments[2]; if (!n && 0 === r) return 0; for (var i = !1; ;)switch (t) { case \"ascii\": case \"latin1\": case \"binary\": return r; case \"utf8\": case \"utf-8\": return j(e).length; case \"ucs2\": case \"ucs-2\": case \"utf16le\": case \"utf-16le\": return 2 * r; case \"hex\": return r >>> 1; case \"base64\": return U(e).length; default: if (i) return n ? -1 : j(e).length; t = (\"\" + t).toLowerCase(), i = !0 } } function p(e, t, r) { var n = e[t]; e[t] = e[r], e[r] = n } function d(e, t, r, n, i) { if (0 === e.length) return -1; if (\"string\" == typeof r ? (n = r, r = 0) : r > 2147483647 ? r = 2147483647 : r < -2147483648 && (r = -2147483648), D(r = +r) && (r = i ? 0 : e.length - 1), r < 0 && (r = e.length + r), r >= e.length) { if (i) return -1; r = e.length - 1 } else if (r < 0) { if (!i) return -1; r = 0 } if (\"string\" == typeof t && (t = s.from(t, n)), s.isBuffer(t)) return 0 === t.length ? -1 : g(e, t, r, n, i); if (\"number\" == typeof t) return t &= 255, \"function\" == typeof Uint8Array.prototype.indexOf ? i ? Uint8Array.prototype.indexOf.call(e, t, r) : Uint8Array.prototype.lastIndexOf.call(e, t, r) : g(e, [t], r, n, i); throw new TypeError(\"val must be string, number or Buffer\") } function g(e, t, r, n, i) { var o, s = 1, a = e.length, u = t.length; if (void 0 !== n && (\"ucs2\" === (n = String(n).toLowerCase()) || \"ucs-2\" === n || \"utf16le\" === n || \"utf-16le\" === n)) { if (e.length < 2 || t.length < 2) return -1; s = 2, a /= 2, u /= 2, r /= 2 } function c(e, t) { return 1 === s ? e[t] : e.readUInt16BE(t * s) } if (i) { var l = -1; for (o = r; o < a; o++)if (c(e, o) === c(t, -1 === l ? 0 : o - l)) { if (-1 === l && (l = o), o - l + 1 === u) return l * s } else -1 !== l && (o -= o - l), l = -1 } else for (r + u > a && (r = a - u), o = r; o >= 0; o--) { for (var f = !0, h = 0; h < u; h++)if (c(e, o + h) !== c(t, h)) { f = !1; break } if (f) return o } return -1 } function b(e, t, r, n) { r = Number(r) || 0; var i = e.length - r; n ? (n = Number(n)) > i && (n = i) : n = i; var o = t.length; n > o / 2 && (n = o / 2); for (var s = 0; s < n; ++s) { var a = parseInt(t.substr(2 * s, 2), 16); if (D(a)) return s; e[r + s] = a } return s } function m(e, t, r, n) { return N(j(t, e.length - r), e, r, n) } function y(e, t, r, n) { return N(function (e) { for (var t = [], r = 0; r < e.length; ++r)t.push(255 & e.charCodeAt(r)); return t }(t), e, r, n) } function _(e, t, r, n) { return y(e, t, r, n) } function w(e, t, r, n) { return N(U(t), e, r, n) } function v(e, t, r, n) { return N(function (e, t) { for (var r, n, i, o = [], s = 0; s < e.length && !((t -= 2) < 0); ++s)r = e.charCodeAt(s), n = r >> 8, i = r % 256, o.push(i), o.push(n); return o }(t, e.length - r), e, r, n) } function S(e, r, n) { return 0 === r && n === e.length ? t.fromByteArray(e) : t.fromByteArray(e.slice(r, n)) } function E(e, t, r) { r = Math.min(e.length, r); for (var n = [], i = t; i < r;) { var o, s, a, u, c = e[i], l = null, f = c > 239 ? 4 : c > 223 ? 3 : c > 191 ? 2 : 1; if (i + f <= r) switch (f) { case 1: c < 128 && (l = c); break; case 2: 128 == (192 & (o = e[i + 1])) && (u = (31 & c) << 6 | 63 & o) > 127 && (l = u); break; case 3: o = e[i + 1], s = e[i + 2], 128 == (192 & o) && 128 == (192 & s) && (u = (15 & c) << 12 | (63 & o) << 6 | 63 & s) > 2047 && (u < 55296 || u > 57343) && (l = u); break; case 4: o = e[i + 1], s = e[i + 2], a = e[i + 3], 128 == (192 & o) && 128 == (192 & s) && 128 == (192 & a) && (u = (15 & c) << 18 | (63 & o) << 12 | (63 & s) << 6 | 63 & a) > 65535 && u < 1114112 && (l = u) }null === l ? (l = 65533, f = 1) : l > 65535 && (l -= 65536, n.push(l >>> 10 & 1023 | 55296), l = 56320 | 1023 & l), n.push(l), i += f } return function (e) { var t = e.length; if (t <= k) return String.fromCharCode.apply(String, e); var r = \"\", n = 0; for (; n < t;)r += String.fromCharCode.apply(String, e.slice(n, n += k)); return r }(n) } r.kMaxLength = i, s.TYPED_ARRAY_SUPPORT = function () { try { var e = new Uint8Array(1); return e.__proto__ = { __proto__: Uint8Array.prototype, foo: function () { return 42 } }, 42 === e.foo() } catch (e) { return !1 } }(), s.TYPED_ARRAY_SUPPORT || \"undefined\" == typeof console || \"function\" != typeof console.error || console.error(\"This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.\"), Object.defineProperty(s.prototype, \"parent\", { enumerable: !0, get: function () { if (s.isBuffer(this)) return this.buffer } }), Object.defineProperty(s.prototype, \"offset\", { enumerable: !0, get: function () { if (s.isBuffer(this)) return this.byteOffset } }), \"undefined\" != typeof Symbol && null != Symbol.species && s[Symbol.species] === s && Object.defineProperty(s, Symbol.species, { value: null, configurable: !0, enumerable: !1, writable: !1 }), s.poolSize = 8192, s.from = function (e, t, r) { return a(e, t, r) }, s.prototype.__proto__ = Uint8Array.prototype, s.__proto__ = Uint8Array, s.alloc = function (e, t, r) { return function (e, t, r) { return u(e), e <= 0 ? o(e) : void 0 !== t ? \"string\" == typeof r ? o(e).fill(t, r) : o(e).fill(t) : o(e) }(e, t, r) }, s.allocUnsafe = function (e) { return c(e) }, s.allocUnsafeSlow = function (e) { return c(e) }, s.isBuffer = function (e) { return null != e && !0 === e._isBuffer && e !== s.prototype }, s.compare = function (e, t) { if (q(e, Uint8Array) && (e = s.from(e, e.offset, e.byteLength)), q(t, Uint8Array) && (t = s.from(t, t.offset, t.byteLength)), !s.isBuffer(e) || !s.isBuffer(t)) throw new TypeError('The \"buf1\", \"buf2\" arguments must be one of type Buffer or Uint8Array'); if (e === t) return 0; for (var r = e.length, n = t.length, i = 0, o = Math.min(r, n); i < o; ++i)if (e[i] !== t[i]) { r = e[i], n = t[i]; break } return r < n ? -1 : n < r ? 1 : 0 }, s.isEncoding = function (e) { switch (String(e).toLowerCase()) { case \"hex\": case \"utf8\": case \"utf-8\": case \"ascii\": case \"latin1\": case \"binary\": case \"base64\": case \"ucs2\": case \"ucs-2\": case \"utf16le\": case \"utf-16le\": return !0; default: return !1 } }, s.concat = function (e, t) { if (!Array.isArray(e)) throw new TypeError('\"list\" argument must be an Array of Buffers'); if (0 === e.length) return s.alloc(0); var r; if (void 0 === t) for (t = 0, r = 0; r < e.length; ++r)t += e[r].length; var n = s.allocUnsafe(t), i = 0; for (r = 0; r < e.length; ++r) { var o = e[r]; if (q(o, Uint8Array) && (o = s.from(o)), !s.isBuffer(o)) throw new TypeError('\"list\" argument must be an Array of Buffers'); o.copy(n, i), i += o.length } return n }, s.byteLength = h, s.prototype._isBuffer = !0, s.prototype.swap16 = function () { var e = this.length; if (e % 2 != 0) throw new RangeError(\"Buffer size must be a multiple of 16-bits\"); for (var t = 0; t < e; t += 2)p(this, t, t + 1); return this }, s.prototype.swap32 = function () { var e = this.length; if (e % 4 != 0) throw new RangeError(\"Buffer size must be a multiple of 32-bits\"); for (var t = 0; t < e; t += 4)p(this, t, t + 3), p(this, t + 1, t + 2); return this }, s.prototype.swap64 = function () { var e = this.length; if (e % 8 != 0) throw new RangeError(\"Buffer size must be a multiple of 64-bits\"); for (var t = 0; t < e; t += 8)p(this, t, t + 7), p(this, t + 1, t + 6), p(this, t + 2, t + 5), p(this, t + 3, t + 4); return this }, s.prototype.toString = function () { var e = this.length; return 0 === e ? \"\" : 0 === arguments.length ? E(this, 0, e) : function (e, t, r) { var n = !1; if ((void 0 === t || t < 0) && (t = 0), t > this.length) return \"\"; if ((void 0 === r || r > this.length) && (r = this.length), r <= 0) return \"\"; if ((r >>>= 0) <= (t >>>= 0)) return \"\"; for (e || (e = \"utf8\"); ;)switch (e) { case \"hex\": return T(this, t, r); case \"utf8\": case \"utf-8\": return E(this, t, r); case \"ascii\": return I(this, t, r); case \"latin1\": case \"binary\": return C(this, t, r); case \"base64\": return S(this, t, r); case \"ucs2\": case \"ucs-2\": case \"utf16le\": case \"utf-16le\": return x(this, t, r); default: if (n) throw new TypeError(\"Unknown encoding: \" + e); e = (e + \"\").toLowerCase(), n = !0 } }.apply(this, arguments) }, s.prototype.toLocaleString = s.prototype.toString, s.prototype.equals = function (e) { if (!s.isBuffer(e)) throw new TypeError(\"Argument must be a Buffer\"); return this === e || 0 === s.compare(this, e) }, s.prototype.inspect = function () { var e = \"\", t = r.INSPECT_MAX_BYTES; return e = this.toString(\"hex\", 0, t).replace(/(.{2})/g, \"$1 \").trim(), this.length > t && (e += \" ... \"), \"<Buffer \" + e + \">\" }, s.prototype.compare = function (e, t, r, n, i) { if (q(e, Uint8Array) && (e = s.from(e, e.offset, e.byteLength)), !s.isBuffer(e)) throw new TypeError('The \"target\" argument must be one of type Buffer or Uint8Array. Received type ' + typeof e); if (void 0 === t && (t = 0), void 0 === r && (r = e ? e.length : 0), void 0 === n && (n = 0), void 0 === i && (i = this.length), t < 0 || r > e.length || n < 0 || i > this.length) throw new RangeError(\"out of range index\"); if (n >= i && t >= r) return 0; if (n >= i) return -1; if (t >= r) return 1; if (t >>>= 0, r >>>= 0, n >>>= 0, i >>>= 0, this === e) return 0; for (var o = i - n, a = r - t, u = Math.min(o, a), c = this.slice(n, i), l = e.slice(t, r), f = 0; f < u; ++f)if (c[f] !== l[f]) { o = c[f], a = l[f]; break } return o < a ? -1 : a < o ? 1 : 0 }, s.prototype.includes = function (e, t, r) { return -1 !== this.indexOf(e, t, r) }, s.prototype.indexOf = function (e, t, r) { return d(this, e, t, r, !0) }, s.prototype.lastIndexOf = function (e, t, r) { return d(this, e, t, r, !1) }, s.prototype.write = function (e, t, r, n) { if (void 0 === t) n = \"utf8\", r = this.length, t = 0; else if (void 0 === r && \"string\" == typeof t) n = t, r = this.length, t = 0; else { if (!isFinite(t)) throw new Error(\"Buffer.write(string, encoding, offset[, length]) is no longer supported\"); t >>>= 0, isFinite(r) ? (r >>>= 0, void 0 === n && (n = \"utf8\")) : (n = r, r = void 0) } var i = this.length - t; if ((void 0 === r || r > i) && (r = i), e.length > 0 && (r < 0 || t < 0) || t > this.length) throw new RangeError(\"Attempt to write outside buffer bounds\"); n || (n = \"utf8\"); for (var o = !1; ;)switch (n) { case \"hex\": return b(this, e, t, r); case \"utf8\": case \"utf-8\": return m(this, e, t, r); case \"ascii\": return y(this, e, t, r); case \"latin1\": case \"binary\": return _(this, e, t, r); case \"base64\": return w(this, e, t, r); case \"ucs2\": case \"ucs-2\": case \"utf16le\": case \"utf-16le\": return v(this, e, t, r); default: if (o) throw new TypeError(\"Unknown encoding: \" + n); n = (\"\" + n).toLowerCase(), o = !0 } }, s.prototype.toJSON = function () { return { type: \"Buffer\", data: Array.prototype.slice.call(this._arr || this, 0) } }; var k = 4096; function I(e, t, r) { var n = \"\"; r = Math.min(e.length, r); for (var i = t; i < r; ++i)n += String.fromCharCode(127 & e[i]); return n } function C(e, t, r) { var n = \"\"; r = Math.min(e.length, r); for (var i = t; i < r; ++i)n += String.fromCharCode(e[i]); return n } function T(e, t, r) { var n = e.length; (!t || t < 0) && (t = 0), (!r || r < 0 || r > n) && (r = n); for (var i = \"\", o = t; o < r; ++o)i += L(e[o]); return i } function x(e, t, r) { for (var n = e.slice(t, r), i = \"\", o = 0; o < n.length; o += 2)i += String.fromCharCode(n[o] + 256 * n[o + 1]); return i } function R(e, t, r) { if (e % 1 != 0 || e < 0) throw new RangeError(\"offset is not uint\"); if (e + t > r) throw new RangeError(\"Trying to access beyond buffer length\") } function A(e, t, r, n, i, o) { if (!s.isBuffer(e)) throw new TypeError('\"buffer\" argument must be a Buffer instance'); if (t > i || t < o) throw new RangeError('\"value\" argument is out of bounds'); if (r + n > e.length) throw new RangeError(\"Index out of range\") } function M(e, t, r, n, i, o) { if (r + n > e.length) throw new RangeError(\"Index out of range\"); if (r < 0) throw new RangeError(\"Index out of range\") } function O(e, t, r, i, o) { return t = +t, r >>>= 0, o || M(e, 0, r, 4), n.write(e, t, r, i, 23, 4), r + 4 } function P(e, t, r, i, o) { return t = +t, r >>>= 0, o || M(e, 0, r, 8), n.write(e, t, r, i, 52, 8), r + 8 } s.prototype.slice = function (e, t) { var r = this.length; e = ~~e, t = void 0 === t ? r : ~~t, e < 0 ? (e += r) < 0 && (e = 0) : e > r && (e = r), t < 0 ? (t += r) < 0 && (t = 0) : t > r && (t = r), t < e && (t = e); var n = this.subarray(e, t); return n.__proto__ = s.prototype, n }, s.prototype.readUIntLE = function (e, t, r) { e >>>= 0, t >>>= 0, r || R(e, t, this.length); for (var n = this[e], i = 1, o = 0; ++o < t && (i *= 256);)n += this[e + o] * i; return n }, s.prototype.readUIntBE = function (e, t, r) { e >>>= 0, t >>>= 0, r || R(e, t, this.length); for (var n = this[e + --t], i = 1; t > 0 && (i *= 256);)n += this[e + --t] * i; return n }, s.prototype.readUInt8 = function (e, t) { return e >>>= 0, t || R(e, 1, this.length), this[e] }, s.prototype.readUInt16LE = function (e, t) { return e >>>= 0, t || R(e, 2, this.length), this[e] | this[e + 1] << 8 }, s.prototype.readUInt16BE = function (e, t) { return e >>>= 0, t || R(e, 2, this.length), this[e] << 8 | this[e + 1] }, s.prototype.readUInt32LE = function (e, t) { return e >>>= 0, t || R(e, 4, this.length), (this[e] | this[e + 1] << 8 | this[e + 2] << 16) + 16777216 * this[e + 3] }, s.prototype.readUInt32BE = function (e, t) { return e >>>= 0, t || R(e, 4, this.length), 16777216 * this[e] + (this[e + 1] << 16 | this[e + 2] << 8 | this[e + 3]) }, s.prototype.readIntLE = function (e, t, r) { e >>>= 0, t >>>= 0, r || R(e, t, this.length); for (var n = this[e], i = 1, o = 0; ++o < t && (i *= 256);)n += this[e + o] * i; return n >= (i *= 128) && (n -= Math.pow(2, 8 * t)), n }, s.prototype.readIntBE = function (e, t, r) { e >>>= 0, t >>>= 0, r || R(e, t, this.length); for (var n = t, i = 1, o = this[e + --n]; n > 0 && (i *= 256);)o += this[e + --n] * i; return o >= (i *= 128) && (o -= Math.pow(2, 8 * t)), o }, s.prototype.readInt8 = function (e, t) { return e >>>= 0, t || R(e, 1, this.length), 128 & this[e] ? -1 * (255 - this[e] + 1) : this[e] }, s.prototype.readInt16LE = function (e, t) { e >>>= 0, t || R(e, 2, this.length); var r = this[e] | this[e + 1] << 8; return 32768 & r ? 4294901760 | r : r }, s.prototype.readInt16BE = function (e, t) { e >>>= 0, t || R(e, 2, this.length); var r = this[e + 1] | this[e] << 8; return 32768 & r ? 4294901760 | r : r }, s.prototype.readInt32LE = function (e, t) { return e >>>= 0, t || R(e, 4, this.length), this[e] | this[e + 1] << 8 | this[e + 2] << 16 | this[e + 3] << 24 }, s.prototype.readInt32BE = function (e, t) { return e >>>= 0, t || R(e, 4, this.length), this[e] << 24 | this[e + 1] << 16 | this[e + 2] << 8 | this[e + 3] }, s.prototype.readFloatLE = function (e, t) { return e >>>= 0, t || R(e, 4, this.length), n.read(this, e, !0, 23, 4) }, s.prototype.readFloatBE = function (e, t) { return e >>>= 0, t || R(e, 4, this.length), n.read(this, e, !1, 23, 4) }, s.prototype.readDoubleLE = function (e, t) { return e >>>= 0, t || R(e, 8, this.length), n.read(this, e, !0, 52, 8) }, s.prototype.readDoubleBE = function (e, t) { return e >>>= 0, t || R(e, 8, this.length), n.read(this, e, !1, 52, 8) }, s.prototype.writeUIntLE = function (e, t, r, n) { (e = +e, t >>>= 0, r >>>= 0, n) || A(this, e, t, r, Math.pow(2, 8 * r) - 1, 0); var i = 1, o = 0; for (this[t] = 255 & e; ++o < r && (i *= 256);)this[t + o] = e / i & 255; return t + r }, s.prototype.writeUIntBE = function (e, t, r, n) { (e = +e, t >>>= 0, r >>>= 0, n) || A(this, e, t, r, Math.pow(2, 8 * r) - 1, 0); var i = r - 1, o = 1; for (this[t + i] = 255 & e; --i >= 0 && (o *= 256);)this[t + i] = e / o & 255; return t + r }, s.prototype.writeUInt8 = function (e, t, r) { return e = +e, t >>>= 0, r || A(this, e, t, 1, 255, 0), this[t] = 255 & e, t + 1 }, s.prototype.writeUInt16LE = function (e, t, r) { return e = +e, t >>>= 0, r || A(this, e, t, 2, 65535, 0), this[t] = 255 & e, this[t + 1] = e >>> 8, t + 2 }, s.prototype.writeUInt16BE = function (e, t, r) { return e = +e, t >>>= 0, r || A(this, e, t, 2, 65535, 0), this[t] = e >>> 8, this[t + 1] = 255 & e, t + 2 }, s.prototype.writeUInt32LE = function (e, t, r) { return e = +e, t >>>= 0, r || A(this, e, t, 4, 4294967295, 0), this[t + 3] = e >>> 24, this[t + 2] = e >>> 16, this[t + 1] = e >>> 8, this[t] = 255 & e, t + 4 }, s.prototype.writeUInt32BE = function (e, t, r) { return e = +e, t >>>= 0, r || A(this, e, t, 4, 4294967295, 0), this[t] = e >>> 24, this[t + 1] = e >>> 16, this[t + 2] = e >>> 8, this[t + 3] = 255 & e, t + 4 }, s.prototype.writeIntLE = function (e, t, r, n) { if (e = +e, t >>>= 0, !n) { var i = Math.pow(2, 8 * r - 1); A(this, e, t, r, i - 1, -i) } var o = 0, s = 1, a = 0; for (this[t] = 255 & e; ++o < r && (s *= 256);)e < 0 && 0 === a && 0 !== this[t + o - 1] && (a = 1), this[t + o] = (e / s >> 0) - a & 255; return t + r }, s.prototype.writeIntBE = function (e, t, r, n) { if (e = +e, t >>>= 0, !n) { var i = Math.pow(2, 8 * r - 1); A(this, e, t, r, i - 1, -i) } var o = r - 1, s = 1, a = 0; for (this[t + o] = 255 & e; --o >= 0 && (s *= 256);)e < 0 && 0 === a && 0 !== this[t + o + 1] && (a = 1), this[t + o] = (e / s >> 0) - a & 255; return t + r }, s.prototype.writeInt8 = function (e, t, r) { return e = +e, t >>>= 0, r || A(this, e, t, 1, 127, -128), e < 0 && (e = 255 + e + 1), this[t] = 255 & e, t + 1 }, s.prototype.writeInt16LE = function (e, t, r) { return e = +e, t >>>= 0, r || A(this, e, t, 2, 32767, -32768), this[t] = 255 & e, this[t + 1] = e >>> 8, t + 2 }, s.prototype.writeInt16BE = function (e, t, r) { return e = +e, t >>>= 0, r || A(this, e, t, 2, 32767, -32768), this[t] = e >>> 8, this[t + 1] = 255 & e, t + 2 }, s.prototype.writeInt32LE = function (e, t, r) { return e = +e, t >>>= 0, r || A(this, e, t, 4, 2147483647, -2147483648), this[t] = 255 & e, this[t + 1] = e >>> 8, this[t + 2] = e >>> 16, this[t + 3] = e >>> 24, t + 4 }, s.prototype.writeInt32BE = function (e, t, r) { return e = +e, t >>>= 0, r || A(this, e, t, 4, 2147483647, -2147483648), e < 0 && (e = 4294967295 + e + 1), this[t] = e >>> 24, this[t + 1] = e >>> 16, this[t + 2] = e >>> 8, this[t + 3] = 255 & e, t + 4 }, s.prototype.writeFloatLE = function (e, t, r) { return O(this, e, t, !0, r) }, s.prototype.writeFloatBE = function (e, t, r) { return O(this, e, t, !1, r) }, s.prototype.writeDoubleLE = function (e, t, r) { return P(this, e, t, !0, r) }, s.prototype.writeDoubleBE = function (e, t, r) { return P(this, e, t, !1, r) }, s.prototype.copy = function (e, t, r, n) { if (!s.isBuffer(e)) throw new TypeError(\"argument should be a Buffer\"); if (r || (r = 0), n || 0 === n || (n = this.length), t >= e.length && (t = e.length), t || (t = 0), n > 0 && n < r && (n = r), n === r) return 0; if (0 === e.length || 0 === this.length) return 0; if (t < 0) throw new RangeError(\"targetStart out of bounds\"); if (r < 0 || r >= this.length) throw new RangeError(\"Index out of range\"); if (n < 0) throw new RangeError(\"sourceEnd out of bounds\"); n > this.length && (n = this.length), e.length - t < n - r && (n = e.length - t + r); var i = n - r; if (this === e && \"function\" == typeof Uint8Array.prototype.copyWithin) this.copyWithin(t, r, n); else if (this === e && r < t && t < n) for (var o = i - 1; o >= 0; --o)e[o + t] = this[o + r]; else Uint8Array.prototype.set.call(e, this.subarray(r, n), t); return i }, s.prototype.fill = function (e, t, r, n) { if (\"string\" == typeof e) { if (\"string\" == typeof t ? (n = t, t = 0, r = this.length) : \"string\" == typeof r && (n = r, r = this.length), void 0 !== n && \"string\" != typeof n) throw new TypeError(\"encoding must be a string\"); if (\"string\" == typeof n && !s.isEncoding(n)) throw new TypeError(\"Unknown encoding: \" + n); if (1 === e.length) { var i = e.charCodeAt(0); (\"utf8\" === n && i < 128 || \"latin1\" === n) && (e = i) } } else \"number\" == typeof e && (e &= 255); if (t < 0 || this.length < t || this.length < r) throw new RangeError(\"Out of range index\"); if (r <= t) return this; var o; if (t >>>= 0, r = void 0 === r ? this.length : r >>> 0, e || (e = 0), \"number\" == typeof e) for (o = t; o < r; ++o)this[o] = e; else { var a = s.isBuffer(e) ? e : s.from(e, n), u = a.length; if (0 === u) throw new TypeError('The value \"' + e + '\" is invalid for argument \"value\"'); for (o = 0; o < r - t; ++o)this[o + t] = a[o % u] } return this }; var B = /[^+/0-9A-Za-z-_]/g; function L(e) { return e < 16 ? \"0\" + e.toString(16) : e.toString(16) } function j(e, t) { var r; t = t || 1 / 0; for (var n = e.length, i = null, o = [], s = 0; s < n; ++s) { if ((r = e.charCodeAt(s)) > 55295 && r < 57344) { if (!i) { if (r > 56319) { (t -= 3) > -1 && o.push(239, 191, 189); continue } if (s + 1 === n) { (t -= 3) > -1 && o.push(239, 191, 189); continue } i = r; continue } if (r < 56320) { (t -= 3) > -1 && o.push(239, 191, 189), i = r; continue } r = 65536 + (i - 55296 << 10 | r - 56320) } else i && (t -= 3) > -1 && o.push(239, 191, 189); if (i = null, r < 128) { if ((t -= 1) < 0) break; o.push(r) } else if (r < 2048) { if ((t -= 2) < 0) break; o.push(r >> 6 | 192, 63 & r | 128) } else if (r < 65536) { if ((t -= 3) < 0) break; o.push(r >> 12 | 224, r >> 6 & 63 | 128, 63 & r | 128) } else { if (!(r < 1114112)) throw new Error(\"Invalid code point\"); if ((t -= 4) < 0) break; o.push(r >> 18 | 240, r >> 12 & 63 | 128, r >> 6 & 63 | 128, 63 & r | 128) } } return o } function U(e) { return t.toByteArray(function (e) { if ((e = (e = e.split(\"=\")[0]).trim().replace(B, \"\")).length < 2) return \"\"; for (; e.length % 4 != 0;)e += \"=\"; return e }(e)) } function N(e, t, r, n) { for (var i = 0; i < n && !(i + r >= t.length || i >= e.length); ++i)t[i + r] = e[i]; return i } function q(e, t) { return e instanceof t || null != e && null != e.constructor && null != e.constructor.name && e.constructor.name === t.name } function D(e) { return e != e } }).call(this) }).call(this, e(\"buffer\").Buffer) }, { \"base64-js\": 10, buffer: 14, ieee754: 32 }], 15: [function (e, t, r) { (function (e) { (function () { function t(e) { return Object.prototype.toString.call(e) } r.isArray = function (e) { return Array.isArray ? Array.isArray(e) : \"[object Array]\" === t(e) }, r.isBoolean = function (e) { return \"boolean\" == typeof e }, r.isNull = function (e) { return null === e }, r.isNullOrUndefined = function (e) { return null == e }, r.isNumber = function (e) { return \"number\" == typeof e }, r.isString = function (e) { return \"string\" == typeof e }, r.isSymbol = function (e) { return \"symbol\" == typeof e }, r.isUndefined = function (e) { return void 0 === e }, r.isRegExp = function (e) { return \"[object RegExp]\" === t(e) }, r.isObject = function (e) { return \"object\" == typeof e && null !== e }, r.isDate = function (e) { return \"[object Date]\" === t(e) }, r.isError = function (e) { return \"[object Error]\" === t(e) || e instanceof Error }, r.isFunction = function (e) { return \"function\" == typeof e }, r.isPrimitive = function (e) { return null === e || \"boolean\" == typeof e || \"number\" == typeof e || \"string\" == typeof e || \"symbol\" == typeof e || void 0 === e }, r.isBuffer = e.isBuffer }).call(this) }).call(this, { isBuffer: e(\"../../is-buffer/index.js\") }) }, { \"../../is-buffer/index.js\": 34 }], 16: [function (e, t, r) { (function (n) { (function () { r.formatArgs = function (e) { if (e[0] = (this.useColors ? \"%c\" : \"\") + this.namespace + (this.useColors ? \" %c\" : \" \") + e[0] + (this.useColors ? \"%c \" : \" \") + \"+\" + t.exports.humanize(this.diff), !this.useColors) return; const r = \"color: \" + this.color; e.splice(1, 0, r, \"color: inherit\"); let n = 0, i = 0; e[0].replace(/%[a-zA-Z%]/g, e => { \"%%\" !== e && \"%c\" === e && (i = ++n) }), e.splice(i, 0, r) }, r.save = function (e) { try { e ? r.storage.setItem(\"debug\", e) : r.storage.removeItem(\"debug\") } catch (e) { } }, r.load = function () { let e; try { e = r.storage.getItem(\"debug\") } catch (e) { } !e && void 0 !== n && \"env\" in n && (e = n.env.DEBUG); return e }, r.useColors = function () { if (\"undefined\" != typeof window && window.process && (\"renderer\" === window.process.type || window.process.__nwjs)) return !0; if (\"undefined\" != typeof navigator && navigator.userAgent && navigator.userAgent.toLowerCase().match(/(edge|trident)\\/(\\d+)/)) return !1; return \"undefined\" != typeof document && document.documentElement && document.documentElement.style && document.documentElement.style.WebkitAppearance || \"undefined\" != typeof window && window.console && (window.console.firebug || window.console.exception && window.console.table) || \"undefined\" != typeof navigator && navigator.userAgent && navigator.userAgent.toLowerCase().match(/firefox\\/(\\d+)/) && parseInt(RegExp.$1, 10) >= 31 || \"undefined\" != typeof navigator && navigator.userAgent && navigator.userAgent.toLowerCase().match(/applewebkit\\/(\\d+)/) }, r.storage = function () { try { return localStorage } catch (e) { } }(), r.destroy = (() => { let e = !1; return () => { e || (e = !0, console.warn(\"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.\")) } })(), r.colors = [\"#0000CC\", \"#0000FF\", \"#0033CC\", \"#0033FF\", \"#0066CC\", \"#0066FF\", \"#0099CC\", \"#0099FF\", \"#00CC00\", \"#00CC33\", \"#00CC66\", \"#00CC99\", \"#00CCCC\", \"#00CCFF\", \"#3300CC\", \"#3300FF\", \"#3333CC\", \"#3333FF\", \"#3366CC\", \"#3366FF\", \"#3399CC\", \"#3399FF\", \"#33CC00\", \"#33CC33\", \"#33CC66\", \"#33CC99\", \"#33CCCC\", \"#33CCFF\", \"#6600CC\", \"#6600FF\", \"#6633CC\", \"#6633FF\", \"#66CC00\", \"#66CC33\", \"#9900CC\", \"#9900FF\", \"#9933CC\", \"#9933FF\", \"#99CC00\", \"#99CC33\", \"#CC0000\", \"#CC0033\", \"#CC0066\", \"#CC0099\", \"#CC00CC\", \"#CC00FF\", \"#CC3300\", \"#CC3333\", \"#CC3366\", \"#CC3399\", \"#CC33CC\", \"#CC33FF\", \"#CC6600\", \"#CC6633\", \"#CC9900\", \"#CC9933\", \"#CCCC00\", \"#CCCC33\", \"#FF0000\", \"#FF0033\", \"#FF0066\", \"#FF0099\", \"#FF00CC\", \"#FF00FF\", \"#FF3300\", \"#FF3333\", \"#FF3366\", \"#FF3399\", \"#FF33CC\", \"#FF33FF\", \"#FF6600\", \"#FF6633\", \"#FF9900\", \"#FF9933\", \"#FFCC00\", \"#FFCC33\"], r.log = console.debug || console.log || (() => { }), t.exports = e(\"./common\")(r); const { formatters: i } = t.exports; i.j = function (e) { try { return JSON.stringify(e) } catch (e) { return \"[UnexpectedJSONParseError]: \" + e.message } } }).call(this) }).call(this, e(\"_process\")) }, { \"./common\": 17, _process: 46 }], 17: [function (e, t, r) { t.exports = function (t) { function r(e) { let t, i = null; function o(...e) { if (!o.enabled) return; const n = o, i = Number(new Date), s = i - (t || i); n.diff = s, n.prev = t, n.curr = i, t = i, e[0] = r.coerce(e[0]), \"string\" != typeof e[0] && e.unshift(\"%O\"); let a = 0; e[0] = e[0].replace(/%([a-zA-Z%])/g, (t, i) => { if (\"%%\" === t) return \"%\"; a++; const o = r.formatters[i]; if (\"function\" == typeof o) { const r = e[a]; t = o.call(n, r), e.splice(a, 1), a-- } return t }), r.formatArgs.call(n, e), (n.log || r.log).apply(n, e) } return o.namespace = e, o.useColors = r.useColors(), o.color = r.selectColor(e), o.extend = n, o.destroy = r.destroy, Object.defineProperty(o, \"enabled\", { enumerable: !0, configurable: !1, get: () => null === i ? r.enabled(e) : i, set: e => { i = e } }), \"function\" == typeof r.init && r.init(o), o } function n(e, t) { const n = r(this.namespace + (void 0 === t ? \":\" : t) + e); return n.log = this.log, n } function i(e) { return e.toString().substring(2, e.toString().length - 2).replace(/\\.\\*\\?$/, \"*\") } return r.debug = r, r.default = r, r.coerce = function (e) { return e instanceof Error ? e.stack || e.message : e }, r.disable = function () { const e = [...r.names.map(i), ...r.skips.map(i).map(e => \"-\" + e)].join(\",\"); return r.enable(\"\"), e }, r.enable = function (e) { let t; r.save(e), r.names = [], r.skips = []; const n = (\"string\" == typeof e ? e : \"\").split(/[\\s,]+/), i = n.length; for (t = 0; t < i; t++)n[t] && (\"-\" === (e = n[t].replace(/\\*/g, \".*?\"))[0] ? r.skips.push(new RegExp(\"^\" + e.substr(1) + \"$\")) : r.names.push(new RegExp(\"^\" + e + \"$\"))) }, r.enabled = function (e) { if (\"*\" === e[e.length - 1]) return !0; let t, n; for (t = 0, n = r.skips.length; t < n; t++)if (r.skips[t].test(e)) return !1; for (t = 0, n = r.names.length; t < n; t++)if (r.names[t].test(e)) return !0; return !1 }, r.humanize = e(\"ms\"), r.destroy = function () { console.warn(\"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.\") }, Object.keys(t).forEach(e => { r[e] = t[e] }), r.names = [], r.skips = [], r.formatters = {}, r.selectColor = function (e) { let t = 0; for (let r = 0; r < e.length; r++)t = (t << 5) - t + e.charCodeAt(r), t |= 0; return r.colors[Math.abs(t) % r.colors.length] }, r.enable(r.load()), r } }, { ms: 43 }], 18: [function (e, t, r) { (function (r, n) { (function () { var i = e(\"readable-stream\"), o = e(\"end-of-stream\"), s = e(\"inherits\"), a = e(\"stream-shift\"), u = n.from && n.from !== Uint8Array.from ? n.from([0]) : new n([0]), c = function (e, t) { e._corked ? e.once(\"uncork\", t) : t() }, l = function (e, t) { return function (r) { r ? function (e, t) { e._autoDestroy && e.destroy(t) }(e, \"premature close\" === r.message ? null : r) : t && !e._ended && e.end() } }, f = function (e, t, r) { if (!(this instanceof f)) return new f(e, t, r); i.Duplex.call(this, r), this._writable = null, this._readable = null, this._readable2 = null, this._autoDestroy = !r || !1 !== r.autoDestroy, this._forwardDestroy = !r || !1 !== r.destroy, this._forwardEnd = !r || !1 !== r.end, this._corked = 1, this._ondrain = null, this._drained = !1, this._forwarding = !1, this._unwrite = null, this._unread = null, this._ended = !1, this.destroyed = !1, e && this.setWritable(e), t && this.setReadable(t) }; s(f, i.Duplex), f.obj = function (e, t, r) { return r || (r = {}), r.objectMode = !0, r.highWaterMark = 16, new f(e, t, r) }, f.prototype.cork = function () { 1 == ++this._corked && this.emit(\"cork\") }, f.prototype.uncork = function () { this._corked && 0 == --this._corked && this.emit(\"uncork\") }, f.prototype.setWritable = function (e) { if (this._unwrite && this._unwrite(), this.destroyed) e && e.destroy && e.destroy(); else if (null !== e && !1 !== e) { var t = this, n = o(e, { writable: !0, readable: !1 }, l(this, this._forwardEnd)), i = function () { var e = t._ondrain; t._ondrain = null, e && e() }; this._unwrite && r.nextTick(i), this._writable = e, this._writable.on(\"drain\", i), this._unwrite = function () { t._writable.removeListener(\"drain\", i), n() }, this.uncork() } else this.end() }, f.prototype.setReadable = function (e) { if (this._unread && this._unread(), this.destroyed) e && e.destroy && e.destroy(); else { if (null === e || !1 === e) return this.push(null), void this.resume(); var t, r = this, n = o(e, { writable: !1, readable: !0 }, l(this)), s = function () { r._forward() }, a = function () { r.push(null) }; this._drained = !0, this._readable = e, this._readable2 = e._readableState ? e : (t = e, new i.Readable({ objectMode: !0, highWaterMark: 16 }).wrap(t)), this._readable2.on(\"readable\", s), this._readable2.on(\"end\", a), this._unread = function () { r._readable2.removeListener(\"readable\", s), r._readable2.removeListener(\"end\", a), n() }, this._forward() } }, f.prototype._read = function () { this._drained = !0, this._forward() }, f.prototype._forward = function () { if (!this._forwarding && this._readable2 && this._drained) { var e; for (this._forwarding = !0; this._drained && null !== (e = a(this._readable2));)this.destroyed || (this._drained = this.push(e)); this._forwarding = !1 } }, f.prototype.destroy = function (e) { if (!this.destroyed) { this.destroyed = !0; var t = this; r.nextTick(function () { t._destroy(e) }) } }, f.prototype._destroy = function (e) { if (e) { var t = this._ondrain; this._ondrain = null, t ? t(e) : this.emit(\"error\", e) } this._forwardDestroy && (this._readable && this._readable.destroy && this._readable.destroy(), this._writable && this._writable.destroy && this._writable.destroy()), this.emit(\"close\") }, f.prototype._write = function (e, t, r) { return this.destroyed ? r() : this._corked ? c(this, this._write.bind(this, e, t, r)) : e === u ? this._finish(r) : this._writable ? void (!1 === this._writable.write(e) ? this._ondrain = r : r()) : r() }, f.prototype._finish = function (e) { var t = this; this.emit(\"preend\"), c(this, function () { var r, n; r = t._forwardEnd && t._writable, n = function () { !1 === t._writableState.prefinished && (t._writableState.prefinished = !0), t.emit(\"prefinish\"), c(t, e) }, r ? r._writableState && r._writableState.finished ? n() : r._writableState ? r.end(n) : (r.end(), n()) : n() }) }, f.prototype.end = function (e, t, r) { return \"function\" == typeof e ? this.end(null, null, e) : \"function\" == typeof t ? this.end(e, null, t) : (this._ended = !0, e && this.write(e), this._writableState.ending || this.write(u), i.Writable.prototype.end.call(this, r)) }, t.exports = f }).call(this) }).call(this, e(\"_process\"), e(\"buffer\").Buffer) }, { _process: 46, buffer: 14, \"end-of-stream\": 30, inherits: 33, \"readable-stream\": 27, \"stream-shift\": 68 }], 19: [function (e, t, r) { \"use strict\"; var n = e(\"process-nextick-args\"), i = Object.keys || function (e) { var t = []; for (var r in e) t.push(r); return t }; t.exports = f; var o = Object.create(e(\"core-util-is\")); o.inherits = e(\"inherits\"); var s = e(\"./_stream_readable\"), a = e(\"./_stream_writable\"); o.inherits(f, s); for (var u = i(a.prototype), c = 0; c < u.length; c++) { var l = u[c]; f.prototype[l] || (f.prototype[l] = a.prototype[l]) } function f(e) { if (!(this instanceof f)) return new f(e); s.call(this, e), a.call(this, e), e && !1 === e.readable && (this.readable = !1), e && !1 === e.writable && (this.writable = !1), this.allowHalfOpen = !0, e && !1 === e.allowHalfOpen && (this.allowHalfOpen = !1), this.once(\"end\", h) } function h() { this.allowHalfOpen || this._writableState.ended || n.nextTick(p, this) } function p(e) { e.end() } Object.defineProperty(f.prototype, \"writableHighWaterMark\", { enumerable: !1, get: function () { return this._writableState.highWaterMark } }), Object.defineProperty(f.prototype, \"destroyed\", { get: function () { return void 0 !== this._readableState && void 0 !== this._writableState && (this._readableState.destroyed && this._writableState.destroyed) }, set: function (e) { void 0 !== this._readableState && void 0 !== this._writableState && (this._readableState.destroyed = e, this._writableState.destroyed = e) } }), f.prototype._destroy = function (e, t) { this.push(null), this.end(), n.nextTick(t, e) } }, { \"./_stream_readable\": 21, \"./_stream_writable\": 23, \"core-util-is\": 15, inherits: 33, \"process-nextick-args\": 45 }], 20: [function (e, t, r) { \"use strict\"; t.exports = o; var n = e(\"./_stream_transform\"), i = Object.create(e(\"core-util-is\")); function o(e) { if (!(this instanceof o)) return new o(e); n.call(this, e) } i.inherits = e(\"inherits\"), i.inherits(o, n), o.prototype._transform = function (e, t, r) { r(null, e) } }, { \"./_stream_transform\": 22, \"core-util-is\": 15, inherits: 33 }], 21: [function (e, t, r) { (function (r, n) { (function () { \"use strict\"; var i = e(\"process-nextick-args\"); t.exports = _; var o, s = e(\"isarray\"); _.ReadableState = y; e(\"events\").EventEmitter; var a = function (e, t) { return e.listeners(t).length }, u = e(\"./internal/streams/stream\"), c = e(\"safe-buffer\").Buffer, l = n.Uint8Array || function () { }; var f = Object.create(e(\"core-util-is\")); f.inherits = e(\"inherits\"); var h = e(\"util\"), p = void 0; p = h && h.debuglog ? h.debuglog(\"stream\") : function () { }; var d, g = e(\"./internal/streams/BufferList\"), b = e(\"./internal/streams/destroy\"); f.inherits(_, u); var m = [\"error\", \"close\", \"destroy\", \"pause\", \"resume\"]; function y(t, r) { o = o || e(\"./_stream_duplex\"), t = t || {}; var n = r instanceof o; this.objectMode = !!t.objectMode, n && (this.objectMode = this.objectMode || !!t.readableObjectMode); var i = t.highWaterMark, s = t.readableHighWaterMark, a = this.objectMode ? 16 : 16384; this.highWaterMark = i || 0 === i ? i : n && (s || 0 === s) ? s : a, this.highWaterMark = Math.floor(this.highWaterMark), this.buffer = new g, this.length = 0, this.pipes = null, this.pipesCount = 0, this.flowing = null, this.ended = !1, this.endEmitted = !1, this.reading = !1, this.sync = !0, this.needReadable = !1, this.emittedReadable = !1, this.readableListening = !1, this.resumeScheduled = !1, this.destroyed = !1, this.defaultEncoding = t.defaultEncoding || \"utf8\", this.awaitDrain = 0, this.readingMore = !1, this.decoder = null, this.encoding = null, t.encoding && (d || (d = e(\"string_decoder/\").StringDecoder), this.decoder = new d(t.encoding), this.encoding = t.encoding) } function _(t) { if (o = o || e(\"./_stream_duplex\"), !(this instanceof _)) return new _(t); this._readableState = new y(t, this), this.readable = !0, t && (\"function\" == typeof t.read && (this._read = t.read), \"function\" == typeof t.destroy && (this._destroy = t.destroy)), u.call(this) } function w(e, t, r, n, i) { var o, s = e._readableState; null === t ? (s.reading = !1, function (e, t) { if (t.ended) return; if (t.decoder) { var r = t.decoder.end(); r && r.length && (t.buffer.push(r), t.length += t.objectMode ? 1 : r.length) } t.ended = !0, k(e) }(e, s)) : (i || (o = function (e, t) { var r; n = t, c.isBuffer(n) || n instanceof l || \"string\" == typeof t || void 0 === t || e.objectMode || (r = new TypeError(\"Invalid non-string/buffer chunk\")); var n; return r }(s, t)), o ? e.emit(\"error\", o) : s.objectMode || t && t.length > 0 ? (\"string\" == typeof t || s.objectMode || Object.getPrototypeOf(t) === c.prototype || (t = function (e) { return c.from(e) }(t)), n ? s.endEmitted ? e.emit(\"error\", new Error(\"stream.unshift() after end event\")) : v(e, s, t, !0) : s.ended ? e.emit(\"error\", new Error(\"stream.push() after EOF\")) : (s.reading = !1, s.decoder && !r ? (t = s.decoder.write(t), s.objectMode || 0 !== t.length ? v(e, s, t, !1) : C(e, s)) : v(e, s, t, !1))) : n || (s.reading = !1)); return function (e) { return !e.ended && (e.needReadable || e.length < e.highWaterMark || 0 === e.length) }(s) } function v(e, t, r, n) { t.flowing && 0 === t.length && !t.sync ? (e.emit(\"data\", r), e.read(0)) : (t.length += t.objectMode ? 1 : r.length, n ? t.buffer.unshift(r) : t.buffer.push(r), t.needReadable && k(e)), C(e, t) } Object.defineProperty(_.prototype, \"destroyed\", { get: function () { return void 0 !== this._readableState && this._readableState.destroyed }, set: function (e) { this._readableState && (this._readableState.destroyed = e) } }), _.prototype.destroy = b.destroy, _.prototype._undestroy = b.undestroy, _.prototype._destroy = function (e, t) { this.push(null), t(e) }, _.prototype.push = function (e, t) { var r, n = this._readableState; return n.objectMode ? r = !0 : \"string\" == typeof e && ((t = t || n.defaultEncoding) !== n.encoding && (e = c.from(e, t), t = \"\"), r = !0), w(this, e, t, !1, r) }, _.prototype.unshift = function (e) { return w(this, e, null, !0, !1) }, _.prototype.isPaused = function () { return !1 === this._readableState.flowing }, _.prototype.setEncoding = function (t) { return d || (d = e(\"string_decoder/\").StringDecoder), this._readableState.decoder = new d(t), this._readableState.encoding = t, this }; var S = 8388608; function E(e, t) { return e <= 0 || 0 === t.length && t.ended ? 0 : t.objectMode ? 1 : e != e ? t.flowing && t.length ? t.buffer.head.data.length : t.length : (e > t.highWaterMark && (t.highWaterMark = function (e) { return e >= S ? e = S : (e-- , e |= e >>> 1, e |= e >>> 2, e |= e >>> 4, e |= e >>> 8, e |= e >>> 16, e++), e }(e)), e <= t.length ? e : t.ended ? t.length : (t.needReadable = !0, 0)) } function k(e) { var t = e._readableState; t.needReadable = !1, t.emittedReadable || (p(\"emitReadable\", t.flowing), t.emittedReadable = !0, t.sync ? i.nextTick(I, e) : I(e)) } function I(e) { p(\"emit readable\"), e.emit(\"readable\"), A(e) } function C(e, t) { t.readingMore || (t.readingMore = !0, i.nextTick(T, e, t)) } function T(e, t) { for (var r = t.length; !t.reading && !t.flowing && !t.ended && t.length < t.highWaterMark && (p(\"maybeReadMore read 0\"), e.read(0), r !== t.length);)r = t.length; t.readingMore = !1 } function x(e) { p(\"readable nexttick read 0\"), e.read(0) } function R(e, t) { t.reading || (p(\"resume read 0\"), e.read(0)), t.resumeScheduled = !1, t.awaitDrain = 0, e.emit(\"resume\"), A(e), t.flowing && !t.reading && e.read(0) } function A(e) { var t = e._readableState; for (p(\"flow\", t.flowing); t.flowing && null !== e.read();); } function M(e, t) { return 0 === t.length ? null : (t.objectMode ? r = t.buffer.shift() : !e || e >= t.length ? (r = t.decoder ? t.buffer.join(\"\") : 1 === t.buffer.length ? t.buffer.head.data : t.buffer.concat(t.length), t.buffer.clear()) : r = function (e, t, r) { var n; e < t.head.data.length ? (n = t.head.data.slice(0, e), t.head.data = t.head.data.slice(e)) : n = e === t.head.data.length ? t.shift() : r ? function (e, t) { var r = t.head, n = 1, i = r.data; e -= i.length; for (; r = r.next;) { var o = r.data, s = e > o.length ? o.length : e; if (s === o.length ? i += o : i += o.slice(0, e), 0 === (e -= s)) { s === o.length ? (++n, r.next ? t.head = r.next : t.head = t.tail = null) : (t.head = r, r.data = o.slice(s)); break } ++n } return t.length -= n, i }(e, t) : function (e, t) { var r = c.allocUnsafe(e), n = t.head, i = 1; n.data.copy(r), e -= n.data.length; for (; n = n.next;) { var o = n.data, s = e > o.length ? o.length : e; if (o.copy(r, r.length - e, 0, s), 0 === (e -= s)) { s === o.length ? (++i, n.next ? t.head = n.next : t.head = t.tail = null) : (t.head = n, n.data = o.slice(s)); break } ++i } return t.length -= i, r }(e, t); return n }(e, t.buffer, t.decoder), r); var r } function O(e) { var t = e._readableState; if (t.length > 0) throw new Error('\"endReadable()\" called on non-empty stream'); t.endEmitted || (t.ended = !0, i.nextTick(P, t, e)) } function P(e, t) { e.endEmitted || 0 !== e.length || (e.endEmitted = !0, t.readable = !1, t.emit(\"end\")) } function B(e, t) { for (var r = 0, n = e.length; r < n; r++)if (e[r] === t) return r; return -1 } _.prototype.read = function (e) { p(\"read\", e), e = parseInt(e, 10); var t = this._readableState, r = e; if (0 !== e && (t.emittedReadable = !1), 0 === e && t.needReadable && (t.length >= t.highWaterMark || t.ended)) return p(\"read: emitReadable\", t.length, t.ended), 0 === t.length && t.ended ? O(this) : k(this), null; if (0 === (e = E(e, t)) && t.ended) return 0 === t.length && O(this), null; var n, i = t.needReadable; return p(\"need readable\", i), (0 === t.length || t.length - e < t.highWaterMark) && p(\"length less than watermark\", i = !0), t.ended || t.reading ? p(\"reading or ended\", i = !1) : i && (p(\"do read\"), t.reading = !0, t.sync = !0, 0 === t.length && (t.needReadable = !0), this._read(t.highWaterMark), t.sync = !1, t.reading || (e = E(r, t))), null === (n = e > 0 ? M(e, t) : null) ? (t.needReadable = !0, e = 0) : t.length -= e, 0 === t.length && (t.ended || (t.needReadable = !0), r !== e && t.ended && O(this)), null !== n && this.emit(\"data\", n), n }, _.prototype._read = function (e) { this.emit(\"error\", new Error(\"_read() is not implemented\")) }, _.prototype.pipe = function (e, t) { var n = this, o = this._readableState; switch (o.pipesCount) { case 0: o.pipes = e; break; case 1: o.pipes = [o.pipes, e]; break; default: o.pipes.push(e) }o.pipesCount += 1, p(\"pipe count=%d opts=%j\", o.pipesCount, t); var u = (!t || !1 !== t.end) && e !== r.stdout && e !== r.stderr ? l : _; function c(t, r) { p(\"onunpipe\"), t === n && r && !1 === r.hasUnpiped && (r.hasUnpiped = !0, p(\"cleanup\"), e.removeListener(\"close\", m), e.removeListener(\"finish\", y), e.removeListener(\"drain\", f), e.removeListener(\"error\", b), e.removeListener(\"unpipe\", c), n.removeListener(\"end\", l), n.removeListener(\"end\", _), n.removeListener(\"data\", g), h = !0, !o.awaitDrain || e._writableState && !e._writableState.needDrain || f()) } function l() { p(\"onend\"), e.end() } o.endEmitted ? i.nextTick(u) : n.once(\"end\", u), e.on(\"unpipe\", c); var f = function (e) { return function () { var t = e._readableState; p(\"pipeOnDrain\", t.awaitDrain), t.awaitDrain && t.awaitDrain-- , 0 === t.awaitDrain && a(e, \"data\") && (t.flowing = !0, A(e)) } }(n); e.on(\"drain\", f); var h = !1; var d = !1; function g(t) { p(\"ondata\"), d = !1, !1 !== e.write(t) || d || ((1 === o.pipesCount && o.pipes === e || o.pipesCount > 1 && -1 !== B(o.pipes, e)) && !h && (p(\"false write response, pause\", n._readableState.awaitDrain), n._readableState.awaitDrain++ , d = !0), n.pause()) } function b(t) { p(\"onerror\", t), _(), e.removeListener(\"error\", b), 0 === a(e, \"error\") && e.emit(\"error\", t) } function m() { e.removeListener(\"finish\", y), _() } function y() { p(\"onfinish\"), e.removeListener(\"close\", m), _() } function _() { p(\"unpipe\"), n.unpipe(e) } return n.on(\"data\", g), function (e, t, r) { if (\"function\" == typeof e.prependListener) return e.prependListener(t, r); e._events && e._events[t] ? s(e._events[t]) ? e._events[t].unshift(r) : e._events[t] = [r, e._events[t]] : e.on(t, r) }(e, \"error\", b), e.once(\"close\", m), e.once(\"finish\", y), e.emit(\"pipe\", n), o.flowing || (p(\"pipe resume\"), n.resume()), e }, _.prototype.unpipe = function (e) { var t = this._readableState, r = { hasUnpiped: !1 }; if (0 === t.pipesCount) return this; if (1 === t.pipesCount) return e && e !== t.pipes ? this : (e || (e = t.pipes), t.pipes = null, t.pipesCount = 0, t.flowing = !1, e && e.emit(\"unpipe\", this, r), this); if (!e) { var n = t.pipes, i = t.pipesCount; t.pipes = null, t.pipesCount = 0, t.flowing = !1; for (var o = 0; o < i; o++)n[o].emit(\"unpipe\", this, r); return this } var s = B(t.pipes, e); return -1 === s ? this : (t.pipes.splice(s, 1), t.pipesCount -= 1, 1 === t.pipesCount && (t.pipes = t.pipes[0]), e.emit(\"unpipe\", this, r), this) }, _.prototype.on = function (e, t) { var r = u.prototype.on.call(this, e, t); if (\"data\" === e) !1 !== this._readableState.flowing && this.resume(); else if (\"readable\" === e) { var n = this._readableState; n.endEmitted || n.readableListening || (n.readableListening = n.needReadable = !0, n.emittedReadable = !1, n.reading ? n.length && k(this) : i.nextTick(x, this)) } return r }, _.prototype.addListener = _.prototype.on, _.prototype.resume = function () { var e = this._readableState; return e.flowing || (p(\"resume\"), e.flowing = !0, function (e, t) { t.resumeScheduled || (t.resumeScheduled = !0, i.nextTick(R, e, t)) }(this, e)), this }, _.prototype.pause = function () { return p(\"call pause flowing=%j\", this._readableState.flowing), !1 !== this._readableState.flowing && (p(\"pause\"), this._readableState.flowing = !1, this.emit(\"pause\")), this }, _.prototype.wrap = function (e) { var t = this, r = this._readableState, n = !1; for (var i in e.on(\"end\", function () { if (p(\"wrapped end\"), r.decoder && !r.ended) { var e = r.decoder.end(); e && e.length && t.push(e) } t.push(null) }), e.on(\"data\", function (i) { (p(\"wrapped data\"), r.decoder && (i = r.decoder.write(i)), !r.objectMode || null !== i && void 0 !== i) && ((r.objectMode || i && i.length) && (t.push(i) || (n = !0, e.pause()))) }), e) void 0 === this[i] && \"function\" == typeof e[i] && (this[i] = function (t) { return function () { return e[t].apply(e, arguments) } }(i)); for (var o = 0; o < m.length; o++)e.on(m[o], this.emit.bind(this, m[o])); return this._read = function (t) { p(\"wrapped _read\", t), n && (n = !1, e.resume()) }, this }, Object.defineProperty(_.prototype, \"readableHighWaterMark\", { enumerable: !1, get: function () { return this._readableState.highWaterMark } }), _._fromList = M }).call(this) }).call(this, e(\"_process\"), \"undefined\" != typeof global ? global : \"undefined\" != typeof self ? self : \"undefined\" != typeof window ? window : {}) }, { \"./_stream_duplex\": 19, \"./internal/streams/BufferList\": 24, \"./internal/streams/destroy\": 25, \"./internal/streams/stream\": 26, _process: 46, \"core-util-is\": 15, events: 31, inherits: 33, isarray: 35, \"process-nextick-args\": 45, \"safe-buffer\": 28, \"string_decoder/\": 29, util: 13 }], 22: [function (e, t, r) { \"use strict\"; t.exports = o; var n = e(\"./_stream_duplex\"), i = Object.create(e(\"core-util-is\")); function o(e) { if (!(this instanceof o)) return new o(e); n.call(this, e), this._transformState = { afterTransform: function (e, t) { var r = this._transformState; r.transforming = !1; var n = r.writecb; if (!n) return this.emit(\"error\", new Error(\"write callback called multiple times\")); r.writechunk = null, r.writecb = null, null != t && this.push(t), n(e); var i = this._readableState; i.reading = !1, (i.needReadable || i.length < i.highWaterMark) && this._read(i.highWaterMark) }.bind(this), needTransform: !1, transforming: !1, writecb: null, writechunk: null, writeencoding: null }, this._readableState.needReadable = !0, this._readableState.sync = !1, e && (\"function\" == typeof e.transform && (this._transform = e.transform), \"function\" == typeof e.flush && (this._flush = e.flush)), this.on(\"prefinish\", s) } function s() { var e = this; \"function\" == typeof this._flush ? this._flush(function (t, r) { a(e, t, r) }) : a(this, null, null) } function a(e, t, r) { if (t) return e.emit(\"error\", t); if (null != r && e.push(r), e._writableState.length) throw new Error(\"Calling transform done when ws.length != 0\"); if (e._transformState.transforming) throw new Error(\"Calling transform done when still transforming\"); return e.push(null) } i.inherits = e(\"inherits\"), i.inherits(o, n), o.prototype.push = function (e, t) { return this._transformState.needTransform = !1, n.prototype.push.call(this, e, t) }, o.prototype._transform = function (e, t, r) { throw new Error(\"_transform() is not implemented\") }, o.prototype._write = function (e, t, r) { var n = this._transformState; if (n.writecb = r, n.writechunk = e, n.writeencoding = t, !n.transforming) { var i = this._readableState; (n.needTransform || i.needReadable || i.length < i.highWaterMark) && this._read(i.highWaterMark) } }, o.prototype._read = function (e) { var t = this._transformState; null !== t.writechunk && t.writecb && !t.transforming ? (t.transforming = !0, this._transform(t.writechunk, t.writeencoding, t.afterTransform)) : t.needTransform = !0 }, o.prototype._destroy = function (e, t) { var r = this; n.prototype._destroy.call(this, e, function (e) { t(e), r.emit(\"close\") }) } }, { \"./_stream_duplex\": 19, \"core-util-is\": 15, inherits: 33 }], 23: [function (e, t, r) { (function (r, n, i) { (function () { \"use strict\"; var o = e(\"process-nextick-args\"); function s(e) { var t = this; this.next = null, this.entry = null, this.finish = function () { !function (e, t, r) { var n = e.entry; e.entry = null; for (; n;) { var i = n.callback; t.pendingcb-- , i(r), n = n.next } t.corkedRequestsFree ? t.corkedRequestsFree.next = e : t.corkedRequestsFree = e }(t, e) } } t.exports = y; var a, u = !r.browser && [\"v0.10\", \"v0.9.\"].indexOf(r.version.slice(0, 5)) > -1 ? i : o.nextTick; y.WritableState = m; var c = Object.create(e(\"core-util-is\")); c.inherits = e(\"inherits\"); var l = { deprecate: e(\"util-deprecate\") }, f = e(\"./internal/streams/stream\"), h = e(\"safe-buffer\").Buffer, p = n.Uint8Array || function () { }; var d, g = e(\"./internal/streams/destroy\"); function b() { } function m(t, r) { a = a || e(\"./_stream_duplex\"), t = t || {}; var n = r instanceof a; this.objectMode = !!t.objectMode, n && (this.objectMode = this.objectMode || !!t.writableObjectMode); var i = t.highWaterMark, c = t.writableHighWaterMark, l = this.objectMode ? 16 : 16384; this.highWaterMark = i || 0 === i ? i : n && (c || 0 === c) ? c : l, this.highWaterMark = Math.floor(this.highWaterMark), this.finalCalled = !1, this.needDrain = !1, this.ending = !1, this.ended = !1, this.finished = !1, this.destroyed = !1; var f = !1 === t.decodeStrings; this.decodeStrings = !f, this.defaultEncoding = t.defaultEncoding || \"utf8\", this.length = 0, this.writing = !1, this.corked = 0, this.sync = !0, this.bufferProcessing = !1, this.onwrite = function (e) { !function (e, t) { var r = e._writableState, n = r.sync, i = r.writecb; if (function (e) { e.writing = !1, e.writecb = null, e.length -= e.writelen, e.writelen = 0 }(r), t) !function (e, t, r, n, i) { --t.pendingcb, r ? (o.nextTick(i, n), o.nextTick(k, e, t), e._writableState.errorEmitted = !0, e.emit(\"error\", n)) : (i(n), e._writableState.errorEmitted = !0, e.emit(\"error\", n), k(e, t)) }(e, r, n, t, i); else { var s = S(r); s || r.corked || r.bufferProcessing || !r.bufferedRequest || v(e, r), n ? u(w, e, r, s, i) : w(e, r, s, i) } }(r, e) }, this.writecb = null, this.writelen = 0, this.bufferedRequest = null, this.lastBufferedRequest = null, this.pendingcb = 0, this.prefinished = !1, this.errorEmitted = !1, this.bufferedRequestCount = 0, this.corkedRequestsFree = new s(this) } function y(t) { if (a = a || e(\"./_stream_duplex\"), !(d.call(y, this) || this instanceof a)) return new y(t); this._writableState = new m(t, this), this.writable = !0, t && (\"function\" == typeof t.write && (this._write = t.write), \"function\" == typeof t.writev && (this._writev = t.writev), \"function\" == typeof t.destroy && (this._destroy = t.destroy), \"function\" == typeof t.final && (this._final = t.final)), f.call(this) } function _(e, t, r, n, i, o, s) { t.writelen = n, t.writecb = s, t.writing = !0, t.sync = !0, r ? e._writev(i, t.onwrite) : e._write(i, o, t.onwrite), t.sync = !1 } function w(e, t, r, n) { r || function (e, t) { 0 === t.length && t.needDrain && (t.needDrain = !1, e.emit(\"drain\")) }(e, t), t.pendingcb-- , n(), k(e, t) } function v(e, t) { t.bufferProcessing = !0; var r = t.bufferedRequest; if (e._writev && r && r.next) { var n = t.bufferedRequestCount, i = new Array(n), o = t.corkedRequestsFree; o.entry = r; for (var a = 0, u = !0; r;)i[a] = r, r.isBuf || (u = !1), r = r.next, a += 1; i.allBuffers = u, _(e, t, !0, t.length, i, \"\", o.finish), t.pendingcb++ , t.lastBufferedRequest = null, o.next ? (t.corkedRequestsFree = o.next, o.next = null) : t.corkedRequestsFree = new s(t), t.bufferedRequestCount = 0 } else { for (; r;) { var c = r.chunk, l = r.encoding, f = r.callback; if (_(e, t, !1, t.objectMode ? 1 : c.length, c, l, f), r = r.next, t.bufferedRequestCount-- , t.writing) break } null === r && (t.lastBufferedRequest = null) } t.bufferedRequest = r, t.bufferProcessing = !1 } function S(e) { return e.ending && 0 === e.length && null === e.bufferedRequest && !e.finished && !e.writing } function E(e, t) { e._final(function (r) { t.pendingcb-- , r && e.emit(\"error\", r), t.prefinished = !0, e.emit(\"prefinish\"), k(e, t) }) } function k(e, t) { var r = S(t); return r && (!function (e, t) { t.prefinished || t.finalCalled || (\"function\" == typeof e._final ? (t.pendingcb++ , t.finalCalled = !0, o.nextTick(E, e, t)) : (t.prefinished = !0, e.emit(\"prefinish\"))) }(e, t), 0 === t.pendingcb && (t.finished = !0, e.emit(\"finish\"))), r } c.inherits(y, f), m.prototype.getBuffer = function () { for (var e = this.bufferedRequest, t = []; e;)t.push(e), e = e.next; return t }, function () { try { Object.defineProperty(m.prototype, \"buffer\", { get: l.deprecate(function () { return this.getBuffer() }, \"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.\", \"DEP0003\") }) } catch (e) { } }(), \"function\" == typeof Symbol && Symbol.hasInstance && \"function\" == typeof Function.prototype[Symbol.hasInstance] ? (d = Function.prototype[Symbol.hasInstance], Object.defineProperty(y, Symbol.hasInstance, { value: function (e) { return !!d.call(this, e) || this === y && (e && e._writableState instanceof m) } })) : d = function (e) { return e instanceof this }, y.prototype.pipe = function () { this.emit(\"error\", new Error(\"Cannot pipe, not readable\")) }, y.prototype.write = function (e, t, r) { var n, i = this._writableState, s = !1, a = !i.objectMode && (n = e, h.isBuffer(n) || n instanceof p); return a && !h.isBuffer(e) && (e = function (e) { return h.from(e) }(e)), \"function\" == typeof t && (r = t, t = null), a ? t = \"buffer\" : t || (t = i.defaultEncoding), \"function\" != typeof r && (r = b), i.ended ? function (e, t) { var r = new Error(\"write after end\"); e.emit(\"error\", r), o.nextTick(t, r) }(this, r) : (a || function (e, t, r, n) { var i = !0, s = !1; return null === r ? s = new TypeError(\"May not write null values to stream\") : \"string\" == typeof r || void 0 === r || t.objectMode || (s = new TypeError(\"Invalid non-string/buffer chunk\")), s && (e.emit(\"error\", s), o.nextTick(n, s), i = !1), i }(this, i, e, r)) && (i.pendingcb++ , s = function (e, t, r, n, i, o) { if (!r) { var s = function (e, t, r) { e.objectMode || !1 === e.decodeStrings || \"string\" != typeof t || (t = h.from(t, r)); return t }(t, n, i); n !== s && (r = !0, i = \"buffer\", n = s) } var a = t.objectMode ? 1 : n.length; t.length += a; var u = t.length < t.highWaterMark; u || (t.needDrain = !0); if (t.writing || t.corked) { var c = t.lastBufferedRequest; t.lastBufferedRequest = { chunk: n, encoding: i, isBuf: r, callback: o, next: null }, c ? c.next = t.lastBufferedRequest : t.bufferedRequest = t.lastBufferedRequest, t.bufferedRequestCount += 1 } else _(e, t, !1, a, n, i, o); return u }(this, i, a, e, t, r)), s }, y.prototype.cork = function () { this._writableState.corked++ }, y.prototype.uncork = function () { var e = this._writableState; e.corked && (e.corked-- , e.writing || e.corked || e.finished || e.bufferProcessing || !e.bufferedRequest || v(this, e)) }, y.prototype.setDefaultEncoding = function (e) { if (\"string\" == typeof e && (e = e.toLowerCase()), !([\"hex\", \"utf8\", \"utf-8\", \"ascii\", \"binary\", \"base64\", \"ucs2\", \"ucs-2\", \"utf16le\", \"utf-16le\", \"raw\"].indexOf((e + \"\").toLowerCase()) > -1)) throw new TypeError(\"Unknown encoding: \" + e); return this._writableState.defaultEncoding = e, this }, Object.defineProperty(y.prototype, \"writableHighWaterMark\", { enumerable: !1, get: function () { return this._writableState.highWaterMark } }), y.prototype._write = function (e, t, r) { r(new Error(\"_write() is not implemented\")) }, y.prototype._writev = null, y.prototype.end = function (e, t, r) { var n = this._writableState; \"function\" == typeof e ? (r = e, e = null, t = null) : \"function\" == typeof t && (r = t, t = null), null !== e && void 0 !== e && this.write(e, t), n.corked && (n.corked = 1, this.uncork()), n.ending || n.finished || function (e, t, r) { t.ending = !0, k(e, t), r && (t.finished ? o.nextTick(r) : e.once(\"finish\", r)); t.ended = !0, e.writable = !1 }(this, n, r) }, Object.defineProperty(y.prototype, \"destroyed\", { get: function () { return void 0 !== this._writableState && this._writableState.destroyed }, set: function (e) { this._writableState && (this._writableState.destroyed = e) } }), y.prototype.destroy = g.destroy, y.prototype._undestroy = g.undestroy, y.prototype._destroy = function (e, t) { this.end(), t(e) } }).call(this) }).call(this, e(\"_process\"), \"undefined\" != typeof global ? global : \"undefined\" != typeof self ? self : \"undefined\" != typeof window ? window : {}, e(\"timers\").setImmediate) }, { \"./_stream_duplex\": 19, \"./internal/streams/destroy\": 25, \"./internal/streams/stream\": 26, _process: 46, \"core-util-is\": 15, inherits: 33, \"process-nextick-args\": 45, \"safe-buffer\": 28, timers: 70, \"util-deprecate\": 73 }], 24: [function (e, t, r) { \"use strict\"; var n = e(\"safe-buffer\").Buffer, i = e(\"util\"); t.exports = function () { function e() { !function (e, t) { if (!(e instanceof t)) throw new TypeError(\"Cannot call a class as a function\") }(this, e), this.head = null, this.tail = null, this.length = 0 } return e.prototype.push = function (e) { var t = { data: e, next: null }; this.length > 0 ? this.tail.next = t : this.head = t, this.tail = t, ++this.length }, e.prototype.unshift = function (e) { var t = { data: e, next: this.head }; 0 === this.length && (this.tail = t), this.head = t, ++this.length }, e.prototype.shift = function () { if (0 !== this.length) { var e = this.head.data; return 1 === this.length ? this.head = this.tail = null : this.head = this.head.next, --this.length, e } }, e.prototype.clear = function () { this.head = this.tail = null, this.length = 0 }, e.prototype.join = function (e) { if (0 === this.length) return \"\"; for (var t = this.head, r = \"\" + t.data; t = t.next;)r += e + t.data; return r }, e.prototype.concat = function (e) { if (0 === this.length) return n.alloc(0); if (1 === this.length) return this.head.data; for (var t, r, i, o = n.allocUnsafe(e >>> 0), s = this.head, a = 0; s;)t = s.data, r = o, i = a, t.copy(r, i), a += s.data.length, s = s.next; return o }, e }(), i && i.inspect && i.inspect.custom && (t.exports.prototype[i.inspect.custom] = function () { var e = i.inspect({ length: this.length }); return this.constructor.name + \" \" + e }) }, { \"safe-buffer\": 28, util: 13 }], 25: [function (e, t, r) { \"use strict\"; var n = e(\"process-nextick-args\"); function i(e, t) { e.emit(\"error\", t) } t.exports = { destroy: function (e, t) { var r = this, o = this._readableState && this._readableState.destroyed, s = this._writableState && this._writableState.destroyed; return o || s ? (t ? t(e) : !e || this._writableState && this._writableState.errorEmitted || n.nextTick(i, this, e), this) : (this._readableState && (this._readableState.destroyed = !0), this._writableState && (this._writableState.destroyed = !0), this._destroy(e || null, function (e) { !t && e ? (n.nextTick(i, r, e), r._writableState && (r._writableState.errorEmitted = !0)) : t && t(e) }), this) }, undestroy: function () { this._readableState && (this._readableState.destroyed = !1, this._readableState.reading = !1, this._readableState.ended = !1, this._readableState.endEmitted = !1), this._writableState && (this._writableState.destroyed = !1, this._writableState.ended = !1, this._writableState.ending = !1, this._writableState.finished = !1, this._writableState.errorEmitted = !1) } } }, { \"process-nextick-args\": 45 }], 26: [function (e, t, r) { t.exports = e(\"events\").EventEmitter }, { events: 31 }], 27: [function (e, t, r) { (r = t.exports = e(\"./lib/_stream_readable.js\")).Stream = r, r.Readable = r, r.Writable = e(\"./lib/_stream_writable.js\"), r.Duplex = e(\"./lib/_stream_duplex.js\"), r.Transform = e(\"./lib/_stream_transform.js\"), r.PassThrough = e(\"./lib/_stream_passthrough.js\") }, { \"./lib/_stream_duplex.js\": 19, \"./lib/_stream_passthrough.js\": 20, \"./lib/_stream_readable.js\": 21, \"./lib/_stream_transform.js\": 22, \"./lib/_stream_writable.js\": 23 }], 28: [function (e, t, r) { var n = e(\"buffer\"), i = n.Buffer; function o(e, t) { for (var r in e) t[r] = e[r] } function s(e, t, r) { return i(e, t, r) } i.from && i.alloc && i.allocUnsafe && i.allocUnsafeSlow ? t.exports = n : (o(n, r), r.Buffer = s), o(i, s), s.from = function (e, t, r) { if (\"number\" == typeof e) throw new TypeError(\"Argument must not be a number\"); return i(e, t, r) }, s.alloc = function (e, t, r) { if (\"number\" != typeof e) throw new TypeError(\"Argument must be a number\"); var n = i(e); return void 0 !== t ? \"string\" == typeof r ? n.fill(t, r) : n.fill(t) : n.fill(0), n }, s.allocUnsafe = function (e) { if (\"number\" != typeof e) throw new TypeError(\"Argument must be a number\"); return i(e) }, s.allocUnsafeSlow = function (e) { if (\"number\" != typeof e) throw new TypeError(\"Argument must be a number\"); return n.SlowBuffer(e) } }, { buffer: 14 }], 29: [function (e, t, r) { \"use strict\"; var n = e(\"safe-buffer\").Buffer, i = n.isEncoding || function (e) { switch ((e = \"\" + e) && e.toLowerCase()) { case \"hex\": case \"utf8\": case \"utf-8\": case \"ascii\": case \"binary\": case \"base64\": case \"ucs2\": case \"ucs-2\": case \"utf16le\": case \"utf-16le\": case \"raw\": return !0; default: return !1 } }; function o(e) { var t; switch (this.encoding = function (e) { var t = function (e) { if (!e) return \"utf8\"; for (var t; ;)switch (e) { case \"utf8\": case \"utf-8\": return \"utf8\"; case \"ucs2\": case \"ucs-2\": case \"utf16le\": case \"utf-16le\": return \"utf16le\"; case \"latin1\": case \"binary\": return \"latin1\"; case \"base64\": case \"ascii\": case \"hex\": return e; default: if (t) return; e = (\"\" + e).toLowerCase(), t = !0 } }(e); if (\"string\" != typeof t && (n.isEncoding === i || !i(e))) throw new Error(\"Unknown encoding: \" + e); return t || e }(e), this.encoding) { case \"utf16le\": this.text = u, this.end = c, t = 4; break; case \"utf8\": this.fillLast = a, t = 4; break; case \"base64\": this.text = l, this.end = f, t = 3; break; default: return this.write = h, void (this.end = p) }this.lastNeed = 0, this.lastTotal = 0, this.lastChar = n.allocUnsafe(t) } function s(e) { return e <= 127 ? 0 : e >> 5 == 6 ? 2 : e >> 4 == 14 ? 3 : e >> 3 == 30 ? 4 : e >> 6 == 2 ? -1 : -2 } function a(e) { var t = this.lastTotal - this.lastNeed, r = function (e, t, r) { if (128 != (192 & t[0])) return e.lastNeed = 0, \"\"; if (e.lastNeed > 1 && t.length > 1) { if (128 != (192 & t[1])) return e.lastNeed = 1, \"\"; if (e.lastNeed > 2 && t.length > 2 && 128 != (192 & t[2])) return e.lastNeed = 2, \"\" } }(this, e); return void 0 !== r ? r : this.lastNeed <= e.length ? (e.copy(this.lastChar, t, 0, this.lastNeed), this.lastChar.toString(this.encoding, 0, this.lastTotal)) : (e.copy(this.lastChar, t, 0, e.length), void (this.lastNeed -= e.length)) } function u(e, t) { if ((e.length - t) % 2 == 0) { var r = e.toString(\"utf16le\", t); if (r) { var n = r.charCodeAt(r.length - 1); if (n >= 55296 && n <= 56319) return this.lastNeed = 2, this.lastTotal = 4, this.lastChar[0] = e[e.length - 2], this.lastChar[1] = e[e.length - 1], r.slice(0, -1) } return r } return this.lastNeed = 1, this.lastTotal = 2, this.lastChar[0] = e[e.length - 1], e.toString(\"utf16le\", t, e.length - 1) } function c(e) { var t = e && e.length ? this.write(e) : \"\"; if (this.lastNeed) { var r = this.lastTotal - this.lastNeed; return t + this.lastChar.toString(\"utf16le\", 0, r) } return t } function l(e, t) { var r = (e.length - t) % 3; return 0 === r ? e.toString(\"base64\", t) : (this.lastNeed = 3 - r, this.lastTotal = 3, 1 === r ? this.lastChar[0] = e[e.length - 1] : (this.lastChar[0] = e[e.length - 2], this.lastChar[1] = e[e.length - 1]), e.toString(\"base64\", t, e.length - r)) } function f(e) { var t = e && e.length ? this.write(e) : \"\"; return this.lastNeed ? t + this.lastChar.toString(\"base64\", 0, 3 - this.lastNeed) : t } function h(e) { return e.toString(this.encoding) } function p(e) { return e && e.length ? this.write(e) : \"\" } r.StringDecoder = o, o.prototype.write = function (e) { if (0 === e.length) return \"\"; var t, r; if (this.lastNeed) { if (void 0 === (t = this.fillLast(e))) return \"\"; r = this.lastNeed, this.lastNeed = 0 } else r = 0; return r < e.length ? t ? t + this.text(e, r) : this.text(e, r) : t || \"\" }, o.prototype.end = function (e) { var t = e && e.length ? this.write(e) : \"\"; return this.lastNeed ? t + \"\" : t }, o.prototype.text = function (e, t) { var r = function (e, t, r) { var n = t.length - 1; if (n < r) return 0; var i = s(t[n]); if (i >= 0) return i > 0 && (e.lastNeed = i - 1), i; if (--n < r || -2 === i) return 0; if ((i = s(t[n])) >= 0) return i > 0 && (e.lastNeed = i - 2), i; if (--n < r || -2 === i) return 0; if ((i = s(t[n])) >= 0) return i > 0 && (2 === i ? i = 0 : e.lastNeed = i - 3), i; return 0 }(this, e, t); if (!this.lastNeed) return e.toString(\"utf8\", t); this.lastTotal = r; var n = e.length - (r - this.lastNeed); return e.copy(this.lastChar, 0, n), e.toString(\"utf8\", t, n) }, o.prototype.fillLast = function (e) { if (this.lastNeed <= e.length) return e.copy(this.lastChar, this.lastTotal - this.lastNeed, 0, this.lastNeed), this.lastChar.toString(this.encoding, 0, this.lastTotal); e.copy(this.lastChar, this.lastTotal - this.lastNeed, 0, e.length), this.lastNeed -= e.length } }, { \"safe-buffer\": 28 }], 30: [function (e, t, r) { (function (r) { (function () { var n = e(\"once\"), i = function () { }, o = function (e, t, s) { if (\"function\" == typeof t) return o(e, null, t); t || (t = {}), s = n(s || i); var a = e._writableState, u = e._readableState, c = t.readable || !1 !== t.readable && e.readable, l = t.writable || !1 !== t.writable && e.writable, f = !1, h = function () { e.writable || p() }, p = function () { l = !1, c || s.call(e) }, d = function () { c = !1, l || s.call(e) }, g = function (t) { s.call(e, t ? new Error(\"exited with error code: \" + t) : null) }, b = function (t) { s.call(e, t) }, m = function () { r.nextTick(y) }, y = function () { if (!f) return (!c || u && u.ended && !u.destroyed) && (!l || a && a.ended && !a.destroyed) ? void 0 : s.call(e, new Error(\"premature close\")) }, _ = function () { e.req.on(\"finish\", p) }; return !function (e) { return e.setHeader && \"function\" == typeof e.abort }(e) ? l && !a && (e.on(\"end\", h), e.on(\"close\", h)) : (e.on(\"complete\", p), e.on(\"abort\", m), e.req ? _() : e.on(\"request\", _)), function (e) { return e.stdio && Array.isArray(e.stdio) && 3 === e.stdio.length }(e) && e.on(\"exit\", g), e.on(\"end\", d), e.on(\"finish\", p), !1 !== t.error && e.on(\"error\", b), e.on(\"close\", m), function () { f = !0, e.removeListener(\"complete\", p), e.removeListener(\"abort\", m), e.removeListener(\"request\", _), e.req && e.req.removeListener(\"finish\", p), e.removeListener(\"end\", h), e.removeListener(\"close\", h), e.removeListener(\"finish\", p), e.removeListener(\"exit\", g), e.removeListener(\"end\", d), e.removeListener(\"error\", b), e.removeListener(\"close\", m) } }; t.exports = o }).call(this) }).call(this, e(\"_process\")) }, { _process: 46, once: 44 }], 31: [function (e, t, r) { var n = Object.create || function (e) { var t = function () { }; return t.prototype = e, new t }, i = Object.keys || function (e) { var t = []; for (var r in e) Object.prototype.hasOwnProperty.call(e, r) && t.push(r); return r }, o = Function.prototype.bind || function (e) { var t = this; return function () { return t.apply(e, arguments) } }; function s() { this._events && Object.prototype.hasOwnProperty.call(this, \"_events\") || (this._events = n(null), this._eventsCount = 0), this._maxListeners = this._maxListeners || void 0 } t.exports = s, s.EventEmitter = s, s.prototype._events = void 0, s.prototype._maxListeners = void 0; var a, u = 10; try { var c = {}; Object.defineProperty && Object.defineProperty(c, \"x\", { value: 0 }), a = 0 === c.x } catch (e) { a = !1 } function l(e) { return void 0 === e._maxListeners ? s.defaultMaxListeners : e._maxListeners } function f(e, t, r, i) { var o, s, a; if (\"function\" != typeof r) throw new TypeError('\"listener\" argument must be a function'); if ((s = e._events) ? (s.newListener && (e.emit(\"newListener\", t, r.listener ? r.listener : r), s = e._events), a = s[t]) : (s = e._events = n(null), e._eventsCount = 0), a) { if (\"function\" == typeof a ? a = s[t] = i ? [r, a] : [a, r] : i ? a.unshift(r) : a.push(r), !a.warned && (o = l(e)) && o > 0 && a.length > o) { a.warned = !0; var u = new Error(\"Possible EventEmitter memory leak detected. \" + a.length + ' \"' + String(t) + '\" listeners added. Use emitter.setMaxListeners() to increase limit.'); u.name = \"MaxListenersExceededWarning\", u.emitter = e, u.type = t, u.count = a.length, \"object\" == typeof console && console.warn && console.warn(\"%s: %s\", u.name, u.message) } } else a = s[t] = r, ++e._eventsCount; return e } function h() { if (!this.fired) switch (this.target.removeListener(this.type, this.wrapFn), this.fired = !0, arguments.length) { case 0: return this.listener.call(this.target); case 1: return this.listener.call(this.target, arguments[0]); case 2: return this.listener.call(this.target, arguments[0], arguments[1]); case 3: return this.listener.call(this.target, arguments[0], arguments[1], arguments[2]); default: for (var e = new Array(arguments.length), t = 0; t < e.length; ++t)e[t] = arguments[t]; this.listener.apply(this.target, e) } } function p(e, t, r) { var n = { fired: !1, wrapFn: void 0, target: e, type: t, listener: r }, i = o.call(h, n); return i.listener = r, n.wrapFn = i, i } function d(e, t, r) { var n = e._events; if (!n) return []; var i = n[t]; return i ? \"function\" == typeof i ? r ? [i.listener || i] : [i] : r ? function (e) { for (var t = new Array(e.length), r = 0; r < t.length; ++r)t[r] = e[r].listener || e[r]; return t }(i) : b(i, i.length) : [] } function g(e) { var t = this._events; if (t) { var r = t[e]; if (\"function\" == typeof r) return 1; if (r) return r.length } return 0 } function b(e, t) { for (var r = new Array(t), n = 0; n < t; ++n)r[n] = e[n]; return r } a ? Object.defineProperty(s, \"defaultMaxListeners\", { enumerable: !0, get: function () { return u }, set: function (e) { if (\"number\" != typeof e || e < 0 || e != e) throw new TypeError('\"defaultMaxListeners\" must be a positive number'); u = e } }) : s.defaultMaxListeners = u, s.prototype.setMaxListeners = function (e) { if (\"number\" != typeof e || e < 0 || isNaN(e)) throw new TypeError('\"n\" argument must be a positive number'); return this._maxListeners = e, this }, s.prototype.getMaxListeners = function () { return l(this) }, s.prototype.emit = function (e) { var t, r, n, i, o, s, a = \"error\" === e; if (s = this._events) a = a && null == s.error; else if (!a) return !1; if (a) { if (arguments.length > 1 && (t = arguments[1]), t instanceof Error) throw t; var u = new Error('Unhandled \"error\" event. (' + t + \")\"); throw u.context = t, u } if (!(r = s[e])) return !1; var c = \"function\" == typeof r; switch (n = arguments.length) { case 1: !function (e, t, r) { if (t) e.call(r); else for (var n = e.length, i = b(e, n), o = 0; o < n; ++o)i[o].call(r) }(r, c, this); break; case 2: !function (e, t, r, n) { if (t) e.call(r, n); else for (var i = e.length, o = b(e, i), s = 0; s < i; ++s)o[s].call(r, n) }(r, c, this, arguments[1]); break; case 3: !function (e, t, r, n, i) { if (t) e.call(r, n, i); else for (var o = e.length, s = b(e, o), a = 0; a < o; ++a)s[a].call(r, n, i) }(r, c, this, arguments[1], arguments[2]); break; case 4: !function (e, t, r, n, i, o) { if (t) e.call(r, n, i, o); else for (var s = e.length, a = b(e, s), u = 0; u < s; ++u)a[u].call(r, n, i, o) }(r, c, this, arguments[1], arguments[2], arguments[3]); break; default: for (i = new Array(n - 1), o = 1; o < n; o++)i[o - 1] = arguments[o]; !function (e, t, r, n) { if (t) e.apply(r, n); else for (var i = e.length, o = b(e, i), s = 0; s < i; ++s)o[s].apply(r, n) }(r, c, this, i) }return !0 }, s.prototype.addListener = function (e, t) { return f(this, e, t, !1) }, s.prototype.on = s.prototype.addListener, s.prototype.prependListener = function (e, t) { return f(this, e, t, !0) }, s.prototype.once = function (e, t) { if (\"function\" != typeof t) throw new TypeError('\"listener\" argument must be a function'); return this.on(e, p(this, e, t)), this }, s.prototype.prependOnceListener = function (e, t) { if (\"function\" != typeof t) throw new TypeError('\"listener\" argument must be a function'); return this.prependListener(e, p(this, e, t)), this }, s.prototype.removeListener = function (e, t) { var r, i, o, s, a; if (\"function\" != typeof t) throw new TypeError('\"listener\" argument must be a function'); if (!(i = this._events)) return this; if (!(r = i[e])) return this; if (r === t || r.listener === t) 0 == --this._eventsCount ? this._events = n(null) : (delete i[e], i.removeListener && this.emit(\"removeListener\", e, r.listener || t)); else if (\"function\" != typeof r) { for (o = -1, s = r.length - 1; s >= 0; s--)if (r[s] === t || r[s].listener === t) { a = r[s].listener, o = s; break } if (o < 0) return this; 0 === o ? r.shift() : function (e, t) { for (var r = t, n = r + 1, i = e.length; n < i; r += 1, n += 1)e[r] = e[n]; e.pop() }(r, o), 1 === r.length && (i[e] = r[0]), i.removeListener && this.emit(\"removeListener\", e, a || t) } return this }, s.prototype.removeAllListeners = function (e) { var t, r, o; if (!(r = this._events)) return this; if (!r.removeListener) return 0 === arguments.length ? (this._events = n(null), this._eventsCount = 0) : r[e] && (0 == --this._eventsCount ? this._events = n(null) : delete r[e]), this; if (0 === arguments.length) { var s, a = i(r); for (o = 0; o < a.length; ++o)\"removeListener\" !== (s = a[o]) && this.removeAllListeners(s); return this.removeAllListeners(\"removeListener\"), this._events = n(null), this._eventsCount = 0, this } if (\"function\" == typeof (t = r[e])) this.removeListener(e, t); else if (t) for (o = t.length - 1; o >= 0; o--)this.removeListener(e, t[o]); return this }, s.prototype.listeners = function (e) { return d(this, e, !0) }, s.prototype.rawListeners = function (e) { return d(this, e, !1) }, s.listenerCount = function (e, t) { return \"function\" == typeof e.listenerCount ? e.listenerCount(t) : g.call(e, t) }, s.prototype.listenerCount = g, s.prototype.eventNames = function () { return this._eventsCount > 0 ? Reflect.ownKeys(this._events) : [] } }, {}], 32: [function (e, t, r) { r.read = function (e, t, r, n, i) { var o, s, a = 8 * i - n - 1, u = (1 << a) - 1, c = u >> 1, l = -7, f = r ? i - 1 : 0, h = r ? -1 : 1, p = e[t + f]; for (f += h, o = p & (1 << -l) - 1, p >>= -l, l += a; l > 0; o = 256 * o + e[t + f], f += h, l -= 8); for (s = o & (1 << -l) - 1, o >>= -l, l += n; l > 0; s = 256 * s + e[t + f], f += h, l -= 8); if (0 === o) o = 1 - c; else { if (o === u) return s ? NaN : 1 / 0 * (p ? -1 : 1); s += Math.pow(2, n), o -= c } return (p ? -1 : 1) * s * Math.pow(2, o - n) }, r.write = function (e, t, r, n, i, o) { var s, a, u, c = 8 * o - i - 1, l = (1 << c) - 1, f = l >> 1, h = 23 === i ? Math.pow(2, -24) - Math.pow(2, -77) : 0, p = n ? 0 : o - 1, d = n ? 1 : -1, g = t < 0 || 0 === t && 1 / t < 0 ? 1 : 0; for (t = Math.abs(t), isNaN(t) || t === 1 / 0 ? (a = isNaN(t) ? 1 : 0, s = l) : (s = Math.floor(Math.log(t) / Math.LN2), t * (u = Math.pow(2, -s)) < 1 && (s-- , u *= 2), (t += s + f >= 1 ? h / u : h * Math.pow(2, 1 - f)) * u >= 2 && (s++ , u /= 2), s + f >= l ? (a = 0, s = l) : s + f >= 1 ? (a = (t * u - 1) * Math.pow(2, i), s += f) : (a = t * Math.pow(2, f - 1) * Math.pow(2, i), s = 0)); i >= 8; e[r + p] = 255 & a, p += d, a /= 256, i -= 8); for (s = s << i | a, c += i; c > 0; e[r + p] = 255 & s, p += d, s /= 256, c -= 8); e[r + p - d] |= 128 * g } }, {}], 33: [function (e, t, r) { \"function\" == typeof Object.create ? t.exports = function (e, t) { t && (e.super_ = t, e.prototype = Object.create(t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } })) } : t.exports = function (e, t) { if (t) { e.super_ = t; var r = function () { }; r.prototype = t.prototype, e.prototype = new r, e.prototype.constructor = e } } }, {}], 34: [function (e, t, r) { function n(e) { return !!e.constructor && \"function\" == typeof e.constructor.isBuffer && e.constructor.isBuffer(e) } t.exports = function (e) { return null != e && (n(e) || function (e) { return \"function\" == typeof e.readFloatLE && \"function\" == typeof e.slice && n(e.slice(0, 0)) }(e) || !!e._isBuffer) } }, {}], 35: [function (e, t, r) { var n = {}.toString; t.exports = Array.isArray || function (e) { return \"[object Array]\" == n.call(e) } }, {}], 36: [function (e, t, r) { (function (e) { (function () { const r = t.exports; r.types = { 0: \"reserved\", 1: \"connect\", 2: \"connack\", 3: \"publish\", 4: \"puback\", 5: \"pubrec\", 6: \"pubrel\", 7: \"pubcomp\", 8: \"subscribe\", 9: \"suback\", 10: \"unsubscribe\", 11: \"unsuback\", 12: \"pingreq\", 13: \"pingresp\", 14: \"disconnect\", 15: \"auth\" }, r.codes = {}; for (const e in r.types) { const t = r.types[e]; r.codes[t] = e } r.CMD_SHIFT = 4, r.CMD_MASK = 240, r.DUP_MASK = 8, r.QOS_MASK = 3, r.QOS_SHIFT = 1, r.RETAIN_MASK = 1, r.VARBYTEINT_MASK = 127, r.VARBYTEINT_FIN_MASK = 128, r.VARBYTEINT_MAX = 268435455, r.SESSIONPRESENT_MASK = 1, r.SESSIONPRESENT_HEADER = e.from([r.SESSIONPRESENT_MASK]), r.CONNACK_HEADER = e.from([r.codes.connack << r.CMD_SHIFT]), r.USERNAME_MASK = 128, r.PASSWORD_MASK = 64, r.WILL_RETAIN_MASK = 32, r.WILL_QOS_MASK = 24, r.WILL_QOS_SHIFT = 3, r.WILL_FLAG_MASK = 4, r.CLEAN_SESSION_MASK = 2, r.CONNECT_HEADER = e.from([r.codes.connect << r.CMD_SHIFT]), r.properties = { sessionExpiryInterval: 17, willDelayInterval: 24, receiveMaximum: 33, maximumPacketSize: 39, topicAliasMaximum: 34, requestResponseInformation: 25, requestProblemInformation: 23, userProperties: 38, authenticationMethod: 21, authenticationData: 22, payloadFormatIndicator: 1, messageExpiryInterval: 2, contentType: 3, responseTopic: 8, correlationData: 9, maximumQoS: 36, retainAvailable: 37, assignedClientIdentifier: 18, reasonString: 31, wildcardSubscriptionAvailable: 40, subscriptionIdentifiersAvailable: 41, sharedSubscriptionAvailable: 42, serverKeepAlive: 19, responseInformation: 26, serverReference: 28, topicAlias: 35, subscriptionIdentifier: 11 }, r.propertiesCodes = {}; for (const e in r.properties) { const t = r.properties[e]; r.propertiesCodes[t] = e } function n(t) { return [0, 1, 2].map(n => [0, 1].map(i => [0, 1].map(o => { const s = e.alloc(1); return s.writeUInt8(r.codes[t] << r.CMD_SHIFT | (i ? r.DUP_MASK : 0) | n << r.QOS_SHIFT | o, 0, !0), s }))) } r.propertiesTypes = { sessionExpiryInterval: \"int32\", willDelayInterval: \"int32\", receiveMaximum: \"int16\", maximumPacketSize: \"int32\", topicAliasMaximum: \"int16\", requestResponseInformation: \"byte\", requestProblemInformation: \"byte\", userProperties: \"pair\", authenticationMethod: \"string\", authenticationData: \"binary\", payloadFormatIndicator: \"byte\", messageExpiryInterval: \"int32\", contentType: \"string\", responseTopic: \"string\", correlationData: \"binary\", maximumQoS: \"int8\", retainAvailable: \"byte\", assignedClientIdentifier: \"string\", reasonString: \"string\", wildcardSubscriptionAvailable: \"byte\", subscriptionIdentifiersAvailable: \"byte\", sharedSubscriptionAvailable: \"byte\", serverKeepAlive: \"int16\", responseInformation: \"string\", serverReference: \"string\", topicAlias: \"int16\", subscriptionIdentifier: \"var\" }, r.PUBLISH_HEADER = n(\"publish\"), r.SUBSCRIBE_HEADER = n(\"subscribe\"), r.SUBSCRIBE_OPTIONS_QOS_MASK = 3, r.SUBSCRIBE_OPTIONS_NL_MASK = 1, r.SUBSCRIBE_OPTIONS_NL_SHIFT = 2, r.SUBSCRIBE_OPTIONS_RAP_MASK = 1, r.SUBSCRIBE_OPTIONS_RAP_SHIFT = 3, r.SUBSCRIBE_OPTIONS_RH_MASK = 3, r.SUBSCRIBE_OPTIONS_RH_SHIFT = 4, r.SUBSCRIBE_OPTIONS_RH = [0, 16, 32], r.SUBSCRIBE_OPTIONS_NL = 4, r.SUBSCRIBE_OPTIONS_RAP = 8, r.SUBSCRIBE_OPTIONS_QOS = [0, 1, 2], r.UNSUBSCRIBE_HEADER = n(\"unsubscribe\"), r.ACKS = { unsuback: n(\"unsuback\"), puback: n(\"puback\"), pubcomp: n(\"pubcomp\"), pubrel: n(\"pubrel\"), pubrec: n(\"pubrec\") }, r.SUBACK_HEADER = e.from([r.codes.suback << r.CMD_SHIFT]), r.VERSION3 = e.from([3]), r.VERSION4 = e.from([4]), r.VERSION5 = e.from([5]), r.QOS = [0, 1, 2].map(t => e.from([t])), r.EMPTY = { pingreq: e.from([r.codes.pingreq << 4, 0]), pingresp: e.from([r.codes.pingresp << 4, 0]), disconnect: e.from([r.codes.disconnect << 4, 0]) } }).call(this) }).call(this, e(\"buffer\").Buffer) }, { buffer: 14 }], 37: [function (e, t, r) { (function (r) { (function () { const n = e(\"./writeToStream\"), i = e(\"events\"); class o extends i { constructor() { super(), this._array = new Array(20), this._i = 0 } write(e) { return this._array[this._i++] = e, !0 } concat() { let e = 0; const t = new Array(this._array.length), n = this._array; let i, o = 0; for (i = 0; i < n.length && void 0 !== n[i]; i++)\"string\" != typeof n[i] ? t[i] = n[i].length : t[i] = r.byteLength(n[i]), e += t[i]; const s = r.allocUnsafe(e); for (i = 0; i < n.length && void 0 !== n[i]; i++)\"string\" != typeof n[i] ? (n[i].copy(s, o), o += t[i]) : (s.write(n[i], o), o += t[i]); return s } } t.exports = function (e, t) { const r = new o; return n(e, r, t), r.concat() } }).call(this) }).call(this, e(\"buffer\").Buffer) }, { \"./writeToStream\": 42, buffer: 14, events: 31 }], 38: [function (e, t, r) { r.parser = e(\"./parser\").parser, r.generate = e(\"./generate\"), r.writeToStream = e(\"./writeToStream\") }, { \"./generate\": 37, \"./parser\": 41, \"./writeToStream\": 42 }], 39: [function (e, t, r) { (function (e) { (function () { const r = 65536, n = {}, i = e.isBuffer(e.from([1, 2]).subarray(0, 1)); function o(t) { const r = e.allocUnsafe(2); return r.writeUInt8(t >> 8, 0), r.writeUInt8(255 & t, 1), r } t.exports = { cache: n, generateCache: function () { for (let e = 0; e < r; e++)n[e] = o(e) }, generateNumber: o, genBufVariableByteInt: function (t) { let r = 0, n = 0; const o = e.allocUnsafe(4); do { r = t % 128 | 0, (t = t / 128 | 0) > 0 && (r |= 128), o.writeUInt8(r, n++) } while (t > 0 && n < 4); return t > 0 && (n = 0), i ? o.subarray(0, n) : o.slice(0, n) }, generate4ByteBuffer: function (t) { const r = e.allocUnsafe(4); return r.writeUInt32BE(t, 0), r } } }).call(this) }).call(this, e(\"buffer\").Buffer) }, { buffer: 14 }], 40: [function (e, t, r) { t.exports = class { constructor() { this.cmd = null, this.retain = !1, this.qos = 0, this.dup = !1, this.length = -1, this.topic = null, this.payload = null } } }, {}], 41: [function (e, t, r) { const n = e(\"bl\"), i = e(\"events\"), o = e(\"./packet\"), s = e(\"./constants\"), a = e(\"debug\")(\"mqtt-packet:parser\"); class u extends i { constructor() { super(), this.parser = this.constructor.parser } static parser(e) { return this instanceof u ? (this.settings = e || {}, this._states = [\"_parseHeader\", \"_parseLength\", \"_parsePayload\", \"_newPacket\"], this._resetState(), this) : (new u).parser(e) } _resetState() { a(\"_resetState: resetting packet, error, _list, and _stateCounter\"), this.packet = new o, this.error = null, this._list = n(), this._stateCounter = 0 } parse(e) { for (this.error && this._resetState(), this._list.append(e), a(\"parse: current state: %s\", this._states[this._stateCounter]); (-1 !== this.packet.length || this._list.length > 0) && this[this._states[this._stateCounter]]() && !this.error;)this._stateCounter++ , a(\"parse: state complete. _stateCounter is now: %d\", this._stateCounter), a(\"parse: packet.length: %d, buffer list length: %d\", this.packet.length, this._list.length), this._stateCounter >= this._states.length && (this._stateCounter = 0); return a(\"parse: exited while loop. packet: %d, buffer list length: %d\", this.packet.length, this._list.length), this._list.length } _parseHeader() { const e = this._list.readUInt8(0); return this.packet.cmd = s.types[e >> s.CMD_SHIFT], this.packet.retain = 0 != (e & s.RETAIN_MASK), this.packet.qos = e >> s.QOS_SHIFT & s.QOS_MASK, this.packet.dup = 0 != (e & s.DUP_MASK), a(\"_parseHeader: packet: %o\", this.packet), this._list.consume(1), !0 } _parseLength() { const e = this._parseVarByteNum(!0); return e && (this.packet.length = e.value, this._list.consume(e.bytes)), a(\"_parseLength %d\", e.value), !!e } _parsePayload() { a(\"_parsePayload: payload %O\", this._list); let e = !1; if (0 === this.packet.length || this._list.length >= this.packet.length) { switch (this._pos = 0, this.packet.cmd) { case \"connect\": this._parseConnect(); break; case \"connack\": this._parseConnack(); break; case \"publish\": this._parsePublish(); break; case \"puback\": case \"pubrec\": case \"pubrel\": case \"pubcomp\": this._parseConfirmation(); break; case \"subscribe\": this._parseSubscribe(); break; case \"suback\": this._parseSuback(); break; case \"unsubscribe\": this._parseUnsubscribe(); break; case \"unsuback\": this._parseUnsuback(); break; case \"pingreq\": case \"pingresp\": break; case \"disconnect\": this._parseDisconnect(); break; case \"auth\": this._parseAuth(); break; default: this._emitError(new Error(\"Not supported\")) }e = !0 } return a(\"_parsePayload complete result: %s\", e), e } _parseConnect() { let e, t, r, n; a(\"_parseConnect\"); const i = {}, o = this.packet, u = this._parseString(); if (null === u) return this._emitError(new Error(\"Cannot parse protocolId\")); if (\"MQTT\" !== u && \"MQIsdp\" !== u) return this._emitError(new Error(\"Invalid protocolId\")); if (o.protocolId = u, this._pos >= this._list.length) return this._emitError(new Error(\"Packet too short\")); if (o.protocolVersion = this._list.readUInt8(this._pos), 3 !== o.protocolVersion && 4 !== o.protocolVersion && 5 !== o.protocolVersion) return this._emitError(new Error(\"Invalid protocol version\")); if (this._pos++ , this._pos >= this._list.length) return this._emitError(new Error(\"Packet too short\")); if (i.username = this._list.readUInt8(this._pos) & s.USERNAME_MASK, i.password = this._list.readUInt8(this._pos) & s.PASSWORD_MASK, i.will = this._list.readUInt8(this._pos) & s.WILL_FLAG_MASK, i.will && (o.will = {}, o.will.retain = 0 != (this._list.readUInt8(this._pos) & s.WILL_RETAIN_MASK), o.will.qos = (this._list.readUInt8(this._pos) & s.WILL_QOS_MASK) >> s.WILL_QOS_SHIFT), o.clean = 0 != (this._list.readUInt8(this._pos) & s.CLEAN_SESSION_MASK), this._pos++ , o.keepalive = this._parseNum(), -1 === o.keepalive) return this._emitError(new Error(\"Packet too short\")); if (5 === o.protocolVersion) { const e = this._parseProperties(); Object.getOwnPropertyNames(e).length && (o.properties = e) } const c = this._parseString(); if (null === c) return this._emitError(new Error(\"Packet too short\")); if (o.clientId = c, a(\"_parseConnect: packet.clientId: %s\", o.clientId), i.will) { if (5 === o.protocolVersion) { const e = this._parseProperties(); Object.getOwnPropertyNames(e).length && (o.will.properties = e) } if (null === (e = this._parseString())) return this._emitError(new Error(\"Cannot parse will topic\")); if (o.will.topic = e, a(\"_parseConnect: packet.will.topic: %s\", o.will.topic), null === (t = this._parseBuffer())) return this._emitError(new Error(\"Cannot parse will payload\")); o.will.payload = t, a(\"_parseConnect: packet.will.paylaod: %s\", o.will.payload) } if (i.username) { if (null === (n = this._parseString())) return this._emitError(new Error(\"Cannot parse username\")); o.username = n, a(\"_parseConnect: packet.username: %s\", o.username) } if (i.password) { if (null === (r = this._parseBuffer())) return this._emitError(new Error(\"Cannot parse password\")); o.password = r } return this.settings = o, a(\"_parseConnect: complete\"), o } _parseConnack() { a(\"_parseConnack\"); const e = this.packet; if (this._list.length < 2) return null; if (e.sessionPresent = !!(this._list.readUInt8(this._pos++) & s.SESSIONPRESENT_MASK), 5 === this.settings.protocolVersion ? e.reasonCode = this._list.readUInt8(this._pos++) : e.returnCode = this._list.readUInt8(this._pos++), -1 === e.returnCode || -1 === e.reasonCode) return this._emitError(new Error(\"Cannot parse return code\")); if (5 === this.settings.protocolVersion) { const t = this._parseProperties(); Object.getOwnPropertyNames(t).length && (e.properties = t) } a(\"_parseConnack: complete\") } _parsePublish() { a(\"_parsePublish\"); const e = this.packet; if (e.topic = this._parseString(), null === e.topic) return this._emitError(new Error(\"Cannot parse topic\")); if (!(e.qos > 0) || this._parseMessageId()) { if (5 === this.settings.protocolVersion) { const t = this._parseProperties(); Object.getOwnPropertyNames(t).length && (e.properties = t) } e.payload = this._list.slice(this._pos, e.length), a(\"_parsePublish: payload from buffer list: %o\", e.payload) } } _parseSubscribe() { a(\"_parseSubscribe\"); const e = this.packet; let t, r, n, i, o, u, c; if (1 !== e.qos) return this._emitError(new Error(\"Wrong subscribe header\")); if (e.subscriptions = [], this._parseMessageId()) { if (5 === this.settings.protocolVersion) { const t = this._parseProperties(); Object.getOwnPropertyNames(t).length && (e.properties = t) } for (; this._pos < e.length;) { if (null === (t = this._parseString())) return this._emitError(new Error(\"Cannot parse topic\")); if (this._pos >= e.length) return this._emitError(new Error(\"Malformed Subscribe Payload\")); n = (r = this._parseByte()) & s.SUBSCRIBE_OPTIONS_QOS_MASK, u = 0 != (r >> s.SUBSCRIBE_OPTIONS_NL_SHIFT & s.SUBSCRIBE_OPTIONS_NL_MASK), o = 0 != (r >> s.SUBSCRIBE_OPTIONS_RAP_SHIFT & s.SUBSCRIBE_OPTIONS_RAP_MASK), i = r >> s.SUBSCRIBE_OPTIONS_RH_SHIFT & s.SUBSCRIBE_OPTIONS_RH_MASK, c = { topic: t, qos: n }, 5 === this.settings.protocolVersion && (c.nl = u, c.rap = o, c.rh = i), a(\"_parseSubscribe: push subscription `%s` to subscription\", c), e.subscriptions.push(c) } } } _parseSuback() { a(\"_parseSuback\"); const e = this.packet; if (this.packet.granted = [], this._parseMessageId()) { if (5 === this.settings.protocolVersion) { const t = this._parseProperties(); Object.getOwnPropertyNames(t).length && (e.properties = t) } for (; this._pos < this.packet.length;)this.packet.granted.push(this._list.readUInt8(this._pos++)) } } _parseUnsubscribe() { a(\"_parseUnsubscribe\"); const e = this.packet; if (e.unsubscriptions = [], this._parseMessageId()) { if (5 === this.settings.protocolVersion) { const t = this._parseProperties(); Object.getOwnPropertyNames(t).length && (e.properties = t) } for (; this._pos < e.length;) { const t = this._parseString(); if (null === t) return this._emitError(new Error(\"Cannot parse topic\")); a(\"_parseUnsubscribe: push topic `%s` to unsubscriptions\", t), e.unsubscriptions.push(t) } } } _parseUnsuback() { a(\"_parseUnsuback\"); const e = this.packet; if (!this._parseMessageId()) return this._emitError(new Error(\"Cannot parse messageId\")); if (5 === this.settings.protocolVersion) { const t = this._parseProperties(); for (Object.getOwnPropertyNames(t).length && (e.properties = t), e.granted = []; this._pos < this.packet.length;)this.packet.granted.push(this._list.readUInt8(this._pos++)) } } _parseConfirmation() { a(\"_parseConfirmation: packet.cmd: `%s`\", this.packet.cmd); const e = this.packet; if (this._parseMessageId(), 5 === this.settings.protocolVersion && (e.length > 2 && (e.reasonCode = this._parseByte(), a(\"_parseConfirmation: packet.reasonCode `%d`\", e.reasonCode)), e.length > 3)) { const t = this._parseProperties(); Object.getOwnPropertyNames(t).length && (e.properties = t) } return !0 } _parseDisconnect() { const e = this.packet; if (a(\"_parseDisconnect\"), 5 === this.settings.protocolVersion) { e.reasonCode = this._parseByte(); const t = this._parseProperties(); Object.getOwnPropertyNames(t).length && (e.properties = t) } return a(\"_parseDisconnect result: true\"), !0 } _parseAuth() { a(\"_parseAuth\"); const e = this.packet; if (5 !== this.settings.protocolVersion) return this._emitError(new Error(\"Not supported auth packet for this version MQTT\")); e.reasonCode = this._parseByte(); const t = this._parseProperties(); return Object.getOwnPropertyNames(t).length && (e.properties = t), a(\"_parseAuth: result: true\"), !0 } _parseMessageId() { const e = this.packet; return e.messageId = this._parseNum(), null === e.messageId ? (this._emitError(new Error(\"Cannot parse messageId\")), !1) : (a(\"_parseMessageId: packet.messageId %d\", e.messageId), !0) } _parseString(e) { const t = this._parseNum(), r = t + this._pos; if (-1 === t || r > this._list.length || r > this.packet.length) return null; const n = this._list.toString(\"utf8\", this._pos, r); return this._pos += t, a(\"_parseString: result: %s\", n), n } _parseStringPair() { return a(\"_parseStringPair\"), { name: this._parseString(), value: this._parseString() } } _parseBuffer() { const e = this._parseNum(), t = e + this._pos; if (-1 === e || t > this._list.length || t > this.packet.length) return null; const r = this._list.slice(this._pos, t); return this._pos += e, a(\"_parseBuffer: result: %o\", r), r } _parseNum() { if (this._list.length - this._pos < 2) return -1; const e = this._list.readUInt16BE(this._pos); return this._pos += 2, a(\"_parseNum: result: %s\", e), e } _parse4ByteNum() { if (this._list.length - this._pos < 4) return -1; const e = this._list.readUInt32BE(this._pos); return this._pos += 4, a(\"_parse4ByteNum: result: %s\", e), e } _parseVarByteNum(e) { a(\"_parseVarByteNum\"); let t, r = 0, n = 1, i = 0, o = !1; const u = this._pos ? this._pos : 0; for (; r < 4;) { if (i += n * ((t = this._list.readUInt8(u + r++)) & s.VARBYTEINT_MASK), n *= 128, 0 == (t & s.VARBYTEINT_FIN_MASK)) { o = !0; break } if (this._list.length <= r) break } return !o && 4 === r && this._list.length >= r && this._emitError(new Error(\"Invalid variable byte integer\")), u && (this._pos += r), a(\"_parseVarByteNum: result: %o\", o = !!o && (e ? { bytes: r, value: i } : i)), o } _parseByte() { const e = this._list.readUInt8(this._pos); return this._pos++ , a(\"_parseByte: result: %o\", e), e } _parseByType(e) { switch (a(\"_parseByType: type: %s\", e), e) { case \"byte\": return 0 !== this._parseByte(); case \"int8\": return this._parseByte(); case \"int16\": return this._parseNum(); case \"int32\": return this._parse4ByteNum(); case \"var\": return this._parseVarByteNum(); case \"string\": return this._parseString(); case \"pair\": return this._parseStringPair(); case \"binary\": return this._parseBuffer() } } _parseProperties() { a(\"_parseProperties\"); const e = this._parseVarByteNum(), t = this._pos + e, r = {}; for (; this._pos < t;) { const e = this._parseByte(), t = s.propertiesCodes[e]; if (!t) return this._emitError(new Error(\"Unknown property\")), !1; if (\"userProperties\" !== t) r[t] ? Array.isArray(r[t]) ? r[t].push(this._parseByType(s.propertiesTypes[t])) : (r[t] = [r[t]], r[t].push(this._parseByType(s.propertiesTypes[t]))) : r[t] = this._parseByType(s.propertiesTypes[t]); else { r[t] || (r[t] = Object.create(null)); const e = this._parseByType(s.propertiesTypes[t]); if (r[t][e.name]) if (Array.isArray(r[t][e.name])) r[t][e.name].push(e.value); else { const n = r[t][e.name]; r[t][e.name] = [n], r[t][e.name].push(e.value) } else r[t][e.name] = e.value } } return r } _newPacket() { return a(\"_newPacket\"), this.packet && (this._list.consume(this.packet.length), a(\"_newPacket: parser emit packet: packet.cmd: %s, packet.payload: %s, packet.length: %d\", this.packet.cmd, this.packet.payload, this.packet.length), this.emit(\"packet\", this.packet)), a(\"_newPacket: new packet\"), this.packet = new o, this._pos = 0, !0 } _emitError(e) { a(\"_emitError\"), this.error = e, this.emit(\"error\", e) } } t.exports = u }, { \"./constants\": 36, \"./packet\": 40, bl: 12, debug: 16, events: 31 }], 42: [function (e, t, r) { (function (r) { (function () { const n = e(\"./constants\"), i = r.allocUnsafe(0), o = r.from([0]), s = e(\"./numbers\"), a = e(\"process-nextick-args\").nextTick, u = e(\"debug\")(\"mqtt-packet:writeToStream\"), c = s.cache, l = s.generateNumber, f = s.generateCache, h = s.genBufVariableByteInt, p = s.generate4ByteBuffer; let d = S, g = !0; function b(e, t, s) { switch (u(\"generate called\"), t.cork && (t.cork(), a(m, t)), g && (g = !1, f()), u(\"generate: packet.cmd: %s\", e.cmd), e.cmd) { case \"connect\": return function (e, t, i) { const o = e || {}, s = o.protocolId || \"MQTT\", a = o.protocolVersion || 4, u = o.will; let c = o.clean; const l = o.keepalive || 0, f = o.clientId || \"\", h = o.username, p = o.password, g = o.properties; void 0 === c && (c = !0); let b = 0; if (!s || \"string\" != typeof s && !r.isBuffer(s)) return t.emit(\"error\", new Error(\"Invalid protocolId\")), !1; b += s.length + 2; if (3 !== a && 4 !== a && 5 !== a) return t.emit(\"error\", new Error(\"Invalid protocol version\")), !1; b += 1; if (\"string\" != typeof f && !r.isBuffer(f) || !f && 4 !== a || !f && !c) { if (a < 4) return t.emit(\"error\", new Error(\"clientId must be supplied before 3.1.1\")), !1; if (1 * c == 0) return t.emit(\"error\", new Error(\"clientId must be given if cleanSession set to 0\")), !1 } else b += f.length + 2; if (\"number\" != typeof l || l < 0 || l > 65535 || l % 1 != 0) return t.emit(\"error\", new Error(\"Invalid keepalive\")), !1; b += 2; if (b += 1, 5 === a) { var m = I(t, g); if (!m) return !1; b += m.length } if (u) { if (\"object\" != typeof u) return t.emit(\"error\", new Error(\"Invalid will\")), !1; if (!u.topic || \"string\" != typeof u.topic) return t.emit(\"error\", new Error(\"Invalid will topic\")), !1; if (b += r.byteLength(u.topic) + 2, b += 2, u.payload) { if (!(u.payload.length >= 0)) return t.emit(\"error\", new Error(\"Invalid will payload\")), !1; \"string\" == typeof u.payload ? b += r.byteLength(u.payload) : b += u.payload.length } var y = {}; if (5 === a) { if (!(y = I(t, u.properties))) return !1; b += y.length } } let v = !1; if (null != h) { if (!A(h)) return t.emit(\"error\", new Error(\"Invalid username\")), !1; v = !0, b += r.byteLength(h) + 2 } if (null != p) { if (!v) return t.emit(\"error\", new Error(\"Username is required to use password\")), !1; if (!A(p)) return t.emit(\"error\", new Error(\"Invalid password\")), !1; b += R(p) + 2 } t.write(n.CONNECT_HEADER), _(t, b), k(t, s), t.write(4 === a ? n.VERSION4 : 5 === a ? n.VERSION5 : n.VERSION3); let S = 0; S |= null != h ? n.USERNAME_MASK : 0, S |= null != p ? n.PASSWORD_MASK : 0, S |= u && u.retain ? n.WILL_RETAIN_MASK : 0, S |= u && u.qos ? u.qos << n.WILL_QOS_SHIFT : 0, S |= u ? n.WILL_FLAG_MASK : 0, S |= c ? n.CLEAN_SESSION_MASK : 0, t.write(r.from([S])), d(t, l), 5 === a && m.write(); k(t, f), u && (5 === a && y.write(), w(t, u.topic), k(t, u.payload)); null != h && k(t, h); null != p && k(t, p); return !0 }(e, t); case \"connack\": return function (e, t, i) { const s = i ? i.protocolVersion : 4, a = e || {}, u = 5 === s ? a.reasonCode : a.returnCode, c = a.properties; let l = 2; if (\"number\" != typeof u) return t.emit(\"error\", new Error(\"Invalid return code\")), !1; let f = null; if (5 === s) { if (!(f = I(t, c))) return !1; l += f.length } t.write(n.CONNACK_HEADER), _(t, l), t.write(a.sessionPresent ? n.SESSIONPRESENT_HEADER : o), t.write(r.from([u])), null != f && f.write(); return !0 }(e, t, s); case \"publish\": return function (e, t, o) { u(\"publish: packet: %o\", e); const s = o ? o.protocolVersion : 4, a = e || {}, c = a.qos || 0, l = a.retain ? n.RETAIN_MASK : 0, f = a.topic, h = a.payload || i, p = a.messageId, g = a.properties; let b = 0; if (\"string\" == typeof f) b += r.byteLength(f) + 2; else { if (!r.isBuffer(f)) return t.emit(\"error\", new Error(\"Invalid topic\")), !1; b += f.length + 2 } r.isBuffer(h) ? b += h.length : b += r.byteLength(h); if (c && \"number\" != typeof p) return t.emit(\"error\", new Error(\"Invalid messageId\")), !1; c && (b += 2); let m = null; if (5 === s) { if (!(m = I(t, g))) return !1; b += m.length } t.write(n.PUBLISH_HEADER[c][a.dup ? 1 : 0][l ? 1 : 0]), _(t, b), d(t, R(f)), t.write(f), c > 0 && d(t, p); null != m && m.write(); return u(\"publish: payload: %o\", h), t.write(h) }(e, t, s); case \"puback\": case \"pubrec\": case \"pubrel\": case \"pubcomp\": return function (e, t, i) { const o = i ? i.protocolVersion : 4, s = e || {}, a = s.cmd || \"puback\", u = s.messageId, c = s.dup && \"pubrel\" === a ? n.DUP_MASK : 0; let l = 0; const f = s.reasonCode, h = s.properties; let p = 5 === o ? 3 : 2; \"pubrel\" === a && (l = 1); if (\"number\" != typeof u) return t.emit(\"error\", new Error(\"Invalid messageId\")), !1; let g = null; if (5 === o && \"object\" == typeof h) { if (!(g = C(t, h, i, p))) return !1; p += g.length } t.write(n.ACKS[a][l][c][0]), _(t, p), d(t, u), 5 === o && t.write(r.from([f])); null !== g && g.write(); return !0 }(e, t, s); case \"subscribe\": return function (e, t, i) { u(\"subscribe: packet: \"); const o = i ? i.protocolVersion : 4, s = e || {}, a = s.dup ? n.DUP_MASK : 0, c = s.messageId, l = s.subscriptions, f = s.properties; let h = 0; if (\"number\" != typeof c) return t.emit(\"error\", new Error(\"Invalid messageId\")), !1; h += 2; let p = null; if (5 === o) { if (!(p = I(t, f))) return !1; h += p.length } if (\"object\" != typeof l || !l.length) return t.emit(\"error\", new Error(\"Invalid subscriptions\")), !1; for (let e = 0; e < l.length; e += 1) { const n = l[e].topic, i = l[e].qos; if (\"string\" != typeof n) return t.emit(\"error\", new Error(\"Invalid subscriptions - invalid topic\")), !1; if (\"number\" != typeof i) return t.emit(\"error\", new Error(\"Invalid subscriptions - invalid qos\")), !1; if (5 === o) { const r = l[e].nl || !1; if (\"boolean\" != typeof r) return t.emit(\"error\", new Error(\"Invalid subscriptions - invalid No Local\")), !1; const n = l[e].rap || !1; if (\"boolean\" != typeof n) return t.emit(\"error\", new Error(\"Invalid subscriptions - invalid Retain as Published\")), !1; const i = l[e].rh || 0; if (\"number\" != typeof i || i > 2) return t.emit(\"error\", new Error(\"Invalid subscriptions - invalid Retain Handling\")), !1 } h += r.byteLength(n) + 2 + 1 } u(\"subscribe: writing to stream: %o\", n.SUBSCRIBE_HEADER), t.write(n.SUBSCRIBE_HEADER[1][a ? 1 : 0][0]), _(t, h), d(t, c), null !== p && p.write(); let g = !0; for (const e of l) { const i = e.topic, s = e.qos, a = +e.nl, u = +e.rap, c = e.rh; let l; w(t, i), l = n.SUBSCRIBE_OPTIONS_QOS[s], 5 === o && (l |= a ? n.SUBSCRIBE_OPTIONS_NL : 0, l |= u ? n.SUBSCRIBE_OPTIONS_RAP : 0, l |= c ? n.SUBSCRIBE_OPTIONS_RH[c] : 0), g = t.write(r.from([l])) } return g }(e, t, s); case \"suback\": return function (e, t, i) { const o = i ? i.protocolVersion : 4, s = e || {}, a = s.messageId, u = s.granted, c = s.properties; let l = 0; if (\"number\" != typeof a) return t.emit(\"error\", new Error(\"Invalid messageId\")), !1; l += 2; if (\"object\" != typeof u || !u.length) return t.emit(\"error\", new Error(\"Invalid qos vector\")), !1; for (let e = 0; e < u.length; e += 1) { if (\"number\" != typeof u[e]) return t.emit(\"error\", new Error(\"Invalid qos vector\")), !1; l += 1 } let f = null; if (5 === o) { if (!(f = C(t, c, i, l))) return !1; l += f.length } t.write(n.SUBACK_HEADER), _(t, l), d(t, a), null !== f && f.write(); return t.write(r.from(u)) }(e, t, s); case \"unsubscribe\": return function (e, t, i) { const o = i ? i.protocolVersion : 4, s = e || {}, a = s.messageId, u = s.dup ? n.DUP_MASK : 0, c = s.unsubscriptions, l = s.properties; let f = 0; if (\"number\" != typeof a) return t.emit(\"error\", new Error(\"Invalid messageId\")), !1; f += 2; if (\"object\" != typeof c || !c.length) return t.emit(\"error\", new Error(\"Invalid unsubscriptions\")), !1; for (let e = 0; e < c.length; e += 1) { if (\"string\" != typeof c[e]) return t.emit(\"error\", new Error(\"Invalid unsubscriptions\")), !1; f += r.byteLength(c[e]) + 2 } let h = null; if (5 === o) { if (!(h = I(t, l))) return !1; f += h.length } t.write(n.UNSUBSCRIBE_HEADER[1][u ? 1 : 0][0]), _(t, f), d(t, a), null !== h && h.write(); let p = !0; for (let e = 0; e < c.length; e++)p = w(t, c[e]); return p }(e, t, s); case \"unsuback\": return function (e, t, i) { const o = i ? i.protocolVersion : 4, s = e || {}, a = s.messageId, u = s.dup ? n.DUP_MASK : 0, c = s.granted, l = s.properties, f = s.cmd; let h = 2; if (\"number\" != typeof a) return t.emit(\"error\", new Error(\"Invalid messageId\")), !1; if (5 === o) { if (\"object\" != typeof c || !c.length) return t.emit(\"error\", new Error(\"Invalid qos vector\")), !1; for (let e = 0; e < c.length; e += 1) { if (\"number\" != typeof c[e]) return t.emit(\"error\", new Error(\"Invalid qos vector\")), !1; h += 1 } } let p = null; if (5 === o) { if (!(p = C(t, l, i, h))) return !1; h += p.length } t.write(n.ACKS[f][0][u][0]), _(t, h), d(t, a), null !== p && p.write(); 5 === o && t.write(r.from(c)); return !0 }(e, t, s); case \"pingreq\": case \"pingresp\": return function (e, t, r) { return t.write(n.EMPTY[e.cmd]) }(e, t); case \"disconnect\": return function (e, t, i) { const o = i ? i.protocolVersion : 4, s = e || {}, a = s.reasonCode, u = s.properties; let c = 5 === o ? 1 : 0, l = null; if (5 === o) { if (!(l = C(t, u, i, c))) return !1; c += l.length } t.write(r.from([n.codes.disconnect << 4])), _(t, c), 5 === o && t.write(r.from([a])); null !== l && l.write(); return !0 }(e, t, s); case \"auth\": return function (e, t, i) { const o = i ? i.protocolVersion : 4, s = e || {}, a = s.reasonCode, u = s.properties; let c = 5 === o ? 1 : 0; 5 !== o && t.emit(\"error\", new Error(\"Invalid mqtt version for auth packet\")); const l = C(t, u, i, c); if (!l) return !1; c += l.length, t.write(r.from([n.codes.auth << 4])), _(t, c), t.write(r.from([a])), null !== l && l.write(); return !0 }(e, t, s); default: return t.emit(\"error\", new Error(\"Unknown command\")), !1 } } function m(e) { e.uncork() } Object.defineProperty(b, \"cacheNumbers\", { get: () => d === S, set(e) { e ? (c && 0 !== Object.keys(c).length || (g = !0), d = S) : (g = !1, d = E) } }); const y = {}; function _(e, t) { if (t > n.VARBYTEINT_MAX) return e.emit(\"error\", new Error(`Invalid variable byte integer: ${t}`)), !1; let r = y[t]; return r || (r = h(t), t < 16384 && (y[t] = r)), u(\"writeVarByteInt: writing to stream: %o\", r), e.write(r) } function w(e, t) { const n = r.byteLength(t); return d(e, n), u(\"writeString: %s\", t), e.write(t, \"utf8\") } function v(e, t, r) { w(e, t), w(e, r) } function S(e, t) { return u(\"writeNumberCached: number: %d\", t), u(\"writeNumberCached: %o\", c[t]), e.write(c[t]) } function E(e, t) { const r = l(t); return u(\"writeNumberGenerated: %o\", r), e.write(r) } function k(e, t) { \"string\" == typeof t ? w(e, t) : t ? (d(e, t.length), e.write(t)) : d(e, 0) } function I(e, t) { if (\"object\" != typeof t || null != t.length) return { length: 1, write() { x(e, {}, 0) } }; let i = 0; function o(t, i) { let o = 0; switch (n.propertiesTypes[t]) { case \"byte\": if (\"boolean\" != typeof i) return e.emit(\"error\", new Error(`Invalid ${t}: ${i}`)), !1; o += 2; break; case \"int8\": if (\"number\" != typeof i || i < 0 || i > 255) return e.emit(\"error\", new Error(`Invalid ${t}: ${i}`)), !1; o += 2; break; case \"binary\": if (i && null === i) return e.emit(\"error\", new Error(`Invalid ${t}: ${i}`)), !1; o += 1 + r.byteLength(i) + 2; break; case \"int16\": if (\"number\" != typeof i || i < 0 || i > 65535) return e.emit(\"error\", new Error(`Invalid ${t}: ${i}`)), !1; o += 3; break; case \"int32\": if (\"number\" != typeof i || i < 0 || i > 4294967295) return e.emit(\"error\", new Error(`Invalid ${t}: ${i}`)), !1; o += 5; break; case \"var\": if (\"number\" != typeof i || i < 0 || i > 268435455) return e.emit(\"error\", new Error(`Invalid ${t}: ${i}`)), !1; o += 1 + r.byteLength(h(i)); break; case \"string\": if (\"string\" != typeof i) return e.emit(\"error\", new Error(`Invalid ${t}: ${i}`)), !1; o += 3 + r.byteLength(i.toString()); break; case \"pair\": if (\"object\" != typeof i) return e.emit(\"error\", new Error(`Invalid ${t}: ${i}`)), !1; o += Object.getOwnPropertyNames(i).reduce((e, t) => { const n = i[t]; return Array.isArray(n) ? e += n.reduce((e, n) => e += 3 + r.byteLength(t.toString()) + 2 + r.byteLength(n.toString()), 0) : e += 3 + r.byteLength(t.toString()) + 2 + r.byteLength(i[t].toString()), e }, 0); break; default: return e.emit(\"error\", new Error(`Invalid property ${t}: ${i}`)), !1 }return o } if (t) for (const e in t) { let r = 0, n = 0; const s = t[e]; if (Array.isArray(s)) for (let t = 0; t < s.length; t++) { if (!(n = o(e, s[t]))) return !1; r += n } else { if (!(n = o(e, s))) return !1; r = n } if (!r) return !1; i += r } return { length: r.byteLength(h(i)) + i, write() { x(e, t, i) } } } function C(e, t, r, n) { const i = [\"reasonString\", \"userProperties\"], o = r && r.properties && r.properties.maximumPacketSize ? r.properties.maximumPacketSize : 0; let s = I(e, t); if (o) for (; n + s.length > o;) { const r = i.shift(); if (!r || !t[r]) return !1; delete t[r], s = I(e, t) } return s } function T(e, t, i) { switch (n.propertiesTypes[t]) { case \"byte\": e.write(r.from([n.properties[t]])), e.write(r.from([+i])); break; case \"int8\": e.write(r.from([n.properties[t]])), e.write(r.from([i])); break; case \"binary\": e.write(r.from([n.properties[t]])), k(e, i); break; case \"int16\": e.write(r.from([n.properties[t]])), d(e, i); break; case \"int32\": e.write(r.from([n.properties[t]])), function (e, t) { const r = p(t); u(\"write4ByteNumber: %o\", r), e.write(r) }(e, i); break; case \"var\": e.write(r.from([n.properties[t]])), _(e, i); break; case \"string\": e.write(r.from([n.properties[t]])), w(e, i); break; case \"pair\": Object.getOwnPropertyNames(i).forEach(o => { const s = i[o]; Array.isArray(s) ? s.forEach(i => { e.write(r.from([n.properties[t]])), v(e, o.toString(), i.toString()) }) : (e.write(r.from([n.properties[t]])), v(e, o.toString(), s.toString())) }); break; default: return e.emit(\"error\", new Error(`Invalid property ${t} value: ${i}`)), !1 } } function x(e, t, r) { _(e, r); for (const r in t) if (Object.prototype.hasOwnProperty.call(t, r) && null !== t[r]) { const n = t[r]; if (Array.isArray(n)) for (let t = 0; t < n.length; t++)T(e, r, n[t]); else T(e, r, n) } } function R(e) { return e ? e instanceof r ? e.length : r.byteLength(e) : 0 } function A(e) { return \"string\" == typeof e || e instanceof r } t.exports = b }).call(this) }).call(this, e(\"buffer\").Buffer) }, { \"./constants\": 36, \"./numbers\": 39, buffer: 14, debug: 16, \"process-nextick-args\": 45 }], 43: [function (e, t, r) { var n = 1e3, i = 60 * n, o = 60 * i, s = 24 * o, a = 7 * s, u = 365.25 * s; function c(e, t, r, n) { var i = t >= 1.5 * r; return Math.round(e / r) + \" \" + n + (i ? \"s\" : \"\") } t.exports = function (e, t) { t = t || {}; var r = typeof e; if (\"string\" === r && e.length > 0) return function (e) { if ((e = String(e)).length > 100) return; var t = /^(-?(?:\\d+)?\\.?\\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e); if (!t) return; var r = parseFloat(t[1]); switch ((t[2] || \"ms\").toLowerCase()) { case \"years\": case \"year\": case \"yrs\": case \"yr\": case \"y\": return r * u; case \"weeks\": case \"week\": case \"w\": return r * a; case \"days\": case \"day\": case \"d\": return r * s; case \"hours\": case \"hour\": case \"hrs\": case \"hr\": case \"h\": return r * o; case \"minutes\": case \"minute\": case \"mins\": case \"min\": case \"m\": return r * i; case \"seconds\": case \"second\": case \"secs\": case \"sec\": case \"s\": return r * n; case \"milliseconds\": case \"millisecond\": case \"msecs\": case \"msec\": case \"ms\": return r; default: return } }(e); if (\"number\" === r && isFinite(e)) return t.long ? function (e) { var t = Math.abs(e); if (t >= s) return c(e, t, s, \"day\"); if (t >= o) return c(e, t, o, \"hour\"); if (t >= i) return c(e, t, i, \"minute\"); if (t >= n) return c(e, t, n, \"second\"); return e + \" ms\" }(e) : function (e) { var t = Math.abs(e); if (t >= s) return Math.round(e / s) + \"d\"; if (t >= o) return Math.round(e / o) + \"h\"; if (t >= i) return Math.round(e / i) + \"m\"; if (t >= n) return Math.round(e / n) + \"s\"; return e + \"ms\" }(e); throw new Error(\"val is not a non-empty string or a valid number. val=\" + JSON.stringify(e)) } }, {}], 44: [function (e, t, r) { var n = e(\"wrappy\"); function i(e) { var t = function () { return t.called ? t.value : (t.called = !0, t.value = e.apply(this, arguments)) }; return t.called = !1, t } function o(e) { var t = function () { if (t.called) throw new Error(t.onceError); return t.called = !0, t.value = e.apply(this, arguments) }, r = e.name || \"Function wrapped with `once`\"; return t.onceError = r + \" shouldn't be called more than once\", t.called = !1, t } t.exports = n(i), t.exports.strict = n(o), i.proto = i(function () { Object.defineProperty(Function.prototype, \"once\", { value: function () { return i(this) }, configurable: !0 }), Object.defineProperty(Function.prototype, \"onceStrict\", { value: function () { return o(this) }, configurable: !0 }) }) }, { wrappy: 74 }], 45: [function (e, t, r) { (function (e) { (function () { \"use strict\"; void 0 === e || !e.version || 0 === e.version.indexOf(\"v0.\") || 0 === e.version.indexOf(\"v1.\") && 0 !== e.version.indexOf(\"v1.8.\") ? t.exports = { nextTick: function (t, r, n, i) { if (\"function\" != typeof t) throw new TypeError('\"callback\" argument must be a function'); var o, s, a = arguments.length; switch (a) { case 0: case 1: return e.nextTick(t); case 2: return e.nextTick(function () { t.call(null, r) }); case 3: return e.nextTick(function () { t.call(null, r, n) }); case 4: return e.nextTick(function () { t.call(null, r, n, i) }); default: for (o = new Array(a - 1), s = 0; s < o.length;)o[s++] = arguments[s]; return e.nextTick(function () { t.apply(null, o) }) } } } : t.exports = e }).call(this) }).call(this, e(\"_process\")) }, { _process: 46 }], 46: [function (e, t, r) { var n, i, o = t.exports = {}; function s() { throw new Error(\"setTimeout has not been defined\") } function a() { throw new Error(\"clearTimeout has not been defined\") } function u(e) { if (n === setTimeout) return setTimeout(e, 0); if ((n === s || !n) && setTimeout) return n = setTimeout, setTimeout(e, 0); try { return n(e, 0) } catch (t) { try { return n.call(null, e, 0) } catch (t) { return n.call(this, e, 0) } } } !function () { try { n = \"function\" == typeof setTimeout ? setTimeout : s } catch (e) { n = s } try { i = \"function\" == typeof clearTimeout ? clearTimeout : a } catch (e) { i = a } }(); var c, l = [], f = !1, h = -1; function p() { f && c && (f = !1, c.length ? l = c.concat(l) : h = -1, l.length && d()) } function d() { if (!f) { var e = u(p); f = !0; for (var t = l.length; t;) { for (c = l, l = []; ++h < t;)c && c[h].run(); h = -1, t = l.length } c = null, f = !1, function (e) { if (i === clearTimeout) return clearTimeout(e); if ((i === a || !i) && clearTimeout) return i = clearTimeout, clearTimeout(e); try { i(e) } catch (t) { try { return i.call(null, e) } catch (t) { return i.call(this, e) } } }(e) } } function g(e, t) { this.fun = e, this.array = t } function b() { } o.nextTick = function (e) { var t = new Array(arguments.length - 1); if (arguments.length > 1) for (var r = 1; r < arguments.length; r++)t[r - 1] = arguments[r]; l.push(new g(e, t)), 1 !== l.length || f || u(d) }, g.prototype.run = function () { this.fun.apply(null, this.array) }, o.title = \"browser\", o.browser = !0, o.env = {}, o.argv = [], o.version = \"\", o.versions = {}, o.on = b, o.addListener = b, o.once = b, o.off = b, o.removeListener = b, o.removeAllListeners = b, o.emit = b, o.prependListener = b, o.prependOnceListener = b, o.listeners = function (e) { return [] }, o.binding = function (e) { throw new Error(\"process.binding is not supported\") }, o.cwd = function () { return \"/\" }, o.chdir = function (e) { throw new Error(\"process.chdir is not supported\") }, o.umask = function () { return 0 } }, {}], 47: [function (e, t, r) { (function (e) { (function () { !function (n) { var i = \"object\" == typeof r && r && !r.nodeType && r, o = \"object\" == typeof t && t && !t.nodeType && t, s = \"object\" == typeof e && e; s.global !== s && s.window !== s && s.self !== s || (n = s); var a, u, c = 2147483647, l = 36, f = 1, h = 26, p = 38, d = 700, g = 72, b = 128, m = \"-\", y = /^xn--/, _ = /[^\\x20-\\x7E]/, w = /[\\x2E\\u3002\\uFF0E\\uFF61]/g, v = { overflow: \"Overflow: input needs wider integers to process\", \"not-basic\": \"Illegal input >= 0x80 (not a basic code point)\", \"invalid-input\": \"Invalid input\" }, S = l - f, E = Math.floor, k = String.fromCharCode; function I(e) { throw new RangeError(v[e]) } function C(e, t) { for (var r = e.length, n = []; r--;)n[r] = t(e[r]); return n } function T(e, t) { var r = e.split(\"@\"), n = \"\"; return r.length > 1 && (n = r[0] + \"@\", e = r[1]), n + C((e = e.replace(w, \".\")).split(\".\"), t).join(\".\") } function x(e) { for (var t, r, n = [], i = 0, o = e.length; i < o;)(t = e.charCodeAt(i++)) >= 55296 && t <= 56319 && i < o ? 56320 == (64512 & (r = e.charCodeAt(i++))) ? n.push(((1023 & t) << 10) + (1023 & r) + 65536) : (n.push(t), i--) : n.push(t); return n } function R(e) { return C(e, function (e) { var t = \"\"; return e > 65535 && (t += k((e -= 65536) >>> 10 & 1023 | 55296), e = 56320 | 1023 & e), t += k(e) }).join(\"\") } function A(e, t) { return e + 22 + 75 * (e < 26) - ((0 != t) << 5) } function M(e, t, r) { var n = 0; for (e = r ? E(e / d) : e >> 1, e += E(e / t); e > S * h >> 1; n += l)e = E(e / S); return E(n + (S + 1) * e / (e + p)) } function O(e) { var t, r, n, i, o, s, a, u, p, d, y, _ = [], w = e.length, v = 0, S = b, k = g; for ((r = e.lastIndexOf(m)) < 0 && (r = 0), n = 0; n < r; ++n)e.charCodeAt(n) >= 128 && I(\"not-basic\"), _.push(e.charCodeAt(n)); for (i = r > 0 ? r + 1 : 0; i < w;) { for (o = v, s = 1, a = l; i >= w && I(\"invalid-input\"), ((u = (y = e.charCodeAt(i++)) - 48 < 10 ? y - 22 : y - 65 < 26 ? y - 65 : y - 97 < 26 ? y - 97 : l) >= l || u > E((c - v) / s)) && I(\"overflow\"), v += u * s, !(u < (p = a <= k ? f : a >= k + h ? h : a - k)); a += l)s > E(c / (d = l - p)) && I(\"overflow\"), s *= d; k = M(v - o, t = _.length + 1, 0 == o), E(v / t) > c - S && I(\"overflow\"), S += E(v / t), v %= t, _.splice(v++, 0, S) } return R(_) } function P(e) { var t, r, n, i, o, s, a, u, p, d, y, _, w, v, S, C = []; for (_ = (e = x(e)).length, t = b, r = 0, o = g, s = 0; s < _; ++s)(y = e[s]) < 128 && C.push(k(y)); for (n = i = C.length, i && C.push(m); n < _;) { for (a = c, s = 0; s < _; ++s)(y = e[s]) >= t && y < a && (a = y); for (a - t > E((c - r) / (w = n + 1)) && I(\"overflow\"), r += (a - t) * w, t = a, s = 0; s < _; ++s)if ((y = e[s]) < t && ++r > c && I(\"overflow\"), y == t) { for (u = r, p = l; !(u < (d = p <= o ? f : p >= o + h ? h : p - o)); p += l)S = u - d, v = l - d, C.push(k(A(d + S % v, 0))), u = E(S / v); C.push(k(A(u, 0))), o = M(r, w, n == i), r = 0, ++n } ++r, ++t } return C.join(\"\") } if (a = { version: \"1.4.1\", ucs2: { decode: x, encode: R }, decode: O, encode: P, toASCII: function (e) { return T(e, function (e) { return _.test(e) ? \"xn--\" + P(e) : e }) }, toUnicode: function (e) { return T(e, function (e) { return y.test(e) ? O(e.slice(4).toLowerCase()) : e }) } }, i && o) if (t.exports == i) o.exports = a; else for (u in a) a.hasOwnProperty(u) && (i[u] = a[u]); else n.punycode = a }(this) }).call(this) }).call(this, \"undefined\" != typeof global ? global : \"undefined\" != typeof self ? self : \"undefined\" != typeof window ? window : {}) }, {}], 48: [function (e, t, r) { \"use strict\"; function n(e, t) { return Object.prototype.hasOwnProperty.call(e, t) } t.exports = function (e, t, r, o) { t = t || \"&\", r = r || \"=\"; var s = {}; if (\"string\" != typeof e || 0 === e.length) return s; var a = /\\+/g; e = e.split(t); var u = 1e3; o && \"number\" == typeof o.maxKeys && (u = o.maxKeys); var c = e.length; u > 0 && c > u && (c = u); for (var l = 0; l < c; ++l) { var f, h, p, d, g = e[l].replace(a, \"%20\"), b = g.indexOf(r); b >= 0 ? (f = g.substr(0, b), h = g.substr(b + 1)) : (f = g, h = \"\"), p = decodeURIComponent(f), d = decodeURIComponent(h), n(s, p) ? i(s[p]) ? s[p].push(d) : s[p] = [s[p], d] : s[p] = d } return s }; var i = Array.isArray || function (e) { return \"[object Array]\" === Object.prototype.toString.call(e) } }, {}], 49: [function (e, t, r) { \"use strict\"; var n = function (e) { switch (typeof e) { case \"string\": return e; case \"boolean\": return e ? \"true\" : \"false\"; case \"number\": return isFinite(e) ? e : \"\"; default: return \"\" } }; t.exports = function (e, t, r, a) { return t = t || \"&\", r = r || \"=\", null === e && (e = void 0), \"object\" == typeof e ? o(s(e), function (s) { var a = encodeURIComponent(n(s)) + r; return i(e[s]) ? o(e[s], function (e) { return a + encodeURIComponent(n(e)) }).join(t) : a + encodeURIComponent(n(e[s])) }).join(t) : a ? encodeURIComponent(n(a)) + r + encodeURIComponent(n(e)) : \"\" }; var i = Array.isArray || function (e) { return \"[object Array]\" === Object.prototype.toString.call(e) }; function o(e, t) { if (e.map) return e.map(t); for (var r = [], n = 0; n < e.length; n++)r.push(t(e[n], n)); return r } var s = Object.keys || function (e) { var t = []; for (var r in e) Object.prototype.hasOwnProperty.call(e, r) && t.push(r); return t } }, {}], 50: [function (e, t, r) { \"use strict\"; r.decode = r.parse = e(\"./decode\"), r.encode = r.stringify = e(\"./encode\") }, { \"./decode\": 48, \"./encode\": 49 }], 51: [function (e, t, r) { \"use strict\"; var n = {}; function i(e, t, r) { r || (r = Error); var i = function (e) { var r, n; function i(r, n, i) { return e.call(this, function (e, r, n) { return \"string\" == typeof t ? t : t(e, r, n) }(r, n, i)) || this } return n = e, (r = i).prototype = Object.create(n.prototype), r.prototype.constructor = r, r.__proto__ = n, i }(r); i.prototype.name = r.name, i.prototype.code = e, n[e] = i } function o(e, t) { if (Array.isArray(e)) { var r = e.length; return e = e.map(function (e) { return String(e) }), r > 2 ? \"one of \".concat(t, \" \").concat(e.slice(0, r - 1).join(\", \"), \", or \") + e[r - 1] : 2 === r ? \"one of \".concat(t, \" \").concat(e[0], \" or \").concat(e[1]) : \"of \".concat(t, \" \").concat(e[0]) } return \"of \".concat(t, \" \").concat(String(e)) } i(\"ERR_INVALID_OPT_VALUE\", function (e, t) { return 'The value \"' + t + '\" is invalid for option \"' + e + '\"' }, TypeError), i(\"ERR_INVALID_ARG_TYPE\", function (e, t, r) { var n, i, s, a; if (\"string\" == typeof t && (i = \"not \", t.substr(!s || s < 0 ? 0 : +s, i.length) === i) ? (n = \"must not be\", t = t.replace(/^not /, \"\")) : n = \"must be\", function (e, t, r) { return (void 0 === r || r > e.length) && (r = e.length), e.substring(r - t.length, r) === t }(e, \" argument\")) a = \"The \".concat(e, \" \").concat(n, \" \").concat(o(t, \"type\")); else { var u = function (e, t, r) { return \"number\" != typeof r && (r = 0), !(r + t.length > e.length) && -1 !== e.indexOf(t, r) }(e, \".\") ? \"property\" : \"argument\"; a = 'The \"'.concat(e, '\" ').concat(u, \" \").concat(n, \" \").concat(o(t, \"type\")) } return a += \". Received type \".concat(typeof r) }, TypeError), i(\"ERR_STREAM_PUSH_AFTER_EOF\", \"stream.push() after EOF\"), i(\"ERR_METHOD_NOT_IMPLEMENTED\", function (e) { return \"The \" + e + \" method is not implemented\" }), i(\"ERR_STREAM_PREMATURE_CLOSE\", \"Premature close\"), i(\"ERR_STREAM_DESTROYED\", function (e) { return \"Cannot call \" + e + \" after a stream was destroyed\" }), i(\"ERR_MULTIPLE_CALLBACK\", \"Callback called multiple times\"), i(\"ERR_STREAM_CANNOT_PIPE\", \"Cannot pipe, not readable\"), i(\"ERR_STREAM_WRITE_AFTER_END\", \"write after end\"), i(\"ERR_STREAM_NULL_VALUES\", \"May not write null values to stream\", TypeError), i(\"ERR_UNKNOWN_ENCODING\", function (e) { return \"Unknown encoding: \" + e }, TypeError), i(\"ERR_STREAM_UNSHIFT_AFTER_END_EVENT\", \"stream.unshift() after end event\"), t.exports.codes = n }, {}], 52: [function (e, t, r) { (function (r) { (function () { \"use strict\"; var n = Object.keys || function (e) { var t = []; for (var r in e) t.push(r); return t }; t.exports = c; var i = e(\"./_stream_readable\"), o = e(\"./_stream_writable\"); e(\"inherits\")(c, i); for (var s = n(o.prototype), a = 0; a < s.length; a++) { var u = s[a]; c.prototype[u] || (c.prototype[u] = o.prototype[u]) } function c(e) { if (!(this instanceof c)) return new c(e); i.call(this, e), o.call(this, e), this.allowHalfOpen = !0, e && (!1 === e.readable && (this.readable = !1), !1 === e.writable && (this.writable = !1), !1 === e.allowHalfOpen && (this.allowHalfOpen = !1, this.once(\"end\", l))) } function l() { this._writableState.ended || r.nextTick(f, this) } function f(e) { e.end() } Object.defineProperty(c.prototype, \"writableHighWaterMark\", { enumerable: !1, get: function () { return this._writableState.highWaterMark } }), Object.defineProperty(c.prototype, \"writableBuffer\", { enumerable: !1, get: function () { return this._writableState && this._writableState.getBuffer() } }), Object.defineProperty(c.prototype, \"writableLength\", { enumerable: !1, get: function () { return this._writableState.length } }), Object.defineProperty(c.prototype, \"destroyed\", { enumerable: !1, get: function () { return void 0 !== this._readableState && void 0 !== this._writableState && (this._readableState.destroyed && this._writableState.destroyed) }, set: function (e) { void 0 !== this._readableState && void 0 !== this._writableState && (this._readableState.destroyed = e, this._writableState.destroyed = e) } }) }).call(this) }).call(this, e(\"_process\")) }, { \"./_stream_readable\": 54, \"./_stream_writable\": 56, _process: 46, inherits: 33 }], 53: [function (e, t, r) { \"use strict\"; t.exports = i; var n = e(\"./_stream_transform\"); function i(e) { if (!(this instanceof i)) return new i(e); n.call(this, e) } e(\"inherits\")(i, n), i.prototype._transform = function (e, t, r) { r(null, e) } }, { \"./_stream_transform\": 55, inherits: 33 }], 54: [function (e, t, r) { (function (r, n) { (function () { \"use strict\"; var i; t.exports = I, I.ReadableState = k; e(\"events\").EventEmitter; var o = function (e, t) { return e.listeners(t).length }, s = e(\"./internal/streams/stream\"), a = e(\"buffer\").Buffer, u = n.Uint8Array || function () { }; var c, l = e(\"util\"); c = l && l.debuglog ? l.debuglog(\"stream\") : function () { }; var f, h, p, d = e(\"./internal/streams/buffer_list\"), g = e(\"./internal/streams/destroy\"), b = e(\"./internal/streams/state\").getHighWaterMark, m = e(\"../errors\").codes, y = m.ERR_INVALID_ARG_TYPE, _ = m.ERR_STREAM_PUSH_AFTER_EOF, w = m.ERR_METHOD_NOT_IMPLEMENTED, v = m.ERR_STREAM_UNSHIFT_AFTER_END_EVENT; e(\"inherits\")(I, s); var S = g.errorOrDestroy, E = [\"error\", \"close\", \"destroy\", \"pause\", \"resume\"]; function k(t, r, n) { i = i || e(\"./_stream_duplex\"), t = t || {}, \"boolean\" != typeof n && (n = r instanceof i), this.objectMode = !!t.objectMode, n && (this.objectMode = this.objectMode || !!t.readableObjectMode), this.highWaterMark = b(this, t, \"readableHighWaterMark\", n), this.buffer = new d, this.length = 0, this.pipes = null, this.pipesCount = 0, this.flowing = null, this.ended = !1, this.endEmitted = !1, this.reading = !1, this.sync = !0, this.needReadable = !1, this.emittedReadable = !1, this.readableListening = !1, this.resumeScheduled = !1, this.paused = !0, this.emitClose = !1 !== t.emitClose, this.autoDestroy = !!t.autoDestroy, this.destroyed = !1, this.defaultEncoding = t.defaultEncoding || \"utf8\", this.awaitDrain = 0, this.readingMore = !1, this.decoder = null, this.encoding = null, t.encoding && (f || (f = e(\"string_decoder/\").StringDecoder), this.decoder = new f(t.encoding), this.encoding = t.encoding) } function I(t) { if (i = i || e(\"./_stream_duplex\"), !(this instanceof I)) return new I(t); var r = this instanceof i; this._readableState = new k(t, this, r), this.readable = !0, t && (\"function\" == typeof t.read && (this._read = t.read), \"function\" == typeof t.destroy && (this._destroy = t.destroy)), s.call(this) } function C(e, t, r, n, i) { c(\"readableAddChunk\", t); var o, s = e._readableState; if (null === t) s.reading = !1, function (e, t) { if (c(\"onEofChunk\"), t.ended) return; if (t.decoder) { var r = t.decoder.end(); r && r.length && (t.buffer.push(r), t.length += t.objectMode ? 1 : r.length) } t.ended = !0, t.sync ? A(e) : (t.needReadable = !1, t.emittedReadable || (t.emittedReadable = !0, M(e))) }(e, s); else if (i || (o = function (e, t) { var r; n = t, a.isBuffer(n) || n instanceof u || \"string\" == typeof t || void 0 === t || e.objectMode || (r = new y(\"chunk\", [\"string\", \"Buffer\", \"Uint8Array\"], t)); var n; return r }(s, t)), o) S(e, o); else if (s.objectMode || t && t.length > 0) if (\"string\" == typeof t || s.objectMode || Object.getPrototypeOf(t) === a.prototype || (t = function (e) { return a.from(e) }(t)), n) s.endEmitted ? S(e, new v) : T(e, s, t, !0); else if (s.ended) S(e, new _); else { if (s.destroyed) return !1; s.reading = !1, s.decoder && !r ? (t = s.decoder.write(t), s.objectMode || 0 !== t.length ? T(e, s, t, !1) : O(e, s)) : T(e, s, t, !1) } else n || (s.reading = !1, O(e, s)); return !s.ended && (s.length < s.highWaterMark || 0 === s.length) } function T(e, t, r, n) { t.flowing && 0 === t.length && !t.sync ? (t.awaitDrain = 0, e.emit(\"data\", r)) : (t.length += t.objectMode ? 1 : r.length, n ? t.buffer.unshift(r) : t.buffer.push(r), t.needReadable && A(e)), O(e, t) } Object.defineProperty(I.prototype, \"destroyed\", { enumerable: !1, get: function () { return void 0 !== this._readableState && this._readableState.destroyed }, set: function (e) { this._readableState && (this._readableState.destroyed = e) } }), I.prototype.destroy = g.destroy, I.prototype._undestroy = g.undestroy, I.prototype._destroy = function (e, t) { t(e) }, I.prototype.push = function (e, t) { var r, n = this._readableState; return n.objectMode ? r = !0 : \"string\" == typeof e && ((t = t || n.defaultEncoding) !== n.encoding && (e = a.from(e, t), t = \"\"), r = !0), C(this, e, t, !1, r) }, I.prototype.unshift = function (e) { return C(this, e, null, !0, !1) }, I.prototype.isPaused = function () { return !1 === this._readableState.flowing }, I.prototype.setEncoding = function (t) { f || (f = e(\"string_decoder/\").StringDecoder); var r = new f(t); this._readableState.decoder = r, this._readableState.encoding = this._readableState.decoder.encoding; for (var n = this._readableState.buffer.head, i = \"\"; null !== n;)i += r.write(n.data), n = n.next; return this._readableState.buffer.clear(), \"\" !== i && this._readableState.buffer.push(i), this._readableState.length = i.length, this }; var x = 1073741824; function R(e, t) { return e <= 0 || 0 === t.length && t.ended ? 0 : t.objectMode ? 1 : e != e ? t.flowing && t.length ? t.buffer.head.data.length : t.length : (e > t.highWaterMark && (t.highWaterMark = function (e) { return e >= x ? e = x : (e-- , e |= e >>> 1, e |= e >>> 2, e |= e >>> 4, e |= e >>> 8, e |= e >>> 16, e++), e }(e)), e <= t.length ? e : t.ended ? t.length : (t.needReadable = !0, 0)) } function A(e) { var t = e._readableState; c(\"emitReadable\", t.needReadable, t.emittedReadable), t.needReadable = !1, t.emittedReadable || (c(\"emitReadable\", t.flowing), t.emittedReadable = !0, r.nextTick(M, e)) } function M(e) { var t = e._readableState; c(\"emitReadable_\", t.destroyed, t.length, t.ended), t.destroyed || !t.length && !t.ended || (e.emit(\"readable\"), t.emittedReadable = !1), t.needReadable = !t.flowing && !t.ended && t.length <= t.highWaterMark, U(e) } function O(e, t) { t.readingMore || (t.readingMore = !0, r.nextTick(P, e, t)) } function P(e, t) { for (; !t.reading && !t.ended && (t.length < t.highWaterMark || t.flowing && 0 === t.length);) { var r = t.length; if (c(\"maybeReadMore read 0\"), e.read(0), r === t.length) break } t.readingMore = !1 } function B(e) { var t = e._readableState; t.readableListening = e.listenerCount(\"readable\") > 0, t.resumeScheduled && !t.paused ? t.flowing = !0 : e.listenerCount(\"data\") > 0 && e.resume() } function L(e) { c(\"readable nexttick read 0\"), e.read(0) } function j(e, t) { c(\"resume\", t.reading), t.reading || e.read(0), t.resumeScheduled = !1, e.emit(\"resume\"), U(e), t.flowing && !t.reading && e.read(0) } function U(e) { var t = e._readableState; for (c(\"flow\", t.flowing); t.flowing && null !== e.read();); } function N(e, t) { return 0 === t.length ? null : (t.objectMode ? r = t.buffer.shift() : !e || e >= t.length ? (r = t.decoder ? t.buffer.join(\"\") : 1 === t.buffer.length ? t.buffer.first() : t.buffer.concat(t.length), t.buffer.clear()) : r = t.buffer.consume(e, t.decoder), r); var r } function q(e) { var t = e._readableState; c(\"endReadable\", t.endEmitted), t.endEmitted || (t.ended = !0, r.nextTick(D, t, e)) } function D(e, t) { if (c(\"endReadableNT\", e.endEmitted, e.length), !e.endEmitted && 0 === e.length && (e.endEmitted = !0, t.readable = !1, t.emit(\"end\"), e.autoDestroy)) { var r = t._writableState; (!r || r.autoDestroy && r.finished) && t.destroy() } } function F(e, t) { for (var r = 0, n = e.length; r < n; r++)if (e[r] === t) return r; return -1 } I.prototype.read = function (e) { c(\"read\", e), e = parseInt(e, 10); var t = this._readableState, r = e; if (0 !== e && (t.emittedReadable = !1), 0 === e && t.needReadable && ((0 !== t.highWaterMark ? t.length >= t.highWaterMark : t.length > 0) || t.ended)) return c(\"read: emitReadable\", t.length, t.ended), 0 === t.length && t.ended ? q(this) : A(this), null; if (0 === (e = R(e, t)) && t.ended) return 0 === t.length && q(this), null; var n, i = t.needReadable; return c(\"need readable\", i), (0 === t.length || t.length - e < t.highWaterMark) && c(\"length less than watermark\", i = !0), t.ended || t.reading ? c(\"reading or ended\", i = !1) : i && (c(\"do read\"), t.reading = !0, t.sync = !0, 0 === t.length && (t.needReadable = !0), this._read(t.highWaterMark), t.sync = !1, t.reading || (e = R(r, t))), null === (n = e > 0 ? N(e, t) : null) ? (t.needReadable = t.length <= t.highWaterMark, e = 0) : (t.length -= e, t.awaitDrain = 0), 0 === t.length && (t.ended || (t.needReadable = !0), r !== e && t.ended && q(this)), null !== n && this.emit(\"data\", n), n }, I.prototype._read = function (e) { S(this, new w(\"_read()\")) }, I.prototype.pipe = function (e, t) { var n = this, i = this._readableState; switch (i.pipesCount) { case 0: i.pipes = e; break; case 1: i.pipes = [i.pipes, e]; break; default: i.pipes.push(e) }i.pipesCount += 1, c(\"pipe count=%d opts=%j\", i.pipesCount, t); var s = (!t || !1 !== t.end) && e !== r.stdout && e !== r.stderr ? u : b; function a(t, r) { c(\"onunpipe\"), t === n && r && !1 === r.hasUnpiped && (r.hasUnpiped = !0, c(\"cleanup\"), e.removeListener(\"close\", d), e.removeListener(\"finish\", g), e.removeListener(\"drain\", l), e.removeListener(\"error\", p), e.removeListener(\"unpipe\", a), n.removeListener(\"end\", u), n.removeListener(\"end\", b), n.removeListener(\"data\", h), f = !0, !i.awaitDrain || e._writableState && !e._writableState.needDrain || l()) } function u() { c(\"onend\"), e.end() } i.endEmitted ? r.nextTick(s) : n.once(\"end\", s), e.on(\"unpipe\", a); var l = function (e) { return function () { var t = e._readableState; c(\"pipeOnDrain\", t.awaitDrain), t.awaitDrain && t.awaitDrain-- , 0 === t.awaitDrain && o(e, \"data\") && (t.flowing = !0, U(e)) } }(n); e.on(\"drain\", l); var f = !1; function h(t) { c(\"ondata\"); var r = e.write(t); c(\"dest.write\", r), !1 === r && ((1 === i.pipesCount && i.pipes === e || i.pipesCount > 1 && -1 !== F(i.pipes, e)) && !f && (c(\"false write response, pause\", i.awaitDrain), i.awaitDrain++), n.pause()) } function p(t) { c(\"onerror\", t), b(), e.removeListener(\"error\", p), 0 === o(e, \"error\") && S(e, t) } function d() { e.removeListener(\"finish\", g), b() } function g() { c(\"onfinish\"), e.removeListener(\"close\", d), b() } function b() { c(\"unpipe\"), n.unpipe(e) } return n.on(\"data\", h), function (e, t, r) { if (\"function\" == typeof e.prependListener) return e.prependListener(t, r); e._events && e._events[t] ? Array.isArray(e._events[t]) ? e._events[t].unshift(r) : e._events[t] = [r, e._events[t]] : e.on(t, r) }(e, \"error\", p), e.once(\"close\", d), e.once(\"finish\", g), e.emit(\"pipe\", n), i.flowing || (c(\"pipe resume\"), n.resume()), e }, I.prototype.unpipe = function (e) { var t = this._readableState, r = { hasUnpiped: !1 }; if (0 === t.pipesCount) return this; if (1 === t.pipesCount) return e && e !== t.pipes ? this : (e || (e = t.pipes), t.pipes = null, t.pipesCount = 0, t.flowing = !1, e && e.emit(\"unpipe\", this, r), this); if (!e) { var n = t.pipes, i = t.pipesCount; t.pipes = null, t.pipesCount = 0, t.flowing = !1; for (var o = 0; o < i; o++)n[o].emit(\"unpipe\", this, { hasUnpiped: !1 }); return this } var s = F(t.pipes, e); return -1 === s ? this : (t.pipes.splice(s, 1), t.pipesCount -= 1, 1 === t.pipesCount && (t.pipes = t.pipes[0]), e.emit(\"unpipe\", this, r), this) }, I.prototype.on = function (e, t) { var n = s.prototype.on.call(this, e, t), i = this._readableState; return \"data\" === e ? (i.readableListening = this.listenerCount(\"readable\") > 0, !1 !== i.flowing && this.resume()) : \"readable\" === e && (i.endEmitted || i.readableListening || (i.readableListening = i.needReadable = !0, i.flowing = !1, i.emittedReadable = !1, c(\"on readable\", i.length, i.reading), i.length ? A(this) : i.reading || r.nextTick(L, this))), n }, I.prototype.addListener = I.prototype.on, I.prototype.removeListener = function (e, t) { var n = s.prototype.removeListener.call(this, e, t); return \"readable\" === e && r.nextTick(B, this), n }, I.prototype.removeAllListeners = function (e) { var t = s.prototype.removeAllListeners.apply(this, arguments); return \"readable\" !== e && void 0 !== e || r.nextTick(B, this), t }, I.prototype.resume = function () { var e = this._readableState; return e.flowing || (c(\"resume\"), e.flowing = !e.readableListening, function (e, t) { t.resumeScheduled || (t.resumeScheduled = !0, r.nextTick(j, e, t)) }(this, e)), e.paused = !1, this }, I.prototype.pause = function () { return c(\"call pause flowing=%j\", this._readableState.flowing), !1 !== this._readableState.flowing && (c(\"pause\"), this._readableState.flowing = !1, this.emit(\"pause\")), this._readableState.paused = !0, this }, I.prototype.wrap = function (e) { var t = this, r = this._readableState, n = !1; for (var i in e.on(\"end\", function () { if (c(\"wrapped end\"), r.decoder && !r.ended) { var e = r.decoder.end(); e && e.length && t.push(e) } t.push(null) }), e.on(\"data\", function (i) { (c(\"wrapped data\"), r.decoder && (i = r.decoder.write(i)), !r.objectMode || null !== i && void 0 !== i) && ((r.objectMode || i && i.length) && (t.push(i) || (n = !0, e.pause()))) }), e) void 0 === this[i] && \"function\" == typeof e[i] && (this[i] = function (t) { return function () { return e[t].apply(e, arguments) } }(i)); for (var o = 0; o < E.length; o++)e.on(E[o], this.emit.bind(this, E[o])); return this._read = function (t) { c(\"wrapped _read\", t), n && (n = !1, e.resume()) }, this }, \"function\" == typeof Symbol && (I.prototype[Symbol.asyncIterator] = function () { return void 0 === h && (h = e(\"./internal/streams/async_iterator\")), h(this) }), Object.defineProperty(I.prototype, \"readableHighWaterMark\", { enumerable: !1, get: function () { return this._readableState.highWaterMark } }), Object.defineProperty(I.prototype, \"readableBuffer\", { enumerable: !1, get: function () { return this._readableState && this._readableState.buffer } }), Object.defineProperty(I.prototype, \"readableFlowing\", { enumerable: !1, get: function () { return this._readableState.flowing }, set: function (e) { this._readableState && (this._readableState.flowing = e) } }), I._fromList = N, Object.defineProperty(I.prototype, \"readableLength\", { enumerable: !1, get: function () { return this._readableState.length } }), \"function\" == typeof Symbol && (I.from = function (t, r) { return void 0 === p && (p = e(\"./internal/streams/from\")), p(I, t, r) }) }).call(this) }).call(this, e(\"_process\"), \"undefined\" != typeof global ? global : \"undefined\" != typeof self ? self : \"undefined\" != typeof window ? window : {}) }, { \"../errors\": 51, \"./_stream_duplex\": 52, \"./internal/streams/async_iterator\": 57, \"./internal/streams/buffer_list\": 58, \"./internal/streams/destroy\": 59, \"./internal/streams/from\": 61, \"./internal/streams/state\": 63, \"./internal/streams/stream\": 64, _process: 46, buffer: 14, events: 31, inherits: 33, \"string_decoder/\": 69, util: 13 }], 55: [function (e, t, r) { \"use strict\"; t.exports = c; var n = e(\"../errors\").codes, i = n.ERR_METHOD_NOT_IMPLEMENTED, o = n.ERR_MULTIPLE_CALLBACK, s = n.ERR_TRANSFORM_ALREADY_TRANSFORMING, a = n.ERR_TRANSFORM_WITH_LENGTH_0, u = e(\"./_stream_duplex\"); function c(e) { if (!(this instanceof c)) return new c(e); u.call(this, e), this._transformState = { afterTransform: function (e, t) { var r = this._transformState; r.transforming = !1; var n = r.writecb; if (null === n) return this.emit(\"error\", new o); r.writechunk = null, r.writecb = null, null != t && this.push(t), n(e); var i = this._readableState; i.reading = !1, (i.needReadable || i.length < i.highWaterMark) && this._read(i.highWaterMark) }.bind(this), needTransform: !1, transforming: !1, writecb: null, writechunk: null, writeencoding: null }, this._readableState.needReadable = !0, this._readableState.sync = !1, e && (\"function\" == typeof e.transform && (this._transform = e.transform), \"function\" == typeof e.flush && (this._flush = e.flush)), this.on(\"prefinish\", l) } function l() { var e = this; \"function\" != typeof this._flush || this._readableState.destroyed ? f(this, null, null) : this._flush(function (t, r) { f(e, t, r) }) } function f(e, t, r) { if (t) return e.emit(\"error\", t); if (null != r && e.push(r), e._writableState.length) throw new a; if (e._transformState.transforming) throw new s; return e.push(null) } e(\"inherits\")(c, u), c.prototype.push = function (e, t) { return this._transformState.needTransform = !1, u.prototype.push.call(this, e, t) }, c.prototype._transform = function (e, t, r) { r(new i(\"_transform()\")) }, c.prototype._write = function (e, t, r) { var n = this._transformState; if (n.writecb = r, n.writechunk = e, n.writeencoding = t, !n.transforming) { var i = this._readableState; (n.needTransform || i.needReadable || i.length < i.highWaterMark) && this._read(i.highWaterMark) } }, c.prototype._read = function (e) { var t = this._transformState; null === t.writechunk || t.transforming ? t.needTransform = !0 : (t.transforming = !0, this._transform(t.writechunk, t.writeencoding, t.afterTransform)) }, c.prototype._destroy = function (e, t) { u.prototype._destroy.call(this, e, function (e) { t(e) }) } }, { \"../errors\": 51, \"./_stream_duplex\": 52, inherits: 33 }], 56: [function (e, t, r) { (function (r, n) { (function () { \"use strict\"; function i(e) { var t = this; this.next = null, this.entry = null, this.finish = function () { !function (e, t, r) { var n = e.entry; e.entry = null; for (; n;) { var i = n.callback; t.pendingcb-- , i(r), n = n.next } t.corkedRequestsFree.next = e }(t, e) } } var o; t.exports = I, I.WritableState = k; var s = { deprecate: e(\"util-deprecate\") }, a = e(\"./internal/streams/stream\"), u = e(\"buffer\").Buffer, c = n.Uint8Array || function () { }; var l, f = e(\"./internal/streams/destroy\"), h = e(\"./internal/streams/state\").getHighWaterMark, p = e(\"../errors\").codes, d = p.ERR_INVALID_ARG_TYPE, g = p.ERR_METHOD_NOT_IMPLEMENTED, b = p.ERR_MULTIPLE_CALLBACK, m = p.ERR_STREAM_CANNOT_PIPE, y = p.ERR_STREAM_DESTROYED, _ = p.ERR_STREAM_NULL_VALUES, w = p.ERR_STREAM_WRITE_AFTER_END, v = p.ERR_UNKNOWN_ENCODING, S = f.errorOrDestroy; function E() { } function k(t, n, s) { o = o || e(\"./_stream_duplex\"), t = t || {}, \"boolean\" != typeof s && (s = n instanceof o), this.objectMode = !!t.objectMode, s && (this.objectMode = this.objectMode || !!t.writableObjectMode), this.highWaterMark = h(this, t, \"writableHighWaterMark\", s), this.finalCalled = !1, this.needDrain = !1, this.ending = !1, this.ended = !1, this.finished = !1, this.destroyed = !1; var a = !1 === t.decodeStrings; this.decodeStrings = !a, this.defaultEncoding = t.defaultEncoding || \"utf8\", this.length = 0, this.writing = !1, this.corked = 0, this.sync = !0, this.bufferProcessing = !1, this.onwrite = function (e) { !function (e, t) { var n = e._writableState, i = n.sync, o = n.writecb; if (\"function\" != typeof o) throw new b; if (function (e) { e.writing = !1, e.writecb = null, e.length -= e.writelen, e.writelen = 0 }(n), t) !function (e, t, n, i, o) { --t.pendingcb, n ? (r.nextTick(o, i), r.nextTick(M, e, t), e._writableState.errorEmitted = !0, S(e, i)) : (o(i), e._writableState.errorEmitted = !0, S(e, i), M(e, t)) }(e, n, i, t, o); else { var s = R(n) || e.destroyed; s || n.corked || n.bufferProcessing || !n.bufferedRequest || x(e, n), i ? r.nextTick(T, e, n, s, o) : T(e, n, s, o) } }(n, e) }, this.writecb = null, this.writelen = 0, this.bufferedRequest = null, this.lastBufferedRequest = null, this.pendingcb = 0, this.prefinished = !1, this.errorEmitted = !1, this.emitClose = !1 !== t.emitClose, this.autoDestroy = !!t.autoDestroy, this.bufferedRequestCount = 0, this.corkedRequestsFree = new i(this) } function I(t) { var r = this instanceof (o = o || e(\"./_stream_duplex\")); if (!r && !l.call(I, this)) return new I(t); this._writableState = new k(t, this, r), this.writable = !0, t && (\"function\" == typeof t.write && (this._write = t.write), \"function\" == typeof t.writev && (this._writev = t.writev), \"function\" == typeof t.destroy && (this._destroy = t.destroy), \"function\" == typeof t.final && (this._final = t.final)), a.call(this) } function C(e, t, r, n, i, o, s) { t.writelen = n, t.writecb = s, t.writing = !0, t.sync = !0, t.destroyed ? t.onwrite(new y(\"write\")) : r ? e._writev(i, t.onwrite) : e._write(i, o, t.onwrite), t.sync = !1 } function T(e, t, r, n) { r || function (e, t) { 0 === t.length && t.needDrain && (t.needDrain = !1, e.emit(\"drain\")) }(e, t), t.pendingcb-- , n(), M(e, t) } function x(e, t) { t.bufferProcessing = !0; var r = t.bufferedRequest; if (e._writev && r && r.next) { var n = t.bufferedRequestCount, o = new Array(n), s = t.corkedRequestsFree; s.entry = r; for (var a = 0, u = !0; r;)o[a] = r, r.isBuf || (u = !1), r = r.next, a += 1; o.allBuffers = u, C(e, t, !0, t.length, o, \"\", s.finish), t.pendingcb++ , t.lastBufferedRequest = null, s.next ? (t.corkedRequestsFree = s.next, s.next = null) : t.corkedRequestsFree = new i(t), t.bufferedRequestCount = 0 } else { for (; r;) { var c = r.chunk, l = r.encoding, f = r.callback; if (C(e, t, !1, t.objectMode ? 1 : c.length, c, l, f), r = r.next, t.bufferedRequestCount-- , t.writing) break } null === r && (t.lastBufferedRequest = null) } t.bufferedRequest = r, t.bufferProcessing = !1 } function R(e) { return e.ending && 0 === e.length && null === e.bufferedRequest && !e.finished && !e.writing } function A(e, t) { e._final(function (r) { t.pendingcb-- , r && S(e, r), t.prefinished = !0, e.emit(\"prefinish\"), M(e, t) }) } function M(e, t) { var n = R(t); if (n && (function (e, t) { t.prefinished || t.finalCalled || (\"function\" != typeof e._final || t.destroyed ? (t.prefinished = !0, e.emit(\"prefinish\")) : (t.pendingcb++ , t.finalCalled = !0, r.nextTick(A, e, t))) }(e, t), 0 === t.pendingcb && (t.finished = !0, e.emit(\"finish\"), t.autoDestroy))) { var i = e._readableState; (!i || i.autoDestroy && i.endEmitted) && e.destroy() } return n } e(\"inherits\")(I, a), k.prototype.getBuffer = function () { for (var e = this.bufferedRequest, t = []; e;)t.push(e), e = e.next; return t }, function () { try { Object.defineProperty(k.prototype, \"buffer\", { get: s.deprecate(function () { return this.getBuffer() }, \"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.\", \"DEP0003\") }) } catch (e) { } }(), \"function\" == typeof Symbol && Symbol.hasInstance && \"function\" == typeof Function.prototype[Symbol.hasInstance] ? (l = Function.prototype[Symbol.hasInstance], Object.defineProperty(I, Symbol.hasInstance, { value: function (e) { return !!l.call(this, e) || this === I && (e && e._writableState instanceof k) } })) : l = function (e) { return e instanceof this }, I.prototype.pipe = function () { S(this, new m) }, I.prototype.write = function (e, t, n) { var i, o = this._writableState, s = !1, a = !o.objectMode && (i = e, u.isBuffer(i) || i instanceof c); return a && !u.isBuffer(e) && (e = function (e) { return u.from(e) }(e)), \"function\" == typeof t && (n = t, t = null), a ? t = \"buffer\" : t || (t = o.defaultEncoding), \"function\" != typeof n && (n = E), o.ending ? function (e, t) { var n = new w; S(e, n), r.nextTick(t, n) }(this, n) : (a || function (e, t, n, i) { var o; return null === n ? o = new _ : \"string\" == typeof n || t.objectMode || (o = new d(\"chunk\", [\"string\", \"Buffer\"], n)), !o || (S(e, o), r.nextTick(i, o), !1) }(this, o, e, n)) && (o.pendingcb++ , s = function (e, t, r, n, i, o) { if (!r) { var s = function (e, t, r) { e.objectMode || !1 === e.decodeStrings || \"string\" != typeof t || (t = u.from(t, r)); return t }(t, n, i); n !== s && (r = !0, i = \"buffer\", n = s) } var a = t.objectMode ? 1 : n.length; t.length += a; var c = t.length < t.highWaterMark; c || (t.needDrain = !0); if (t.writing || t.corked) { var l = t.lastBufferedRequest; t.lastBufferedRequest = { chunk: n, encoding: i, isBuf: r, callback: o, next: null }, l ? l.next = t.lastBufferedRequest : t.bufferedRequest = t.lastBufferedRequest, t.bufferedRequestCount += 1 } else C(e, t, !1, a, n, i, o); return c }(this, o, a, e, t, n)), s }, I.prototype.cork = function () { this._writableState.corked++ }, I.prototype.uncork = function () { var e = this._writableState; e.corked && (e.corked-- , e.writing || e.corked || e.bufferProcessing || !e.bufferedRequest || x(this, e)) }, I.prototype.setDefaultEncoding = function (e) { if (\"string\" == typeof e && (e = e.toLowerCase()), !([\"hex\", \"utf8\", \"utf-8\", \"ascii\", \"binary\", \"base64\", \"ucs2\", \"ucs-2\", \"utf16le\", \"utf-16le\", \"raw\"].indexOf((e + \"\").toLowerCase()) > -1)) throw new v(e); return this._writableState.defaultEncoding = e, this }, Object.defineProperty(I.prototype, \"writableBuffer\", { enumerable: !1, get: function () { return this._writableState && this._writableState.getBuffer() } }), Object.defineProperty(I.prototype, \"writableHighWaterMark\", { enumerable: !1, get: function () { return this._writableState.highWaterMark } }), I.prototype._write = function (e, t, r) { r(new g(\"_write()\")) }, I.prototype._writev = null, I.prototype.end = function (e, t, n) { var i = this._writableState; return \"function\" == typeof e ? (n = e, e = null, t = null) : \"function\" == typeof t && (n = t, t = null), null !== e && void 0 !== e && this.write(e, t), i.corked && (i.corked = 1, this.uncork()), i.ending || function (e, t, n) { t.ending = !0, M(e, t), n && (t.finished ? r.nextTick(n) : e.once(\"finish\", n)); t.ended = !0, e.writable = !1 }(this, i, n), this }, Object.defineProperty(I.prototype, \"writableLength\", { enumerable: !1, get: function () { return this._writableState.length } }), Object.defineProperty(I.prototype, \"destroyed\", { enumerable: !1, get: function () { return void 0 !== this._writableState && this._writableState.destroyed }, set: function (e) { this._writableState && (this._writableState.destroyed = e) } }), I.prototype.destroy = f.destroy, I.prototype._undestroy = f.undestroy, I.prototype._destroy = function (e, t) { t(e) } }).call(this) }).call(this, e(\"_process\"), \"undefined\" != typeof global ? global : \"undefined\" != typeof self ? self : \"undefined\" != typeof window ? window : {}) }, { \"../errors\": 51, \"./_stream_duplex\": 52, \"./internal/streams/destroy\": 59, \"./internal/streams/state\": 63, \"./internal/streams/stream\": 64, _process: 46, buffer: 14, inherits: 33, \"util-deprecate\": 73 }], 57: [function (e, t, r) { (function (r) { (function () { \"use strict\"; var n; function i(e, t, r) { return t in e ? Object.defineProperty(e, t, { value: r, enumerable: !0, configurable: !0, writable: !0 }) : e[t] = r, e } var o = e(\"./end-of-stream\"), s = Symbol(\"lastResolve\"), a = Symbol(\"lastReject\"), u = Symbol(\"error\"), c = Symbol(\"ended\"), l = Symbol(\"lastPromise\"), f = Symbol(\"handlePromise\"), h = Symbol(\"stream\"); function p(e, t) { return { value: e, done: t } } function d(e) { var t = e[s]; if (null !== t) { var r = e[h].read(); null !== r && (e[l] = null, e[s] = null, e[a] = null, t(p(r, !1))) } } var g = Object.getPrototypeOf(function () { }), b = Object.setPrototypeOf((i(n = { get stream() { return this[h] }, next: function () { var e = this, t = this[u]; if (null !== t) return Promise.reject(t); if (this[c]) return Promise.resolve(p(void 0, !0)); if (this[h].destroyed) return new Promise(function (t, n) { r.nextTick(function () { e[u] ? n(e[u]) : t(p(void 0, !0)) }) }); var n, i = this[l]; if (i) n = new Promise(function (e, t) { return function (r, n) { e.then(function () { t[c] ? r(p(void 0, !0)) : t[f](r, n) }, n) } }(i, this)); else { var o = this[h].read(); if (null !== o) return Promise.resolve(p(o, !1)); n = new Promise(this[f]) } return this[l] = n, n } }, Symbol.asyncIterator, function () { return this }), i(n, \"return\", function () { var e = this; return new Promise(function (t, r) { e[h].destroy(null, function (e) { e ? r(e) : t(p(void 0, !0)) }) }) }), n), g); t.exports = function (e) { var t, n = Object.create(b, (i(t = {}, h, { value: e, writable: !0 }), i(t, s, { value: null, writable: !0 }), i(t, a, { value: null, writable: !0 }), i(t, u, { value: null, writable: !0 }), i(t, c, { value: e._readableState.endEmitted, writable: !0 }), i(t, f, { value: function (e, t) { var r = n[h].read(); r ? (n[l] = null, n[s] = null, n[a] = null, e(p(r, !1))) : (n[s] = e, n[a] = t) }, writable: !0 }), t)); return n[l] = null, o(e, function (e) { if (e && \"ERR_STREAM_PREMATURE_CLOSE\" !== e.code) { var t = n[a]; return null !== t && (n[l] = null, n[s] = null, n[a] = null, t(e)), void (n[u] = e) } var r = n[s]; null !== r && (n[l] = null, n[s] = null, n[a] = null, r(p(void 0, !0))), n[c] = !0 }), e.on(\"readable\", function (e) { r.nextTick(d, e) }.bind(null, n)), n } }).call(this) }).call(this, e(\"_process\")) }, { \"./end-of-stream\": 60, _process: 46 }], 58: [function (e, t, r) { \"use strict\"; function n(e, t) { var r = Object.keys(e); if (Object.getOwnPropertySymbols) { var n = Object.getOwnPropertySymbols(e); t && (n = n.filter(function (t) { return Object.getOwnPropertyDescriptor(e, t).enumerable })), r.push.apply(r, n) } return r } function i(e, t, r) { return t in e ? Object.defineProperty(e, t, { value: r, enumerable: !0, configurable: !0, writable: !0 }) : e[t] = r, e } function o(e, t) { for (var r = 0; r < t.length; r++) { var n = t[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, \"value\" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } var s = e(\"buffer\").Buffer, a = e(\"util\").inspect, u = a && a.custom || \"inspect\"; t.exports = function () { function e() { !function (e, t) { if (!(e instanceof t)) throw new TypeError(\"Cannot call a class as a function\") }(this, e), this.head = null, this.tail = null, this.length = 0 } var t, r, c; return t = e, (r = [{ key: \"push\", value: function (e) { var t = { data: e, next: null }; this.length > 0 ? this.tail.next = t : this.head = t, this.tail = t, ++this.length } }, { key: \"unshift\", value: function (e) { var t = { data: e, next: this.head }; 0 === this.length && (this.tail = t), this.head = t, ++this.length } }, { key: \"shift\", value: function () { if (0 !== this.length) { var e = this.head.data; return 1 === this.length ? this.head = this.tail = null : this.head = this.head.next, --this.length, e } } }, { key: \"clear\", value: function () { this.head = this.tail = null, this.length = 0 } }, { key: \"join\", value: function (e) { if (0 === this.length) return \"\"; for (var t = this.head, r = \"\" + t.data; t = t.next;)r += e + t.data; return r } }, { key: \"concat\", value: function (e) { if (0 === this.length) return s.alloc(0); for (var t, r, n, i = s.allocUnsafe(e >>> 0), o = this.head, a = 0; o;)t = o.data, r = i, n = a, s.prototype.copy.call(t, r, n), a += o.data.length, o = o.next; return i } }, { key: \"consume\", value: function (e, t) { var r; return e < this.head.data.length ? (r = this.head.data.slice(0, e), this.head.data = this.head.data.slice(e)) : r = e === this.head.data.length ? this.shift() : t ? this._getString(e) : this._getBuffer(e), r } }, { key: \"first\", value: function () { return this.head.data } }, { key: \"_getString\", value: function (e) { var t = this.head, r = 1, n = t.data; for (e -= n.length; t = t.next;) { var i = t.data, o = e > i.length ? i.length : e; if (o === i.length ? n += i : n += i.slice(0, e), 0 === (e -= o)) { o === i.length ? (++r, t.next ? this.head = t.next : this.head = this.tail = null) : (this.head = t, t.data = i.slice(o)); break } ++r } return this.length -= r, n } }, { key: \"_getBuffer\", value: function (e) { var t = s.allocUnsafe(e), r = this.head, n = 1; for (r.data.copy(t), e -= r.data.length; r = r.next;) { var i = r.data, o = e > i.length ? i.length : e; if (i.copy(t, t.length - e, 0, o), 0 === (e -= o)) { o === i.length ? (++n, r.next ? this.head = r.next : this.head = this.tail = null) : (this.head = r, r.data = i.slice(o)); break } ++n } return this.length -= n, t } }, { key: u, value: function (e, t) { return a(this, function (e) { for (var t = 1; t < arguments.length; t++) { var r = null != arguments[t] ? arguments[t] : {}; t % 2 ? n(Object(r), !0).forEach(function (t) { i(e, t, r[t]) }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(r)) : n(Object(r)).forEach(function (t) { Object.defineProperty(e, t, Object.getOwnPropertyDescriptor(r, t)) }) } return e }({}, t, { depth: 0, customInspect: !1 })) } }]) && o(t.prototype, r), c && o(t, c), e }() }, { buffer: 14, util: 13 }], 59: [function (e, t, r) { (function (e) { (function () { \"use strict\"; function r(e, t) { i(e, t), n(e) } function n(e) { e._writableState && !e._writableState.emitClose || e._readableState && !e._readableState.emitClose || e.emit(\"close\") } function i(e, t) { e.emit(\"error\", t) } t.exports = { destroy: function (t, o) { var s = this, a = this._readableState && this._readableState.destroyed, u = this._writableState && this._writableState.destroyed; return a || u ? (o ? o(t) : t && (this._writableState ? this._writableState.errorEmitted || (this._writableState.errorEmitted = !0, e.nextTick(i, this, t)) : e.nextTick(i, this, t)), this) : (this._readableState && (this._readableState.destroyed = !0), this._writableState && (this._writableState.destroyed = !0), this._destroy(t || null, function (t) { !o && t ? s._writableState ? s._writableState.errorEmitted ? e.nextTick(n, s) : (s._writableState.errorEmitted = !0, e.nextTick(r, s, t)) : e.nextTick(r, s, t) : o ? (e.nextTick(n, s), o(t)) : e.nextTick(n, s) }), this) }, undestroy: function () { this._readableState && (this._readableState.destroyed = !1, this._readableState.reading = !1, this._readableState.ended = !1, this._readableState.endEmitted = !1), this._writableState && (this._writableState.destroyed = !1, this._writableState.ended = !1, this._writableState.ending = !1, this._writableState.finalCalled = !1, this._writableState.prefinished = !1, this._writableState.finished = !1, this._writableState.errorEmitted = !1) }, errorOrDestroy: function (e, t) { var r = e._readableState, n = e._writableState; r && r.autoDestroy || n && n.autoDestroy ? e.destroy(t) : e.emit(\"error\", t) } } }).call(this) }).call(this, e(\"_process\")) }, { _process: 46 }], 60: [function (e, t, r) { \"use strict\"; var n = e(\"../../../errors\").codes.ERR_STREAM_PREMATURE_CLOSE; function i() { } t.exports = function e(t, r, o) { if (\"function\" == typeof r) return e(t, null, r); r || (r = {}), o = function (e) { var t = !1; return function () { if (!t) { t = !0; for (var r = arguments.length, n = new Array(r), i = 0; i < r; i++)n[i] = arguments[i]; e.apply(this, n) } } }(o || i); var s = r.readable || !1 !== r.readable && t.readable, a = r.writable || !1 !== r.writable && t.writable, u = function () { t.writable || l() }, c = t._writableState && t._writableState.finished, l = function () { a = !1, c = !0, s || o.call(t) }, f = t._readableState && t._readableState.endEmitted, h = function () { s = !1, f = !0, a || o.call(t) }, p = function (e) { o.call(t, e) }, d = function () { var e; return s && !f ? (t._readableState && t._readableState.ended || (e = new n), o.call(t, e)) : a && !c ? (t._writableState && t._writableState.ended || (e = new n), o.call(t, e)) : void 0 }, g = function () { t.req.on(\"finish\", l) }; return function (e) { return e.setHeader && \"function\" == typeof e.abort }(t) ? (t.on(\"complete\", l), t.on(\"abort\", d), t.req ? g() : t.on(\"request\", g)) : a && !t._writableState && (t.on(\"end\", u), t.on(\"close\", u)), t.on(\"end\", h), t.on(\"finish\", l), !1 !== r.error && t.on(\"error\", p), t.on(\"close\", d), function () { t.removeListener(\"complete\", l), t.removeListener(\"abort\", d), t.removeListener(\"request\", g), t.req && t.req.removeListener(\"finish\", l), t.removeListener(\"end\", u), t.removeListener(\"close\", u), t.removeListener(\"finish\", l), t.removeListener(\"end\", h), t.removeListener(\"error\", p), t.removeListener(\"close\", d) } } }, { \"../../../errors\": 51 }], 61: [function (e, t, r) { t.exports = function () { throw new Error(\"Readable.from is not available in the browser\") } }, {}], 62: [function (e, t, r) { \"use strict\"; var n; var i = e(\"../../../errors\").codes, o = i.ERR_MISSING_ARGS, s = i.ERR_STREAM_DESTROYED; function a(e) { if (e) throw e } function u(e) { e() } function c(e, t) { return e.pipe(t) } t.exports = function () { for (var t = arguments.length, r = new Array(t), i = 0; i < t; i++)r[i] = arguments[i]; var l, f = function (e) { return e.length ? \"function\" != typeof e[e.length - 1] ? a : e.pop() : a }(r); if (Array.isArray(r[0]) && (r = r[0]), r.length < 2) throw new o(\"streams\"); var h = r.map(function (t, i) { var o = i < r.length - 1; return function (t, r, i, o) { o = function (e) { var t = !1; return function () { t || (t = !0, e.apply(void 0, arguments)) } }(o); var a = !1; t.on(\"close\", function () { a = !0 }), void 0 === n && (n = e(\"./end-of-stream\")), n(t, { readable: r, writable: i }, function (e) { if (e) return o(e); a = !0, o() }); var u = !1; return function (e) { if (!a && !u) return u = !0, function (e) { return e.setHeader && \"function\" == typeof e.abort }(t) ? t.abort() : \"function\" == typeof t.destroy ? t.destroy() : void o(e || new s(\"pipe\")) } }(t, o, i > 0, function (e) { l || (l = e), e && h.forEach(u), o || (h.forEach(u), f(l)) }) }); return r.reduce(c) } }, { \"../../../errors\": 51, \"./end-of-stream\": 60 }], 63: [function (e, t, r) { \"use strict\"; var n = e(\"../../../errors\").codes.ERR_INVALID_OPT_VALUE; t.exports = { getHighWaterMark: function (e, t, r, i) { var o = function (e, t, r) { return null != e.highWaterMark ? e.highWaterMark : t ? e[r] : null }(t, i, r); if (null != o) { if (!isFinite(o) || Math.floor(o) !== o || o < 0) throw new n(i ? r : \"highWaterMark\", o); return Math.floor(o) } return e.objectMode ? 16 : 16384 } } }, { \"../../../errors\": 51 }], 64: [function (e, t, r) { arguments[4][26][0].apply(r, arguments) }, { dup: 26, events: 31 }], 65: [function (e, t, r) { (r = t.exports = e(\"./lib/_stream_readable.js\")).Stream = r, r.Readable = r, r.Writable = e(\"./lib/_stream_writable.js\"), r.Duplex = e(\"./lib/_stream_duplex.js\"), r.Transform = e(\"./lib/_stream_transform.js\"), r.PassThrough = e(\"./lib/_stream_passthrough.js\"), r.finished = e(\"./lib/internal/streams/end-of-stream.js\"), r.pipeline = e(\"./lib/internal/streams/pipeline.js\") }, { \"./lib/_stream_duplex.js\": 52, \"./lib/_stream_passthrough.js\": 53, \"./lib/_stream_readable.js\": 54, \"./lib/_stream_transform.js\": 55, \"./lib/_stream_writable.js\": 56, \"./lib/internal/streams/end-of-stream.js\": 60, \"./lib/internal/streams/pipeline.js\": 62 }], 66: [function (e, t, r) { \"use strict\"; t.exports = function () { if (\"function\" != typeof arguments[0]) throw new Error(\"callback needed\"); if (\"number\" != typeof arguments[1]) throw new Error(\"interval needed\"); var e; if (arguments.length > 0) { e = new Array(arguments.length - 2); for (var t = 0; t < e.length; t++)e[t] = arguments[t + 2] } return new function (e, t, r) { var n = this; this._callback = e, this._args = r, this._interval = setInterval(e, t, this._args), this.reschedule = function (e) { e || (e = n._interval), n._interval && clearInterval(n._interval), n._interval = setInterval(n._callback, e, n._args) }, this.clear = function () { n._interval && (clearInterval(n._interval), n._interval = void 0) }, this.destroy = function () { n._interval && clearInterval(n._interval), n._callback = void 0, n._interval = void 0, n._args = void 0 } }(arguments[0], arguments[1], e) } }, {}], 67: [function (e, t, r) { var n = e(\"buffer\"), i = n.Buffer; function o(e, t) { for (var r in e) t[r] = e[r] } function s(e, t, r) { return i(e, t, r) } i.from && i.alloc && i.allocUnsafe && i.allocUnsafeSlow ? t.exports = n : (o(n, r), r.Buffer = s), s.prototype = Object.create(i.prototype), o(i, s), s.from = function (e, t, r) { if (\"number\" == typeof e) throw new TypeError(\"Argument must not be a number\"); return i(e, t, r) }, s.alloc = function (e, t, r) { if (\"number\" != typeof e) throw new TypeError(\"Argument must be a number\"); var n = i(e); return void 0 !== t ? \"string\" == typeof r ? n.fill(t, r) : n.fill(t) : n.fill(0), n }, s.allocUnsafe = function (e) { if (\"number\" != typeof e) throw new TypeError(\"Argument must be a number\"); return i(e) }, s.allocUnsafeSlow = function (e) { if (\"number\" != typeof e) throw new TypeError(\"Argument must be a number\"); return n.SlowBuffer(e) } }, { buffer: 14 }], 68: [function (e, t, r) { t.exports = function (e) { var t = e._readableState; return t ? t.objectMode || \"number\" == typeof e._duplexState ? e.read() : e.read((r = t, r.buffer.length ? r.buffer.head ? r.buffer.head.data.length : r.buffer[0].length : r.length)) : null; var r } }, {}], 69: [function (e, t, r) { arguments[4][29][0].apply(r, arguments) }, { dup: 29, \"safe-buffer\": 67 }], 70: [function (e, t, r) { (function (t, n) { (function () { var i = e(\"process/browser.js\").nextTick, o = Function.prototype.apply, s = Array.prototype.slice, a = {}, u = 0; function c(e, t) { this._id = e, this._clearFn = t } r.setTimeout = function () { return new c(o.call(setTimeout, window, arguments), clearTimeout) }, r.setInterval = function () { return new c(o.call(setInterval, window, arguments), clearInterval) }, r.clearTimeout = r.clearInterval = function (e) { e.close() }, c.prototype.unref = c.prototype.ref = function () { }, c.prototype.close = function () { this._clearFn.call(window, this._id) }, r.enroll = function (e, t) { clearTimeout(e._idleTimeoutId), e._idleTimeout = t }, r.unenroll = function (e) { clearTimeout(e._idleTimeoutId), e._idleTimeout = -1 }, r._unrefActive = r.active = function (e) { clearTimeout(e._idleTimeoutId); var t = e._idleTimeout; t >= 0 && (e._idleTimeoutId = setTimeout(function () { e._onTimeout && e._onTimeout() }, t)) }, r.setImmediate = \"function\" == typeof t ? t : function (e) { var t = u++, n = !(arguments.length < 2) && s.call(arguments, 1); return a[t] = !0, i(function () { a[t] && (n ? e.apply(null, n) : e.call(null), r.clearImmediate(t)) }), t }, r.clearImmediate = \"function\" == typeof n ? n : function (e) { delete a[e] } }).call(this) }).call(this, e(\"timers\").setImmediate, e(\"timers\").clearImmediate) }, { \"process/browser.js\": 46, timers: 70 }], 71: [function (e, t, r) { \"use strict\"; var n = e(\"punycode\"), i = e(\"./util\"); function o() { this.protocol = null, this.slashes = null, this.auth = null, this.host = null, this.port = null, this.hostname = null, this.hash = null, this.search = null, this.query = null, this.pathname = null, this.path = null, this.href = null } r.parse = _, r.resolve = function (e, t) { return _(e, !1, !0).resolve(t) }, r.resolveObject = function (e, t) { return e ? _(e, !1, !0).resolveObject(t) : t }, r.format = function (e) { i.isString(e) && (e = _(e)); return e instanceof o ? e.format() : o.prototype.format.call(e) }, r.Url = o; var s = /^([a-z0-9.+-]+:)/i, a = /:[0-9]*$/, u = /^(\\/\\/?(?!\\/)[^\\?\\s]*)(\\?[^\\s]*)?$/, c = [\"{\", \"}\", \"|\", \"\\\\\", \"^\", \"`\"].concat([\"<\", \">\", '\"', \"`\", \" \", \"\\r\", \"\\n\", \"\\t\"]), l = [\"'\"].concat(c), f = [\"%\", \"/\", \"?\", \";\", \"#\"].concat(l), h = [\"/\", \"?\", \"#\"], p = /^[+a-z0-9A-Z_-]{0,63}$/, d = /^([+a-z0-9A-Z_-]{0,63})(.*)$/, g = { javascript: !0, \"javascript:\": !0 }, b = { javascript: !0, \"javascript:\": !0 }, m = { http: !0, https: !0, ftp: !0, gopher: !0, file: !0, \"http:\": !0, \"https:\": !0, \"ftp:\": !0, \"gopher:\": !0, \"file:\": !0 }, y = e(\"querystring\"); function _(e, t, r) { if (e && i.isObject(e) && e instanceof o) return e; var n = new o; return n.parse(e, t, r), n } o.prototype.parse = function (e, t, r) { if (!i.isString(e)) throw new TypeError(\"Parameter 'url' must be a string, not \" + typeof e); var o = e.indexOf(\"?\"), a = -1 !== o && o < e.indexOf(\"#\") ? \"?\" : \"#\", c = e.split(a); c[0] = c[0].replace(/\\\\/g, \"/\"); var _ = e = c.join(a); if (_ = _.trim(), !r && 1 === e.split(\"#\").length) { var w = u.exec(_); if (w) return this.path = _, this.href = _, this.pathname = w[1], w[2] ? (this.search = w[2], this.query = t ? y.parse(this.search.substr(1)) : this.search.substr(1)) : t && (this.search = \"\", this.query = {}), this } var v = s.exec(_); if (v) { var S = (v = v[0]).toLowerCase(); this.protocol = S, _ = _.substr(v.length) } if (r || v || _.match(/^\\/\\/[^@\\/]+@[^@\\/]+/)) { var E = \"//\" === _.substr(0, 2); !E || v && b[v] || (_ = _.substr(2), this.slashes = !0) } if (!b[v] && (E || v && !m[v])) { for (var k, I, C = -1, T = 0; T < h.length; T++) { -1 !== (x = _.indexOf(h[T])) && (-1 === C || x < C) && (C = x) } -1 !== (I = -1 === C ? _.lastIndexOf(\"@\") : _.lastIndexOf(\"@\", C)) && (k = _.slice(0, I), _ = _.slice(I + 1), this.auth = decodeURIComponent(k)), C = -1; for (T = 0; T < f.length; T++) { var x; -1 !== (x = _.indexOf(f[T])) && (-1 === C || x < C) && (C = x) } -1 === C && (C = _.length), this.host = _.slice(0, C), _ = _.slice(C), this.parseHost(), this.hostname = this.hostname || \"\"; var R = \"[\" === this.hostname[0] && \"]\" === this.hostname[this.hostname.length - 1]; if (!R) for (var A = this.hostname.split(/\\./), M = (T = 0, A.length); T < M; T++) { var O = A[T]; if (O && !O.match(p)) { for (var P = \"\", B = 0, L = O.length; B < L; B++)O.charCodeAt(B) > 127 ? P += \"x\" : P += O[B]; if (!P.match(p)) { var j = A.slice(0, T), U = A.slice(T + 1), N = O.match(d); N && (j.push(N[1]), U.unshift(N[2])), U.length && (_ = \"/\" + U.join(\".\") + _), this.hostname = j.join(\".\"); break } } } this.hostname.length > 255 ? this.hostname = \"\" : this.hostname = this.hostname.toLowerCase(), R || (this.hostname = n.toASCII(this.hostname)); var q = this.port ? \":\" + this.port : \"\", D = this.hostname || \"\"; this.host = D + q, this.href += this.host, R && (this.hostname = this.hostname.substr(1, this.hostname.length - 2), \"/\" !== _[0] && (_ = \"/\" + _)) } if (!g[S]) for (T = 0, M = l.length; T < M; T++) { var F = l[T]; if (-1 !== _.indexOf(F)) { var W = encodeURIComponent(F); W === F && (W = escape(F)), _ = _.split(F).join(W) } } var H = _.indexOf(\"#\"); -1 !== H && (this.hash = _.substr(H), _ = _.slice(0, H)); var V = _.indexOf(\"?\"); if (-1 !== V ? (this.search = _.substr(V), this.query = _.substr(V + 1), t && (this.query = y.parse(this.query)), _ = _.slice(0, V)) : t && (this.search = \"\", this.query = {}), _ && (this.pathname = _), m[S] && this.hostname && !this.pathname && (this.pathname = \"/\"), this.pathname || this.search) { q = this.pathname || \"\"; var K = this.search || \"\"; this.path = q + K } return this.href = this.format(), this }, o.prototype.format = function () { var e = this.auth || \"\"; e && (e = (e = encodeURIComponent(e)).replace(/%3A/i, \":\"), e += \"@\"); var t = this.protocol || \"\", r = this.pathname || \"\", n = this.hash || \"\", o = !1, s = \"\"; this.host ? o = e + this.host : this.hostname && (o = e + (-1 === this.hostname.indexOf(\":\") ? this.hostname : \"[\" + this.hostname + \"]\"), this.port && (o += \":\" + this.port)), this.query && i.isObject(this.query) && Object.keys(this.query).length && (s = y.stringify(this.query)); var a = this.search || s && \"?\" + s || \"\"; return t && \":\" !== t.substr(-1) && (t += \":\"), this.slashes || (!t || m[t]) && !1 !== o ? (o = \"//\" + (o || \"\"), r && \"/\" !== r.charAt(0) && (r = \"/\" + r)) : o || (o = \"\"), n && \"#\" !== n.charAt(0) && (n = \"#\" + n), a && \"?\" !== a.charAt(0) && (a = \"?\" + a), t + o + (r = r.replace(/[?#]/g, function (e) { return encodeURIComponent(e) })) + (a = a.replace(\"#\", \"%23\")) + n }, o.prototype.resolve = function (e) { return this.resolveObject(_(e, !1, !0)).format() }, o.prototype.resolveObject = function (e) { if (i.isString(e)) { var t = new o; t.parse(e, !1, !0), e = t } for (var r = new o, n = Object.keys(this), s = 0; s < n.length; s++) { var a = n[s]; r[a] = this[a] } if (r.hash = e.hash, \"\" === e.href) return r.href = r.format(), r; if (e.slashes && !e.protocol) { for (var u = Object.keys(e), c = 0; c < u.length; c++) { var l = u[c]; \"protocol\" !== l && (r[l] = e[l]) } return m[r.protocol] && r.hostname && !r.pathname && (r.path = r.pathname = \"/\"), r.href = r.format(), r } if (e.protocol && e.protocol !== r.protocol) { if (!m[e.protocol]) { for (var f = Object.keys(e), h = 0; h < f.length; h++) { var p = f[h]; r[p] = e[p] } return r.href = r.format(), r } if (r.protocol = e.protocol, e.host || b[e.protocol]) r.pathname = e.pathname; else { for (var d = (e.pathname || \"\").split(\"/\"); d.length && !(e.host = d.shift());); e.host || (e.host = \"\"), e.hostname || (e.hostname = \"\"), \"\" !== d[0] && d.unshift(\"\"), d.length < 2 && d.unshift(\"\"), r.pathname = d.join(\"/\") } if (r.search = e.search, r.query = e.query, r.host = e.host || \"\", r.auth = e.auth, r.hostname = e.hostname || e.host, r.port = e.port, r.pathname || r.search) { var g = r.pathname || \"\", y = r.search || \"\"; r.path = g + y } return r.slashes = r.slashes || e.slashes, r.href = r.format(), r } var _ = r.pathname && \"/\" === r.pathname.charAt(0), w = e.host || e.pathname && \"/\" === e.pathname.charAt(0), v = w || _ || r.host && e.pathname, S = v, E = r.pathname && r.pathname.split(\"/\") || [], k = (d = e.pathname && e.pathname.split(\"/\") || [], r.protocol && !m[r.protocol]); if (k && (r.hostname = \"\", r.port = null, r.host && (\"\" === E[0] ? E[0] = r.host : E.unshift(r.host)), r.host = \"\", e.protocol && (e.hostname = null, e.port = null, e.host && (\"\" === d[0] ? d[0] = e.host : d.unshift(e.host)), e.host = null), v = v && (\"\" === d[0] || \"\" === E[0])), w) r.host = e.host || \"\" === e.host ? e.host : r.host, r.hostname = e.hostname || \"\" === e.hostname ? e.hostname : r.hostname, r.search = e.search, r.query = e.query, E = d; else if (d.length) E || (E = []), E.pop(), E = E.concat(d), r.search = e.search, r.query = e.query; else if (!i.isNullOrUndefined(e.search)) { if (k) r.hostname = r.host = E.shift(), (R = !!(r.host && r.host.indexOf(\"@\") > 0) && r.host.split(\"@\")) && (r.auth = R.shift(), r.host = r.hostname = R.shift()); return r.search = e.search, r.query = e.query, i.isNull(r.pathname) && i.isNull(r.search) || (r.path = (r.pathname ? r.pathname : \"\") + (r.search ? r.search : \"\")), r.href = r.format(), r } if (!E.length) return r.pathname = null, r.search ? r.path = \"/\" + r.search : r.path = null, r.href = r.format(), r; for (var I = E.slice(-1)[0], C = (r.host || e.host || E.length > 1) && (\".\" === I || \"..\" === I) || \"\" === I, T = 0, x = E.length; x >= 0; x--)\".\" === (I = E[x]) ? E.splice(x, 1) : \"..\" === I ? (E.splice(x, 1), T++) : T && (E.splice(x, 1), T--); if (!v && !S) for (; T--; T)E.unshift(\"..\"); !v || \"\" === E[0] || E[0] && \"/\" === E[0].charAt(0) || E.unshift(\"\"), C && \"/\" !== E.join(\"/\").substr(-1) && E.push(\"\"); var R, A = \"\" === E[0] || E[0] && \"/\" === E[0].charAt(0); k && (r.hostname = r.host = A ? \"\" : E.length ? E.shift() : \"\", (R = !!(r.host && r.host.indexOf(\"@\") > 0) && r.host.split(\"@\")) && (r.auth = R.shift(), r.host = r.hostname = R.shift())); return (v = v || r.host && E.length) && !A && E.unshift(\"\"), E.length ? r.pathname = E.join(\"/\") : (r.pathname = null, r.path = null), i.isNull(r.pathname) && i.isNull(r.search) || (r.path = (r.pathname ? r.pathname : \"\") + (r.search ? r.search : \"\")), r.auth = e.auth || r.auth, r.slashes = r.slashes || e.slashes, r.href = r.format(), r }, o.prototype.parseHost = function () { var e = this.host, t = a.exec(e); t && (\":\" !== (t = t[0]) && (this.port = t.substr(1)), e = e.substr(0, e.length - t.length)), e && (this.hostname = e) } }, { \"./util\": 72, punycode: 47, querystring: 50 }], 72: [function (e, t, r) { \"use strict\"; t.exports = { isString: function (e) { return \"string\" == typeof e }, isObject: function (e) { return \"object\" == typeof e && null !== e }, isNull: function (e) { return null === e }, isNullOrUndefined: function (e) { return null == e } } }, {}], 73: [function (e, t, r) { (function (e) { (function () { function r(t) { try { if (!e.localStorage) return !1 } catch (e) { return !1 } var r = e.localStorage[t]; return null != r && \"true\" === String(r).toLowerCase() } t.exports = function (e, t) { if (r(\"noDeprecation\")) return e; var n = !1; return function () { if (!n) { if (r(\"throwDeprecation\")) throw new Error(t); r(\"traceDeprecation\") ? console.trace(t) : console.warn(t), n = !0 } return e.apply(this, arguments) } } }).call(this) }).call(this, \"undefined\" != typeof global ? global : \"undefined\" != typeof self ? self : \"undefined\" != typeof window ? window : {}) }, {}], 74: [function (e, t, r) { t.exports = function e(t, r) { if (t && r) return e(t)(r); if (\"function\" != typeof t) throw new TypeError(\"need wrapper function\"); Object.keys(t).forEach(function (e) { n[e] = t[e] }); return n; function n() { for (var e = new Array(arguments.length), r = 0; r < e.length; r++)e[r] = arguments[r]; var n = t.apply(this, e), i = e[e.length - 1]; return \"function\" == typeof n && n !== i && Object.keys(i).forEach(function (e) { n[e] = i[e] }), n } } }, {}], 75: [function (e, t, r) { \"use strict\"; t.exports = function () { throw new Error(\"ws does not work in the browser. Browser clients must use the native WebSocket object\") } }, {}], 76: [function (e, t, r) { t.exports = function () { for (var e = {}, t = 0; t < arguments.length; t++) { var r = arguments[t]; for (var i in r) n.call(r, i) && (e[i] = r[i]) } return e }; var n = Object.prototype.hasOwnProperty }, {}] }, {}, [9])(9) });",""],"parameterObjects":"","useStrict":true,"eventsSheetExpanded":false}],"parameters":[],"objectGroups":[]},{"fullName":"","functionType":"Action","name":"onScenePostEvents","sentence":"","events":[{"type":"BuiltinCommonInstructions::JsCode","inlineCode":["// Remove the messages of the last frame for no dataloss mode","Object","    .values(gdjs.evtTools.mqtt.events)","    .forEach((event, index) => {","        if (Array.isArray(event.data))","            event.data.shift();","        else event.data = gdjs.evtTools.mqtt.empty;","    });",""],"parameterObjects":"","useStrict":true,"eventsSheetExpanded":false}],"parameters":[],"objectGroups":[]},{"description":"Triggers if the client is connected to an MQTT broker server.","fullName":"Is connected to a broker?","functionType":"Condition","name":"isConnected","sentence":"Client connected to a broker","events":[{"type":"BuiltinCommonInstructions::JsCode","inlineCode":["eventsFunctionContext.returnValue =","    gdjs.evtTools.mqtt.connection && gdjs.evtTools.mqtt.connection.connected;",""],"parameterObjects":"","useStrict":true,"eventsSheetExpanded":false}],"parameters":[],"objectGroups":[]},{"description":"Connects to an MQTT broker. ","fullName":"Connect to a broker","functionType":"Action","name":"connect","sentence":"Connect to MQTT broker _PARAM1_ with parameters _PARAM2_ (secure connection: _PARAM3_)","events":[{"type":"BuiltinCommonInstructions::JsCode","inlineCode":["// Parse settings","const settings = eventsFunctionContext.getArgument(\"settings\");","let settingsParsed;","if (settings.length > 2)","    try {","        settingsParsed = JSON.parse(settings);","    } catch (e) {","        settingsParsed = {}","        console.error(\"Invalid settings: \", settings, \", Error:\", e);","    };","","// Connect to broker","gdjs.evtTools.mqtt.connection = mqtt.connect(","    (eventsFunctionContext.getArgument(\"secure\")","        ? \"wss://\"","        : \"ws://\")","    + eventsFunctionContext.getArgument(\"host\"),","    settingsParsed",");","","// Set up listeners","gdjs.evtTools.mqtt.connection.on(\"message\", (channel, message) => {","    if (typeof gdjs.evtTools.mqtt.events[channel] === undefined) {","        gdjs.evtTools.mqtt.events[channel] = {","            loss: false,","            data: [message],","        };","        return;","    }","","    const mqttEvent = gdjs.evtTools.mqtt.events[channel];","    if (mqttEvent.loss) {","        mqttEvent.data = message;","    } else {","        if (!Array.isArray(mqttEvent.data)) mqttEvent.data = [];","        mqttEvent.data.push(message);","    }","});","","gdjs.evtTools.mqtt.connection.on(\"error\", function (e) {","    gdjs.evtTools.mqtt.lastError = e;","});",""],"parameterObjects":"","useStrict":true,"eventsSheetExpanded":true}],"parameters":[{"description":"Host port","name":"host","type":"string"},{"description":"Settings as JSON","longDescription":"You can find the list of settings at [the MQTT.js docs](https://github.com/mqttjs/MQTT.js/#client).  \nAn example of valid configuration would be `\"{\\\"clientId\\\": \\\"myUserName\\\"}\"`.","name":"settings","type":"string"},{"description":"Use secure WebSockets?","name":"secure","type":"yesorno"}],"objectGroups":[]},{"description":"Disconnects from the current MQTT broker.","fullName":"Disconnect from broker","functionType":"Action","name":"disconnect","sentence":"Disconnect from MQTT broker (force: _PARAM1_)","events":[{"type":"BuiltinCommonInstructions::JsCode","inlineCode":["if (gdjs.evtTools.mqtt.connection === null) return;","gdjs.evtTools.mqtt.connection.end(eventsFunctionContext.getArgument(\"force\"));","gdjs.evtTools.mqtt.connection = null;",""],"parameterObjects":"","useStrict":true,"eventsSheetExpanded":false}],"parameters":[{"description":"Force end the connection?","longDescription":"By default, MQTT waits for pending messages or messages in the process of being sent to finish being sent before ending the connection. Use this to cancel any request and immediately shutdown the connection.","name":"force","type":"yesorno"}],"objectGroups":[]},{"description":"Publishes a message on a topic.","fullName":"Publish message","functionType":"Action","name":"publish","sentence":"Publish variable _PARAM1_ on topic _PARAM2_ (QoS: _PARAM3_)","events":[{"type":"BuiltinCommonInstructions::JsCode","inlineCode":["if (gdjs.evtTools.mqtt.connection === null) return;","gdjs.evtTools.mqtt.connection.publish(","    eventsFunctionContext.getArgument(\"topic\"),","    eventsFunctionContext.getArgument(\"content\"),","    { qos: eventsFunctionContext.getArgument(\"QoS\"), retain: eventsFunctionContext.getArgument(\"retain\") }",");",""],"parameterObjects":"","useStrict":true,"eventsSheetExpanded":false}],"parameters":[{"description":"Text to publish","name":"content","type":"string"},{"description":"Topic to publish to","name":"topic","type":"string"},{"description":"The QoS","longDescription":"See [this](https://github.com/mqttjs/MQTT.js#qos) for more details.","name":"QoS","type":"expression"},{"description":"Should the message be retained?","longDescription":"When a message is retained, it will be sent to every client that subscribe to the topic. Only one message can be retained per topic, if another retained message is sent it will overwrite the previous one.  \nRead more [here](https://www.hivemq.com/blog/mqtt-essentials-part-8-retained-messages/#retained-messages).","name":"retain","type":"yesorno"}],"objectGroups":[]},{"description":"Subcribe to a topic. All messages published on that topic will be received.","fullName":"Subscribe to a topic","functionType":"Action","name":"subscribe","sentence":"Subscribe to topic _PARAM1_ with QoS at _PARAM2_ and dataloss _PARAM3_","events":[{"type":"BuiltinCommonInstructions::JsCode","inlineCode":["if (gdjs.evtTools.mqtt.connection === null) return;","","const topic = eventsFunctionContext.getArgument(\"topic\");","if (typeof gdjs.evtTools.mqtt.events[topic] === \"undefined\") gdjs.evtTools.mqtt.events[topic] = { data: eventsFunctionContext.getArgument(\"dataloss\") ? \"\" : [] };","gdjs.evtTools.mqtt.events[topic].loss = eventsFunctionContext.getArgument(\"dataloss\");","","gdjs.evtTools.mqtt.connection.subscribe(","    topic,","    { qos: eventsFunctionContext.getArgument(\"QoS\") }",");",""],"parameterObjects":"","useStrict":true,"eventsSheetExpanded":false}],"parameters":[{"description":"The topic to subscribe to","name":"topic","type":"string"},{"description":"The QoS","longDescription":"See https://github.com/mqttjs/MQTT.js#qos for more details","name":"QoS","type":"expression"},{"description":"Is dataloss allowed?","longDescription":"See https://wiki.gdevelop.io/gdevelop5/all-features/p2p#choosing_if_you_want_to_activate_data_loss_mode for more details","name":"dataloss","type":"yesorno"}],"objectGroups":[]},{"description":"Unsubcribe from a topic. No more messages from this topic will be received.","fullName":"Unsubscribe from a topic","functionType":"Action","name":"unsubscribe","sentence":"Unsubscribe from topic _PARAM1_","events":[{"type":"BuiltinCommonInstructions::JsCode","inlineCode":["if (gdjs.evtTools.mqtt.connection !== null)","    gdjs.evtTools.mqtt.connection.unsubscribe(","        eventsFunctionContext.getArgument(\"topic\")","    );",""],"parameterObjects":"","useStrict":true,"eventsSheetExpanded":false}],"parameters":[{"description":"The topic to subscribe to","name":"topic","type":"string"}],"objectGroups":[]},{"description":"Triggers whenever a message was received. Note that you first need to subcribe to a topic in order to get messages from it.","fullName":"On message","functionType":"Condition","name":"onMessage","sentence":"Message received from topic _PARAM1_","events":[{"type":"BuiltinCommonInstructions::JsCode","inlineCode":["const mqttEvent = gdjs.evtTools.mqtt.events[eventsFunctionContext.getArgument(\"topic\")];\r","if (typeof mqttEvent === \"undefined\" || typeof mqttEvent.data === \"undefined\") return;\r","eventsFunctionContext.returnValue =\r","    Array.isArray(mqttEvent.data)\r","        ? mqttEvent.data.length !== 0\r","        : mqttEvent.data !== gdjs.evtTools.mqtt.empty;\r",""],"parameterObjects":"","useStrict":true,"eventsSheetExpanded":false}],"parameters":[{"description":"The topic to listen to","name":"topic","type":"string"}],"objectGroups":[]},{"description":"Get the last received message of a topic.","fullName":"Get last message","functionType":"StringExpression","name":"GetLastMessage","sentence":"","events":[{"type":"BuiltinCommonInstructions::JsCode","inlineCode":["const mqttEvent = gdjs.evtTools.mqtt.events[eventsFunctionContext.getArgument(\"topic\")];","if (typeof mqttEvent === \"undefined\") return;","eventsFunctionContext.returnValue = Array.isArray(mqttEvent.data)","    ? mqttEvent.data[0]","    : mqttEvent.data;",""],"parameterObjects":"","useStrict":true,"eventsSheetExpanded":false}],"expressionType":{"type":"string"},"parameters":[{"description":"The topic to get the message from","name":"topic","type":"string"}],"objectGroups":[]},{"description":"Gets the last error. Returns an empty string if there was no errors.","fullName":"Get the last error","functionType":"StringExpression","name":"getCurrentError","sentence":"","events":[{"type":"BuiltinCommonInstructions::JsCode","inlineCode":"eventsFunctionContext.returnValue = gdjs.evtTools.mqtt.lastError","parameterObjects":"","useStrict":true,"eventsSheetExpanded":false}],"expressionType":{"type":"string"},"parameters":[],"objectGroups":[]}],"eventsBasedBehaviors":[],"eventsBasedObjects":[]}],"externalLayouts":[],"externalSourceFiles":[]}